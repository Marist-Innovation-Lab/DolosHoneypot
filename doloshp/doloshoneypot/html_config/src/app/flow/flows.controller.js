define(["app/flow/flows.module","jquery","footable","app/flow/flows.services","common/general/common.general.filters"],function(e,t){e.register.controller("rootFlowCtrl",["$rootScope","$scope",function(e,t){e.section_logo="logo_flow",t.getText=function(e){return e.innerText||e.textContent}}]),e.register.controller("ListAllFlowCtrl",["$scope","FlowSvc",function(e,n){e.svc=n,n.getAll(null).then(function(t){e.data=t}),t("table").footable().on("click",".row-delete",function(n){n.preventDefault();var r=t("table").data("footable"),i=t(this).parents("tr:first");e.svc.delete(e.getText(i[0].cells[0]),e.getText(i[0].cells[3]),e.getText(i[0].cells[4])),r.removeRow(i)}),e.$on("ngRepeatFinished",function(e){t("table").trigger("footable_setup_paging")})}]),e.register.controller("ListNodeFlowCtrl",["$scope","FlowSvc",function(e,t){t.nodeflowUrl(null,e.$stateParams.nodeType,e.$stateParams.nodeId).getList().then(function(t){e.flow=t.flowConfig})}]),e.register.controller("ShowDetailCtrl",["$scope","FlowSvc","$stateParams",function(e,t,n){t.staticFlowUrl(null,n.nodeType,n.nodeId,n.flowName).get().then(function(t){e.flow=t})}]),e.register.controller("EditStateCtrl",["$scope","FlowSvc","$stateParams","SwitchSvc",function(e,n,r,i){e.actionActive=[],e.chosedOptions=[],e.setupActions=function(){t.each(e.chosedOptions,function(t,n){n.type!==undefined?e.flow.actions.push(n.name+"="+n.value):e.flow.actions.push(n.name)})},e.changeOptions=function(n){var r=-1;t.each(e.actionOptions,function(e,t){if(t.displayName==n)return r=e,!1}),e.actionOptions[r].hidden=!0,t("#actions")[0].selectedIndex=0,e.actionActive="";if(e.actionOptions[r].type!==undefined){var i=prompt(e.actionOptions[r].help);e.actionOptions[r].value=i}e.chosedOptions.push(e.actionOptions[r]),e.setupActions()},e.$watch("nodeString",function(t,n,r){if(!t)return;var s=e.nodeString.split("/");e.flow.node={type:s[0],id:s[1]},delete e.flow.ingressPort,delete e.connectors,i.nodeUrl(null,e.flow.node.type,e.flow.node.id).get().then(function(t){e.connectors=t})}),i.nodesUrl().getList().then(function(t){e.nodes=t}),e.actionOptions=[{displayName:"Please add an action"},{name:"DROP",displayName:"Drop"},{name:"LOOPBACK",displayName:"Loopback"},{name:"FLOOD",displayName:"Flood"},{name:"SW_PATH",displayName:"Software Path"},{name:"HW_PATH",displayName:"Hardware Path"},{name:"CONTROLLER",displayName:"Controller"},{name:"OUTPUT",displayName:"Add Output Ports"},{name:"SET_VLAN_ID",displayName:"Set VLAN ID",help:"Set VLAN ID",type:"text",placeholder:"VLAN Identification Number"},{name:"SET_VLAN_PCP",displayName:"Set VLAN Priority",help:"Set VLAN Priority",type:"text",placeholder:"VLAN Priority"},{name:"POP_VLAN",displayName:"Strip VLAN Header"},{name:"SET_DL_SRC",displayName:"Modify Datalayer Source Address",help:"Set Source MAC Address",type:"text",placeholder:"Source MAC Address"},{name:"SET_DL_DST",displayName:"Modify Datalayer Destination Address",help:"Set Destination MAC Address",type:"text",placeholder:"Destination MAC Address"},{name:"SET_NW_SRC",displayName:"Modify Network Source Address",help:"Set IP Source Address",type:"text",placeholder:"Source IP Address"},{name:"SET_NW_DST",displayName:"Modify Network Destination Address",help:"Set IP Destination Address",type:"text",placeholder:"Destination IP Address"},{name:"SET_NW_TOS",displayName:"Modify ToS Bits",help:"Set IPv4 ToS",type:"text",placeholder:"IPv4 ToS"},{name:"SET_TP_SRC",displayName:"Modify Transport Source Port",help:"Set Transport Source Port",type:"text",placeholder:"Transport Source Port"},{name:"SET_TP_DST",displayName:"Set Transport Destination Port",type:"text",help:"Set Transport Destination Port",placeholder:"Transport Destination Port"}],n.staticFlowUrl(null,r.nodeType,r.nodeId,r.flowName).get().then(function(t){e.flow=t}),e.setupActions()}]),e.register.controller("FlowCreateCtrl",["$scope","$http","FlowSvc","SwitchSvc","$state",function(e,n,r,i,s){e.flow={installInHw:!0},e.actionOptions=[{displayName:"Please add an action"},{name:"DROP",displayName:"Drop"},{name:"LOOPBACK",displayName:"Loopback"},{name:"FLOOD",displayName:"Flood"},{name:"SW_PATH",displayName:"Software Path"},{name:"HW_PATH",displayName:"Hardware Path"},{name:"CONTROLLER",displayName:"Controller"},{name:"OUTPUT",displayName:"Add Output Ports"},{name:"SET_VLAN_ID",displayName:"Set VLAN ID",help:"Set VLAN ID",type:"text",placeholder:"VLAN Identification Number"},{name:"SET_VLAN_PCP",displayName:"Set VLAN Priority",help:"Set VLAN Priority",type:"text",placeholder:"VLAN Priority"},{name:"POP_VLAN",displayName:"Strip VLAN Header"},{name:"SET_DL_SRC",displayName:"Modify Datalayer Source Address",help:"Set Source MAC Address",type:"text",placeholder:"Source MAC Address"},{name:"SET_DL_DST",displayName:"Modify Datalayer Destination Address",help:"Set Destination MAC Address",type:"text",placeholder:"Destination MAC Address"},{name:"SET_NW_SRC",displayName:"Modify Network Source Address",help:"Set IP Source Address",type:"text",placeholder:"Source IP Address"},{name:"SET_NW_DST",displayName:"Modify Network Destination Address",help:"Set IP Destination Address",type:"text",placeholder:"Destination IP Address"},{name:"SET_NW_TOS",displayName:"Modify ToS Bits",help:"Set IPv4 ToS",type:"text",placeholder:"IPv4 ToS"},{name:"SET_TP_SRC",displayName:"Modify Transport Source Port",help:"Set Transport Source Port",type:"text",placeholder:"Transport Source Port"},{name:"SET_TP_DST",displayName:"Set Transport Destination Port",type:"text",help:"Set Transport Destination Port",placeholder:"Transport Destination Port"}],e.actionActive=[],e.chosedOptions=[],e.flow.actions=[],e.setupActions=function(){e.flow.actions=[],t.each(e.chosedOptions,function(t,n){n.type!==undefined?e.flow.actions.push(n.name+"="+n.value):e.flow.actions.push(n.name)})},e.changeOptions=function(n){var r=-1;t.each(e.actionOptions,function(e,t){if(t.displayName==n)return r=e,!1}),e.actionOptions[r].hidden=!0,t("#actions")[0].selectedIndex=0,e.actionActive="";if(e.actionOptions[r].type!==undefined){var i=prompt(e.actionOptions[r].help);e.actionOptions[r].value=i}e.chosedOptions.push(e.actionOptions[r]),e.setupActions()},i.nodesUrl().getList().then(function(t){e.nodes=t}),e.$watch("nodeString",function(t,n,r){if(!t)return;var s=e.nodeString.split("/");e.flow.node={type:s[0],id:s[1]},delete e.flow.ingressPort,delete e.connectors,i.nodeUrl(null,e.flow.node.type,e.flow.node.id).get().then(function(t){e.connectors=t})}),e.submit=function(){r.staticFlowUrl(null,e.flow.node.type,e.flow.node.id,e.flow.name).customPUT(e.flow).then(function(e){s.transitionTo("flow.index",null,{location:!0,inherit:!0,relative:s.$current,notify:!0})},function(t){e.error=t.data})}}]),e.controller("FlowCompositionCtrl",["$scope","$state",function(e,n){Array.prototype.removeValue=function(e,n){var r=t.map(this,function(t,r){return t[e]===n?null:t});this.length=0,this.push.apply(this,r)},Array.prototype.getIndex=function(n,r){var i=-1;return t.each(e.actionOptions,function(e,t){t[n]==r&&(i=e)}),i},t("table").footable().on("click",".row-delete",function(n){n.preventDefault();var r=t("table").data("footable"),i=t(this).parents("tr:first");e.actionOptions[e.actionOptions.getIndex("displayName",e.getText(i[0].cells[0]))].hidden=!1,e.chosedOptions.removeValue("displayName",e.getText(i[0].cells[0])),r.removeRow(i),e.setupActions(),e.$apply()})}])});