define(["common/yangutils/yangutils.module"],function(e){e.factory("YangUtilsRestangular",["Restangular","ENV",function(e,t){return e.withConfig(function(e){e.setBaseUrl(t.getBaseURL("MD_SAL"))})}]),e.factory("arrayUtils",function(){var e={};return e.getFirstElementByCondition=function(e,t){var n=e&&t?e.filter(function(e){return t(e)}):[];return n.length?n[0]:null},e}),e.factory("pathUtils",["arrayUtils",function(e){var t={},n="..",r=function(e,t,n){this.name=e,this.module=t,this.identifierName=n,this.identifierValue="",this.hasIdentifier=function(){return n?!0:!1},this.toString=function(){return(this.module?this.module+":":"")+this.name+"/"+(this.hasIdentifier()?this.identifierValue+"/":"")},this.checkNode=function(e){return(this.module?this.module===e.module:!0)&&(this.name?this.name===e.label:!0)}},i=function(e,t){return e.indexOf(":")>-1?e.split(":"):[t,e]},s=function(e){return e.indexOf("{")===e.indexOf("}")==0},o=function(e,t,n,s){var o=i(e,s),u=n&&o[0]!==s?n(o[0]):o[0],a=o[1];return new r(a,u,t)};return t.search=function(r,i){var s=i.shift(),o=s.name===n?r.parent:e.getFirstElementByCondition(r.children,function(e){return s.checkNode(e)});return o!==null?i.length?t.search(o,i):o:null},t.translate=function(e,t,n){var r=n,i=e.split("/").filter(function(e){return e!==""}).slice(),u=i.map(function(e,n){if(s(e))return null;var u,a;return i.length>n+1&&s(i[n+1])&&(u=i[n+1].slice(1,-1)),a=o(e,u,t,r),a}).filter(function(e){return e!==null});return u},t.__test={PathElem:r,getModuleNodePair:i,isIdentifier:s,createPathElement:o},t}]),e.factory("syncFact",["$timeout",function(e){var t=1e4,n=function(){this.runningRequests=[],this.reqId=0,this.timeElapsed=0,this.spawnRequest=function(e){var t=e+(this.reqId++).toString();return this.runningRequests.push(t),t},this.removeRequest=function(e){var t=this.runningRequests.indexOf(e);t>-1?this.runningRequests.splice(t,1):console.warn("cannot remove request",e,"from",this.runningRequests,"index is",t)},this.waitFor=function(n){var r=1e3,i=this.runningRequests.length,s=this;i>0&&s.timeElapsed<t?e(function(){s.timeElapsed=s.timeElapsed+r,s.waitFor(n)},r):n()}};return{generateObj:function(){return new n}}}]),e.factory("custFunct",["reqBuilder",function(e){var t=function(e,t,n){this.label=e,this.callback=n,this.setCallback=function(e){this.callback=e},this.runCallback=function(){this.callback?this.callback():console.warn("no callback set for custom functionality",this.label)}};return custFunct={},custFunct.createNewFunctionality=function(e,n,r){if(n&&r)return new t(e,n,r);console.error("no node or callback is set for custom functionality")},custFunct}]),e.factory("reqBuilder",function(){var e="flow-node-inventory",t={namespace:e,createObj:function(){return{}},createList:function(){return[]},insertObjToList:function(e,t){e.push(t)},insertPropertyToObj:function(e,t,n){var r=n?n:{},i=t;e[i]=r},resultToString:function(e){return JSON.stringify(e,null,4)}};return t}),e.factory("nodeWrapper",["constants","$timeout","reqBuilder",function(e,t,n){var r=function(t,n){return(t.indexOf(":")>-1?t.split(":")[1]:t)===n},i=function(e,t){var n=e.length===t.length&&e.length>0;if(n){var r=0;while(r<e.length&&n){var i=e[r]===t[r];n=n&&i,r++}}return n},s=function(e,t,n){var r=function(e,t,n){return e&&e.hasOwnProperty(t)?e[t]:e&&e.hasOwnProperty(n+":"+t)?e[n+":"+t]:null},s=function(e,t){return t.map(function(t){return r(e,t.label,t.module)}).filter(function(e){return e!==null})},o=s(e,n);return keyValuesB=s(t,n),i(o,keyValuesB)},o=function(e,t){var n=[],r=[];return e.forEach(function(e,i){var o=r.filter(function(r){var i=s(e,r.item,t);return i&&n.indexOf(r.index)===-1&&n.push(r.index),i});o.length?n.push(i):r.push({index:i,item:e})}),n},u={wrap:function(e){this.hasOwnProperty(e.type)&&this[e.type](e)},wrapAll:function(e){var t=this;t.wrap(e),e.children.forEach(function(e){t.wrapAll(e)})},leaf:function(t){t.value="";var n=function(e){var n="";try{n=e.toString()}catch(r){console.warn("cannot convert value",t.value)}return n};t.buildRequest=function(e,r){var i="";return i=n(t.value),i?(e.insertPropertyToObj(r,t.label,i),!0):!1},t.fill=function(e,n){var i=r(e,t.label);return i&&(t.value=n),i},t.clear=function(){t.value="",t.nodeType=e.NODE_UI_DISPLAY},t.isFilled=function(){var e=n(t.value)?!0:!1;return e}},container:function(t){t.expanded=!1,t.toggleExpand=function(){t.expanded=!t.expanded},t.buildRequest=function(n,r){var i=!1,s=t.label,o=n.createObj();return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).length?t.getChildrenByNodeType(e.NODE_UI_DISPLAY).forEach(function(e){var t=e.buildRequest(n,o);i=i||t}):i=!0,i&&n.insertPropertyToObj(r,s,o),i},t.fill=function(n,i){var s=r(n,t.label),o=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);return s&&o.length&&(o.forEach(function(e){for(var t in i)e.fill(t,i[t])}),t.expanded=!0),s},t.clear=function(){var n=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);t.nodeType=e.NODE_UI_DISPLAY,n.length&&n.forEach(function(e){e.clear()})},t.isFilled=function(){return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).some(function(e){return e.isFilled()})}},rpc:function(t){t.expanded=!0,t.buildRequest=function(n,r){var i=!1,s=t.label;return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).length?t.getChildrenByNodeType(e.NODE_UI_DISPLAY).forEach(function(e){var t=e.buildRequest(n,r);i=i||t}):i=!0,i},t.fill=function(n,r){var i=!1,s=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);return s.forEach(function(e){var t=e.fill(n,r);i=i||t}),t.expanded=i,i},t.clear=function(){var n=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);t.nodeType=e.NODE_UI_DISPLAY,n.length&&n.forEach(function(e){e.clear()})},t.isFilled=function(){return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).some(function(e){return e.isFilled()})}},input:function(t){t.expanded=!0,t.buildRequest=function(n,r){var i=!1,s=t.label,o=n.createObj();return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).length?t.getChildrenByNodeType(e.NODE_UI_DISPLAY).forEach(function(e){var t=e.buildRequest(n,o);i=i||t}):i=!0,i&&n.insertPropertyToObj(r,s,o),i},t.fill=function(n,i){var s=r(n,t.label),o=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);return s&&o.length&&(o.forEach(function(e){for(var t in i)e.fill(t,i[t])}),t.expanded=!0),s},t.clear=function(){var n=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);t.nodeType=e.NODE_UI_DISPLAY,n.length&&n.forEach(function(e){e.clear()})},t.isFilled=function(){return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).some(function(e){return e.isFilled()})}},output:function(t){t.expanded=!0,t.buildRequest=function(n,r){var i=!1,s=t.label,o=n.createObj();return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).length?t.getChildrenByNodeType(e.NODE_UI_DISPLAY).forEach(function(e){var t=e.buildRequest(n,o);i=i||t}):i=!0,i&&n.insertPropertyToObj(r,s,o),i},t.fill=function(n,i){var s=r(n,t.label),o=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);return s&&o.length&&(o.forEach(function(e){for(var t in i)e.fill(t,i[t])}),t.expanded=!0),s},t.clear=function(){var n=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);t.nodeType=e.NODE_UI_DISPLAY,n.length&&n.forEach(function(e){e.clear()})},t.isFilled=function(){return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).some(function(e){return e.isFilled()})}},"case":function(t){t.buildRequest=function(n,r){var i=!1;return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).forEach(function(e){var t=e.buildRequest(n,r);i=i||t}),i},t.fill=function(n,r){var i=!1,s=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);return s.forEach(function(e){var t=e.fill(n,r);i=i||t}),i},t.clear=function(){var n=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);t.nodeType=e.NODE_UI_DISPLAY,n.forEach(function(e){e.clear()})},t.isFilled=function(){return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).some(function(e){return e.isFilled()})}},choice:function(t){t.choice=null,t.expanded=!0,t.buildRequest=function(e,n){var r;return t.choice&&(r=t.choice.buildRequest(e,n)),r},t.fill=function(n,r){var i=!1,s=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);return s.forEach(function(e){var s=e.fill(n,r);s&&(t.choice=e),i=i||s;if(i)return!1}),i},t.clear=function(){t.nodeType=e.NODE_UI_DISPLAY,t.choice&&(t.choice.clear(),t.choice=null)},t.isFilled=function(){return t.choice!==null}},"leaf-list":function(t){t.value=[],t.expanded=!0,t.toggleExpand=function(){t.expanded=!t.expanded},t.addListElem=function(){var e={value:""};t.value.push(e)},t.removeListElem=function(e){t.value.splice(t.value.indexOf(e),1)},t.buildRequest=function(e,n){var r=[];for(var i=0;i<t.value.length;i++)r.push(t.value[i].value);return r.length>0?(e.insertPropertyToObj(n,t.label,r),!0):!1},t.fill=function(e,n){var i=r(e,t.label),s;if(i)for(var o=0;o<n.length;o++)s={value:n[o]},t.value.push(s);return i},t.clear=function(){t.nodeType=e.NODE_UI_DISPLAY,t.value=[]},t.isFilled=function(){return t.value.length>0}},key:function(t){if(t.parent.hasOwnProperty("refKey")){var n=t.label.split(" ");t.parent.refKey=t.parent.getChildrenByNodeType(e.NODE_UI_DISPLAY).filter(function(e){return n.indexOf(e.label)>-1})}},list:function(t){t.refKey=[],t.doubleKeyIndexes=[],t.actElemStructure=null,t.actElemIndex=-1,t.listData=[],t.expanded=!0,t.toggleExpand=function(){t.expanded=!t.expanded},t.createStructure=function(){if(t.actElemStructure===null){var e=t.deepCopy();u._listElem(e),t.actElemStructure=e}},t.addListElem=function(){t.createStructure();var e={};t.listData.push(e),t.changeActElementData(t.listData.length-1)},t.buildActElemData=function(){var e=[],r;return t.actElemStructure&&(t.actElemStructure.listElemBuildRequest(n,e),r=e[0]?e[0]:{}),r},t.changeActElementData=function(e){var n=t.buildActElemData();t.expanded=!0,t.actElemIndex>-1&&(t.listData[t.actElemIndex]=n),t.actElemIndex=e;var r=t.listData[t.actElemIndex];t.actElemStructure.clear();for(var i in r)t.actElemStructure.fillListElement(i,r[i])},t.removeListElem=function(e){t.listData.splice(e,1),t.actElemIndex=t.listData.length-1;if(t.actElemIndex===-1)t.actElemStructure=null;else{var n=t.listData[t.actElemIndex];t.actElemStructure.clear();for(var r in n)t.actElemStructure.fillListElement(r,n[r])}},t.buildRequest=function(e,n){var r=!1,i=t.buildActElemData();t.actElemIndex>-1&&(t.listData[t.actElemIndex]=i),r=t.listData.filter(function(e){return $.isEmptyObject(e)===!1}).length>0;var s=t.listData.slice().map(function(e){return e&&e.hasOwnProperty("$$hashKey")&&delete e.$$hashKey,e});return t.doubleKeyIndexes=o(t.listData,t.refKey),r&&e.insertPropertyToObj(n,t.label,s),r},t.fill=function(e,n){var i=r(e,t.label);if(i&&n.length){t.createStructure(),t.listData=n.slice(),t.actElemIndex=t.listData.length-1;for(var s in t.listData[t.actElemIndex])t.actElemStructure.fillListElement(s,t.listData[t.actElemIndex][s])}return i&&n.length>0},t.clear=function(){while(t.listData.length>0)t.listData.pop();t.actElemIndex=-1,t.actElemStructure=null,t.nodeType=e.NODE_UI_DISPLAY},t.isFilled=function(){return t.listData.length>0},t.createListName=function(e){var n="",r="";return e>-1&&t.refKey.forEach(function(i){$.isEmptyObject(t.listData[e])||(r=t.listData[e][i.label]?i.label+":"+t.listData[e][i.label]:t.listData[e][i.module+":"+i.label]?i.label+":"+t.listData[e][i.module+":"+i.label]:"",n=n?n+(r?" "+r:""):n+(r?" <"+r:""))}),n&&(n+=">"),n}},_listElem:function(t){t.listElemBuildRequest=function(n,r){var i=!1,s=n.createObj();return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).forEach(function(e){var t=e.buildRequest(n,s);i=i||t}),i&&n.insertObjToList(r,s),i},t.fillListElement=function(n,r){var i=!1;return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).forEach(function(e){var t=e.fill(n,r);i=i||t}),i},t.isFilled=function(){return t.getChildrenByNodeType(e.NODE_UI_DISPLAY).some(function(e){return e.isFilled()})},t.clear=function(){var n=t.getChildrenByNodeType(e.NODE_UI_DISPLAY);t.nodeType=e.NODE_UI_DISPLAY,n.length&&n.forEach(function(e){e.clear()})},t.children.forEach(function(e){u.wrapAll(e)})}};return u.__test={comparePropToElemByName:r,equalArrays:i,equalListElems:s,checkListElemKeys:o},u}]),e.factory("yinParser",["$http","syncFact","constants","arrayUtils","pathUtils",function(e,t,n,r,i){var s="augment",o="./assets",u=function(e,t,n,r,i,s,o,a){this.id=e,this.label=t,this.localeLabel="YANGUI_"+t.toUpperCase(),this.type=n,this.module=r,this.children=[],this.parent=s,this.nodeType=o,this.namespace=i,this.moduleRevision=a,this.allChildrenCount=function(){var e=0,t=function(n){e+=n.children.length,n.children.forEach(function(e){t(e)})};t(this),alert(e)},this.appendTo=function(e){e.children.push(this)},this.deepCopy=function(){var t=new u(this.id,this.label,this.type,this.module,this.namespace,null,this.nodeType,this.moduleRevision);return this.children.forEach(function(e){var n=e.deepCopy();n.parent=t,t.children.push(n)}),t},this.getChildrenByNodeType=function(e){return e instanceof Array?this.children.filter(function(t){return e.indexOf(t.nodeType)>-1}):this.children.filter(function(t){return t.nodeType===e})},this.getChildren=function(e,t,n,r){var i=this.children.filter(function(r){return(t?t===r.label:!0)&&(e?e===r.type:!0)&&(n?n===r.nodeType:!0)});return r?i.filter(function(e){return e.hasOwnProperty(r)}).map(function(e){return e[r]}):i}},a=function(e){this.node=e,this.path=e.path?e.path:[],this.apply=function(e){var t=this.getTargetNodeToAugment(e);t?this.node.children.forEach(function(e){e.appendTo(t)}):console.warn("can't find target node for augmentation "+this.getPathString())},this.getTargetNodeToAugment=function(e){return i.search({children:e},this.path.slice())},this.getPathString=function(){return this.path.map(function(e){return e.module+":"+e.name}).join("/")}},f=function(e){return e.get(0).tagName.toLowerCase()==="module"?e.get(0):f(e.parent())},l=function(n,r,i){var s=new c;e.get(o+n).success(function(e){var t=$($.parseXML(e).documentElement).attr("name"),n=$($.parseXML(e)).find("namespace").attr("uri"),i=$($.parseXML(e)).find("revision").attr("date");s.setCurrentModule(t),s.setCurrentNamespace(n),s.setModuleRevision(i),s.parse($.parseXML(e).documentElement,null,!1),s.sync.waitFor(function(){r(s.getRoots(),s.getAugments())})}).error(function(){return console.warn("can't find module: "+n),i(),null})},c=function(){this.currentModule=null,this.currentNamespace=null,this.rootNodes=[],this.nodeIndex=0,this.sync=t.generateObj(),this.moduleRevision=null,this.getRoots=function(){return this.rootNodes.filter(function(e){return e.type!==s})},this.getAugments=function(){return this.rootNodes.filter(function(e){return e.type===s}).map(function(e){return new a(e)})},this.setCurrentModule=function(e){this.currentModule=e?e:null},this.setCurrentNamespace=function(e){if(e){var t=e.split(":");t.splice(0,1),this.currentNamespace=t.join("-")}else this.currentNamespace=null},this.setModuleRevision=function(e){this.moduleRevision=e?e:null},this.getNamespace=function(e){if(e){var t=e.split(":");return t.splice(0,1),t.join("-")}return null},this.createNewNode=function(e,t,n,r,i,s){var o=null;return n?(o=new u(this.nodeIndex++,e,t,this.currentModule,i!==null?i:n.namespace,n,r,s!==null?s:n.moduleRevision),n.children.push(o)):(o=new u(this.nodeIndex++,e,t,this.currentModule,this.currentNamespace,n,r,this.moduleRevision),this.rootNodes.push(o)),o},this.parse=function(e,t,n){var r=this;$(e).children().each(function(e,i){var s=i.tagName.toLowerCase();r.hasOwnProperty(s)&&r[s](i,t,n)})},this.leaf=function(e,t,r){var i="leaf",s=$(e).attr("name"),o=n.NODE_UI_DISPLAY,u=null,a=null;u=this._namespace(e,r),a=this._revision(e,r);var f=this.createNewNode(s,i,t,o,u,a);this.parse(e,f,r)},this["leaf-list"]=function(e,t,r){var i="leaf-list",s=$(e).attr("name"),o=n.NODE_UI_DISPLAY,u=null,a=null,f;u=this._namespace(e,r),a=this._revision(e,r),f=this.createNewNode(s,i,t,o,u,a),this.parse(e,f,r)},this.container=function(e,t,r){var i="container",s=$(e).attr("name"),o=n.NODE_UI_DISPLAY,u=null,a=null;u=this._namespace(e,r),a=this._revision(e,r);if($(e).children().length===0)this.createNewNode(s,i,t,o,u,a);else{var f=this.createNewNode(s,i,t,o,u,a);this.parse(e,f,r)}},this.choice=function(e,t,r){var i="choice",s=$(e).attr("name"),o=this,u=n.NODE_UI_DISPLAY,a=null,f=null,l=null;f=this._namespace(e,r),l=this._revision(e,r),a=this.createNewNode(s,i,t,u,f,l),this.parse(e,a,r)},this.case=function(e,t,r){var i="case",s=$(e).attr("name"),o=n.NODE_UI_DISPLAY,u=null,a=null,f=null;a=this._namespace(e,r),f=this._revision(e,r),u=this.createNewNode(s,i,t,o,a,f),this.parse(e,u,r)},this.list=function(e,t,r){var i="list",s=$(e).attr("name"),o=n.NODE_UI_DISPLAY,u=null,a=null,f=null;a=this._namespace(e,r),f=this._revision(e,r),u=this.createNewNode(s,i,t,o,a,f),this.parse(e,u,r)},this.key=function(e,t,r){var i="key",s=$(e).attr("value"),o=n.NODE_ALTER,u=null,a=null;u=this._namespace(e,r),a=this._revision(e,r),this.createNewNode(s,i,t,o,u,a)},this.description=function(e,t,r){var i="description",s=$(e).children("text:first").text(),o=n.NODE_ALTER,u=null,a=null;u=this._namespace(e,r),a=this._revision(e,r),this.createNewNode(s,i,t,o,u,a)},this._grouping=function(e,t,n,r){var i=this;$(e).children("grouping[name='"+n+"']").each(function(){i.parse(this,t,r)})},this.uses=function(t,n,r){var i=this,s=$(t),u=s.attr("name"),a=u.split(":"),l;if(a[1]===undefined)i._grouping(f(s),n,a[0],!1);else{l=i._import(f(s),a[0]);if(l.moduleName){var c=i.sync.spawnRequest(l.moduleName);e.get(o+"/yang2xml/"+l.fileName+".yang.xml").success(function(e){i._grouping($.parseXML(e).documentElement,n,a[1],!0),i.sync.removeRequest(c)})}}},this._namespace=function(e,t){var n=$(e),r=null;if(t){r=$(f(n)).find("namespace").attr("uri");if(r){var i=r.split(":");i.splice(0,1),r=i.join("-")}}return r},this._revision=function(e,t){var n=$(e),r=null;return t&&(r=$(f(n)).find("revision").attr("date"),r||(r=null)),r},this._import=function(e,t){var n=this,r,i,s={};return $(e).children("import").each(function(){var e=$(this),n=$(e.children("prefix[value='"+t+"']"));r=n.parent().attr("module");if(r)return i=e.children("revision-date").attr("date"),!1}),i?s={moduleName:r,revisionDate:i,fileName:r}:s={moduleName:r,revisionDate:i,fileName:r},s},this.augment=function(e,t,r){var o=s,u=n.NODE_ALTER,a=this,l=function(t){return a._import(f($(e)),t).moduleName},c=$(e).attr("target-node"),h=i.translate(c,l,this.currentModule),p=null,d=null,v=null;d=this._namespace(e,r),v=this._revision(e,r),p=this.createNewNode(c,o,null,u,d,v),p.path=h,this.parse(e,p,r)},this.rpc=function(e,t,r){var i="rpc",s=$(e).attr("name"),o=n.NODE_UI_DISPLAY,u=null,a=null,f=null;a=this._namespace(e,r),f=this._revision(e,r),u=this.createNewNode(s,i,t,o,a,f),this.parse(e,u,r)},this.input=function(e,t,r){var i="input",s="input",o=n.NODE_UI_DISPLAY,u=null,a=null,f=null;a=this._namespace(e,r),f=this._revision(e,r),u=this.createNewNode(s,i,t,o,a,f),this.parse(e,u,r)},this.output=function(e,t,r){var i="output",s="output",o=n.NODE_UI_DISPLAY,u=null,a=null,f=null;a=this._namespace(e,r),f=this._revision(e,r),u=this.createNewNode(s,i,t,o,a,f),this.parse(e,u,r)}};return{parse:l,__test:{path:o,parentTag:f,yangParser:new c,Augmentation:a}}}]),e.factory("apiConnector",["$http","syncFact","arrayUtils","pathUtils","custFunct","Base64","$window",function(e,t,n,r,i,s,o){var u={},a="Basic "+s.encode(o.sessionStorage.odlUser+":"+o.sessionStorage.odlPass),f={withCredentials:!0,headers:{Authorization:a}},l=function(e){var t=e.map(function(e){return e.toString()}).join("");return t.slice(0,-1)},c=function(e,t){this.node=null,this.pathTemplateString=e,this.pathArray=[],this.operations=t,this.custFunct=[],this.hasSetData=function(){return this.node!==null&&this.pathArray.length>0},this.setNode=function(e){this.node=e},this.setPathArray=function(e){this.pathArray=e},this.buildApiRequestString=function(){return l(this.pathArray)},this.addCustomFunctionality=function(e,t){var n=i.createNewFunctionality(e,this.node,t);n&&this.custFunct.push(n)}},h=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("(");return{module:e.slice(t+1,n),revision:e.slice(n+1,-1)}};u.processApis=function(n,r){var i=[],s=t.generateObj();n.forEach(function(t){var n=h(t.path),r=s.spawnRequest(t.path),o={module:n.module,revision:n.revision};e.get(t.path,f).success(function(e){var t=[];e.apis.forEach(function(e){var n=e.operations.map(function(e){return e.method}),r=new c(e.path,n);t.push(r)}),o.basePath=e.basePath,o.subApis=t,s.removeRequest(r)}).error(function(){s.removeRequest(r)}),i.push(o)}),s.waitFor(function(){r(i)})};var p=function(e,t,r){var i=n.getFirstElementByCondition(r,function(n){return n.module===e&&n.label===t});return i||console.warn("cannot find root node for module",e,"label",t),i};return u.linkApisToNodes=function(e,t){return e.map(function(e){return e.subApis=e.subApis.map(function(e){var n=r.translate(e.pathTemplateString,null,null),i=n&&n.length>1?p(n[1].module,n[1].name,t):null;return i&&n&&(e.setNode(n.length>2?r.search(i,n.slice(2)):i),e.setPathArray(n)),e}).filter(function(e){return e.hasSetData()}),e})},u.createCustomFunctionalityApis=function(e,t,n,r,i,s){e=e.map(function(e){return(t?e.module===t:!0)&&(n?e.revision===n:!0)&&(e.subApis=e.subApis.map(function(e){return e.pathTemplateString===r&&e.addCustomFunctionality(i,s),e})),e})},u.__test={apiPathElemsToString:l,parseApiPath:h,getRootNodeByPath:p,SubApi:c},u}]),e.factory("yangUtils",["$http","yinParser","nodeWrapper","reqBuilder","syncFact","apiConnector","constants","pathUtils","YangUtilsRestangular","Base64","$window",function(e,t,n,r,i,s,o,u,a,f,l){var c={},h="Basic "+f.encode(l.sessionStorage.odlUser+":"+l.sessionStorage.odlPass),p={withCredentials:!0,headers:{Authorization:h}};return c.exportModulesLocales=function(e){var t={},n=["leaf","list","container","choice","leaf-list","rpc","input","output"],r=function i(e){n.indexOf(e.type)>=0&&t.hasOwnProperty(e.localeLabel)===!1&&(t[e.localeLabel]=e.label),e.children.forEach(function(e){i(e)})};return e.forEach(function(e){r(e)}),JSON.stringify(t,null,4)},c.generateNodesToApis=function(t,n){var r=[],o=[],u=i.generateObj(),f=u.spawnRequest("apis"),l=u.spawnRequest("all"),h="/apidocs/apis/";e.get(a.configuration.baseUrl+h,p).success(function(e){s.processApis(e.apis,function(e){o=e,u.removeRequest(f)})}).error(function(e){console.error("Error getting API data from :"+a.configuration.baseUrl+h+":"+e),u.removeRequest(f)});var d="/restconf/modules/";e.get(a.configuration.baseUrl+d,p).success(function(e){r=c.processModules(e.modules,function(e){r=e,u.removeRequest(l)})}).error(function(e){console.error("Error getting API data:",e),u.removeRequest(l)}),u.waitFor(function(){try{t(s.linkApisToNodes(o,r),r)}catch(e){throw n(e),e}})},c.generateApiTreeData=function(t,n){var s=[],o=i.generateObj();s=t.map(function(e,t){var n=function(e,t){var n=[];return e.subApis.map(function(e,r){var i=0,s=function(e,t,n,r,o){var u=null,a,f=null,l=function(e,t){var n={};return n.label=e[i-1].name,n.identifier=e[i-1].identifierName!==undefined?" {"+e[i-1].identifierName+"}":"",n.children=[],t.push(n),t};i++;if(i-1<e.length){t.length>0?(a=!1,t.map(function(t,n){t.label===e[i-1].name&&(a=!0,u=n)}),a||(t=l(e,t))):t=l(e,t),f=u!==null?u:t.length-1;var c=s(e,t[f].children,n,r,o);return c.length||(t[f].indexApi=r,t[f].indexSubApi=n),t[f].children=c,t}return[]};n=s(e.pathArray,n,r,t,e)}),n},r=n(e,t);return{label:e.module+" rev."+e.revision,children:r}}),s.forEach(function(n){var i=function(e){var n=null;if(e.hasOwnProperty("indexApi")&&e.hasOwnProperty("indexSubApi")&&t[e.indexApi].subApis[e.indexSubApi].operations.indexOf("PUT")>-1)n={api:e.indexApi,subApi:e.indexSubApi};else if(e.children.length&&n===null){var r=null;for(var s=0;s<e.children.length&&n===null;s++)n=i(e.children[s])}return n},s=i(n),u=function(t,i){var s=function(e){var t=e.getChildren("leaf"),n=!1,r,i;if(t.length&&e.type==="list")e.addListElem(),e.actElemStructure.getChildren("leaf")[0].value="0",n=!0;else if(t.length)t[0].value="0",n=!0;else if(t.length===0&&e.type==="list"){r=!1;for(i=0;i<e.actElemStructure.children.length&&!r;i++)r=s(e.actElemStructure.children[i]);n=r}else{r=!1;for(i=0;i<e.children.length&&!r;i++)r=s(e.children[i]);n=r}return n},u={},a=t.basePath+"/"+i.buildApiRequestString(),f=o.spawnRequest(a);s(i.node),i.node.buildRequest(r,u),e({method:"PUT",url:a,data:u,headers:{"Content-Type":"application/yang.data+json"}}).success(function(e){o.removeRequest(f)}).error(function(e,t){n.toRemove=!0,o.removeRequest(f)})};s?u(t[s.api],t[s.api].subApis[s.subApi]):n.toRemove=!0}),o.waitFor(function(){n(s.filter(function(e){return!e.hasOwnProperty("toRemove")}))})},c.processModules=function(e,r){var s=[],o=[],u=i.generateObj();e.module.forEach(function(e){var n=u.spawnRequest(e.name);t.parse("/yang2xml/"+e.name+".yang.xml",function(e,t){e.length&&(s=s.concat(e)),t.length&&(o=o.concat(t)),u.removeRequest(n)},function(){u.removeRequest(n)})}),u.waitFor(function(){console.info(s.length+" modules loaded",s),console.info(o.length+" augments loaded",o);var e=o.sort(function(e,t){return e.path.length-t.path.length});e.map(function(e){e.apply(s)}),r(s.map(function(e){var t=e.deepCopy();return n.wrapAll(t),t}))})},c.buildRequest=function(e){var t=r.createObj();return e.buildRequest(r,t),t.flows},c.getRequestString=function(e){var t=r.createObj(),n="";return e.buildRequest(r,t),t&&$.isEmptyObject(t)===!1&&(n=r.resultToString(t)),n},c.transformTopologyData=function(e){var t=[],n=[],r=function(t,n){var r=t.filter(function(e,t){return e.label===n}),i;return r.length>0&&r[0]?(i=r[0].id,i):null};if(e["network-topology"]&&e["network-topology"].topology.length){var i=e["network-topology"].topology[0],s=0,o=0;n=i.hasOwnProperty("node")?i.node.map(function(e){return{id:(s++).toString(),label:e["node-id"],group:"switch",value:20,title:"Name: <b>"+e["node-id"]+"</b><br>Type: Switch"}}):[],t=i.hasOwnProperty("link")?i.link.map(function(e){var t=r(n,e.source["source-node"]),i=r(n,e.destination["dest-node"]),s=e.source["source-tp"],u=e.destination["dest-tp"];if(t!=null&&i!=null)return{id:(o++).toString(),from:t,to:i,title:"Source Port: <b>"+s+"</b><br>Dest Port: <b>"+u+"</b>"}}):[]}return{nodes:n,links:t}},c.__test={},c}]),e.factory("constants",function(){return{NODE_UI_DISPLAY:1,NODE_ALTER:2,NODE_CONDITIONAL:3}})});