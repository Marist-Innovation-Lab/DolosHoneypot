/**
 * vis.js
 * https://github.com/almende/vis
 *
 * A dynamic, browser-based visualization library.
 *
 * @version 2.0.0
 * @date    2014-06-19
 *
 * @license
 * Copyright (C) 2011-2014 Almende B.V, http://almende.com
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */

!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.vis=e()}}(function(){var define,module,exports;return function t(e,n,r){function i(o,u){if(!n[o]){if(!e[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(require,module,exports){function DataSet(e,t){if(!e||Array.isArray(e)||util.isDataTable(e)||(t=e,e=null),this._options=t||{},this._data={},this._fieldId=this._options.fieldId||"id",this._type={},this._options.type)for(var n in this._options.type)if(this._options.type.hasOwnProperty(n)){var r=this._options.type[n];this._type[n]="Date"==r||"ISODate"==r||"ASPDate"==r?"Date":r}if(this._options.convert)throw new Error('Option "convert" is deprecated. Use "type" instead.');this._subscribers={},e&&this.add(e)}function DataView(e,t){this._data=null,this._ids={},this._options=t||{},this._fieldId="id",this._subscribers={};var n=this;this.listener=function(){n._onEvent.apply(n,arguments)},this.setData(e)}function TimeStep(e,t,n){this.current=new Date,this._start=new Date,this._end=new Date,this.autoScale=!0,this.scale=TimeStep.SCALE.DAY,this.step=1,this.setRange(e,t,n)}function Range(e,t){var n=moment().hours(0).minutes(0).seconds(0).milliseconds(0);this.start=n.clone().add("days",-3).valueOf(),this.end=n.clone().add("days",4).valueOf(),this.body=e,this.defaultOptions={start:null,end:null,direction:"horizontal",moveable:!0,zoomable:!0,min:null,max:null,zoomMin:10,zoomMax:31536e10},this.options=util.extend({},this.defaultOptions),this.props={touch:{}},this.body.emitter.on("dragstart",this._onDragStart.bind(this)),this.body.emitter.on("drag",this._onDrag.bind(this)),this.body.emitter.on("dragend",this._onDragEnd.bind(this)),this.body.emitter.on("hold",this._onHold.bind(this)),this.body.emitter.on("mousewheel",this._onMouseWheel.bind(this)),this.body.emitter.on("DOMMouseScroll",this._onMouseWheel.bind(this)),this.body.emitter.on("touch",this._onTouch.bind(this)),this.body.emitter.on("pinch",this._onPinch.bind(this)),this.setOptions(t)}function validateDirection(e){if("horizontal"!=e&&"vertical"!=e)throw new TypeError('Unknown direction "'+e+'". Choose "horizontal" or "vertical".')}function getPointer(e,t){return{x:e.pageX-vis.util.getAbsoluteLeft(t),y:e.pageY-vis.util.getAbsoluteTop(t)}}function Component(){this.options=null,this.props=null}function TimeAxis(e,t){this.dom={foreground:null,majorLines:[],majorTexts:[],minorLines:[],minorTexts:[],redundant:{majorLines:[],majorTexts:[],minorLines:[],minorTexts:[]}},this.props={range:{start:0,end:0,minimumStep:0},lineTop:0},this.defaultOptions={orientation:"bottom",showMinorLabels:!0,showMajorLabels:!0},this.options=util.extend({},this.defaultOptions),this.body=e,this._create(),this.setOptions(t)}function CurrentTime(e,t){this.body=e,this.defaultOptions={showCurrentTime:!0},this.options=util.extend({},this.defaultOptions),this._create(),this.setOptions(t)}function CustomTime(e,t){this.body=e,this.defaultOptions={showCustomTime:!1},this.options=util.extend({},this.defaultOptions),this.customTime=new Date,this.eventParams={},this._create(),this.setOptions(t)}function ItemSet(e,t){this.body=e,this.defaultOptions={type:"box",orientation:"bottom",align:"center",stack:!0,groupOrder:null,selectable:!0,editable:{updateTime:!1,updateGroup:!1,add:!1,remove:!1},onAdd:function(e,t){t(e)},onUpdate:function(e,t){t(e)},onMove:function(e,t){t(e)},onRemove:function(e,t){t(e)},margin:{item:10,axis:20},padding:5},this.options=util.extend({},this.defaultOptions),this.itemOptions={type:{start:"Date",end:"Date"}},this.conversion={toScreen:e.util.toScreen,toTime:e.util.toTime},this.dom={},this.props={},this.hammer=null;var n=this;this.itemsData=null,this.groupsData=null,this.itemListeners={add:function(e,t){n._onAdd(t.items)},update:function(e,t){n._onUpdate(t.items)},remove:function(e,t){n._onRemove(t.items)}},this.groupListeners={add:function(e,t){n._onAddGroups(t.items)},update:function(e,t){n._onUpdateGroups(t.items)},remove:function(e,t){n._onRemoveGroups(t.items)}},this.items={},this.groups={},this.groupIds=[],this.selection=[],this.stackDirty=!0,this.touchParams={},this._create(),this.setOptions(t)}function Item(e,t,n){this.id=null,this.parent=null,this.data=e,this.dom=null,this.conversion=t||{},this.options=n||{},this.selected=!1,this.displayed=!1,this.dirty=!0,this.top=null,this.left=null,this.width=null,this.height=null}function ItemBox(e,t,n){if(this.props={dot:{width:0,height:0},line:{width:0,height:0}},e&&void 0==e.start)throw new Error('Property "start" missing in item '+e);Item.call(this,e,t,n)}function ItemPoint(e,t,n){if(this.props={dot:{top:0,width:0,height:0},content:{height:0,marginLeft:0}},e&&void 0==e.start)throw new Error('Property "start" missing in item '+e);Item.call(this,e,t,n)}function ItemRange(e,t,n){if(this.props={content:{width:0}},e){if(void 0==e.start)throw new Error('Property "start" missing in item '+e.id);if(void 0==e.end)throw new Error('Property "end" missing in item '+e.id)}Item.call(this,e,t,n)}function ItemRangeOverflow(e,t,n){this.props={content:{left:0,width:0}},ItemRange.call(this,e,t,n)}function Group(e,t,n){this.groupId=e,this.itemSet=n,this.dom={},this.props={label:{width:0,height:0}},this.className=null,this.items={},this.visibleItems=[],this.orderedItems={byStart:[],byEnd:[]},this._create(),this.setData(t)}function Timeline(e,t,n){var r=this;this.defaultOptions={start:null,end:null,autoResize:!0,orientation:"bottom",width:null,height:null,maxHeight:null,minHeight:null},this.options=util.deepExtend({},this.defaultOptions),this._create(e),this.components=[],this.body={dom:this.dom,domProps:this.props,emitter:{on:this.on.bind(this),off:this.off.bind(this),emit:this.emit.bind(this)},util:{snap:null,toScreen:r._toScreen.bind(r),toTime:r._toTime.bind(r)}},this.range=new Range(this.body),this.components.push(this.range),this.body.range=this.range,this.timeAxis=new TimeAxis(this.body),this.components.push(this.timeAxis),this.body.util.snap=this.timeAxis.snap.bind(this.timeAxis),this.currentTime=new CurrentTime(this.body),this.components.push(this.currentTime),this.customTime=new CustomTime(this.body),this.components.push(this.customTime),this.itemSet=new ItemSet(this.body),this.components.push(this.itemSet),this.itemsData=null,this.groupsData=null,n&&this.setOptions(n),t?this.setItems(t):this.redraw()}function Node(e,t,n,r){this.selected=!1,this.hover=!1,this.edges=[],this.dynamicEdges=[],this.reroutedEdges={},this.group=r.nodes.group,this.fontSize=Number(r.nodes.fontSize),this.fontFace=r.nodes.fontFace,this.fontColor=r.nodes.fontColor,this.fontDrawThreshold=3,this.color=r.nodes.color,this.id=void 0,this.shape=r.nodes.shape,this.image=r.nodes.image,this.x=null,this.y=null,this.xFixed=!1,this.yFixed=!1,this.horizontalAlignLeft=!0,this.verticalAlignTop=!0,this.radius=r.nodes.radius,this.baseRadiusValue=r.nodes.radius,this.radiusFixed=!1,this.radiusMin=r.nodes.radiusMin,this.radiusMax=r.nodes.radiusMax,this.level=-1,this.preassignedLevel=!1,this.imagelist=t,this.grouplist=n,this.fx=0,this.fy=0,this.vx=0,this.vy=0,this.minForce=r.minForce,this.damping=r.physics.damping,this.mass=1,this.fixedData={x:null,y:null},this.setProperties(e,r),this.resetCluster(),this.dynamicEdgesLength=0,this.clusterSession=0,this.clusterSizeWidthFactor=r.clustering.nodeScaling.width,this.clusterSizeHeightFactor=r.clustering.nodeScaling.height,this.clusterSizeRadiusFactor=r.clustering.nodeScaling.radius,this.maxNodeSizeIncrements=r.clustering.maxNodeSizeIncrements,this.growthIndicator=0,this.graphScaleInv=1,this.graphScale=1,this.canvasTopLeft={x:-300,y:-300},this.canvasBottomRight={x:300,y:300},this.parentEdgeId=null}function Edge(e,t,n){if(!t)throw"No graph provided";this.graph=t,this.widthMin=n.edges.widthMin,this.widthMax=n.edges.widthMax,this.id=void 0,this.fromId=void 0,this.toId=void 0,this.style=n.edges.style,this.title=void 0,this.width=n.edges.width,this.hoverWidth=n.edges.hoverWidth,this.value=void 0,this.length=n.physics.springLength,this.customLength=!1,this.selected=!1,this.hover=!1,this.smooth=n.smoothCurves,this.arrowScaleFactor=n.edges.arrowScaleFactor,this.from=null,this.to=null,this.via=null,this.originalFromId=[],this.originalToId=[],this.connected=!1,this.dash=util.extend({},n.edges.dash),this.color={color:n.edges.color.color,highlight:n.edges.color.highlight,hover:n.edges.color.hover},this.widthFixed=!1,this.lengthFixed=!1,this.setProperties(e,n),this.controlNodesEnabled=!1,this.controlNodes={from:null,to:null,positions:{}},this.connectedNode=null}function Popup(e,t,n,r,i){this.container=e?e:document.body,void 0===i&&("object"==typeof t?(i=t,t=void 0):"object"==typeof r?(i=r,r=void 0):i={fontColor:"black",fontSize:14,fontFace:"verdana",color:{border:"#666",background:"#FFFFC6"}}),this.x=0,this.y=0,this.padding=5,void 0!==t&&void 0!==n&&this.setPosition(t,n),void 0!==r&&this.setText(r),this.frame=document.createElement("div");var s=this.frame.style;s.position="absolute",s.visibility="hidden",s.border="1px solid "+i.color.border,s.color=i.fontColor,s.fontSize=i.fontSize+"px",s.fontFamily=i.fontFace,s.padding=this.padding+"px",s.backgroundColor=i.color.background,s.borderRadius="3px",s.MozBorderRadius="3px",s.WebkitBorderRadius="3px",s.boxShadow="3px 3px 10px rgba(128, 128, 128, 0.5)",s.whiteSpace="nowrap",this.container.appendChild(this.frame)}function Groups(){this.clear(),this.defaultIndex=0}function Images(){this.images={},this.callback=void 0}function graphToggleSmoothCurves(){this.constants.smoothCurves=!this.constants.smoothCurves;var e=document.getElementById("graph_toggleSmooth");e.style.background=1==this.constants.smoothCurves?"#A4FF56":"#FF8532",this._configureSmoothCurves(!1)}function graphRepositionNodes(){for(var e in this.calculationNodes)this.calculationNodes.hasOwnProperty(e)&&(this.calculationNodes[e].vx=0,this.calculationNodes[e].vy=0,this.calculationNodes[e].fx=0,this.calculationNodes[e].fy=0);1==this.constants.hierarchicalLayout.enabled?this._setupHierarchicalLayout():this.repositionNodes(),this.moving=!0,this.start()}function graphGenerateOptions(){var e="No options are required, default values used.",t=[],n=document.getElementById("graph_physicsMethod1"),r=document.getElementById("graph_physicsMethod2");if(1==n.checked){if(this.constants.physics.barnesHut.gravitationalConstant!=this.backupConstants.physics.barnesHut.gravitationalConstant&&t.push("gravitationalConstant: "+this.constants.physics.barnesHut.gravitationalConstant),this.constants.physics.centralGravity!=this.backupConstants.physics.barnesHut.centralGravity&&t.push("centralGravity: "+this.constants.physics.centralGravity),this.constants.physics.springLength!=this.backupConstants.physics.barnesHut.springLength&&t.push("springLength: "+this.constants.physics.springLength),this.constants.physics.springConstant!=this.backupConstants.physics.barnesHut.springConstant&&t.push("springConstant: "+this.constants.physics.springConstant),this.constants.physics.damping!=this.backupConstants.physics.barnesHut.damping&&t.push("damping: "+this.constants.physics.damping),0!=t.length){e="var options = {",e+="physics: {barnesHut: {";for(var i=0;i<t.length;i++)e+=t[i],i<t.length-1&&(e+=", ");e+="}}"}this.constants.smoothCurves!=this.backupConstants.smoothCurves&&(0==t.length?e="var options = {":e+=", ",e+="smoothCurves: "+this.constants.smoothCurves),"No options are required, default values used."!=e&&(e+="};")}else if(1==r.checked){if(e="var options = {",e+="physics: {barnesHut: {enabled: false}",this.constants.physics.repulsion.nodeDistance!=this.backupConstants.physics.repulsion.nodeDistance&&t.push("nodeDistance: "+this.constants.physics.repulsion.nodeDistance),this.constants.physics.centralGravity!=this.backupConstants.physics.repulsion.centralGravity&&t.push("centralGravity: "+this.constants.physics.centralGravity),this.constants.physics.springLength!=this.backupConstants.physics.repulsion.springLength&&t.push("springLength: "+this.constants.physics.springLength),this.constants.physics.springConstant!=this.backupConstants.physics.repulsion.springConstant&&t.push("springConstant: "+this.constants.physics.springConstant),this.constants.physics.damping!=this.backupConstants.physics.repulsion.damping&&t.push("damping: "+this.constants.physics.damping),0!=t.length){e+=", repulsion: {";for(var i=0;i<t.length;i++)e+=t[i],i<t.length-1&&(e+=", ");e+="}}"}0==t.length&&(e+="}"),this.constants.smoothCurves!=this.backupConstants.smoothCurves&&(e+=", smoothCurves: "+this.constants.smoothCurves),e+="};"}else{if(e="var options = {",this.constants.physics.hierarchicalRepulsion.nodeDistance!=this.backupConstants.physics.hierarchicalRepulsion.nodeDistance&&t.push("nodeDistance: "+this.constants.physics.hierarchicalRepulsion.nodeDistance),this.constants.physics.centralGravity!=this.backupConstants.physics.hierarchicalRepulsion.centralGravity&&t.push("centralGravity: "+this.constants.physics.centralGravity),this.constants.physics.springLength!=this.backupConstants.physics.hierarchicalRepulsion.springLength&&t.push("springLength: "+this.constants.physics.springLength),this.constants.physics.springConstant!=this.backupConstants.physics.hierarchicalRepulsion.springConstant&&t.push("springConstant: "+this.constants.physics.springConstant),this.constants.physics.damping!=this.backupConstants.physics.hierarchicalRepulsion.damping&&t.push("damping: "+this.constants.physics.damping),0!=t.length){e+="physics: {hierarchicalRepulsion: {";for(var i=0;i<t.length;i++)e+=t[i],i<t.length-1&&(e+=", ");e+="}},"}if(e+="hierarchicalLayout: {",t=[],this.constants.hierarchicalLayout.direction!=this.backupConstants.hierarchicalLayout.direction&&t.push("direction: "+this.constants.hierarchicalLayout.direction),Math.abs(this.constants.hierarchicalLayout.levelSeparation)!=this.backupConstants.hierarchicalLayout.levelSeparation&&t.push("levelSeparation: "+this.constants.hierarchicalLayout.levelSeparation),this.constants.hierarchicalLayout.nodeSpacing!=this.backupConstants.hierarchicalLayout.nodeSpacing&&t.push("nodeSpacing: "+this.constants.hierarchicalLayout.nodeSpacing),0!=t.length){for(var i=0;i<t.length;i++)e+=t[i],i<t.length-1&&(e+=", ");e+="}"}else e+="enabled:true}";e+="};"}this.optionsDiv.innerHTML=e}function switchConfigurations(){var e=["graph_BH_table","graph_R_table","graph_H_table"],t=document.querySelector('input[name="graph_physicsMethod"]:checked').value,n="graph_"+t+"_table",r=document.getElementById(n);r.style.display="block";for(var i=0;i<e.length;i++)e[i]!=n&&(r=document.getElementById(e[i]),r.style.display="none");this._restoreNodes(),"R"==t?(this.constants.hierarchicalLayout.enabled=!1,this.constants.physics.hierarchicalRepulsion.enabled=!1,this.constants.physics.barnesHut.enabled=!1):"H"==t?0==this.constants.hierarchicalLayout.enabled&&(this.constants.hierarchicalLayout.enabled=!0,this.constants.physics.hierarchicalRepulsion.enabled=!0,this.constants.physics.barnesHut.enabled=!1,this._setupHierarchicalLayout()):(this.constants.hierarchicalLayout.enabled=!1,this.constants.physics.hierarchicalRepulsion.enabled=!1,this.constants.physics.barnesHut.enabled=!0),this._loadSelectedForceSolver();var s=document.getElementById("graph_toggleSmooth");s.style.background=1==this.constants.smoothCurves?"#A4FF56":"#FF8532",this.moving=!0,this.start()}function showValueOfRange(e,t,n){var r=e+"_value",i=document.getElementById(e).value;t instanceof Array?(document.getElementById(r).value=t[parseInt(i)],this._overWriteGraphConstants(n,t[parseInt(i)])):(document.getElementById(r).value=parseInt(t)*parseFloat(i),this._overWriteGraphConstants(n,parseInt(t)*parseFloat(i))),("hierarchicalLayout_direction"==n||"hierarchicalLayout_levelSeparation"==n||"hierarchicalLayout_nodeSpacing"==n)&&this._setupHierarchicalLayout(),this.moving=!0,this.start()}function Graph(e,t,n){this._initializeMixinLoaders(),this.containerElement=e,this.width="100%",this.height="100%",this.renderRefreshRate=60,this.renderTimestep=1e3/this.renderRefreshRate,this.renderTime=.5*this.renderTimestep,this.maxPhysicsTicksPerRender=3,this.physicsDiscreteStepsize=.5,this.stabilize=!0,this.selectable=!0,this.initializing=!0,this.triggerFunctions={add:null,edit:null,editEdge:null,connect:null,del:null},this.constants={nodes:{radiusMin:5,radiusMax:20,radius:5,shape:"ellipse",image:void 0,widthMin:16,widthMax:64,fixed:!1,fontColor:"black",fontSize:14,fontFace:"verdana",level:-1,color:{border:"#2B7CE9",background:"#97C2FC",highlight:{border:"#2B7CE9",background:"#D2E5FF"},hover:{border:"#2B7CE9",background:"#D2E5FF"}},borderColor:"#2B7CE9",backgroundColor:"#97C2FC",highlightColor:"#D2E5FF",group:void 0},edges:{widthMin:1,widthMax:15,width:1,hoverWidth:1.5,style:"line",color:{color:"#848484",highlight:"#848484",hover:"#848484"},fontColor:"#343434",fontSize:14,fontFace:"arial",fontFill:"white",arrowScaleFactor:1,dash:{length:10,gap:5,altLength:void 0}},configurePhysics:!1,physics:{barnesHut:{enabled:!0,theta:1/.6,gravitationalConstant:-2e3,centralGravity:.3,springLength:95,springConstant:.04,damping:.09},repulsion:{centralGravity:.1,springLength:200,springConstant:.05,nodeDistance:100,damping:.09},hierarchicalRepulsion:{enabled:!1,centralGravity:0,springLength:100,springConstant:.01,nodeDistance:60,damping:.09},damping:null,centralGravity:null,springLength:null,springConstant:null},clustering:{enabled:!1,initialMaxNodes:100,clusterThreshold:500,reduceToNodes:300,chainThreshold:.4,clusterEdgeThreshold:20,sectorThreshold:100,screenSizeThreshold:.2,fontSizeMultiplier:4,maxFontSize:1e3,forceAmplification:.1,distanceAmplification:.1,edgeGrowth:20,nodeScaling:{width:1,height:1,radius:1},maxNodeSizeIncrements:600,activeAreaBoxSize:80,clusterLevelDifference:2},navigation:{enabled:!1},keyboard:{enabled:!1,speed:{x:10,y:10,zoom:.02}},dataManipulation:{enabled:!1,initiallyVisible:!1},hierarchicalLayout:{enabled:!1,levelSeparation:150,nodeSpacing:100,direction:"UD"},freezeForStabilization:!1,smoothCurves:!0,maxVelocity:10,minVelocity:.1,stabilizationIterations:1e3,labels:{add:"Add Node",edit:"Edit",link:"Add Link",del:"Delete selected",editNode:"Edit Node",editEdge:"Edit Edge",back:"Back",addDescription:"Click in an empty space to place a new node.",linkDescription:"Click on a node and drag the edge to another node to connect them.",editEdgeDescription:"Click on the control points and drag them to a node to connect to it.",addError:"The function for add does not support two arguments (data,callback).",linkError:"The function for connect does not support two arguments (data,callback).",editError:"The function for edit does not support two arguments (data, callback).",editBoundError:"No edit function has been bound to this button.",deleteError:"The function for delete does not support two arguments (data, callback).",deleteClusterError:"Clusters cannot be deleted."},tooltip:{delay:300,fontColor:"black",fontSize:14,fontFace:"verdana",color:{border:"#666",background:"#FFFFC6"}},dragGraph:!0,dragNodes:!0,zoomable:!0,hover:!1},this.hoverObj={nodes:{},edges:{}};var r=this;this.groups=new Groups,this.images=new Images,this.images.setOnloadCallback(function(){r._redraw()}),this.xIncrement=0,this.yIncrement=0,this.zoomIncrement=0,this._loadPhysicsSystem(),this._create(),this._loadSectorSystem(),this._loadClusterSystem(),this._loadSelectionSystem(),this._loadHierarchySystem(),this._setTranslation(this.frame.clientWidth/2,this.frame.clientHeight/2),this._setScale(1),this.setOptions(n),this.freezeSimulation=!1,this.cachedFunctions={},this.calculationNodes={},this.calculationNodeIndices=[],this.nodeIndices=[],this.nodes={},this.edges={},this.canvasTopLeft={x:0,y:0},this.canvasBottomRight={x:0,y:0},this.pointerPosition={x:0,y:0},this.areaCenter={},this.scale=1,this.previousScale=this.scale,this.nodesData=null,this.edgesData=null,this.nodesListeners={add:function(e,t){r._addNodes(t.items),r.start()},update:function(e,t){r._updateNodes(t.items),r.start()},remove:function(e,t){r._removeNodes(t.items),r.start()}},this.edgesListeners={add:function(e,t){r._addEdges(t.items),r.start()},update:function(e,t){r._updateEdges(t.items),r.start()},remove:function(e,t){r._removeEdges(t.items),r.start()}},this.moving=!0,this.timer=void 0,this.setData(t,this.constants.clustering.enabled||this.constants.hierarchicalLayout.enabled),this.initializing=!1,1==this.constants.hierarchicalLayout.enabled?this._setupHierarchicalLayout():0==this.stabilize&&this.zoomExtent(!0,this.constants.clustering.enabled),this.constants.clustering.enabled&&this.startWithClustering()}function Graph3d(e,t,n){this.containerElement=e,this.width="400px",this.height="400px",this.margin=10,this.defaultXCenter="55%",this.defaultYCenter="50%",this.xLabel="x",this.yLabel="y",this.zLabel="z",this.filterLabel="time",this.legendLabel="value",this.style=Graph3d.STYLE.DOT,this.showPerspective=!0,this.showGrid=!0,this.keepAspectRatio=!0,this.showShadow=!1,this.showGrayBottom=!1,this.showTooltip=!1,this.verticalRatio=.5,this.animationInterval=1e3,this.animationPreload=!1,this.camera=new Graph3d.Camera,this.eye=new Point3d(0,0,-1),this.dataTable=null,this.dataPoints=null,this.colX=void 0,this.colY=void 0,this.colZ=void 0,this.colValue=void 0,this.colFilter=void 0,this.xMin=0,this.xStep=void 0,this.xMax=1,this.yMin=0,this.yStep=void 0,this.yMax=1,this.zMin=0,this.zStep=void 0,this.zMax=1,this.valueMin=0,this.valueMax=1,this.xBarWidth=1,this.yBarWidth=1,this.colorAxis="#4D4D4D",this.colorGrid="#D3D3D3",this.colorDot="#7DC1FF",this.colorDotBorder="#3267D2",this.create(),this.setOptions(n),t&&this.setData(t)}function Point3d(e,t,n){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0,this.z=void 0!==n?n:0}function Filter(e,t,n){this.data=e,this.column=t,this.graph=n,this.index=void 0,this.value=void 0,this.values=n.getDistinctValues(e.get(),this.column),this.values.sort(function(e,t){return e>t?1:t>e?-1:0}),this.values.length>0&&this.selectValue(0),this.dataPoints=[],this.loaded=!1,this.onLoadCallback=void 0,n.animationPreload?(this.loaded=!1,this.loadInBackground()):this.loaded=!0}function Slider(e,t){if(void 0===e)throw"Error: No container element defined";if(this.container=e,this.visible=t&&void 0!=t.visible?t.visible:!0,this.visible){this.frame=document.createElement("DIV"),this.frame.style.width="100%",this.frame.style.position="relative",this.container.appendChild(this.frame),this.frame.prev=document.createElement("INPUT"),this.frame.prev.type="BUTTON",this.frame.prev.value="Prev",this.frame.appendChild(this.frame.prev),this.frame.play=document.createElement("INPUT"),this.frame.play.type="BUTTON",this.frame.play.value="Play",this.frame.appendChild(this.frame.play),this.frame.next=document.createElement("INPUT"),this.frame.next.type="BUTTON",this.frame.next.value="Next",this.frame.appendChild(this.frame.next),this.frame.bar=document.createElement("INPUT"),this.frame.bar.type="BUTTON",this.frame.bar.style.position="absolute",this.frame.bar.style.border="1px solid red",this.frame.bar.style.width="100px",this.frame.bar.style.height="6px",this.frame.bar.style.borderRadius="2px",this.frame.bar.style.MozBorderRadius="2px",this.frame.bar.style.border="1px solid #7F7F7F",this.frame.bar.style.backgroundColor="#E5E5E5",this.frame.appendChild(this.frame.bar),this.frame.slide=document.createElement("INPUT"),this.frame.slide.type="BUTTON",this.frame.slide.style.margin="0px",this.frame.slide.value=" ",this.frame.slide.style.position="relative",this.frame.slide.style.left="-100px",this.frame.appendChild(this.frame.slide);var n=this;this.frame.slide.onmousedown=function(e){n._onMouseDown(e)},this.frame.prev.onclick=function(e){n.prev(e)},this.frame.play.onclick=function(e){n.togglePlay(e)},this.frame.next.onclick=function(e){n.next(e)}}this.onChangeCallback=void 0,this.values=[],this.index=void 0,this.playTimeout=void 0,this.playInterval=1e3,this.playLoop=!0}var moment="undefined"!=typeof window&&window.moment||require("moment"),Emitter=require("emitter-component"),Hammer;Hammer="undefined"!=typeof window?window.Hammer||require("hammerjs"):function(){throw Error("hammer.js is only available in a browser, not in node.js.")};var mousetrap;if(mousetrap="undefined"!=typeof window?window.mousetrap||require("mousetrap"):function(){throw Error("mouseTrap is only available in a browser, not in node.js.")},!Array.prototype.indexOf){Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1};try{console.log("Warning: Ancient browser detected. Please update your browser")}catch(err){}}Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;r>n;++n)e.call(t||this,this[n],n,this)}),Array.prototype.map||(Array.prototype.map=function(e,t){var n,r,i;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(this),o=s.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(n=t),r=new Array(o),i=0;o>i;){var u,a;i in s&&(u=s[i],a=e.call(n,u,i,s),r[i]=a),i++}return r}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],i=arguments[1],s=0;n>s;s++)if(s in t){var o=t[s];e.call(i,o,s,t)&&r.push(o)}return r}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(o){if("object"!=typeof o&&"function"!=typeof o||null===o)throw new TypeError("Object.keys called on non-object");var u=[];for(var a in o)e.call(o,a)&&u.push(a);if(t)for(var f=0;r>f;f++)e.call(o,n[f])&&u.push(n[f]);return u}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),Object.create||(Object.create=function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i});var util={};util.isNumber=function(e){return e instanceof Number||"number"==typeof e},util.isString=function(e){return e instanceof String||"string"==typeof e},util.isDate=function(e){if(e instanceof Date)return!0;if(util.isString(e)){var t=ASPDateRegex.exec(e);if(t)return!0;if(!isNaN(Date.parse(e)))return!0}return!1},util.isDataTable=function(e){return"undefined"!=typeof google&&google.visualization&&google.visualization.DataTable&&e instanceof google.visualization.DataTable},util.randomUUID=function(){var e=function(){return Math.floor(65536*Math.random()).toString(16)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},util.extend=function(e){for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e},util.selectiveExtend=function(e,t){if(!Array.isArray(e))throw new Error("Array with property names expected as first argument");for(var n=1,r=arguments.length;r>n;n++)for(var i=arguments[n],s=0,o=e.length;o>s;s++){var u=e[s];i.hasOwnProperty(u)&&(t[u]=i[u])}return t},util.deepExtend=function(e,t){if(Array.isArray(t))throw new TypeError("Arrays are not supported by deepExtend");for(var n in t)if(t.hasOwnProperty(n))if(t[n]&&t[n].constructor===Object)void 0===e[n]&&(e[n]={}),e[n].constructor===Object?util.deepExtend(e[n],t[n]):e[n]=t[n];else{if(Array.isArray(t[n]))throw new TypeError("Arrays are not supported by deepExtend");e[n]=t[n]}return e},util.equalArray=function(e,t){if(e.length!=t.length)return!1;for(var n=0,r=e.length;r>n;n++)if(e[n]!=t[n])return!1;return!0},util.convert=function(e,t){var n;if(void 0===e)return void 0;if(null===e)return null;if(!t)return e;if(!("string"==typeof t||t instanceof String))throw new Error("Type must be a string");switch(t){case"boolean":case"Boolean":return Boolean(e);case"number":case"Number":return Number(e.valueOf());case"string":case"String":return String(e);case"Date":if(util.isNumber(e))return new Date(e);if(e instanceof Date)return new Date(e.valueOf());if(moment.isMoment(e))return new Date(e.valueOf());if(util.isString(e))return n=ASPDateRegex.exec(e),n?new Date(Number(n[1])):moment(e).toDate();throw new Error("Cannot convert object of type "+util.getType(e)+" to type Date");case"Moment":if(util.isNumber(e))return moment(e);if(e instanceof Date)return moment(e.valueOf());if(moment.isMoment(e))return moment(e);if(util.isString(e))return n=ASPDateRegex.exec(e),moment(n?Number(n[1]):e);throw new Error("Cannot convert object of type "+util.getType(e)+" to type Date");case"ISODate":if(util.isNumber(e))return new Date(e);if(e instanceof Date)return e.toISOString();if(moment.isMoment(e))return e.toDate().toISOString();if(util.isString(e))return n=ASPDateRegex.exec(e),n?(new Date(Number(n[1]))).toISOString():(new Date(e)).toISOString();throw new Error("Cannot convert object of type "+util.getType(e)+" to type ISODate");case"ASPDate":if(util.isNumber(e))return"/Date("+e+")/";if(e instanceof Date)return"/Date("+e.valueOf()+")/";if(util.isString(e)){n=ASPDateRegex.exec(e);var r;return r=n?(new Date(Number(n[1]))).valueOf():(new Date(e)).valueOf(),"/Date("+r+")/"}throw new Error("Cannot convert object of type "+util.getType(e)+" to type ASPDate");default:throw new Error('Unknown type "'+t+'"')}};var ASPDateRegex=/^\/?Date\((\-?\d+)/i;util.getType=function(e){var t=typeof e;return"object"==t?null==e?"null":e instanceof Boolean?"Boolean":e instanceof Number?"Number":e instanceof String?"String":e instanceof Array?"Array":e instanceof Date?"Date":"Object":"number"==t?"Number":"boolean"==t?"Boolean":"string"==t?"String":t},util.getAbsoluteLeft=function(e){for(var t=document.documentElement,n=document.body,r=e.offsetLeft,i=e.offsetParent;null!=i&&i!=n&&i!=t;)r+=i.offsetLeft,r-=i.scrollLeft,i=i.offsetParent;return r},util.getAbsoluteTop=function(e){for(var t=document.documentElement,n=document.body,r=e.offsetTop,i=e.offsetParent;null!=i&&i!=n&&i!=t;)r+=i.offsetTop,r-=i.scrollTop,i=i.offsetParent;return r},util.getPageY=function(e){if("pageY"in e)return e.pageY;var t;t="targetTouches"in e&&e.targetTouches.length?e.targetTouches[0].clientY:e.clientY;var n=document.documentElement,r=document.body;return t+(n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0)},util.getPageX=function(e){if("pageY"in e)return e.pageX;var t;t="targetTouches"in e&&e.targetTouches.length?e.targetTouches[0].clientX:e.clientX;var n=document.documentElement,r=document.body;return t+(n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0)},util.addClassName=function(e,t){var n=e.className.split(" ");-1==n.indexOf(t)&&(n.push(t),e.className=n.join(" "))},util.removeClassName=function(e,t){var n=e.className.split(" "),r=n.indexOf(t);-1!=r&&(n.splice(r,1),e.className=n.join(" "))},util.forEach=function(e,t){var n,r;if(e instanceof Array)for(n=0,r=e.length;r>n;n++)t(e[n],n,e);else for(n in e)e.hasOwnProperty(n)&&t(e[n],n,e)},util.toArray=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},util.updateProperty=function(e,t,n){return e[t]!==n?(e[t]=n,!0):!1},util.addEventListener=function(e,t,n,r){e.addEventListener?(void 0===r&&(r=!1),"mousewheel"===t&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.addEventListener(t,n,r)):e.attachEvent("on"+t,n)},util.removeEventListener=function(e,t,n,r){e.removeEventListener?(void 0===r&&(r=!1),"mousewheel"===t&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.removeEventListener(t,n,r)):e.detachEvent("on"+t,n)},util.getTarget=function(e){e||(e=window.event);var t;return e.target?t=e.target:e.srcElement&&(t=e.srcElement),void 0!=t.nodeType&&3==t.nodeType&&(t=t.parentNode),t},util.fakeGesture=function(e,t){var n=null,r=Hammer.event.collectEventData(this,n,t);return isNaN(r.center.pageX)&&(r.center.pageX=t.pageX),isNaN(r.center.pageY)&&(r.center.pageY=t.pageY),r},util.option={},util.option.asBoolean=function(e,t){return"function"==typeof e&&(e=e()),null!=e?0!=e:t||null},util.option.asNumber=function(e,t){return"function"==typeof e&&(e=e()),null!=e?Number(e)||t||null:t||null},util.option.asString=function(e,t){return"function"==typeof e&&(e=e()),null!=e?String(e):t||null},util.option.asSize=function(e,t){return"function"==typeof e&&(e=e()),util.isString(e)?e:util.isNumber(e)?e+"px":t||null},util.option.asElement=function(e,t){return"function"==typeof e&&(e=e()),e||t||null},util.GiveDec=function(Hex){var Value;return Value="A"==Hex?10:"B"==Hex?11:"C"==Hex?12:"D"==Hex?13:"E"==Hex?14:"F"==Hex?15:eval(Hex)},util.GiveHex=function(e){var t;return t=10==e?"A":11==e?"B":12==e?"C":13==e?"D":14==e?"E":15==e?"F":""+e},util.parseColor=function(e){var t;if(util.isString(e))if(util.isValidHex(e)){var n=util.hexToHSV(e),r={h:n.h,s:.45*n.s,v:Math.min(1,1.05*n.v)},i={h:n.h,s:Math.min(1,1.25*n.v),v:.6*n.v},s=util.HSVToHex(i.h,i.h,i.v),o=util.HSVToHex(r.h,r.s,r.v);t={background:e,border:s,highlight:{background:o,border:s},hover:{background:o,border:s}}}else t={background:e,border:e,highlight:{background:e,border:e},hover:{background:e,border:e}};else t={},t.background=e.background||"white",t.border=e.border||t.background,util.isString(e.highlight)?t.highlight={border:e.highlight,background:e.highlight}:(t.highlight={},t.highlight.background=e.highlight&&e.highlight.background||t.background,t.highlight.border=e.highlight&&e.highlight.border||t.border),util.isString(e.hover)?t.hover={border:e.hover,background:e.hover}:(t.hover={},t.hover.background=e.hover&&e.hover.background||t.background,t.hover.border=e.hover&&e.hover.border||t.border);return t},util.hexToRGB=function(e){e=e.replace("#","").toUpperCase();var t=util.GiveDec(e.substring(0,1)),n=util.GiveDec(e.substring(1,2)),r=util.GiveDec(e.substring(2,3)),i=util.GiveDec(e.substring(3,4)),s=util.GiveDec(e.substring(4,5)),o=util.GiveDec(e.substring(5,6)),u=16*t+n,a=16*r+i,n=16*s+o;return{r:u,g:a,b:n}},util.RGBToHex=function(e,t,n){var r=util.GiveHex(Math.floor(e/16)),i=util.GiveHex(e%16),s=util.GiveHex(Math.floor(t/16)),o=util.GiveHex(t%16),u=util.GiveHex(Math.floor(n/16)),a=util.GiveHex(n%16),f=r+i+s+o+u+a;return"#"+f},util.RGBToHSV=function(e,t,n){e/=255,t/=255,n/=255;var r=Math.min(e,Math.min(t,n)),i=Math.max(e,Math.max(t,n));if(r==i)return{h:0,s:0,v:r};var s=e==r?t-n:n==r?e-t:n-e,o=e==r?3:n==r?1:5,u=60*(o-s/(i-r))/360,a=(i-r)/i,f=i;return{h:u,s:a,v:f}},util.HSVToRGB=function(e,t,n){var r,i,s,o=Math.floor(6*e),u=6*e-o,a=n*(1-t),f=n*(1-u*t),l=n*(1-(1-u)*t);switch(o%6){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;case 5:r=n,i=a,s=f}return{r:Math.floor(255*r),g:Math.floor(255*i),b:Math.floor(255*s)}},util.HSVToHex=function(e,t,n){var r=util.HSVToRGB(e,t,n);return util.RGBToHex(r.r,r.g,r.b)},util.hexToHSV=function(e){var t=util.hexToRGB(e);return util.RGBToHSV(t.r,t.g,t.b)},util.isValidHex=function(e){var t=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e);return t},util.copyObject=function(e,t){for(var n in e)e.hasOwnProperty(n)&&("object"==typeof e[n]?(t[n]={},util.copyObject(e[n],t[n])):t[n]=e[n])},DataSet.prototype.on=function(e,t){var n=this._subscribers[e];n||(n=[],this._subscribers[e]=n),n.push({callback:t})},DataSet.prototype.subscribe=DataSet.prototype.on,DataSet.prototype.off=function(e,t){var n=this._subscribers[e];n&&(this._subscribers[e]=n.filter(function(e){return e.callback!=t}))},DataSet.prototype.unsubscribe=DataSet.prototype.off,DataSet.prototype._trigger=function(e,t,n){if("*"==e)throw new Error("Cannot trigger event *");var r=[];e in this._subscribers&&(r=r.concat(this._subscribers[e])),"*"in this._subscribers&&(r=r.concat(this._subscribers["*"]));for(var i=0;i<r.length;i++){var s=r[i];s.callback&&s.callback(e,t,n||null)}},DataSet.prototype.add=function(e,t){var n,r=[],i=this;if(Array.isArray(e))for(var s=0,o=e.length;o>s;s++)n=i._addItem(e[s]),r.push(n);else if(util.isDataTable(e))for(var u=this._getColumnNames(e),a=0,f=e.getNumberOfRows();f>a;a++){for(var l={},c=0,h=u.length;h>c;c++){var p=u[c];l[p]=e.getValue(a,c)}n=i._addItem(l),r.push(n)}else{if(!(e instanceof Object))throw new Error("Unknown dataType");n=i._addItem(e),r.push(n)}return r.length&&this._trigger("add",{items:r},t),r},DataSet.prototype.update=function(e,t){var n=[],r=[],i=this,s=i._fieldId,o=function(e){var t=e[s];i._data[t]?(t=i._updateItem(e),r.push(t)):(t=i._addItem(e),n.push(t))};if(Array.isArray(e))for(var u=0,a=e.length;a>u;u++)o(e[u]);else if(util.isDataTable(e))for(var f=this._getColumnNames(e),l=0,c=e.getNumberOfRows();c>l;l++){for(var h={},p=0,d=f.length;d>p;p++){var v=f[p];h[v]=e.getValue(l,p)}o(h)}else{if(!(e instanceof Object))throw new Error("Unknown dataType");o(e)}return n.length&&this._trigger("add",{items:n},t),r.length&&this._trigger("update",{items:r},t),n.concat(r)},DataSet.prototype.get=function(){var e,t,n,r,i=this,s=util.getType(arguments[0]);"String"==s||"Number"==s?(e=arguments[0],n=arguments[1],r=arguments[2]):"Array"==s?(t=arguments[0],n=arguments[1],r=arguments[2]):(n=arguments[0],r=arguments[1]);var o;if(n&&n.returnType){if(o="DataTable"==n.returnType?"DataTable":"Array",r&&o!=util.getType(r))throw new Error('Type of parameter "data" ('+util.getType(r)+") does not correspond with specified options.type ("+n.type+")");if("DataTable"==o&&!util.isDataTable(r))throw new Error('Parameter "data" must be a DataTable when options.type is "DataTable"')}else o=r&&"DataTable"==util.getType(r)?"DataTable":"Array";var u,a,f,l,c=n&&n.type||this._options.type,h=n&&n.filter,p=[];if(void 0!=e)u=i._getItem(e,c),h&&!h(u)&&(u=null);else if(void 0!=t)for(f=0,l=t.length;l>f;f++)u=i._getItem(t[f],c),(!h||h(u))&&p.push(u);else for(a in this._data)this._data.hasOwnProperty(a)&&(u=i._getItem(a,c),(!h||h(u))&&p.push(u));if(n&&n.order&&void 0==e&&this._sort(p,n.order),n&&n.fields){var d=n.fields;if(void 0!=e)u=this._filterFields(u,d);else for(f=0,l=p.length;l>f;f++)p[f]=this._filterFields(p[f],d)}if("DataTable"==o){var v=this._getColumnNames(r);if(void 0!=e)i._appendRow(r,v,u);else for(f=0,l=p.length;l>f;f++)i._appendRow(r,v,p[f]);return r}if(void 0!=e)return u;if(r){for(f=0,l=p.length;l>f;f++)r.push(p[f]);return r}return p},DataSet.prototype.getIds=function(e){var t,n,r,i,s,o=this._data,u=e&&e.filter,a=e&&e.order,f=e&&e.type||this._options.type,l=[];if(u)if(a){s=[];for(r in o)o.hasOwnProperty(r)&&(i=this._getItem(r,f),u(i)&&s.push(i));for(this._sort(s,a),t=0,n=s.length;n>t;t++)l[t]=s[t][this._fieldId]}else for(r in o)o.hasOwnProperty(r)&&(i=this._getItem(r,f),u(i)&&l.push(i[this._fieldId]));else if(a){s=[];for(r in o)o.hasOwnProperty(r)&&s.push(o[r]);for(this._sort(s,a),t=0,n=s.length;n>t;t++)l[t]=s[t][this._fieldId]}else for(r in o)o.hasOwnProperty(r)&&(i=o[r],l.push(i[this._fieldId]));return l},DataSet.prototype.forEach=function(e,t){var n,r,i=t&&t.filter,s=t&&t.type||this._options.type,o=this._data;if(t&&t.order)for(var u=this.get(t),a=0,f=u.length;f>a;a++)n=u[a],r=n[this._fieldId],e(n,r);else for(r in o)o.hasOwnProperty(r)&&(n=this._getItem(r,s),(!i||i(n))&&e(n,r))},DataSet.prototype.map=function(e,t){var n,r=t&&t.filter,i=t&&t.type||this._options.type,s=[],o=this._data;for(var u in o)o.hasOwnProperty(u)&&(n=this._getItem(u,i),(!r||r(n))&&s.push(e(n,u)));return t&&t.order&&this._sort(s,t.order),s},DataSet.prototype._filterFields=function(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&-1!=t.indexOf(r)&&(n[r]=e[r]);return n},DataSet.prototype._sort=function(e,t){if(util.isString(t)){var n=t;e.sort(function(e,t){var r=e[n],s=t[n];return r>s?1:s>r?-1:0})}else{if("function"!=typeof t)throw new TypeError("Order must be a function or a string");e.sort(t)}},DataSet.prototype.remove=function(e,t){var n,r,i,s=[];if(Array.isArray(e))for(n=0,r=e.length;r>n;n++)i=this._remove(e[n]),null!=i&&s.push(i);else i=this._remove(e),null!=i&&s.push(i);return s.length&&this._trigger("remove",{items:s},t),s},DataSet.prototype._remove=function(e){if(util.isNumber(e)||util.isString(e)){if(this._data[e])return delete this._data[e],e}else if(e instanceof Object){var t=e[this._fieldId];if(t&&this._data[t])return delete this._data[t],t}return null},DataSet.prototype.clear=function(e){var t=Object.keys(this._data);return this._data={},this._trigger("remove",{items:t},e),t},DataSet.prototype.max=function(e){var t=this._data,n=null,r=null;for(var i in t)if(t.hasOwnProperty(i)){var s=t[i],o=s[e];null!=o&&(!n||o>r)&&(n=s,r=o)}return n},DataSet.prototype.min=function(e){var t=this._data,n=null,r=null;for(var i in t)if(t.hasOwnProperty(i)){var s=t[i],o=s[e];null!=o&&(!n||r>o)&&(n=s,r=o)}return n},DataSet.prototype.distinct=function(e){var t,n=this._data,r=[],i=this._options.type&&this._options.type[e]||null,s=0;for(var o in n)if(n.hasOwnProperty(o)){var u=n[o],a=u[e],f=!1;for(t=0;s>t;t++)if(r[t]==a){f=!0;break}f||void 0===a||(r[s]=a,s++)}if(i)for(t=0;t<r.length;t++)r[t]=util.convert(r[t],i);return r},DataSet.prototype._addItem=function(e){var t=e[this._fieldId];if(void 0!=t){if(this._data[t])throw new Error("Cannot add item: item with id "+t+" already exists")}else t=util.randomUUID(),e[this._fieldId]=t;var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=this._type[r];n[r]=util.convert(e[r],i)}return this._data[t]=n,t},DataSet.prototype._getItem=function(e,t){var n,r,i=this._data[e];if(!i)return null;var s={};if(t)for(n in i)i.hasOwnProperty(n)&&(r=i[n],s[n]=util.convert(r,t[n]));else for(n in i)i.hasOwnProperty(n)&&(r=i[n],s[n]=r);return s},DataSet.prototype._updateItem=function(e){var t=e[this._fieldId];if(void 0==t)throw new Error("Cannot update item: item has no id (item: "+JSON.stringify(e)+")");var n=this._data[t];if(!n)throw new Error("Cannot update item: no item with id "+t+" found");for(var r in e)if(e.hasOwnProperty(r)){var i=this._type[r];n[r]=util.convert(e[r],i)}return t},DataSet.prototype._getColumnNames=function(e){for(var t=[],n=0,r=e.getNumberOfColumns();r>n;n++)t[n]=e.getColumnId(n)||e.getColumnLabel(n);return t},DataSet.prototype._appendRow=function(e,t,n){for(var r=e.addRow(),i=0,s=t.length;s>i;i++){var o=t[i];e.setValue(r,i,n[o])}},DataView.prototype.setData=function(e){var t,n,r;if(this._data){this._data.unsubscribe&&this._data.unsubscribe("*",this.listener),t=[];for(var i in this._ids)this._ids.hasOwnProperty(i)&&t.push(i);this._ids={},this._trigger("remove",{items:t})}if(this._data=e,this._data){for(this._fieldId=this._options.fieldId||this._data&&this._data.options&&this._data.options.fieldId||"id",t=this._data.getIds({filter:this._options&&this._options.filter}),n=0,r=t.length;r>n;n++)i=t[n],this._ids[i]=!0;this._trigger("add",{items:t}),this._data.on&&this._data.on("*",this.listener)}},DataView.prototype.get=function(){var e,t,n,r=this,i=util.getType(arguments[0]);"String"==i||"Number"==i||"Array"==i?(e=arguments[0],t=arguments[1],n=arguments[2]):(t=arguments[0],n=arguments[1]);var s=util.extend({},this._options,t);this._options.filter&&t&&t.filter&&(s.filter=function(e){return r._options.filter(e)&&t.filter(e)});var o=[];return void 0!=e&&o.push(e),o.push(s),o.push(n),this._data&&this._data.get.apply(this._data,o)},DataView.prototype.getIds=function(e){var t;if(this._data){var n,r=this._options.filter;n=e&&e.filter?r?function(t){return r(t)&&e.filter(t)}:e.filter:r,t=this._data.getIds({filter:n,order:e&&e.order})}else t=[];return t},DataView.prototype._onEvent=function(e,t,n){var r,i,s,o,u=t&&t.items,a=this._data,f=[],l=[],c=[];if(u&&a){switch(e){case"add":for(r=0,i=u.length;i>r;r++)s=u[r],o=this.get(s),o&&(this._ids[s]=!0,f.push(s));break;case"update":for(r=0,i=u.length;i>r;r++)s=u[r],o=this.get(s),o?this._ids[s]?l.push(s):(this._ids[s]=!0,f.push(s)):this._ids[s]&&(delete this._ids[s],c.push(s));break;case"remove":for(r=0,i=u.length;i>r;r++)s=u[r],this._ids[s]&&(delete this._ids[s],c.push(s))}f.length&&this._trigger("add",{items:f},n),l.length&&this._trigger("update",{items:l},n),c.length&&this._trigger("remove",{items:c},n)}},DataView.prototype.on=DataSet.prototype.on,DataView.prototype.off=DataSet.prototype.off,DataView.prototype._trigger=DataSet.prototype._trigger,DataView.prototype.subscribe=DataView.prototype.on,DataView.prototype.unsubscribe=DataView.prototype.off;var stack={};stack.orderByStart=function(e){e.sort(function(e,t){return e.data.start-t.data.start})},stack.orderByEnd=function(e){e.sort(function(e,t){var n="end"in e.data?e.data.end:e.data.start,r="end"in t.data?t.data.end:t.data.start;return n-r})},stack.stack=function(e,t,n){var r,i;if(n)for(r=0,i=e.length;i>r;r++)e[r].top=null;for(r=0,i=e.length;i>r;r++){var s=e[r];if(null===s.top){s.top=t.axis;do{for(var o=null,u=0,a=e.length;a>u;u++){var f=e[u];if(null!==f.top&&f!==s&&stack.collision(s,f,t.item)){o=f;break}}null!=o&&(s.top=o.top+o.height+t.item)}while(o)}}},stack.nostack=function(e,t){var n,r;for(n=0,r=e.length;r>n;n++)e[n].top=t.axis},stack.collision=function(e,t,n){return e.left-n<t.left+t.width&&e.left+e.width+n>t.left&&e.top-n<t.top+t.height&&e.top+e.height+n>t.top},TimeStep.SCALE={MILLISECOND:1,SECOND:2,MINUTE:3,HOUR:4,DAY:5,WEEKDAY:6,MONTH:7,YEAR:8},TimeStep.prototype.setRange=function(e,t,n){if(!(e instanceof Date&&t instanceof Date))throw"No legal start or end date in method setRange";this._start=void 0!=e?new Date(e.valueOf()):new Date,this._end=void 0!=t?new Date(t.valueOf()):new Date,this.autoScale&&this.setMinimumStep(n)},TimeStep.prototype.first=function(){this.current=new Date(this._start.valueOf()),this.roundToMinor()},TimeStep.prototype.roundToMinor=function(){switch(this.scale){case TimeStep.SCALE.YEAR:this.current.setFullYear(this.step*Math.floor(this.current.getFullYear()/this.step)),this.current.setMonth(0);case TimeStep.SCALE.MONTH:this.current.setDate(1);case TimeStep.SCALE.DAY:case TimeStep.SCALE.WEEKDAY:this.current.setHours(0);case TimeStep.SCALE.HOUR:this.current.setMinutes(0);case TimeStep.SCALE.MINUTE:this.current.setSeconds(0);case TimeStep.SCALE.SECOND:this.current.setMilliseconds(0)}if(1!=this.step)switch(this.scale){case TimeStep.SCALE.MILLISECOND:this.current.setMilliseconds(this.current.getMilliseconds()-this.current.getMilliseconds()%this.step);break;case TimeStep.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()-this.current.getSeconds()%this.step);break;case TimeStep.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()-this.current.getMinutes()%this.step);break;case TimeStep.SCALE.HOUR:this.current.setHours(this.current.getHours()-this.current.getHours()%this.step);break;case TimeStep.SCALE.WEEKDAY:case TimeStep.SCALE.DAY:this.current.setDate(this.current.getDate()-1-(this.current.getDate()-1)%this.step+1);break;case TimeStep.SCALE.MONTH:this.current.setMonth(this.current.getMonth()-this.current.getMonth()%this.step);break;case TimeStep.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()-this.current.getFullYear()%this.step)}},TimeStep.prototype.hasNext=function(){return this.current.valueOf()<=this._end.valueOf()},TimeStep.prototype.next=function(){var e=this.current.valueOf();if(this.current.getMonth()<6)switch(this.scale){case TimeStep.SCALE.MILLISECOND:this.current=new Date(this.current.valueOf()+this.step);break;case TimeStep.SCALE.SECOND:this.current=new Date(this.current.valueOf()+1e3*this.step);break;case TimeStep.SCALE.MINUTE:this.current=new Date(this.current.valueOf()+1e3*this.step*60);break;case TimeStep.SCALE.HOUR:this.current=new Date(this.current.valueOf()+1e3*this.step*60*60);var t=this.current.getHours();this.current.setHours(t-t%this.step);break;case TimeStep.SCALE.WEEKDAY:case TimeStep.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case TimeStep.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case TimeStep.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step)}else switch(this.scale){case TimeStep.SCALE.MILLISECOND:this.current=new Date(this.current.valueOf()+this.step);break;case TimeStep.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()+this.step);break;case TimeStep.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()+this.step);break;case TimeStep.SCALE.HOUR:this.current.setHours(this.current.getHours()+this.step);break;case TimeStep.SCALE.WEEKDAY:case TimeStep.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case TimeStep.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case TimeStep.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step)}if(1!=this.step)switch(this.scale){case TimeStep.SCALE.MILLISECOND:this.current.getMilliseconds()<this.step&&this.current.setMilliseconds(0);break;case TimeStep.SCALE.SECOND:this.current.getSeconds()<this.step&&this.current.setSeconds(0);break;case TimeStep.SCALE.MINUTE:this.current.getMinutes()<this.step&&this.current.setMinutes(0);break;case TimeStep.SCALE.HOUR:this.current.getHours()<this.step&&this.current.setHours(0);break;case TimeStep.SCALE.WEEKDAY:case TimeStep.SCALE.DAY:this.current.getDate()<this.step+1&&this.current.setDate(1);break;case TimeStep.SCALE.MONTH:this.current.getMonth()<this.step&&this.current.setMonth(0);break;case TimeStep.SCALE.YEAR:}this.current.valueOf()==e&&(this.current=new Date(this._end.valueOf()))},TimeStep.prototype.getCurrent=function(){return this.current},TimeStep.prototype.setScale=function(e,t){this.scale=e,t>0&&(this.step=t),this.autoScale=!1},TimeStep.prototype.setAutoScale=function(e){this.autoScale=e},TimeStep.prototype.setMinimumStep=function(e){if(void 0!=e){var t=31104e6,n=2592e6,r=864e5,i=36e5,s=6e4,o=1e3,u=1;1e3*t>e&&(this.scale=TimeStep.SCALE.YEAR,this.step=1e3),500*t>e&&(this.scale=TimeStep.SCALE.YEAR,this.step=500),100*t>e&&(this.scale=TimeStep.SCALE.YEAR,this.step=100),50*t>e&&(this.scale=TimeStep.SCALE.YEAR,this.step=50),10*t>e&&(this.scale=TimeStep.SCALE.YEAR,this.step=10),5*t>e&&(this.scale=TimeStep.SCALE.YEAR,this.step=5),t>e&&(this.scale=TimeStep.SCALE.YEAR,this.step=1),3*n>e&&(this.scale=TimeStep.SCALE.MONTH,this.step=3),n>e&&(this.scale=TimeStep.SCALE.MONTH,this.step=1),5*r>e&&(this.scale=TimeStep.SCALE.DAY,this.step=5),2*r>e&&(this.scale=TimeStep.SCALE.DAY,this.step=2),r>e&&(this.scale=TimeStep.SCALE.DAY,this.step=1),r/2>e&&(this.scale=TimeStep.SCALE.WEEKDAY,this.step=1),4*i>e&&(this.scale=TimeStep.SCALE.HOUR,this.step=4),i>e&&(this.scale=TimeStep.SCALE.HOUR,this.step=1),15*s>e&&(this.scale=TimeStep.SCALE.MINUTE,this.step=15),10*s>e&&(this.scale=TimeStep.SCALE.MINUTE,this.step=10),5*s>e&&(this.scale=TimeStep.SCALE.MINUTE,this.step=5),s>e&&(this.scale=TimeStep.SCALE.MINUTE,this.step=1),15*o>e&&(this.scale=TimeStep.SCALE.SECOND,this.step=15),10*o>e&&(this.scale=TimeStep.SCALE.SECOND,this.step=10),5*o>e&&(this.scale=TimeStep.SCALE.SECOND,this.step=5),o>e&&(this.scale=TimeStep.SCALE.SECOND,this.step=1),200*u>e&&(this.scale=TimeStep.SCALE.MILLISECOND,this.step=200),100*u>e&&(this.scale=TimeStep.SCALE.MILLISECOND,this.step=100),50*u>e&&(this.scale=TimeStep.SCALE.MILLISECOND,this.step=50),10*u>e&&(this.scale=TimeStep.SCALE.MILLISECOND,this.step=10),5*u>e&&(this.scale=TimeStep.SCALE.MILLISECOND,this.step=5),u>e&&(this.scale=TimeStep.SCALE.MILLISECOND,this.step=1)}},TimeStep.prototype.snap=function(e){var t=new Date(e.valueOf());if(this.scale==TimeStep.SCALE.YEAR){var n=t.getFullYear()+Math.round(t.getMonth()/12);t.setFullYear(Math.round(n/this.step)*this.step),t.setMonth(0),t.setDate(0),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0)}else if(this.scale==TimeStep.SCALE.MONTH)t.getDate()>15?(t.setDate(1),t.setMonth(t.getMonth()+1)):t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);else if(this.scale==TimeStep.SCALE.DAY){switch(this.step){case 5:case 2:t.setHours(24*Math.round(t.getHours()/24));break;default:t.setHours(12*Math.round(t.getHours()/12))}t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0)}else if(this.scale==TimeStep.SCALE.WEEKDAY){switch(this.step){case 5:case 2:t.setHours(12*Math.round(t.getHours()/12));break;default:t.setHours(6*Math.round(t.getHours()/6))}t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0)}else if(this.scale==TimeStep.SCALE.HOUR){switch(this.step){case 4:t.setMinutes(60*Math.round(t.getMinutes()/60));break;default:t.setMinutes(30*Math.round(t.getMinutes()/30))}t.setSeconds(0),t.setMilliseconds(0)}else if(this.scale==TimeStep.SCALE.MINUTE){switch(this.step){case 15:case 10:t.setMinutes(5*Math.round(t.getMinutes()/5)),t.setSeconds(0);break;case 5:t.setSeconds(60*Math.round(t.getSeconds()/60));break;default:t.setSeconds(30*Math.round(t.getSeconds()/30))}t.setMilliseconds(0)}else if(this.scale==TimeStep.SCALE.SECOND)switch(this.step){case 15:case 10:t.setSeconds(5*Math.round(t.getSeconds()/5)),t.setMilliseconds(0);break;case 5:t.setMilliseconds(1e3*Math.round(t.getMilliseconds()/1e3));break;default:t.setMilliseconds(500*Math.round(t.getMilliseconds()/500))}else if(this.scale==TimeStep.SCALE.MILLISECOND){var r=this.step>5?this.step/2:1;t.setMilliseconds(Math.round(t.getMilliseconds()/r)*r)}return t},TimeStep.prototype.isMajor=function(){switch(this.scale){case TimeStep.SCALE.MILLISECOND:return 0==this.current.getMilliseconds();case TimeStep.SCALE.SECOND:return 0==this.current.getSeconds();case TimeStep.SCALE.MINUTE:return 0==this.current.getHours()&&0==this.current.getMinutes();case TimeStep.SCALE.HOUR:return 0==this.current.getHours();case TimeStep.SCALE.WEEKDAY:case TimeStep.SCALE.DAY:return 1==this.current.getDate();case TimeStep.SCALE.MONTH:return 0==this.current.getMonth();case TimeStep.SCALE.YEAR:return!1;default:return!1}},TimeStep.prototype.getLabelMinor=function(e){switch(void 0==e&&(e=this.current),this.scale){case TimeStep.SCALE.MILLISECOND:return moment(e).format("SSS");case TimeStep.SCALE.SECOND:return moment(e).format("s");case TimeStep.SCALE.MINUTE:return moment(e).format("HH:mm");case TimeStep.SCALE.HOUR:return moment(e).format("HH:mm");case TimeStep.SCALE.WEEKDAY:return moment(e).format("ddd D");case TimeStep.SCALE.DAY:return moment(e).format("D");case TimeStep.SCALE.MONTH:return moment(e).format("MMM");case TimeStep.SCALE.YEAR:return moment(e).format("YYYY");default:return""}},TimeStep.prototype.getLabelMajor=function(e){switch(void 0==e&&(e=this.current),this.scale){case TimeStep.SCALE.MILLISECOND:return moment(e).format("HH:mm:ss");case TimeStep.SCALE.SECOND:return moment(e).format("D MMMM HH:mm");case TimeStep.SCALE.MINUTE:case TimeStep.SCALE.HOUR:return moment(e).format("ddd D MMMM");case TimeStep.SCALE.WEEKDAY:case TimeStep.SCALE.DAY:return moment(e).format("MMMM YYYY");case TimeStep.SCALE.MONTH:return moment(e).format("YYYY");case TimeStep.SCALE.YEAR:return"";default:return""}},Range.prototype=new Component,Range.prototype.setOptions=function(e){if(e){var t=["direction","min","max","zoomMin","zoomMax","moveable","zoomable"];util.selectiveExtend(t,this.options,e),("start"in e||"end"in e)&&this.setRange(e.start,e.end)}},Range.prototype.setRange=function(e,t){var n=this._applyRange(e,t);if(n){var r={start:new Date(this.start),end:new Date(this.end)};this.body.emitter.emit("rangechange",r),this.body.emitter.emit("rangechanged",r)}},Range.prototype._applyRange=function(e,t){var n,r=null!=e?util.convert(e,"Date").valueOf():this.start,i=null!=t?util.convert(t,"Date").valueOf():this.end,s=null!=this.options.max?util.convert(this.options.max,"Date").valueOf():null,o=null!=this.options.min?util.convert(this.options.min,"Date").valueOf():null;if(isNaN(r)||null===r)throw new Error('Invalid start "'+e+'"');if(isNaN(i)||null===i)throw new Error('Invalid end "'+t+'"');if(r>i&&(i=r),null!==o&&o>r&&(n=o-r,r+=n,i+=n,null!=s&&i>s&&(i=s)),null!==s&&i>s&&(n=i-s,r-=n,i-=n,null!=o&&o>r&&(r=o)),null!==this.options.zoomMin){var u=parseFloat(this.options.zoomMin);0>u&&(u=0),u>i-r&&(this.end-this.start===u?(r=this.start,i=this.end):(n=u-(i-r),r-=n/2,i+=n/2))}if(null!==this.options.zoomMax){var a=parseFloat(this.options.zoomMax);0>a&&(a=0),i-r>a&&(this.end-this.start===a?(r=this.start,i=this.end):(n=i-r-a,r+=n/2,i-=n/2))}var f=this.start!=r||this.end!=i;return this.start=r,this.end=i,f},Range.prototype.getRange=function(){return{start:this.start,end:this.end}},Range.prototype.conversion=function(e){return Range.conversion(this.start,this.end,e)},Range.conversion=function(e,t,n){return 0!=n&&t-e!=0?{offset:e,scale:n/(t-e)}:{offset:0,scale:1}},Range.prototype._onDragStart=function(){this.options.moveable&&this.props.touch.allowDragging&&(this.props.touch.start=this.start,this.props.touch.end=this.end,this.body.dom.root&&(this.body.dom.root.style.cursor="move"))},Range.prototype._onDrag=function(e){if(this.options.moveable){var t=this.options.direction;if(validateDirection(t),this.props.touch.allowDragging){var n="horizontal"==t?e.gesture.deltaX:e.gesture.deltaY,r=this.props.touch.end-this.props.touch.start,i="horizontal"==t?this.body.domProps.center.width:this.body.domProps.center.height,s=-n/i*r;this._applyRange(this.props.touch.start+s,this.props.touch.end+s),this.body.emitter.emit("rangechange",{start:new Date(this.start),end:new Date(this.end)})}}},Range.prototype._onDragEnd=function(){this.options.moveable&&this.props.touch.allowDragging&&(this.body.dom.root&&(this.body.dom.root.style.cursor="auto"),this.body.emitter.emit("rangechanged",{start:new Date(this.start),end:new Date(this.end)}))},Range.prototype._onMouseWheel=function(e){if(this.options.zoomable&&this.options.moveable){var t=0;if(e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t){var n;n=0>t?1-t/5:1/(1+t/5);var r=util.fakeGesture(this,e),i=getPointer(r.center,this.body.dom.center),s=this._pointerToDate(i);this.zoom(n,s)}e.preventDefault()}},Range.prototype._onTouch=function(){this.props.touch.start=this.start,this.props.touch.end=this.end,this.props.touch.allowDragging=!0,this.props.touch.center=null},Range.prototype._onHold=function(){this.props.touch.allowDragging=!1},Range.prototype._onPinch=function(e){if(this.options.zoomable&&this.options.moveable&&(this.props.touch.allowDragging=!1,e.gesture.touches.length>1)){this.props.touch.center||(this.props.touch.center=getPointer(e.gesture.center,this.body.dom.center));var t=1/e.gesture.scale,n=this._pointerToDate(this.props.touch.center),r=parseInt(n+(this.props.touch.start-n)*t),i=parseInt(n+(this.props.touch.end-n)*t);this.setRange(r,i)}},Range.prototype._pointerToDate=function(e){var t,n=this.options.direction;if(validateDirection(n),"horizontal"==n){var r=this.body.domProps.center.width;return t=this.conversion(r),e.x/t.scale+t.offset}var i=this.body.domProps.center.height;return t=this.conversion(i),e.y/t.scale+t.offset},Range.prototype.zoom=function(e,t){null==t&&(t=(this.start+this.end)/2);var n=t+(this.start-t)*e,r=t+(this.end-t)*e;this.setRange(n,r)},Range.prototype.move=function(e){var t=this.end-this.start,n=this.start+t*e,r=this.end+t*e;this.start=n,this.end=r},Range.prototype.moveTo=function(e){var t=(this.start+this.end)/2,n=t-e,r=this.start-n,i=this.end-n;this.setRange(r,i)},Component.prototype.setOptions=function(e){e&&util.extend(this.options,e)},Component.prototype.redraw=function(){return!1},Component.prototype.destroy=function(){},Component.prototype._isResized=function(){var e=this.props._previousWidth!==this.props.width||this.props._previousHeight!==this.props.height;return this.props._previousWidth=this.props.width,this.props._previousHeight=this.props.height,e},TimeAxis.prototype=new Component,TimeAxis.prototype.setOptions=function(e){e&&util.selectiveExtend(["orientation","showMinorLabels","showMajorLabels"],this.options,e)},TimeAxis.prototype._create=function(){this.dom.foreground=document.createElement("div"),this.dom.background=document.createElement("div"),this.dom.foreground.className="timeaxis foreground",this.dom.background.className="timeaxis background"},TimeAxis.prototype.destroy=function(){this.dom.foreground.parentNode&&this.dom.foreground.parentNode.removeChild(this.dom.foreground),this.dom.background.parentNode&&this.dom.background.parentNode.removeChild(this.dom.background),this.body=null},TimeAxis.prototype.redraw=function(){var e=this.options,t=this.props,n=this.dom.foreground,r=this.dom.background,i="top"==e.orientation?this.body.dom.top:this.body.dom.bottom,s=n.parentNode!==i;this._calculateCharSize();var o=(this.options.orientation,this.options.showMinorLabels),u=this.options.showMajorLabels;t.minorLabelHeight=o?t.minorCharHeight:0,t.majorLabelHeight=u?t.majorCharHeight:0,t.height=t.minorLabelHeight+t.majorLabelHeight,t.width=n.offsetWidth,t.minorLineHeight=this.body.domProps.root.height-t.majorLabelHeight-("top"==e.orientation?this.body.domProps.bottom.height:this.body.domProps.top.height),t.minorLineWidth=1,t.majorLineHeight=t.minorLineHeight+t.majorLabelHeight,t.majorLineWidth=1;var a=n.nextSibling,f=r.nextSibling;return n.parentNode&&n.parentNode.removeChild(n),r.parentNode&&r.parentNode.removeChild(r),n.style.height=this.props.height+"px",this._repaintLabels(),a?i.insertBefore(n,a):i.appendChild(n),f?this.body.dom.backgroundVertical.insertBefore(r,f):this.body.dom.backgroundVertical.appendChild(r),this._isResized()||s},TimeAxis.prototype._repaintLabels=function(){var e=this.options.orientation,t=util.convert(this.body.range.start,"Number"),n=util.convert(this.body.range.end,"Number"),r=this.body.util.toTime(7*(this.props.minorCharWidth||10)).valueOf()-this.body.util.toTime(0).valueOf(),i=new TimeStep(new Date(t),new Date(n),r);this.step=i;var s=this.dom;s.redundant.majorLines=s.majorLines,s.redundant.majorTexts=s.majorTexts,s.redundant.minorLines=s.minorLines,s.redundant.minorTexts=s.minorTexts,s.majorLines=[],s.majorTexts=[],s.minorLines=[],s.minorTexts=[],i.first();for(var o=void 0,u=0;i.hasNext()&&1e3>u;){u++;var a=i.getCurrent(),f=this.body.util.toScreen(a),l=i.isMajor();this.options.showMinorLabels&&this._repaintMinorText(f,i.getLabelMinor(),e),l&&this.options.showMajorLabels?(f>0&&(void 0==o&&(o=f),this._repaintMajorText(f,i.getLabelMajor(),e)),this._repaintMajorLine(f,e)):this._repaintMinorLine(f,e),i.next()}if(this.options.showMajorLabels){var c=this.body.util.toTime(0),h=i.getLabelMajor(c),p=h.length*(this.props.majorCharWidth||10)+10;(void 0==o||o>p)&&this._repaintMajorText(0,h,e)}util.forEach(this.dom.redundant,function(e){for(;e.length;){var t=e.pop();t&&t.parentNode&&t.parentNode.removeChild(t)}})},TimeAxis.prototype._repaintMinorText=function(e,t,n){var r=this.dom.redundant.minorTexts.shift();if(!r){var i=document.createTextNode("");r=document.createElement("div"),r.appendChild(i),r.className="text minor",this.dom.foreground.appendChild(r)}this.dom.minorTexts.push(r),r.childNodes[0].nodeValue=t,r.style.top="top"==n?this.props.majorLabelHeight+"px":"0",r.style.left=e+"px"},TimeAxis.prototype._repaintMajorText=function(e,t,n){var r=this.dom.redundant.majorTexts.shift();if(!r){var i=document.createTextNode(t);r=document.createElement("div"),r.className="text major",r.appendChild(i),this.dom.foreground.appendChild(r)}this.dom.majorTexts.push(r),r.childNodes[0].nodeValue=t,r.style.top="top"==n?"0":this.props.minorLabelHeight+"px",r.style.left=e+"px"},TimeAxis.prototype._repaintMinorLine=function(e,t){var n=this.dom.redundant.minorLines.shift();n||(n=document.createElement("div"),n.className="grid vertical minor",this.dom.background.appendChild(n)),this.dom.minorLines.push(n);var r=this.props;n.style.top="top"==t?r.majorLabelHeight+"px":this.body.domProps.top.height+"px",n.style.height=r.minorLineHeight+"px",n.style.left=e-r.minorLineWidth/2+"px"},TimeAxis.prototype._repaintMajorLine=function(e,t){var n=this.dom.redundant.majorLines.shift();n||(n=document.createElement("DIV"),n.className="grid vertical major",this.dom.background.appendChild(n)),this.dom.majorLines.push(n);var r=this.props;n.style.top="top"==t?"0":this.body.domProps.top.height+"px",n.style.left=e-r.majorLineWidth/2+"px",n.style.height=r.majorLineHeight+"px"},TimeAxis.prototype._calculateCharSize=function(){this.dom.measureCharMinor||(this.dom.measureCharMinor=document.createElement("DIV"),this.dom.measureCharMinor.className="text minor measure",this.dom.measureCharMinor.style.position="absolute",this.dom.measureCharMinor.appendChild(document.createTextNode("0")),this.dom.foreground.appendChild(this.dom.measureCharMinor)),this.props.minorCharHeight=this.dom.measureCharMinor.clientHeight,this.props.minorCharWidth=this.dom.measureCharMinor.clientWidth,this.dom.measureCharMajor||(this.dom.measureCharMajor=document.createElement("DIV"),this.dom.measureCharMajor.className="text minor measure",this.dom.measureCharMajor.style.position="absolute",this.dom.measureCharMajor.appendChild(document.createTextNode("0")),this.dom.foreground.appendChild(this.dom.measureCharMajor)),this.props.majorCharHeight=this.dom.measureCharMajor.clientHeight,this.props.majorCharWidth=this.dom.measureCharMajor.clientWidth},TimeAxis.prototype.snap=function(e){return this.step.snap(e)},CurrentTime.prototype=new Component,CurrentTime.prototype._create=function(){var e=document.createElement("div");e.className="currenttime",e.style.position="absolute",e.style.top="0px",e.style.height="100%",this.bar=e},CurrentTime.prototype.destroy=function(){this.options.showCurrentTime=!1,this.redraw(),this.body=null},CurrentTime.prototype.setOptions=function(e){e&&util.selectiveExtend(["showCurrentTime"],this.options,e)},CurrentTime.prototype.redraw=function(){if(this.options.showCurrentTime){var e=this.body.dom.backgroundVertical;this.bar.parentNode!=e&&(this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),e.appendChild(this.bar),this.start());var t=new Date,n=this.body.util.toScreen(t);this.bar.style.left=n+"px",this.bar.title="Current time: "+t}else this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),this.stop();return!1},CurrentTime.prototype.start=function(){function e(){t.stop();var n=t.body.range.conversion(t.body.domProps.center.width).scale,r=1/n/10;30>r&&(r=30),r>1e3&&(r=1e3),t.redraw(),t.currentTimeTimer=setTimeout(e,r)}var t=this;e()},CurrentTime.prototype.stop=function(){void 0!==this.currentTimeTimer&&(clearTimeout(this.currentTimeTimer),delete this.currentTimeTimer)},CustomTime.prototype=new Component,CustomTime.prototype.setOptions=function(e){e&&util.selectiveExtend(["showCustomTime"],this.options,e)},CustomTime.prototype._create=function(){var e=document.createElement("div");e.className="customtime",e.style.position="absolute",e.style.top="0px",e.style.height="100%",this.bar=e;var t=document.createElement("div");t.style.position="relative",t.style.top="0px",t.style.left="-10px",t.style.height="100%",t.style.width="20px",e.appendChild(t),this.hammer=Hammer(e,{prevent_default:!0}),this.hammer.on("dragstart",this._onDragStart.bind(this)),this.hammer.on("drag",this._onDrag.bind(this)),this.hammer.on("dragend",this._onDragEnd.bind(this))},CustomTime.prototype.destroy=function(){this.options.showCustomTime=!1,this.redraw(),this.hammer.enable(!1),this.hammer=null,this.body=null},CustomTime.prototype.redraw=function(){if(this.options.showCustomTime){var e=this.body.dom.backgroundVertical;this.bar.parentNode!=e&&(this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),e.appendChild(this.bar));var t=this.body.util.toScreen(this.customTime);this.bar.style.left=t+"px",this.bar.title="Time: "+this.customTime}else this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar);return!1},CustomTime.prototype.setCustomTime=function(e){this.customTime=new Date(e.valueOf()),this.redraw()},CustomTime.prototype.getCustomTime=function(){return new Date(this.customTime.valueOf())},CustomTime.prototype._onDragStart=function(e){this.eventParams.dragging=!0,this.eventParams.customTime=this.customTime,e.stopPropagation(),e.preventDefault()},CustomTime.prototype._onDrag=function(e){if(this.eventParams.dragging){var t=e.gesture.deltaX,n=this.body.util.toScreen(this.eventParams.customTime)+t,r=this.body.util.toTime(n);this.setCustomTime(r),this.body.emitter.emit("timechange",{time:new Date(this.customTime.valueOf())}),e.stopPropagation(),e.preventDefault()}},CustomTime.prototype._onDragEnd=function(e){this.eventParams.dragging&&(this.body.emitter.emit("timechanged",{time:new Date(this.customTime.valueOf())}),e.stopPropagation(),e.preventDefault())};var UNGROUPED="__ungrouped__";ItemSet.prototype=new Component,ItemSet.types={box:ItemBox,range:ItemRange,rangeoverflow:ItemRangeOverflow,point:ItemPoint},ItemSet.prototype._create=function(){var e=document.createElement("div");e.className="itemset",e["timeline-itemset"]=this,this.dom.frame=e;var t=document.createElement("div");t.className="background",e.appendChild(t),this.dom.background=t;var n=document.createElement("div");n.className="foreground",e.appendChild(n),this.dom.foreground=n;var r=document.createElement("div");r.className="axis",this.dom.axis=r;var i=document.createElement("div");i.className="labelset",this.dom.labelSet=i,this._updateUngrouped(),this.hammer=Hammer(this.body.dom.centerContainer,{prevent_default:!0}),this.hammer.on("touch",this._onTouch.bind(this)),this.hammer.on("dragstart",this._onDragStart.bind(this)),this.hammer.on("drag",this._onDrag.bind(this)),this.hammer.on("dragend",this._onDragEnd.bind(this)),this.hammer.on("tap",this._onSelectItem.bind(this)),this.hammer.on("hold",this._onMultiSelectItem.bind(this)),this.hammer.on("doubletap",this._onAddItem.bind(this)),this.show()},ItemSet.prototype.setOptions=function(e){if(e){var t=["type","align","orientation","padding","stack","selectable","groupOrder"];util.selectiveExtend(t,this.options,e),"margin"in e&&("number"==typeof e.margin?(this.options.margin.axis=e.margin,this.options.margin.item=e.margin):"object"==typeof e.margin&&util.selectiveExtend(["axis","item"],this.options.margin,e.margin)),"editable"in e&&("boolean"==typeof e.editable?(this.options.editable.updateTime=e.editable,this.options.editable.updateGroup=e.editable,this.options.editable.add=e.editable,this.options.editable.remove=e.editable):"object"==typeof e.editable&&util.selectiveExtend(["updateTime","updateGroup","add","remove"],this.options.editable,e.editable));var n=function(t){if(t in e){var n=e[t];if(!(n instanceof Function&&2==n.length))throw new Error("option "+t+" must be a function "+t+"(item, callback)");this.options[t]=n}}.bind(this);["onAdd","onUpdate","onRemove","onMove"].forEach(n),this.markDirty()}},ItemSet.prototype.markDirty=function(){this.groupIds=[],this.stackDirty=!0},ItemSet.prototype.destroy=function(){this.hide(),this.setItems(null),this.setGroups(null),this.hammer=null,this.body=null,this.conversion=null},ItemSet.prototype.hide=function(){this.dom.frame.parentNode&&this.dom.frame.parentNode.removeChild(this.dom.frame),this.dom.axis.parentNode&&this.dom.axis.parentNode.removeChild(this.dom.axis),this.dom.labelSet.parentNode&&this.dom.labelSet.parentNode.removeChild(this.dom.labelSet)},ItemSet.prototype.show=function(){this.dom.frame.parentNode||this.body.dom.center.appendChild(this.dom.frame),this.dom.axis.parentNode||this.body.dom.backgroundVertical.appendChild(this.dom.axis),this.dom.labelSet.parentNode||this.body.dom.left.appendChild(this.dom.labelSet)},ItemSet.prototype.setSelection=function(e){var t,n,r,i;if(e){if(!Array.isArray(e))throw new TypeError("Array expected");for(t=0,n=this.selection.length;n>t;t++)r=this.selection[t],i=this.items[r],i&&i.unselect();for(this.selection=[],t=0,n=e.length;n>t;t++)r=e[t],i=this.items[r],i&&(this.selection.push(r),i.select())}},ItemSet.prototype.getSelection=function(){return this.selection.concat([])},ItemSet.prototype._deselect=function(e){for(var t=this.selection,n=0,r=t.length;r>n;n++)if(t[n]==e){t.splice(n,1);break}},ItemSet.prototype.redraw=function(){var e=this.options.margin,t=this.body.range,n=util.option.asSize,r=this.options,i=r.orientation,s=!1,o=this.dom.frame,u=r.editable.updateTime||r.editable.updateGroup;o.className="itemset"+(u?" editable":""),s=this._orderGroups()||s;var a=t.end-t.start,f=a!=this.lastVisibleInterval||this.props.width!=this.props.lastWidth;f&&(this.stackDirty=!0),this.lastVisibleInterval=a,this.props.lastWidth=this.props.width;var l=this.stackDirty,c=this._firstGroup(),h={item:e.item,axis:e.axis},p={item:e.item,axis:e.item/2},d=0,v=e.axis+e.item;return util.forEach(this.groups,function(e){var n=e==c?h:p,r=e.redraw(t,n,l);s=r||s,d+=e.height}),d=Math.max(d,v),this.stackDirty=!1,o.style.height=n(d),this.props.top=o.offsetTop,this.props.left=o.offsetLeft,this.props.width=o.offsetWidth,this.props.height=d,this.dom.axis.style.top=n("top"==i?this.body.domProps.top.height+this.body.domProps.border.top:this.body.domProps.top.height+this.body.domProps.centerContainer.height),this.dom.axis.style.left=this.body.domProps.border.left+"px",s=this._isResized()||s},ItemSet.prototype._firstGroup=function(){var e="top"==this.options.orientation?0:this.groupIds.length-1,t=this.groupIds[e],n=this.groups[t]||this.groups[UNGROUPED];return n||null},ItemSet.prototype._updateUngrouped=function(){var e=this.groups[UNGROUPED];if(this.groupsData)e&&(e.hide(),delete this.groups[UNGROUPED]);else if(!e){var t=null,n=null;e=new Group(t,n,this),this.groups[UNGROUPED]=e;for(var r in this.items)this.items.hasOwnProperty(r)&&e.add(this.items[r]);e.show()}},ItemSet.prototype.getLabelSet=function(){return this.dom.labelSet},ItemSet.prototype.setItems=function(e){var t,n=this,r=this.itemsData;if(e){if(!(e instanceof DataSet||e instanceof DataView))throw new TypeError("Data must be an instance of DataSet or DataView");this.itemsData=e}else this.itemsData=null;if(r&&(util.forEach(this.itemListeners,function(e,t){r.off(t,e)}),t=r.getIds(),this._onRemove(t)),this.itemsData){var i=this.id;util.forEach(this.itemListeners,function(e,t){n.itemsData.on(t,e,i)}),t=this.itemsData.getIds(),this._onAdd(t),this._updateUngrouped()}},ItemSet.prototype.getItems=function(){return this.itemsData},ItemSet.prototype.setGroups=function(e){var t,n=this;if(this.groupsData&&(util.forEach(this.groupListeners,function(e,t){n.groupsData.unsubscribe(t,e)}),t=this.groupsData.getIds(),this.groupsData=null,this._onRemoveGroups(t)),e){if(!(e instanceof DataSet||e instanceof DataView))throw new TypeError("Data must be an instance of DataSet or DataView");this.groupsData=e}else this.groupsData=null;if(this.groupsData){var r=this.id;util.forEach(this.groupListeners,function(e,t){n.groupsData.on(t,e,r)}),t=this.groupsData.getIds(),this._onAddGroups(t)}this._updateUngrouped(),this._order(),this.body.emitter.emit("change")},ItemSet.prototype.getGroups=function(){return this.groupsData},ItemSet.prototype.removeItem=function(e){var t=this.itemsData.get(e),n=this._myDataSet();t&&this.options.onRemove(t,function(t){t&&n.remove(e)})},ItemSet.prototype._onUpdate=function(e){var t=this;e.forEach(function(e){var n=t.itemsData.get(e,t.itemOptions),r=t.items[e],i=n.type||n.start&&n.end&&"range"||t.options.type||"box",s=ItemSet.types[i];if(r&&(s&&r instanceof s?t._updateItem(r,n):(t._removeItem(r),r=null)),!r){if(!s)throw new TypeError('Unknown item type "'+i+'"');r=new s(n,t.conversion,t.options),r.id=e,t._addItem(r)}}),this._order(),this.stackDirty=!0,this.body.emitter.emit("change")},ItemSet.prototype._onAdd=ItemSet.prototype._onUpdate,ItemSet.prototype._onRemove=function(e){var t=0,n=this;e.forEach(function(e){var r=n.items[e];r&&(t++,n._removeItem(r))}),t&&(this._order(),this.stackDirty=!0,this.body.emitter.emit("change"))},ItemSet.prototype._order=function(){util.forEach(this.groups,function(e){e.order()})},ItemSet.prototype._onUpdateGroups=function(e){this._onAddGroups(e)},ItemSet.prototype._onAddGroups=function(e){var t=this;e.forEach(function(e){var n=t.groupsData.get(e),r=t.groups[e];if(r)r.setData(n);else{if(e==UNGROUPED)throw new Error("Illegal group id. "+e+" is a reserved id.");var i=Object.create(t.options);util.extend(i,{height:null}),r=new Group(e,n,t),t.groups[e]=r;for(var s in t.items)if(t.items.hasOwnProperty(s)){var o=t.items[s];o.data.group==e&&r.add(o)}r.order(),r.show()}}),this.body.emitter.emit("change")},ItemSet.prototype._onRemoveGroups=function(e){var t=this.groups;e.forEach(function(e){var n=t[e];n&&(n.hide(),delete t[e])}),this.markDirty(),this.body.emitter.emit("change")},ItemSet.prototype._orderGroups=function(){if(this.groupsData){var e=this.groupsData.getIds({order:this.options.groupOrder}),t=!util.equalArray(e,this.groupIds);if(t){var n=this.groups;e.forEach(function(e){n[e].hide()}),e.forEach(function(e){n[e].show()}),this.groupIds=e}return t}return!1},ItemSet.prototype._addItem=function(e){this.items[e.id]=e;var t=this.groupsData?e.data.group:UNGROUPED,n=this.groups[t];n&&n.add(e)},ItemSet.prototype._updateItem=function(e,t){var n=e.data.group;if(e.data=t,e.displayed&&e.redraw(),n!=e.data.group){var r=this.groups[n];r&&r.remove(e);var i=this.groupsData?e.data.group:UNGROUPED,s=this.groups[i];s&&s.add(e)}},ItemSet.prototype._removeItem=function(e){e.hide(),delete this.items[e.id];var t=this.selection.indexOf(e.id);-1!=t&&this.selection.splice(t,1);var n=this.groupsData?e.data.group:UNGROUPED,r=this.groups[n];r&&r.remove(e)},ItemSet.prototype._constructByEndArray=function(e){for(var t=[],n=0;n<e.length;n++)e[n]instanceof ItemRange&&t.push(e[n]);return t},ItemSet.prototype._onTouch=function(e){this.touchParams.item=ItemSet.itemFromTarget(e)},ItemSet.prototype._onDragStart=function(e){if(this.options.editable.updateTime||this.options.editable.updateGroup){var t,n=this.touchParams.item||null,r=this;if(n&&n.selected){var i=e.target.dragLeftItem,s=e.target.dragRightItem;i?(t={item:i},r.options.editable.updateTime&&(t.start=n.data.start.valueOf()),r.options.editable.updateGroup&&"group"in n.data&&(t.group=n.data.group),this.touchParams.itemProps=[t]):s?(t={item:s},r.options.editable.updateTime&&(t.end=n.data.end.valueOf()),r.options.editable.updateGroup&&"group"in n.data&&(t.group=n.data.group),this.touchParams.itemProps=[t]):this.touchParams.itemProps=this.getSelection().map(function(e){var t=r.items[e],n={item:t};return r.options.editable.updateTime&&("start"in t.data&&(n.start=t.data.start.valueOf()),"end"in t.data&&(n.end=t.data.end.valueOf())),r.options.editable.updateGroup&&"group"in t.data&&(n.group=t.data.group),n}),e.stopPropagation()}}},ItemSet.prototype._onDrag=function(e){if(this.touchParams.itemProps){var t=this.body.range,n=this.body.util.snap||null,r=e.gesture.deltaX,i=this.props.width/(t.end-t.start),s=r/i;this.touchParams.itemProps.forEach(function(t){if("start"in t){var r=new Date(t.start+s);t.item.data.start=n?n(r):r}if("end"in t){var i=new Date(t.end+s);t.item.data.end=n?n(i):i}if("group"in t){var u=ItemSet.groupFromTarget(e);if(u&&u.groupId!=t.item.data.group){var a=t.item.parent;a.remove(t.item),a.order(),u.add(t.item),u.order(),t.item.data.group=u.groupId}}}),this.stackDirty=!0,this.body.emitter.emit("change"),e.stopPropagation()}},ItemSet.prototype._onDragEnd=function(e){if(this.touchParams.itemProps){var t=[],n=this,r=this._myDataSet();this.touchParams.itemProps.forEach(function(e){var o=e.item.id,u=n.itemsData.get(o,n.itemOptions),a=!1;"start"in e.item.data&&(a=e.start!=e.item.data.start.valueOf(),u.start=util.convert(e.item.data.start,r._options.type&&r._options.type.start||"Date")),"end"in e.item.data&&(a=a||e.end!=e.item.data.end.valueOf(),u.end=util.convert(e.item.data.end,r._options.type&&r._options.type.end||"Date")),"group"in e.item.data&&(a=a||e.group!=e.item.data.group,u.group=e.item.data.group),a&&n.options.onMove(u,function(u){u?(u[r._fieldId]=o,t.push(u)):("start"in e&&(e.item.data.start=e.start),"end"in e&&(e.item.data.end=e.end),n.stackDirty=!0,n.body.emitter.emit("change"))})}),this.touchParams.itemProps=null,t.length&&r.update(t),e.stopPropagation()}},ItemSet.prototype._onSelectItem=function(e){if(this.options.selectable){var t=e.gesture.srcEvent&&e.gesture.srcEvent.ctrlKey,n=e.gesture.srcEvent&&e.gesture.srcEvent.shiftKey;if(t||n)return void this._onMultiSelectItem(e);var r=this.getSelection(),i=ItemSet.itemFromTarget(e),s=i?[i.id]:[];this.setSelection(s);var o=this.getSelection();(o.length>0||r.length>0)&&this.body.emitter.emit("select",{items:this.getSelection()}),e.stopPropagation()}},ItemSet.prototype._onAddItem=function(e){if(this.options.selectable&&this.options.editable.add){var t=this,n=this.body.util.snap||null,r=ItemSet.itemFromTarget(e);if(r){var i=t.itemsData.get(r.id);this.options.onUpdate(i,function(e){e&&t.itemsData.update(e)})}else{var s=vis.util.getAbsoluteLeft(this.dom.frame),o=e.gesture.center.pageX-s,u=this.body.util.toTime(o),a={start:n?n(u):u,content:"new item"};if("range"===this.options.type||"rangeoverflow"==this.options.type){var f=this.body.util.toTime(o+this.props.width/5);a.end=n?n(f):f}a[this.itemsData.fieldId]=util.randomUUID();var l=ItemSet.groupFromTarget(e);l&&(a.group=l.groupId),this.options.onAdd(a,function(e){e&&t.itemsData.add(a)})}}},ItemSet.prototype._onMultiSelectItem=function(e){if(this.options.selectable){var t,n=ItemSet.itemFromTarget(e);if(n){t=this.getSelection();var r=t.indexOf(n.id);-1==r?t.push(n.id):t.splice(r,1),this.setSelection(t),this.body.emitter.emit("select",{items:this.getSelection()}),e.stopPropagation()}}},ItemSet.itemFromTarget=function(e){for(var t=e.target;t;){if(t.hasOwnProperty("timeline-item"))return t["timeline-item"];t=t.parentNode}return null},ItemSet.groupFromTarget=function(e){for(var t=e.target;t;){if(t.hasOwnProperty("timeline-group"))return t["timeline-group"];t=t.parentNode}return null},ItemSet.itemSetFromTarget=function(e){for(var t=e.target;t;){if(t.hasOwnProperty("timeline-itemset"))return t["timeline-itemset"];t=t.parentNode}return null},ItemSet.prototype._myDataSet=function(){for(var e=this.itemsData;e instanceof DataView;)e=e.data;return e},Item.prototype.select=function(){this.selected=!0,this.displayed&&this.redraw()},Item.prototype.unselect=function(){this.selected=!1,this.displayed&&this.redraw()},Item.prototype.setParent=function(e){this.displayed?(this.hide(),this.parent=e,this.parent&&this.show()):this.parent=e},Item.prototype.isVisible=function(){return!1},Item.prototype.show=function(){return!1},Item.prototype.hide=function(){return!1},Item.prototype.redraw=function(){},Item.prototype.repositionX=function(){},Item.prototype.repositionY=function(){},Item.prototype._repaintDeleteButton=function(e){if(this.selected&&this.options.editable.remove&&!this.dom.deleteButton){var t=this,n=document.createElement("div");n.className="delete",n.title="Delete this item",Hammer(n,{preventDefault:!0}).on("tap",function(e){t.parent.removeFromDataSet(t),e.stopPropagation()}),e.appendChild(n),this.dom.deleteButton=n}else!this.selected&&this.dom.deleteButton&&(this.dom.deleteButton.parentNode&&this.dom.deleteButton.parentNode.removeChild(this.dom.deleteButton),this.dom.deleteButton=null)},ItemBox.prototype=new Item(null,null,null),ItemBox.prototype.isVisible=function(e){var t=(e.end-e.start)/4;return this.data.start>e.start-t&&this.data.start<e.end+t},ItemBox.prototype.redraw=function(){var e=this.dom;if(e||(this.dom={},e=this.dom,e.box=document.createElement("DIV"),e.content=document.createElement("DIV"),e.content.className="content",e.box.appendChild(e.content),e.line=document.createElement("DIV"),e.line.className="line",e.dot=document.createElement("DIV"),e.dot.className="dot",e.box["timeline-item"]=this),!this.parent)throw new Error("Cannot redraw item: no parent attached");if(!e.box.parentNode){var t=this.parent.dom.foreground;if(!t)throw new Error("Cannot redraw time axis: parent has no foreground container element");t.appendChild(e.box)}if(!e.line.parentNode){var n=this.parent.dom.background;if(!n)throw new Error("Cannot redraw time axis: parent has no background container element");n.appendChild(e.line)}if(!e.dot.parentNode){var r=this.parent.dom.axis;if(!n)throw new Error("Cannot redraw time axis: parent has no axis container element");r.appendChild(e.dot)}if(this.displayed=!0,this.data.content!=this.content){if(this.content=this.data.content,this.content instanceof Element)e.content.innerHTML="",e.content.appendChild(this.content);else{if(void 0==this.data.content)throw new Error('Property "content" missing in item '+this.data.id);e.content.innerHTML=this.content}this.dirty=!0}var i=(this.data.className?" "+this.data.className:"")+(this.selected?" selected":"");this.className!=i&&(this.className=i,e.box.className="item box"+i,e.line.className="item line"+i,e.dot.className="item dot"+i,this.dirty=!0),this.dirty&&(this.props.dot.height=e.dot.offsetHeight,this.props.dot.width=e.dot.offsetWidth,this.props.line.width=e.line.offsetWidth,this.width=e.box.offsetWidth,this.height=e.box.offsetHeight,this.dirty=!1),this._repaintDeleteButton(e.box)},ItemBox.prototype.show=function(){this.displayed||this.redraw()},ItemBox.prototype.hide=function(){if(this.displayed){var e=this.dom;e.box.parentNode&&e.box.parentNode.removeChild(e.box),e.line.parentNode&&e.line.parentNode.removeChild(e.line),e.dot.parentNode&&e.dot.parentNode.removeChild(e.dot),this.top=null,this.left=null,this.displayed=!1}},ItemBox.prototype.repositionX=function(){var e=this.conversion.toScreen(this.data.start),t=this.options.align,n=this.dom.box,r=this.dom.line,i=this.dom.dot;this.left="right"==t?e-this.width:"left"==t?e:e-this.width/2,n.style.left=this.left+"px",r.style.left=e-this.props.line.width/2+"px",i.style.left=e-this.props.dot.width/2+"px"},ItemBox.prototype.repositionY=function(){var e=this.options.orientation,t=this.dom.box,n=this.dom.line,r=this.dom.dot;if("top"==e)t.style.top=(this.top||0)+"px",n.style.top="0",n.style.height=this.parent.top+this.top+1+"px",n.style.bottom="";else{var i=this.parent.itemSet.props.height,s=i-this.parent.top-this.parent.height+this.top;t.style.top=(this.parent.height-this.top-this.height||0)+"px",n.style.top=i-s+"px",n.style.bottom="0"}r.style.top=-this.props.dot.height/2+"px"},ItemPoint.prototype=new Item(null,null,null),ItemPoint.prototype.isVisible=function(e){var t=(e.end-e.start)/4;return this.data.start>e.start-t&&this.data.start<e.end+t},ItemPoint.prototype.redraw=function(){var e=this.dom;if(e||(this.dom={},e=this.dom,e.point=document.createElement("div"),e.content=document.createElement("div"),e.content.className="content",e.point.appendChild(e.content),e.dot=document.createElement("div"),e.point.appendChild(e.dot),e.point["timeline-item"]=this),!this.parent)throw new Error("Cannot redraw item: no parent attached");if(!e.point.parentNode){var t=this.parent.dom.foreground;if(!t)throw new Error("Cannot redraw time axis: parent has no foreground container element");t.appendChild(e.point)}if(this.displayed=!0,this.data.content!=this.content){if(this.content=this.data.content,this.content instanceof Element)e.content.innerHTML="",e.content.appendChild(this.content);else{if(void 0==this.data.content)throw new Error('Property "content" missing in item '+this.data.id);e.content.innerHTML=this.content}this.dirty=!0}var n=(this.data.className?" "+this.data.className:"")+(this.selected?" selected":"");this.className!=n&&(this.className=n,e.point.className="item point"+n,e.dot.className="item dot"+n,this.dirty=!0),this.dirty&&(this.width=e.point.offsetWidth,this.height=e.point.offsetHeight,this.props.dot.width=e.dot.offsetWidth,this.props.dot.height=e.dot.offsetHeight,this.props.content.height=e.content.offsetHeight,e.content.style.marginLeft=2*this.props.dot.width+"px",e.dot.style.top=(this.height-this.props.dot.height)/2+"px",e.dot.style.left=this.props.dot.width/2+"px",this.dirty=!1),this._repaintDeleteButton(e.point)},ItemPoint.prototype.show=function(){this.displayed||this.redraw()},ItemPoint.prototype.hide=function(){this.displayed&&(this.dom.point.parentNode&&this.dom.point.parentNode.removeChild(this.dom.point),this.top=null,this.left=null,this.displayed=!1)},ItemPoint.prototype.repositionX=function(){var e=this.conversion.toScreen(this.data.start);this.left=e-this.props.dot.width,this.dom.point.style.left=this.left+"px"},ItemPoint.prototype.repositionY=function(){var e=this.options.orientation,t=this.dom.point;t.style.top="top"==e?this.top+"px":this.parent.height-this.top-this.height+"px"},ItemRange.prototype=new Item(null,null,null),ItemRange.prototype.baseClassName="item range",ItemRange.prototype.isVisible=function(e){return this.data.start<e.end&&this.data.end>e.start},ItemRange.prototype.redraw=function(){var e=this.dom;if(e||(this.dom={},e=this.dom,e.box=document.createElement("div"),e.content=document.createElement("div"),e.content.className="content",e.box.appendChild(e.content),e.box["timeline-item"]=this),!this.parent)throw new Error("Cannot redraw item: no parent attached");if(!e.box.parentNode){var t=this.parent.dom.foreground;if(!t)throw new Error("Cannot redraw time axis: parent has no foreground container element");t.appendChild(e.box)}if(this.displayed=!0,this.data.content!=this.content){if(this.content=this.data.content,this.content instanceof Element)e.content.innerHTML="",e.content.appendChild(this.content);else{if(void 0==this.data.content)throw new Error('Property "content" missing in item '+this.data.id);e.content.innerHTML=this.content}this.dirty=!0}var n=(this.data.className?" "+this.data.className:"")+(this.selected?" selected":"");this.className!=n&&(this.className=n,e.box.className=this.baseClassName+n,this.dirty=!0),this.dirty&&(this.props.content.width=this.dom.content.offsetWidth,this.height=this.dom.box.offsetHeight,this.dirty=!1),this._repaintDeleteButton(e.box),this._repaintDragLeft(),this._repaintDragRight()},ItemRange.prototype.show=function(){this.displayed||this.redraw()},ItemRange.prototype.hide=function(){if(this.displayed){var e=this.dom.box;e.parentNode&&e.parentNode.removeChild(e),this.top=null,this.left=null,this.displayed=!1}},ItemRange.prototype.repositionX=function(){var e,t=this.props,n=this.parent.width,r=this.conversion.toScreen(this.data.start),i=this.conversion.toScreen(this.data.end),s=this.options.padding;-n>r&&(r=-n),i>2*n&&(i=2*n),e=0>r?Math.min(-r,i-r-t.content.width-2*s):0,this.left=r,this.width=Math.max(i-r,1),this.dom.box.style.left=this.left+"px",this.dom.box.style.width=this.width+"px",this.dom.content.style.left=e+"px"},ItemRange.prototype.repositionY=function(){var e=this.options.orientation,t=this.dom.box;t.style.top="top"==e?this.top+"px":this.parent.height-this.top-this.height+"px"},ItemRange.prototype._repaintDragLeft=function(){if(this.selected&&this.options.editable.updateTime&&!this.dom.dragLeft){var e=document.createElement("div");e.className="drag-left",e.dragLeftItem=this,Hammer(e,{preventDefault:!0}).on("drag",function(){}),this.dom.box.appendChild(e),this.dom.dragLeft=e}else!this.selected&&this.dom.dragLeft&&(this.dom.dragLeft.parentNode&&this.dom.dragLeft.parentNode.removeChild(this.dom.dragLeft),this.dom.dragLeft=null)},ItemRange.prototype._repaintDragRight=function(){if(this.selected&&this.options.editable.updateTime&&!this.dom.dragRight){var e=document.createElement("div");e.className="drag-right",e.dragRightItem=this,Hammer(e,{preventDefault:!0}).on("drag",function(){}),this.dom.box.appendChild(e),this.dom.dragRight=e}else!this.selected&&this.dom.dragRight&&(this.dom.dragRight.parentNode&&this.dom.dragRight.parentNode.removeChild(this.dom.dragRight),this.dom.dragRight=null)},ItemRangeOverflow.prototype=new ItemRange(null,null,null),ItemRangeOverflow.prototype.baseClassName="item rangeoverflow",ItemRangeOverflow.prototype.repositionX=function(){var e,t=this.parent.width,n=this.conversion.toScreen(this.data.start),r=this.conversion.toScreen(this.data.end);-t>n&&(n=-t),r>2*t&&(r=2*t),e=Math.max(-n,0),this.left=n;var i=Math.max(r-n,1);this.width=i+this.props.content.width,this.dom.box.style.left=this.left+"px",this.dom.box.style.width=i+"px",this.dom.content.style.left=e+"px"},Group.prototype._create=function(){var e=document.createElement("div");e.className="vlabel",this.dom.label=e;var t=document.createElement("div");t.className="inner",e.appendChild(t),this.dom.inner=t;var n=document.createElement("div");n.className="group",n["timeline-group"]=this,this.dom.foreground=n,this.dom.background=document.createElement("div"),this.dom.background.className="group",this.dom.axis=document.createElement("div"),this.dom.axis.className="group",this.dom.marker=document.createElement("div"),this.dom.marker.style.visibility="hidden",this.dom.marker.innerHTML="?",this.dom.background.appendChild(this.dom.marker)},Group.prototype.setData=function(e){var t=e&&e.content;t instanceof Element?this.dom.inner.appendChild(t):this.dom.inner.innerHTML=void 0!=t?t:this.groupId,this.dom.inner.firstChild?util.removeClassName(this.dom.inner,"hidden"):util.addClassName(this.dom.inner,"hidden");var n=e&&e.className||null;n!=this.className&&(this.className&&(util.removeClassName(this.dom.label,n),util.removeClassName(this.dom.foreground,n),util.removeClassName(this.dom.background,n),util.removeClassName(this.dom.axis,n)),util.addClassName(this.dom.label,n),util.addClassName(this.dom.foreground,n),util.addClassName(this.dom.background,n),util.addClassName(this.dom.axis,n))},Group.prototype.getLabelWidth=function(){return this.props.label.width},Group.prototype.redraw=function(e,t,n){var r=!1;this.visibleItems=this._updateVisibleItems(this.orderedItems,this.visibleItems,e);var i=this.dom.marker.clientHeight;i!=this.lastMarkerHeight&&(this.lastMarkerHeight=i,util.forEach(this.items,function(e){e.dirty=!0,e.displayed&&e.redraw()}),n=!0),this.itemSet.options.stack?stack.stack(this.visibleItems,t,n):stack.nostack(this.visibleItems,t);var s,o=this.visibleItems;if(o.length){var u=o[0].top,a=o[0].top+o[0].height;util.forEach(o,function(e){u=Math.min(u,e.top),a=Math.max(a,e.top+e.height)}),s=a-u+t.axis+t.item}else s=t.axis+t.item;s=Math.max(s,this.props.label.height);var f=this.dom.foreground;this.top=f.offsetTop,this.left=f.offsetLeft,this.width=f.offsetWidth,r=util.updateProperty(this,"height",s)||r,r=util.updateProperty(this.props.label,"width",this.dom.inner.clientWidth)||r,r=util.updateProperty(this.props.label,"height",this.dom.inner.clientHeight)||r,f.style.height=s+"px",this.dom.label.style.height=s+"px";for(var l=0,c=this.visibleItems.length;c>l;l++){var h=this.visibleItems[l];h.repositionY()}return r},Group.prototype.show=function(){this.dom.label.parentNode||this.itemSet.dom.labelSet.appendChild(this.dom.label),this.dom.foreground.parentNode||this.itemSet.dom.foreground.appendChild(this.dom.foreground),this.dom.background.parentNode||this.itemSet.dom.background.appendChild(this.dom.background),this.dom.axis.parentNode||this.itemSet.dom.axis.appendChild(this.dom.axis)},Group.prototype.hide=function(){var e=this.dom.label;e.parentNode&&e.parentNode.removeChild(e);var t=this.dom.foreground;t.parentNode&&t.parentNode.removeChild(t);var n=this.dom.background;n.parentNode&&n.parentNode.removeChild(n);var r=this.dom.axis;r.parentNode&&r.parentNode.removeChild(r)},Group.prototype.add=function(e){if(this.items[e.id]=e,e.setParent(this),e instanceof ItemRange&&-1==this.visibleItems.indexOf(e)){var t=this.itemSet.body.range;this._checkIfVisible(e,this.visibleItems,t)}},Group.prototype.remove=function(e){delete this.items[e.id],e.setParent(this.itemSet);var t=this.visibleItems.indexOf(e);-1!=t&&this.visibleItems.splice(t,1)},Group.prototype.removeFromDataSet=function(e){this.itemSet.removeItem(e.id)},Group.prototype.order=function(){var e=util.toArray(this.items);this.orderedItems.byStart=e,this.orderedItems.byEnd=this._constructByEndArray(e),stack.orderByStart(this.orderedItems.byStart),stack.orderByEnd(this.orderedItems.byEnd)},Group.prototype._constructByEndArray=function(e){for(var t=[],n=0;n<e.length;n++)e[n]instanceof ItemRange&&t.push(e[n]);return t},Group.prototype._updateVisibleItems=function(e,t,n){var r,i,s=[];if(t.length>0)for(i=0;i<t.length;i++)this._checkIfVisible(t[i],s,n);r=0==s.length?this._binarySearch(e,n,!1):e.byStart.indexOf(s[0]);var o=this._binarySearch(e,n,!0);if(-1!=r){for(i=r;i>=0&&!this._checkIfInvisible(e.byStart[i],s,n);i--);for(i=r+1;i<e.byStart.length&&!this._checkIfInvisible(e.byStart[i],s,n);i++);}if(-1!=o){for(i=o;i>=0&&!this._checkIfInvisible(e.byEnd[i],s,n);i--);for(i=o+1;i<e.byEnd.length&&!this._checkIfInvisible(e.byEnd[i],s,n);i++);}return s},Group.prototype._binarySearch=function(e,t,n){var r=[],i=n?"end":"start";r=1==n?e.byEnd:e.byStart;var s,o=t.end-t.start,u=!1,a=0,f=r.length,l=Math.floor(.5*(f+a));if(0==f)l=-1;else if(1==f)l=r[l].data[i]>t.start-o&&r[l].data[i]<t.end?0:-1;else for(f-=1;0==u;)r[l].data[i]>t.start-o&&r[l].data[i]<t.end?u=!0:(r[l].data[i]<t.start-o?a=Math.floor(.5*(f+a)):f=Math.floor(.5*(f+a)),s=Math.floor(.5*(f+a)),l==s?(l=-1,u=!0):l=s);return l},Group.prototype._checkIfInvisible=function(e,t,n){return e.isVisible(n)?(e.displayed||e.show(),e.repositionX(),-1==t.indexOf(e)&&t.push(e),!1):!0},Group.prototype._checkIfVisible=function(e,t,n){e.isVisible(n)?(e.displayed||e.show(),e.repositionX(),t.push(e)):e.displayed&&e.hide()},Emitter(Timeline.prototype),Timeline.prototype._create=function(e){this.dom={},this.dom.root=document.createElement("div"),this.dom.background=document.createElement("div"),this.dom.backgroundVertical=document.createElement("div"),this.dom.backgroundHorizontal=document.createElement("div"),this.dom.centerContainer=document.createElement("div"),this.dom.leftContainer=document.createElement("div"),this.dom.rightContainer=document.createElement("div"),this.dom.center=document.createElement("div"),this.dom.left=document.createElement("div"),this.dom.right=document.createElement("div"),this.dom.top=document.createElement("div"),this.dom.bottom=document.createElement("div"),this.dom.shadowTop=document.createElement("div"),this.dom.shadowBottom=document.createElement("div"),this.dom.shadowTopLeft=document.createElement("div"),this.dom.shadowBottomLeft=document.createElement("div"),this.dom.shadowTopRight=document.createElement("div"),this.dom.shadowBottomRight=document.createElement("div"),this.dom.background.className="vispanel background",this.dom.backgroundVertical.className="vispanel background vertical",this.dom.backgroundHorizontal.className="vispanel background horizontal",this.dom.centerContainer.className="vispanel center",this.dom.leftContainer.className="vispanel left",this.dom.rightContainer.className="vispanel right",this.dom.top.className="vispanel top",this.dom.bottom.className="vispanel bottom",this.dom.left.className="content",this.dom.center.className="content",this.dom.right.className="content",this.dom.shadowTop.className="shadow top",this.dom.shadowBottom.className="shadow bottom",this.dom.shadowTopLeft.className="shadow top",this.dom.shadowBottomLeft.className="shadow bottom",this.dom.shadowTopRight.className="shadow top",this.dom.shadowBottomRight.className="shadow bottom",this.dom.root.appendChild(this.dom.background),this.dom.root.appendChild(this.dom.backgroundVertical),this.dom.root.appendChild(this.dom.backgroundHorizontal),this.dom.root.appendChild(this.dom.centerContainer),this.dom.root.appendChild(this.dom.leftContainer),this.dom.root.appendChild(this.dom.rightContainer),this.dom.root.appendChild(this.dom.top),this.dom.root.appendChild(this.dom.bottom),this.dom.centerContainer.appendChild(this.dom.center),this.dom.leftContainer.appendChild(this.dom.left),this.dom.rightContainer.appendChild(this.dom.right),this.dom.centerContainer.appendChild(this.dom.shadowTop),this.dom.centerContainer.appendChild(this.dom.shadowBottom),this.dom.leftContainer.appendChild(this.dom.shadowTopLeft),this.dom.leftContainer.appendChild(this.dom.shadowBottomLeft),this.dom.rightContainer.appendChild(this.dom.shadowTopRight),this.dom.rightContainer.appendChild(this.dom.shadowBottomRight),this.on("rangechange",this.redraw.bind(this)),this.on("change",this.redraw.bind(this)),this.on("touch",this._onTouch.bind(this)),this.on("pinch",this._onPinch.bind(this)),this.on("dragstart",this._onDragStart.bind(this)),this.on("drag",this._onDrag.bind(this)),this.hammer=Hammer(this.dom.root,{prevent_default:!0}),this.listeners={};var t=this,n=["touch","pinch","tap","doubletap","hold","dragstart","drag","dragend","mousewheel","DOMMouseScroll"];if(n.forEach(function(e){var n=function(){var n=[e].concat(Array.prototype.slice.call(arguments,0));t.emit.apply(t,n)};t.hammer.on(e,n),t.listeners[e]=n}),this.props={root:{},background:{},centerContainer:{},leftContainer:{},rightContainer:{},center:{},left:{},right:{},top:{},bottom:{},border:{},scrollTop:0,scrollTopMin:0},this.touch={},!e)throw new Error("No container provided");e.appendChild(this.dom.root)},Timeline.prototype.destroy=function(){this.clear(),this.off(),this._stopAutoResize(),this.dom.root.parentNode&&this.dom.root.parentNode.removeChild(this.dom.root),this.dom=null;for(var e in this.listeners)this.listeners.hasOwnProperty(e)&&delete this.listeners[e];this.listeners=null,this.hammer=null,this.components.forEach(function(e){e.destroy()}),this.body=null},Timeline.prototype.setOptions=function(e){if(e){var t=["width","height","minHeight","maxHeight","autoResize","start","end","orientation"];util.selectiveExtend(t,this.options,e),this._initAutoResize()}if(this.components.forEach(function(t){t.setOptions(e)}),e&&e.order)throw new Error("Option order is deprecated. There is no replacement for this feature.");this.redraw()},Timeline.prototype.setCustomTime=function(e){if(!this.customTime)throw new Error("Cannot get custom time: Custom time bar is not enabled");this.customTime.setCustomTime(e)},Timeline.prototype.getCustomTime=function(){if(!this.customTime)throw new Error("Cannot get custom time: Custom time bar is not enabled");return this.customTime.getCustomTime()},Timeline.prototype.setItems=function(e){var t,n=null==this.itemsData;if(t=e?e instanceof DataSet||e instanceof DataView?e:new DataSet(e,{type:{start:"Date",end:"Date"}}):null,this.itemsData=t,this.itemSet&&this.itemSet.setItems(t),n&&("start"in this.options||"end"in this.options)){this.fit();var r="start"in this.options?util.convert(this.options.start,"Date"):null,i="end"in this.options?util.convert(this.options.end,"Date"):null;this.setWindow(r,i)}},Timeline.prototype.setGroups=function(e){var t;t=e?e instanceof DataSet||e instanceof DataView?e:new DataSet(e):null,this.groupsData=t,this.itemSet.setGroups(t)},Timeline.prototype.clear=function(e){(!e||e.items)&&this.setItems(null),(!e||e.groups)&&this.setGroups(null),(!e||e.options)&&(this.components.forEach(function(e){e.setOptions(e.defaultOptions)}),this.setOptions(this.defaultOptions))},Timeline.prototype.fit=function(){var e=this.getItemRange(),t=e.min,n=e.max;if(null!=t&&null!=n){var r=n.valueOf()-t.valueOf();0>=r&&(r=864e5),t=new Date(t.valueOf()-.05*r),n=new Date(n.valueOf()+.05*r)}(null!==t||null!==n)&&this.range.setRange(t,n)},Timeline.prototype.getItemRange=function(){var e=this.itemsData,t=null,n=null;if(e){var r=e.min("start");t=r?util.convert(r.start,"Date").valueOf():null;var i=e.max("start");i&&(n=util.convert(i.start,"Date").valueOf());var s=e.max("end");s&&(n=null==n?util.convert(s.end,"Date").valueOf():Math.max(n,util.convert(s.end,"Date").valueOf()))}return{min:null!=t?new Date(t):null,max:null!=n?new Date(n):null}},Timeline.prototype.setSelection=function(e){this.itemSet&&this.itemSet.setSelection(e)},Timeline.prototype.getSelection=function(){return this.itemSet&&this.itemSet.getSelection()||[]},Timeline.prototype.setWindow=function(e,t){if(1==arguments.length){var n=arguments[0];this.range.setRange(n.start,n.end)}else this.range.setRange(e,t)},Timeline.prototype.getWindow=function(){var e=this.range.getRange();return{start:new Date(e.start),end:new Date(e.end)}},Timeline.prototype.redraw=function(){var e=!1,t=this.options,n=this.props,r=this.dom;if(r){r.root.className="vis timeline root "+t.orientation,r.root.style.maxHeight=util.option.asSize(t.maxHeight,""),r.root.style.minHeight=util.option.asSize(t.minHeight,""),r.root.style.width=util.option.asSize(t.width,""),n.border.left=(r.centerContainer.offsetWidth-r.centerContainer.clientWidth)/2,n.border.right=n.border.left,n.border.top=(r.centerContainer.offsetHeight-r.centerContainer.clientHeight)/2,n.border.bottom=n.border.top;var i=r.root.offsetHeight-r.root.clientHeight,s=r.root.offsetWidth-r.root.clientWidth;n.center.height=r.center.offsetHeight,n.left.height=r.left.offsetHeight,n.right.height=r.right.offsetHeight,n.top.height=r.top.clientHeight||-n.border.top,n.bottom.height=r.bottom.clientHeight||-n.border.bottom;var o=Math.max(n.left.height,n.center.height,n.right.height),u=n.top.height+o+n.bottom.height+i+n.border.top+n.border.bottom;r.root.style.height=util.option.asSize(t.height,u+"px"),n.root.height=r.root.offsetHeight,n.background.height=n.root.height-i;var a=n.root.height-n.top.height-n.bottom.height-i;n.centerContainer.height=a,n.leftContainer.height=a,n.rightContainer.height=n.leftContainer.height,n.root.width=r.root.offsetWidth,n.background.width=n.root.width-s,n.left.width=r.leftContainer.clientWidth||-n.border.left,n.leftContainer.width=n.left.width,n.right.width=r.rightContainer.clientWidth||-n.border.right,n.rightContainer.width=n.right.width;var f=n.root.width-n.left.width-n.right.width-s;n.center.width=f,n.centerContainer.width=f,n.top.width=f,n.bottom.width=f,r.background.style.height=n.background.height+"px",r.backgroundVertical.style.height=n.background.height+"px",r.backgroundHorizontal.style.height=n.centerContainer.height+"px",r.centerContainer.style.height=n.centerContainer.height+"px",r.leftContainer.style.height=n.leftContainer.height+"px",r.rightContainer.style.height=n.rightContainer.height+"px",r.background.style.width=n.background.width+"px",r.backgroundVertical.style.width=n.centerContainer.width+"px",r.backgroundHorizontal.style.width=n.background.width+"px",r.centerContainer.style.width=n.center.width+"px",r.top.style.width=n.top.width+"px",r.bottom.style.width=n.bottom.width+"px",r.background.style.left="0",r.background.style.top="0",r.backgroundVertical.style.left=n.left.width+"px",r.backgroundVertical.style.top="0",r.backgroundHorizontal.style.left="0",r.backgroundHorizontal.style.top=n.top.height+"px",r.centerContainer.style.left=n.left.width+"px",r.centerContainer.style.top=n.top.height+"px",r.leftContainer.style.left="0",r.leftContainer.style.top=n.top.height+"px",r.rightContainer.style.left=n.left.width+n.center.width+"px",r.rightContainer.style.top=n.top.height+"px",r.top.style.left=n.left.width+"px",r.top.style.top="0",r.bottom.style.left=n.left.width+"px",r.bottom.style.top=n.top.height+n.centerContainer.height+"px",this._updateScrollTop();var l=this.props.scrollTop;"bottom"==t.orientation&&(l+=Math.max(this.props.centerContainer.height-this.props.center.height,0)),r.center.style.left="0",r.center.style.top=l+"px",r.left.style.left="0",r.left.style.top=l+"px",r.right.style.left="0",r.right.style.top=l+"px";var c=0==this.props.scrollTop?"hidden":"",h=this.props.scrollTop==this.props.scrollTopMin?"hidden":"";r.shadowTop.style.visibility=c,r.shadowBottom.style.visibility=h,r.shadowTopLeft.style.visibility=c,r.shadowBottomLeft.style.visibility=h,r.shadowTopRight.style.visibility=c,r.shadowBottomRight.style.visibility=h,this.components.forEach(function(t){e=t.redraw()||e}),e&&this.redraw()}},Timeline.prototype.repaint=function(){throw new Error("Function repaint is deprecated. Use redraw instead.")},Timeline.prototype._toTime=function(e){var t=this.range.conversion(this.props.center.width);return new Date(e/t.scale+t.offset)},Timeline.prototype._toScreen=function(e){var t=this.range.conversion(this.props.center.width);return(e.valueOf()-t.offset)*t.scale},Timeline.prototype._initAutoResize=function(){1==this.options.autoResize?this._startAutoResize():this._stopAutoResize()},Timeline.prototype._startAutoResize=function(){var e=this;this._stopAutoResize(),this._onResize=function(){return 1!=e.options.autoResize?void e._stopAutoResize():void (e.dom.root&&(e.dom.root.clientWidth!=e.props.lastWidth||e.dom.root.clientHeight!=e.props.lastHeight)&&(e.props.lastWidth=e.dom.root.clientWidth,e.props.lastHeight=e.dom.root.clientHeight,e.emit("change")))},util.addEventListener(window,"resize",this._onResize),this.watchTimer=setInterval(this._onResize,1e3)},Timeline.prototype._stopAutoResize=function(){this.watchTimer&&(clearInterval(this.watchTimer),this.watchTimer=void 0),util.removeEventListener(window,"resize",this._onResize),this._onResize=null},Timeline.prototype._onTouch=function(){this.touch.allowDragging=!0},Timeline.prototype._onPinch=function(){this.touch.allowDragging=!1},Timeline.prototype._onDragStart=function(){this.touch.initialScrollTop=this.props.scrollTop},Timeline.prototype._onDrag=function(e){if(this.touch.allowDragging){var t=e.gesture.deltaY,n=this._getScrollTop(),r=this._setScrollTop(this.touch.initialScrollTop+t);r!=n&&this.redraw()}},Timeline.prototype._setScrollTop=function(e){return this.props.scrollTop=e,this._updateScrollTop(),this.props.scrollTop},Timeline.prototype._updateScrollTop=function(){var e=Math.min(this.props.centerContainer.height-this.props.center.height,0);return e!=this.props.scrollTopMin&&("bottom"==this.options.orientation&&(this.props.scrollTop+=e-this.props.scrollTopMin),this.props.scrollTopMin=e),this.props.scrollTop>0&&(this.props.scrollTop=0),this.props.scrollTop<e&&(this.props.scrollTop=e),this.props.scrollTop},Timeline.prototype._getScrollTop=function(){return this.props.scrollTop},function(e){function t(e){return C=e,h()}function n(){k=0,L=C.charAt(0)}function r(){k++,L=C.charAt(k)}function i(){return C.charAt(k+1)}function s(e){return M.test(e)}function o(e,t){if(e||(e={}),t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function u(e,t,n){for(var r=t.split("."),i=e;r.length;){var s=r.shift();r.length?(i[s]||(i[s]={}),i=i[s]):i[s]=n}}function a(e,t){for(var n,r,i=null,s=[e],u=e;u.parent;)s.push(u.parent),u=u.parent;if(u.nodes)for(n=0,r=u.nodes.length;r>n;n++)if(t.id===u.nodes[n].id){i=u.nodes[n];break}for(i||(i={id:t.id},e.node&&(i.attr=o(i.attr,e.node))),n=s.length-1;n>=0;n--){var a=s[n];a.nodes||(a.nodes=[]),-1==a.nodes.indexOf(i)&&a.nodes.push(i)}t.attr&&(i.attr=o(i.attr,t.attr))}function f(e,t){if(e.edges||(e.edges=[]),e.edges.push(t),e.edge){var n=o({},e.edge);t.attr=o(n,t.attr)}}function l(e,t,n,r,i){var s={from:t,to:n,type:r};return e.edge&&(s.attr=o({},e.edge)),s.attr=o(s.attr||{},i),s}function c(){for(O=T.NULL,A="";" "==L||"	"==L||"\n"==L||"\r"==L;)r();do{var e=!1;if("#"==L){for(var t=k-1;" "==C.charAt(t)||"	"==C.charAt(t);)t--;if("\n"==C.charAt(t)||""==C.charAt(t)){for(;""!=L&&"\n"!=L;)r();e=!0}}if("/"==L&&"/"==i()){for(;""!=L&&"\n"!=L;)r();e=!0}if("/"==L&&"*"==i()){for(;""!=L;){if("*"==L&&"/"==i()){r(),r();break}r()}e=!0}for(;" "==L||"	"==L||"\n"==L||"\r"==L;)r()}while(e);if(""==L)return void (O=T.DELIMITER);var n=L+i();if(N[n])return O=T.DELIMITER,A=n,r(),void r();if(N[L])return O=T.DELIMITER,A=L,void r();if(s(L)||"-"==L){for(A+=L,r();s(L);)A+=L,r();return"false"==A?A=!1:"true"==A?A=!0:isNaN(Number(A))||(A=Number(A)),void (O=T.IDENTIFIER)}if('"'==L){for(r();""!=L&&('"'!=L||'"'==L&&'"'==i());)A+=L,'"'==L&&r(),r();if('"'!=L)throw w('End of string " expected');return r(),void (O=T.IDENTIFIER)}for(O=T.UNKNOWN;""!=L;)A+=L,r();throw new SyntaxError('Syntax error in part "'+E(A,30)+'"')}function h(){var e={};if(n(),c(),"strict"==A&&(e.strict=!0,c()),("graph"==A||"digraph"==A)&&(e.type=A,c()),O==T.IDENTIFIER&&(e.id=A,c()),"{"!=A)throw w("Angle bracket { expected");if(c(),p(e),"}"!=A)throw w("Angle bracket } expected");if(c(),""!==A)throw w("End of file expected");return c(),delete e.node,delete e.edge,delete e.graph,e}function p(e){for(;""!==A&&"}"!=A;)d(e),";"==A&&c()}function d(e){var t=v(e);if(t)return void y(e,t);var n=m(e);if(!n){if(O!=T.IDENTIFIER)throw w("Identifier expected");var r=A;if(c(),"="==A){if(c(),O!=T.IDENTIFIER)throw w("Identifier expected");e[r]=A,c()}else g(e,r)}}function v(e){var t=null;if("subgraph"==A&&(t={},t.type="subgraph",c(),O==T.IDENTIFIER&&(t.id=A,c())),"{"==A){if(c(),t||(t={}),t.parent=e,t.node=e.node,t.edge=e.edge,t.graph=e.graph,p(t),"}"!=A)throw w("Angle bracket } expected");c(),delete t.node,delete t.edge,delete t.graph,delete t.parent,e.subgraphs||(e.subgraphs=[]),e.subgraphs.push(t)}return t}function m(e){return"node"==A?(c(),e.node=b(),"node"):"edge"==A?(c(),e.edge=b(),"edge"):"graph"==A?(c(),e.graph=b(),"graph"):null}function g(e,t){var n={id:t},r=b();r&&(n.attr=r),a(e,n),y(e,t)}function y(e,t){for(;"->"==A||"--"==A;){var n,r=A;c();var i=v(e);if(i)n=i;else{if(O!=T.IDENTIFIER)throw w("Identifier or subgraph expected");n=A,a(e,{id:n}),c()}var s=b(),o=l(e,t,n,r,s);f(e,o),t=n}}function b(){for(var e=null;"["==A;){for(c(),e={};""!==A&&"]"!=A;){if(O!=T.IDENTIFIER)throw w("Attribute name expected");var t=A;if(c(),"="!=A)throw w("Equal sign = expected");if(c(),O!=T.IDENTIFIER)throw w("Attribute value expected");var n=A;u(e,t,n),c(),","==A&&c()}if("]"!=A)throw w("Bracket ] expected");c()}return e}function w(e){return new SyntaxError(e+', got "'+E(A,30)+'" (char '+k+")")}function E(e,t){return e.length<=t?e:e.substr(0,27)+"..."}function S(e,t,n){e instanceof Array?e.forEach(function(e){t instanceof Array?t.forEach(function(t){n(e,t)}):n(e,t)}):t instanceof Array?t.forEach(function(t){n(e,t)}):n(e,t)}function x(e){function n(e){var t={from:e.from,to:e.to};return o(t,e.attr),t.style="->"==e.type?"arrow":"line",t}var r=t(e),i={nodes:[],edges:[],options:{}};return r.nodes&&r.nodes.forEach(function(e){var t={id:e.id,label:String(e.label||e.id)};o(t,e.attr),t.image&&(t.shape="image"),i.nodes.push(t)}),r.edges&&r.edges.forEach(function(e){var t,r;t=e.from instanceof Object?e.from.nodes:{id:e.from},r=e.to instanceof Object?e.to.nodes:{id:e.to},e.from instanceof Object&&e.from.edges&&e.from.edges.forEach(function(e){var t=n(e);i.edges.push(t)}),S(t,r,function(t,r){var s=l(i,t.id,r.id,e.type,e.attr),o=n(s);i.edges.push(o)}),e.to instanceof Object&&e.to.edges&&e.to.edges.forEach(function(e){var t=n(e);i.edges.push(t)})}),r.attr&&(i.options=r.attr),i}var T={NULL:0,DELIMITER:1,IDENTIFIER:2,UNKNOWN:3},N={"{":!0,"}":!0,"[":!0,"]":!0,";":!0,"=":!0,",":!0,"->":!0,"--":!0},C="",k=0,L="",A="",O=T.NULL,M=/[a-zA-Z_0-9.:#]/;e.parseDOT=t,e.DOTToGraph=x}("undefined"!=typeof util?util:exports),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.circle=function(e,t,n){this.beginPath(),this.arc(e,t,n,0,2*Math.PI,!1)},CanvasRenderingContext2D.prototype.square=function(e,t,n){this.beginPath(),this.rect(e-n,t-n,2*n,2*n)},CanvasRenderingContext2D.prototype.triangle=function(e,t,n){this.beginPath();var r=2*n,i=r/2,s=Math.sqrt(3)/6*r,o=Math.sqrt(r*r-i*i);this.moveTo(e,t-(o-s)),this.lineTo(e+i,t+s),this.lineTo(e-i,t+s),this.lineTo(e,t-(o-s)),this.closePath()},CanvasRenderingContext2D.prototype.triangleDown=function(e,t,n){this.beginPath();var r=2*n,i=r/2,s=Math.sqrt(3)/6*r,o=Math.sqrt(r*r-i*i);this.moveTo(e,t+(o-s)),this.lineTo(e+i,t-s),this.lineTo(e-i,t-s),this.lineTo(e,t+(o-s)),this.closePath()},CanvasRenderingContext2D.prototype.star=function(e,t,n){this.beginPath();for(var r=0;10>r;r++){var i=r%2===0?1.3*n:.5*n;this.lineTo(e+i*Math.sin(2*r*Math.PI/10),t-i*Math.cos(2*r*Math.PI/10))}this.closePath()},CanvasRenderingContext2D.prototype.roundRect=function(e,t,n,r,i){var s=Math.PI/180;0>n-2*i&&(i=n/2),0>r-2*i&&(i=r/2),this.beginPath(),this.moveTo(e+i,t),this.lineTo(e+n-i,t),this.arc(e+n-i,t+i,i,270*s,360*s,!1),this.lineTo(e+n,t+r-i),this.arc(e+n-i,t+r-i,i,0,90*s,!1),this.lineTo(e+i,t+r),this.arc(e+i,t+r-i,i,90*s,180*s,!1),this.lineTo(e,t+i),this.arc(e+i,t+i,i,180*s,270*s,!1)},CanvasRenderingContext2D.prototype.ellipse=function(e,t,n,r){var i=.5522848,s=n/2*i,o=r/2*i,u=e+n,a=t+r,f=e+n/2,l=t+r/2;this.beginPath(),this.moveTo(e,l),this.bezierCurveTo(e,l-o,f-s,t,f,t),this.bezierCurveTo(f+s,t,u,l-o,u,l),this.bezierCurveTo(u,l+o,f+s,a,f,a),this.bezierCurveTo(f-s,a,e,l+o,e,l)},CanvasRenderingContext2D.prototype.database=function(e,t,n,r){var i=1/3,s=n,o=r*i,u=.5522848,a=s/2*u,f=o/2*u,l=e+s,c=t+o,h=e+s/2,p=t+o/2,d=t+(r-o/2),v=t+r;this.beginPath(),this.moveTo(l,p),this.bezierCurveTo(l,p+f,h+a,c,h,c),this.bezierCurveTo(h-a,c,e,p+f,e,p),this.bezierCurveTo(e,p-f,h-a,t,h,t),this.bezierCurveTo(h+a,t,l,p-f,l,p),this.lineTo(l,d),this.bezierCurveTo(l,d+f,h+a,v,h,v),this.bezierCurveTo(h-a,v,e,d+f,e,d),this.lineTo(e,p)},CanvasRenderingContext2D.prototype.arrow=function(e,t,n,r){var i=e-r*Math.cos(n),s=t-r*Math.sin(n),o=e-.9*r*Math.cos(n),u=t-.9*r*Math.sin(n),a=i+r/3*Math.cos(n+.5*Math.PI),f=s+r/3*Math.sin(n+.5*Math.PI),l=i+r/3*Math.cos(n-.5*Math.PI),c=s+r/3*Math.sin(n-.5*Math.PI);this.beginPath(),this.moveTo(e,t),this.lineTo(a,f),this.lineTo(o,u),this.lineTo(l,c),this.closePath()},CanvasRenderingContext2D.prototype.dashedLine=function(e,t,n,r,i){i||(i=[10,5]),0==h&&(h=.001);var s=i.length;this.moveTo(e,t);for(var o=n-e,u=r-t,a=u/o,f=Math.sqrt(o*o+u*u),l=0,c=!0;f>=.1;){var h=i[l++%s];h>f&&(h=f);var p=Math.sqrt(h*h/(1+a*a));0>o&&(p=-p),e+=p,t+=a*p,this[c?"lineTo":"moveTo"](e,t),f-=h,c=!c}}),Node.prototype.resetCluster=function(){this.formationScale=void 0,this.clusterSize=1,this.containedNodes={},this.containedEdges={},this.clusterSessions=[]},Node.prototype.attachEdge=function(e){-1==this.edges.indexOf(e)&&this.edges.push(e),-1==this.dynamicEdges.indexOf(e)&&this.dynamicEdges.push(e),this.dynamicEdgesLength=this.dynamicEdges.length},Node.prototype.detachEdge=function(e){var t=this.edges.indexOf(e);-1!=t&&(this.edges.splice(t,1),this.dynamicEdges.splice(t,1)),this.dynamicEdgesLength=this.dynamicEdges.length},Node.prototype.setProperties=function(e,t){if(e){if(this.originalLabel=void 0,void 0!==e.id&&(this.id=e.id),void 0!==e.label&&(this.label=e.label,this.originalLabel=e.label),void 0!==e.title&&(this.title=e.title),void 0!==e.group&&(this.group=e.group),void 0!==e.x&&(this.x=e.x),void 0!==e.y&&(this.y=e.y),void 0!==e.value&&(this.value=e.value),void 0!==e.level&&(this.level=e.level,this.preassignedLevel=!0),void 0!==e.mass&&(this.mass=e.mass),void 0!==e.horizontalAlignLeft&&(this.horizontalAlignLeft=e.horizontalAlignLeft),void 0!==e.verticalAlignTop&&(this.verticalAlignTop=e.verticalAlignTop),void 0!==e.triggerFunction&&(this.triggerFunction=e.triggerFunction),void 0===this.id)throw"Node must have an id";if(this.group){var n=this.grouplist.get(this.group);for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r])}if(void 0!==e.shape&&(this.shape=e.shape),void 0!==e.image&&(this.image=e.image),void 0!==e.radius&&(this.radius=e.radius),void 0!==e.color&&(this.color=util.parseColor(e.color)),void 0!==e.fontColor&&(this.fontColor=e.fontColor),void 0!==e.fontSize&&(this.fontSize=e.fontSize),void 0!==e.fontFace&&(this.fontFace=e.fontFace),void 0!==this.image&&""!=this.image){if(!this.imagelist)throw"No imagelist provided";this.imageObj=this.imagelist.load(this.image)}switch(this.xFixed=this.xFixed||void 0!==e.x&&!e.allowedToMoveX,this.yFixed=this.yFixed||void 0!==e.y&&!e.allowedToMoveY,this.radiusFixed=this.radiusFixed||void 0!==e.radius,"image"==this.shape&&(this.radiusMin=t.nodes.widthMin,this.radiusMax=t.nodes.widthMax),this.shape){case"database":this.draw=this._drawDatabase,this.resize=this._resizeDatabase;break;case"box":this.draw=this._drawBox,this.resize=this._resizeBox;break;case"circle":this.draw=this._drawCircle,this.resize=this._resizeCircle;break;case"ellipse":this.draw=this._drawEllipse,this.resize=this._resizeEllipse;break;case"image":this.draw=this._drawImage,this.resize=this._resizeImage;break;case"text":this.draw=this._drawText,this.resize=this._resizeText;break;case"dot":this.draw=this._drawDot,this.resize=this._resizeShape;break;case"square":this.draw=this._drawSquare,this.resize=this._resizeShape;break;case"triangle":this.draw=this._drawTriangle,this.resize=this._resizeShape;break;case"triangleDown":this.draw=this._drawTriangleDown,this.resize=this._resizeShape;break;case"star":this.draw=this._drawStar,this.resize=this._resizeShape;break;default:this.draw=this._drawEllipse,this.resize=this._resizeEllipse}this._reset()}},Node.prototype.select=function(){this.selected=!0,this._reset()},Node.prototype.unselect=function(){this.selected=!1,this._reset()},Node.prototype.clearSizeCache=function(){this._reset()},Node.prototype._reset=function(){this.width=void 0,this.height=void 0},Node.prototype.getTitle=function(){return"function"==typeof this.title?this.title():this.title},Node.prototype.distanceToBorder=function(e,t){var n=1;switch(this.width||this.resize(e),this.shape){case"circle":case"dot":return this.radius+n;case"ellipse":var r=this.width/2,i=this.height/2,s=Math.sin(t)*r,o=Math.cos(t)*i;return r*i/Math.sqrt(s*s+o*o);case"box":case"image":case"text":default:return this.width?Math.min(Math.abs(this.width/2/Math.cos(t)),Math.abs(this.height/2/Math.sin(t)))+n:0}},Node.prototype._setForce=function(e,t){this.fx=e,this.fy=t},Node.prototype._addForce=function(e,t){this.fx+=e,this.fy+=t},Node.prototype.discreteStep=function(e){if(!this.xFixed){var t=this.damping*this.vx,n=(this.fx-t)/this.mass;this.vx+=n*e,this.x+=this.vx*e}if(!this.yFixed){var r=this.damping*this.vy,i=(this.fy-r)/this.mass;this.vy+=i*e,this.y+=this.vy*e}},Node.prototype.discreteStepLimited=function(e,t){if(this.xFixed)this.fx=0;else{var n=this.damping*this.vx,r=(this.fx-n)/this.mass;this.vx+=r*e,this.vx=Math.abs(this.vx)>t?this.vx>0?t:-t:this.vx,this.x+=this.vx*e}if(this.yFixed)this.fy=0;else{var i=this.damping*this.vy,s=(this.fy-i)/this.mass;this.vy+=s*e,this.vy=Math.abs(this.vy)>t?this.vy>0?t:-t:this.vy,this.y+=this.vy*e}},Node.prototype.isFixed=function(){return this.xFixed&&this.yFixed},Node.prototype.isMoving=function(e){return Math.abs(this.vx)>e||Math.abs(this.vy)>e},Node.prototype.isSelected=function(){return this.selected},Node.prototype.getValue=function(){return this.value},Node.prototype.getDistance=function(e,t){var n=this.x-e,r=this.y-t;return Math.sqrt(n*n+r*r)},Node.prototype.setValueRange=function(e,t){if(!this.radiusFixed&&void 0!==this.value)if(t==e)this.radius=(this.radiusMin+this.radiusMax)/2;else{var n=(this.radiusMax-this.radiusMin)/(t-e);this.radius=(this.value-e)*n+this.radiusMin}this.baseRadiusValue=this.radius},Node.prototype.draw=function(){throw"Draw method not initialized for node"},Node.prototype.resize=function(){throw"Resize method not initialized for node"},Node.prototype.isOverlappingWith=function(e){return this.left<e.right&&this.left+this.width>e.left&&this.top<e.bottom&&this.top+this.height>e.top},Node.prototype._resizeImage=function(){if(!this.width||!this.height){var e,t;if(this.value){this.radius=this.baseRadiusValue;var n=this.imageObj.height/this.imageObj.width;void 0!==n?(e=this.radius||this.imageObj.width,t=this.radius*n||this.imageObj.height):(e=0,t=0)}else e=this.imageObj.width,t=this.imageObj.height;this.width=e,this.height=t,this.growthIndicator=0,this.width>0&&this.height>0&&(this.width+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeWidthFactor,this.height+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeHeightFactor,this.radius+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeRadiusFactor,this.growthIndicator=this.width-e)}},Node.prototype._drawImage=function(e){this._resizeImage(e),this.left=this.x-this.width/2,this.top=this.y-this.height/2;var t;if(0!=this.imageObj.width){if(this.clusterSize>1){var n=this.clusterSize>1?10:0;n*=this.graphScaleInv,n=Math.min(.2*this.width,n),e.globalAlpha=.5,e.drawImage(this.imageObj,this.left-n,this.top-n,this.width+2*n,this.height+2*n)}e.globalAlpha=1,e.drawImage(this.imageObj,this.left,this.top,this.width,this.height),t=this.y+this.height/2}else t=this.y;this._label(e,this.label,this.x,t,void 0,"top")},Node.prototype._resizeBox=function(e){if(!this.width){var t=5,n=this.getTextSize(e);this.width=n.width+2*t,this.height=n.height+2*t,this.width+=.5*Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeWidthFactor,this.height+=.5*Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeHeightFactor,this.growthIndicator=this.width-(n.width+2*t)}},Node.prototype._drawBox=function(e){this._resizeBox(e),this.left=this.x-this.width/2,this.top=this.y-this.height/2;var t=2.5,n=2;e.strokeStyle=this.selected?this.color.highlight.border:this.hover?this.color.hover.border:this.color.border,this.clusterSize>1&&(e.lineWidth=(this.selected?n:1)+(this.clusterSize>1?t:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.roundRect(this.left-2*e.lineWidth,this.top-2*e.lineWidth,this.width+4*e.lineWidth,this.height+4*e.lineWidth,this.radius),e.stroke()),e.lineWidth=(this.selected?n:1)+(this.clusterSize>1?t:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.fillStyle=this.selected?this.color.highlight.background:this.color.background,e.roundRect(this.left,this.top,this.width,this.height,this.radius),e.fill(),e.stroke(),this._label(e,this.label,this.x,this.y)},Node.prototype._resizeDatabase=function(e){if(!this.width){var t=5,n=this.getTextSize(e),r=n.width+2*t;this.width=r,this.height=r,this.width+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeWidthFactor,this.height+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeHeightFactor,this.radius+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeRadiusFactor,this.growthIndicator=this.width-r}},Node.prototype._drawDatabase=function(e){this._resizeDatabase(e),this.left=this.x-this.width/2,this.top=this.y-this.height/2;var t=2.5,n=2;e.strokeStyle=this.selected?this.color.highlight.border:this.hover?this.color.hover.border:this.color.border,this.clusterSize>1&&(e.lineWidth=(this.selected?n:1)+(this.clusterSize>1?t:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.database(this.x-this.width/2-2*e.lineWidth,this.y-.5*this.height-2*e.lineWidth,this.width+4*e.lineWidth,this.height+4*e.lineWidth),e.stroke()),e.lineWidth=(this.selected?n:1)+(this.clusterSize>1?t:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.fillStyle=this.selected?this.color.highlight.background:this.hover?this.color.hover.background:this.color.background,e.database(this.x-this.width/2,this.y-.5*this.height,this.width,this.height),e.fill(),e.stroke(),this._label(e,this.label,this.x,this.y)},Node.prototype._resizeCircle=function(e){if(!this.width){var t=5,n=this.getTextSize(e),r=Math.max(n.width,n.height)+2*t;this.radius=r/2,this.width=r,this.height=r,this.radius+=.5*Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeRadiusFactor,this.growthIndicator=this.radius-.5*r}},Node.prototype._drawCircle=function(e){this._resizeCircle(e),this.left=this.x-this.width/2,this.top=this.y-this.height/2;var t=2.5,n=2;e.strokeStyle=this.selected?this.color.highlight.border:this.hover?this.color.hover.border:this.color.border,this.clusterSize>1&&(e.lineWidth=(this.selected?n:1)+(this.clusterSize>1?t:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.circle(this.x,this.y,this.radius+2*e.lineWidth),e.stroke()),e.lineWidth=(this.selected?n:1)+(this.clusterSize>1?t:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.fillStyle=this.selected?this.color.highlight.background:this.hover?this.color.hover.background:this.color.background,e.circle(this.x,this.y,this.radius),e.fill(),e.stroke(),this._label(e,this.label,this.x,this.y)},Node.prototype._resizeEllipse=function(e){if(!this.width){var t=this.getTextSize(e);this.width=1.5*t.width,this.height=2*t.height,this.width<this.height&&(this.width=this.height);var n=this.width;this.width+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeWidthFactor,this.height+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeHeightFactor,this.radius+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeRadiusFactor,this.growthIndicator=this.width-n}},Node.prototype._drawEllipse=function(e){this._resizeEllipse(e),this.left=this.x-this.width/2,this.top=this.y-this.height/2;var t=2.5,n=2;e.strokeStyle=this.selected?this.color.highlight.border:this.hover?this.color.hover.border:this.color.border,this.clusterSize>1&&(e.lineWidth=(this.selected?n:1)+(this.clusterSize>1?t:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.ellipse(this.left-2*e.lineWidth,this.top-2*e.lineWidth,this.width+4*e.lineWidth,this.height+4*e.lineWidth),e.stroke()),e.lineWidth=(this.selected?n:1)+(this.clusterSize>1?t:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.fillStyle=this.selected?this.color.highlight.background:this.hover?this.color.hover.background:this.color.background,e.ellipse(this.left,this.top,this.width,this.height),e.fill(),e.stroke(),this._label(e,this.label,this.x,this.y)},Node.prototype._drawDot=function(e){this._drawShape(e,"circle")},Node.prototype._drawTriangle=function(e){this._drawShape(e,"triangle")},Node.prototype._drawTriangleDown=function(e){this._drawShape(e,"triangleDown")},Node.prototype._drawSquare=function(e){this._drawShape(e,"square")},Node.prototype._drawStar=function(e){this._drawShape(e,"star")},Node.prototype._resizeShape=function(){if(!this.width){this.radius=this.baseRadiusValue;var e=2*this.radius;this.width=e,this.height=e,this.width+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeWidthFactor,this.height+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeHeightFactor,this.radius+=.5*Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeRadiusFactor,this.growthIndicator=this.width-e}},Node.prototype._drawShape=function(e,t){this._resizeShape(e),this.left=this.x-this.width/2,this.top=this.y-this.height/2;var n=2.5,r=2,i=2;switch(t){case"dot":i=2;break;case"square":i=2;break;case"triangle":i=3;break;case"triangleDown":i=3;break;case"star":i=4}e.strokeStyle=this.selected?this.color.highlight.border:this.hover?this.color.hover.border:this.color.border,this.clusterSize>1&&(e.lineWidth=(this.selected?r:1)+(this.clusterSize>1?n:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e[t](this.x,this.y,this.radius+i*e.lineWidth),e.stroke()),e.lineWidth=(this.selected?r:1)+(this.clusterSize>1?n:0),e.lineWidth*=this.graphScaleInv,e.lineWidth=Math.min(.1*this.width,e.lineWidth),e.fillStyle=this.selected?this.color.highlight.background:this.hover?this.color.hover.background:this.color.background,e[t](this.x,this.y,this.radius),e.fill(),e.stroke(),this.label&&this._label(e,this.label,this.x,this.y+this.height/2,void 0,"top")},Node.prototype._resizeText=function(e){if(!this.width){var t=5,n=this.getTextSize(e);this.width=n.width+2*t,this.height=n.height+2*t,this.width+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeWidthFactor,this.height+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeHeightFactor,this.radius+=Math.min(this.clusterSize-1,this.maxNodeSizeIncrements)*this.clusterSizeRadiusFactor,this.growthIndicator=this.width-(n.width+2*t)}},Node.prototype._drawText=function(e){this._resizeText(e),this.left=this.x-this.width/2,this.top=this.y-this.height/2,this._label(e,this.label,this.x,this.y)},Node.prototype._label=function(e,t,n,r,i,s){if(t&&this.fontSize*this.graphScale>this.fontDrawThreshold){e.font=(this.selected?"bold ":"")+this.fontSize+"px "+this.fontFace,e.fillStyle=this.fontColor||"black",e.textAlign=i||"center",e.textBaseline=s||"middle";for(var o=t.split("\n"),u=o.length,a=this.fontSize+4,f=r+(1-u)/2*a,l=0;u>l;l++)e.fillText(o[l],n,f),f+=a}},Node.prototype.getTextSize=function(e){if(void 0!==this.label){e.font=(this.selected?"bold ":"")+this.fontSize+"px "+this.fontFace;for(var t=this.label.split("\n"),n=(this.fontSize+4)*t.length,r=0,i=0,s=t.length;s>i;i++)r=Math.max(r,e.measureText(t[i]).width);return{width:r,height:n}}return{width:0,height:0}},Node.prototype.inArea=function(){return void 0!==this.width?this.x+this.width*this.graphScaleInv>=this.canvasTopLeft.x&&this.x-this.width*this.graphScaleInv<this.canvasBottomRight.x&&this.y+this.height*this.graphScaleInv>=this.canvasTopLeft.y&&this.y-this.height*this.graphScaleInv<this.canvasBottomRight.y:!0},Node.prototype.inView=function(){return this.x>=this.canvasTopLeft.x&&this.x<this.canvasBottomRight.x&&this.y>=this.canvasTopLeft.y&&this.y<this.canvasBottomRight.y},Node.prototype.setScaleAndPos=function(e,t,n){this.graphScaleInv=1/e,this.graphScale=e,this.canvasTopLeft=t,this.canvasBottomRight=n},Node.prototype.setScale=function(e){this.graphScaleInv=1/e,this.graphScale=e},Node.prototype.clearVelocity=function(){this.vx=0,this.vy=0},Node.prototype.updateVelocity=function(e){var t=this.vx*this.vx*e;this.vx=Math.sqrt(t/this.mass),t=this.vy*this.vy*e,this.vy=Math.sqrt(t/this.mass)},Edge.prototype.setProperties=function(e,t){if(e)switch(void 0!==e.from&&(this.fromId=e.from),void 0!==e.to&&(this.toId=e.to),void 0!==e.id&&(this.id=e.id),void 0!==e.style&&(this.style=e.style),void 0!==e.label&&(this.label=e.label),this.label&&(this.fontSize=t.edges.fontSize,this.fontFace=t.edges.fontFace,this.fontColor=t.edges.fontColor,this.fontFill=t.edges.fontFill,void 0!==e.fontColor&&(this.fontColor=e.fontColor),void 0!==e.fontSize&&(this.fontSize=e.fontSize),void 0!==e.fontFace&&(this.fontFace=e.fontFace),void 0!==e.fontFill&&(this.fontFill=e.fontFill)),void 0!==e.title&&(this.title=e.title),void 0!==e.width&&(this.width=e.width),void 0!==e.hoverWidth&&(this.hoverWidth=e.hoverWidth),void 0!==e.value&&(this.value=e.value),void 0!==e.length&&(this.length=e.length,this.customLength=!0),void 0!==e.arrowScaleFactor&&(this.arrowScaleFactor=e.arrowScaleFactor),e.dash&&(void 0!==e.dash.length&&(this.dash.length=e.dash.length),void 0!==e.dash.gap&&(this.dash.gap=e.dash.gap),void 0!==e.dash.altLength&&(this.dash.altLength=e.dash.altLength)),void 0!==e.color&&(util.isString(e.color)?(this.color.color=e.color,this.color.highlight=e.color):(void 0!==e.color.color&&(this.color.color=e.color.color),void 0!==e.color.highlight&&(this.color.highlight=e.color.highlight))),this.connect(),this.widthFixed=this.widthFixed||void 0!==e.width,this.lengthFixed=this.lengthFixed||void 0!==e.length,this.style){case"line":this.draw=this._drawLine;break;case"arrow":this.draw=this._drawArrow;break;case"arrow-center":this.draw=this._drawArrowCenter;break;case"dash-line":this.draw=this._drawDashLine;break;default:this.draw=this._drawLine}},Edge.prototype.connect=function(){this.disconnect(),this.from=this.graph.nodes[this.fromId]||null,this.to=this.graph.nodes[this.toId]||null,this.connected=this.from&&this.to,this.connected?(this.from.attachEdge(this),this.to.attachEdge(this)):(this.from&&this.from.detachEdge(this),this.to&&this.to.detachEdge(this))},Edge.prototype.disconnect=function(){this.from&&(this.from.detachEdge(this),this.from=null),this.to&&(this.to.detachEdge(this),this.to=null),this.connected=!1},Edge.prototype.getTitle=function(){return"function"==typeof this.title?this.title():this.title},Edge.prototype.getValue=function(){return this.value},Edge.prototype.setValueRange=function(e,t){if(!this.widthFixed&&void 0!==this.value){var n=(this.widthMax-this.widthMin)/(t-e);this.width=(this.value-e)*n+this.widthMin}},Edge.prototype.draw=function(){throw"Method draw not initialized in edge"},Edge.prototype.isOverlappingWith=function(e){if(this.connected){var t=10,n=this.from.x,r=this.from.y,i=this.to.x,s=this.to.y,o=e.left,u=e.top,a=this._getDistanceToEdge(n,r,i,s,o,u);return t>a}return!1},Edge.prototype._drawLine=function(e){if(e.strokeStyle=1==this.selected?this.color.highlight:1==this.hover?this.color.hover:this.color.color,e.lineWidth=this._getLineWidth(),this.from!=this.to){this._line(e);var t;if(this.label){if(1==this.smooth){var n=.5*(.5*(this.from.x+this.via.x)+.5*(this.to.x+this.via.x)),r=.5*(.5*(this.from.y+this.via.y)+.5*(this.to.y+this.via.y));t={x:n,y:r}}else t=this._pointOnLine(.5);this._label(e,this.label,t.x,t.y)}}else{var i,s,o=this.length/4,u=this.from;u.width||u.resize(e),u.width>u.height?(i=u.x+u.width/2,s=u.y-o):(i=u.x+o,s=u.y-u.height/2),this._circle(e,i,s,o),t=this._pointOnCircle(i,s,o,.5),this._label(e,this.label,t.x,t.y)}},Edge.prototype._getLineWidth=function(){return 1==this.selected?Math.min(2*this.width,this.widthMax)*this.graphScaleInv:1==this.hover?Math.min(this.hoverWidth,this.widthMax)*this.graphScaleInv:this.width*this.graphScaleInv},Edge.prototype._line=function(e){e.beginPath(),e.moveTo(this.from.x,this.from.y),1==this.smooth?e.quadraticCurveTo(this.via.x,this.via.y,this.to.x,this.to.y):e.lineTo(this.to.x,this.to.y),e.stroke()},Edge.prototype._circle=function(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI,!1),e.stroke()},Edge.prototype._label=function(e,t,n,r){if(t){e.font=(this.from.selected||this.to.selected?"bold ":"")+this.fontSize+"px "+this.fontFace,e.fillStyle=this.fontFill;var i=e.measureText(t).width,s=this.fontSize,o=n-i/2,u=r-s/2;e.fillRect(o,u,i,s),e.fillStyle=this.fontColor||"black",e.textAlign="left",e.textBaseline="top",e.fillText(t,o,u)}},Edge.prototype._drawDashLine=function(e){if(e.strokeStyle=1==this.selected?this.color.highlight:1==this.hover?this.color.hover:this.color.color,e.lineWidth=this._getLineWidth(),void 0!==e.mozDash||void 0!==e.setLineDash){e.beginPath(),e.moveTo(this.from.x,this.from.y);var t=[0];t=void 0!==this.dash.length&&void 0!==this.dash.gap?[this.dash.length,this.dash.gap]:[5,5],"undefined"!=typeof e.setLineDash?(e.setLineDash(t),e.lineDashOffset=0):(e.mozDash=t,e.mozDashOffset=0),1==this.smooth?e.quadraticCurveTo(this.via.x,this.via.y,this.to.x,this.to.y):e.lineTo(this.to.x,this.to.y),e.stroke(),"undefined"!=typeof e.setLineDash?(e.setLineDash([0]),e.lineDashOffset=0):(e.mozDash=[0],e.mozDashOffset=0)}else e.beginPath(),e.lineCap="round",void 0!==this.dash.altLength?e.dashedLine(this.from.x,this.from.y,this.to.x,this.to.y,[this.dash.length,this.dash.gap,this.dash.altLength,this.dash.gap]):void 0!==this.dash.length&&void 0!==this.dash.gap?e.dashedLine(this.from.x,this.from.y,this.to.x,this.to.y,[this.dash.length,this.dash.gap]):(e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y)),e.stroke();if(this.label){var n;if(1==this.smooth){var r=.5*(.5*(this.from.x+this.via.x)+.5*(this.to.x+this.via.x)),i=.5*(.5*(this.from.y+this.via.y)+.5*(this.to.y+this.via.y));n={x:r,y:i}}else n=this._pointOnLine(.5);this._label(e,this.label,n.x,n.y)}},Edge.prototype._pointOnLine=function(e){return{x:(1-e)*this.from.x+e*this.to.x,y:(1-e)*this.from.y+e*this.to.y}},Edge.prototype._pointOnCircle=function(e,t,n,r){var i=2*(r-3/8)*Math.PI;return{x:e+n*Math.cos(i),y:t-n*Math.sin(i)}},Edge.prototype._drawArrowCenter=function(e){var t;if(1==this.selected?(e.strokeStyle=this.color.highlight,e.fillStyle=this.color.highlight):1==this.hover?(e.strokeStyle=this.color.hover,e.fillStyle=this.color.hover):(e.strokeStyle=this.color.color,e.fillStyle=this.color.color),e.lineWidth=this._getLineWidth(),this.from!=this.to){this._line(e);var n=Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x),r=(10+5*this.width)*this.arrowScaleFactor;if(1==this.smooth){var i=.5*(.5*(this.from.x+this.via.x)+.5*(this.to.x+this.via.x)),s=.5*(.5*(this.from.y+this.via.y)+.5*(this.to.y+this.via.y));t={x:i,y:s}}else t=this._pointOnLine(.5);e.arrow(t.x,t.y,n,r),e.fill(),e.stroke(),this.label&&this._label(e,this.label,t.x,t.y)}else{var o,u,a=.25*Math.max(100,this.length),f=this.from;f.width||f.resize(e),f.width>f.height?(o=f.x+.5*f.width,u=f.y-a):(o=f.x+a,u=f.y-.5*f.height),this._circle(e,o,u,a);var n=.2*Math.PI,r=(10+5*this.width)*this.arrowScaleFactor;t=this._pointOnCircle(o,u,a,.5),e.arrow(t.x,t.y,n,r),e.fill(),e.stroke(),this.label&&(t=this._pointOnCircle(o,u,a,.5),this._label(e,this.label,t.x,t.y))}},Edge.prototype._drawArrow=function(e){1==this.selected?(e.strokeStyle=this.color.highlight,e.fillStyle=this.color.highlight):1==this.hover?(e.strokeStyle=this.color.hover,e.fillStyle=this.color.hover):(e.strokeStyle=this.color.color,e.fillStyle=this.color.color),e.lineWidth=this._getLineWidth();var t,n;if(this.from!=this.to){t=Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x);var r=this.to.x-this.from.x,i=this.to.y-this.from.y,s=Math.sqrt(r*r+i*i),o=this.from.distanceToBorder(e,t+Math.PI),u=(s-o)/s,a=u*this.from.x+(1-u)*this.to.x,f=u*this.from.y+(1-u)*this.to.y;1==this.smooth&&(t=Math.atan2(this.to.y-this.via.y,this.to.x-this.via.x),r=this.to.x-this.via.x,i=this.to.y-this.via.y,s=Math.sqrt(r*r+i*i));var l,c,h=this.to.distanceToBorder(e,t),p=(s-h)/s;if(1==this.smooth?(l=(1-p)*this.via.x+p*this.to.x,c=(1-p)*this.via.y+p*this.to.y):(l=(1-p)*this.from.x+p*this.to.x,c=(1-p)*this.from.y+p*this.to.y),e.beginPath(),e.moveTo(a,f),1==this.smooth?e.quadraticCurveTo(this.via.x,this.via.y,l,c):e.lineTo(l,c),e.stroke(),n=(10+5*this.width)*this.arrowScaleFactor,e.arrow(l,c,t,n),e.fill(),e.stroke(),this.label){var d;if(1==this.smooth){var v=.5*(.5*(this.from.x+this.via.x)+.5*(this.to.x+this.via.x)),m=.5*(.5*(this.from.y+this.via.y)+.5*(this.to.y+this.via.y));d={x:v,y:m}}else d=this._pointOnLine(.5);this._label(e,this.label,d.x,d.y)}}else{var g,y,b,w=this.from,E=.25*Math.max(100,this.length);w.width||w.resize(e),w.width>w.height?(g=w.x+.5*w.width,y=w.y-E,b={x:g,y:w.y,angle:.9*Math.PI}):(g=w.x+E,y=w.y-.5*w.height,b={x:w.x,y:y,angle:.6*Math.PI}),e.beginPath(),e.arc(g,y,E,0,2*Math.PI,!1),e.stroke();var n=(10+5*this.width)*this.arrowScaleFactor;e.arrow(b.x,b.y,b.angle,n),e.fill(),e.stroke(),this.label&&(d=this._pointOnCircle(g,y,E,.5),this._label(e,this.label,d.x,d.y))}},Edge.prototype._getDistanceToEdge=function(e,t,n,r,i,s){if(this.from!=this.to){if(1==this.smooth){var o,u,a,f,l,c,h=1e9;for(o=0;10>o;o++)u=.1*o,a=Math.pow(1-u,2)*e+2*u*(1-u)*this.via.x+Math.pow(u,2)*n,f=Math.pow(1-u,2)*t+2*u*(1-u)*this.via.y+Math.pow(u,2)*r,l=Math.abs(i-a),c=Math.abs(s-f),h=Math.min(h,Math.sqrt(l*l+c*c));return h}var p=n-e,d=r-t,v=p*p+d*d,m=((i-e)*p+(s-t)*d)/v;m>1?m=1:0>m&&(m=0);var a=e+m*p,f=t+m*d,l=a-i,c=f-s;return Math.sqrt(l*l+c*c)}var a,f,l,c,g=this.length/4,y=this.from;return y.width||y.resize(ctx),y.width>y.height?(a=y.x+y.width/2,f=y.y-g):(a=y.x+g,f=y.y-y.height/2),l=a-i,c=f-s,Math.abs(Math.sqrt(l*l+c*c)-g)},Edge.prototype.setScale=function(e){this.graphScaleInv=1/e},Edge.prototype.select=function(){this.selected=!0},Edge.prototype.unselect=function(){this.selected=!1},Edge.prototype.positionBezierNode=function(){null!==this.via&&(this.via.x=.5*(this.from.x+this.to.x),this.via.y=.5*(this.from.y+this.to.y))},Edge.prototype._drawControlNodes=function(e){if(1==this.controlNodesEnabled){if(null===this.controlNodes.from&&null===this.controlNodes.to){var t="edgeIdFrom:".concat(this.id),n="edgeIdTo:".concat(this.id),r={nodes:{group:"",radius:8},physics:{damping:0},clustering:{maxNodeSizeIncrements:0,nodeScaling:{width:0,height:0,radius:0}}};this.controlNodes.from=new Node({id:t,shape:"dot",color:{background:"#ff4e00",border:"#3c3c3c",highlight:{background:"#07f968"}}},{},{},r),this.controlNodes.to=new Node({id:n,shape:"dot",color:{background:"#ff4e00",border:"#3c3c3c",highlight:{background:"#07f968"}}},{},{},r)}0==this.controlNodes.from.selected&&0==this.controlNodes.to.selected&&(this.controlNodes.positions=this.getControlNodePositions(e),this.controlNodes.from.x=this.controlNodes.positions.from.x,this.controlNodes.from.y=this.controlNodes.positions.from.y,this.controlNodes.to.x=this.controlNodes.positions.to.x,this.controlNodes.to.y=this.controlNodes.positions.to.y),this.controlNodes.from.draw(e),this.controlNodes.to.draw(e)}else this.controlNodes={from:null,to:null,positions:{}}},Edge.prototype._enableControlNodes=function(){this.controlNodesEnabled=!0},Edge.prototype._disableControlNodes=function(){this.controlNodesEnabled=!1},Edge.prototype._getSelectedControlNode=function(e,t){var n=this.controlNodes.positions,r=Math.sqrt(Math.pow(e-n.from.x,2)+Math.pow(t-n.from.y,2)),i=Math.sqrt(Math.pow(e-n.to.x,2)+Math.pow(t-n.to.y,2));return 15>r?(this.connectedNode=this.from,this.from=this.controlNodes.from,this.controlNodes.from):15>i?(this.connectedNode=this.to,this.to=this.controlNodes.to,this.controlNodes.to):null},Edge.prototype._restoreControlNodes=function(){1==this.controlNodes.from.selected&&(this.from=this.connectedNode,this.connectedNode=null,this.controlNodes.from.unselect()),1==this.controlNodes.to.selected&&(this.to=this.connectedNode,this.connectedNode=null,this.controlNodes.to.unselect())},Edge.prototype.getControlNodePositions=function(e){var t=Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x),n=this.to.x-this.from.x,r=this.to.y-this.from.y,i=Math.sqrt(n*n+r*r),s=this.from.distanceToBorder(e,t+Math.PI),o=(i-s)/i,u=o*this.from.x+(1-o)*this.to.x,a=o*this.from.y+(1-o)*this.to.y;1==this.smooth&&(t=Math.atan2(this.to.y-this.via.y,this.to.x-this.via.x),n=this.to.x-this.via.x,r=this.to.y-this.via.y,i=Math.sqrt(n*n+r*r));var f,l,c=this.to.distanceToBorder(e,t),h=(i-c)/i;return 1==this.smooth?(f=(1-h)*this.via.x+h*this.to.x,l=(1-h)*this.via.y+h*this.to.y):(f=(1-h)*this.from.x+h*this.to.x,l=(1-h)*this.from.y+h*this.to.y),{from:{x:u,y:a},to:{x:f,y:l}}},Popup.prototype.setPosition=function(e,t){this.x=parseInt(e),this.y=parseInt(t)},Popup.prototype.setText=function(e){this.frame.innerHTML=e},Popup.prototype.show=function(e){if(void 0===e&&(e=!0),e){var t=this.frame.clientHeight,n=this.frame.clientWidth,r=this.frame.parentNode.clientHeight,i=this.frame.parentNode.clientWidth,s=this.y-t;s+t+this.padding>r&&(s=r-t-this.padding),s<this.padding&&(s=this.padding);var o=this.x;o+n+this.padding>i&&(o=i-n-this.padding),o<this.padding&&(o=this.padding),this.frame.style.left=o+"px",this.frame.style.top=s+"px",this.frame.style.visibility="visible"}else this.hide()},Popup.prototype.hide=function(){this.frame.style.visibility="hidden"},Groups.DEFAULT=[{border:"#2B7CE9",background:"#97C2FC",highlight:{border:"#2B7CE9",background:"#D2E5FF"}},{border:"#FFA500",background:"#FFFF00",highlight:{border:"#FFA500",background:"#FFFFA3"}},{border:"#FA0A10",background:"#FB7E81",highlight:{border:"#FA0A10",background:"#FFAFB1"}},{border:"#41A906",background:"#7BE141",highlight:{border:"#41A906",background:"#A1EC76"}},{border:"#E129F0",background:"#EB7DF4",highlight:{border:"#E129F0",background:"#F0B3F5"}},{border:"#7C29F0",background:"#AD85E4",highlight:{border:"#7C29F0",background:"#D3BDF0"}},{border:"#C37F00",background:"#FFA807",highlight:{border:"#C37F00",background:"#FFCA66"}},{border:"#4220FB",background:"#6E6EFD",highlight:{border:"#4220FB",background:"#9B9BFD"}},{border:"#FD5A77",background:"#FFC0CB",highlight:{border:"#FD5A77",background:"#FFD1D9"}},{border:"#4AD63A",background:"#C2FABC",highlight:{border:"#4AD63A",background:"#E6FFE3"}}],Groups.prototype.clear=function(){this.groups={},this.groups.length=function(){var e=0;for(var t in this)this.hasOwnProperty(t)&&e++;return e}},Groups.prototype.get=function(e){var t=this.groups[e];if(void 0==t){var n=this.defaultIndex%Groups.DEFAULT.length;this.defaultIndex++,t={},t.color=Groups.DEFAULT[n],this.groups[e]=t}return t},Groups.prototype.add=function(e,t){return this.groups[e]=t,t.color&&(t.color=util.parseColor(t.color)),t},Images.prototype.setOnloadCallback=function(e){this.callback=e},Images.prototype.load=function(e){var t=this.images[e];if(void 0==t){var n=this;t=new Image,this.images[e]=t,t.onload=function(){n.callback&&n.callback(this)},t.src=e}return t};var physicsMixin={_toggleBarnesHut:function(){this.constants.physics.barnesHut.enabled=!this.constants.physics.barnesHut.enabled,this._loadSelectedForceSolver(),this.moving=!0,this.start()},_loadSelectedForceSolver:function(){1==this.constants.physics.barnesHut.enabled?(this._clearMixin(repulsionMixin),this._clearMixin(hierarchalRepulsionMixin),this.constants.physics.centralGravity=this.constants.physics.barnesHut.centralGravity,this.constants.physics.springLength=this.constants.physics.barnesHut.springLength,this.constants.physics.springConstant=this.constants.physics.barnesHut.springConstant,this.constants.physics.damping=this.constants.physics.barnesHut.damping,this._loadMixin(barnesHutMixin)):1==this.constants.physics.hierarchicalRepulsion.enabled?(this._clearMixin(barnesHutMixin),this._clearMixin(repulsionMixin),this.constants.physics.centralGravity=this.constants.physics.hierarchicalRepulsion.centralGravity,this.constants.physics.springLength=this.constants.physics.hierarchicalRepulsion.springLength,this.constants.physics.springConstant=this.constants.physics.hierarchicalRepulsion.springConstant,this.constants.physics.damping=this.constants.physics.hierarchicalRepulsion.damping,this._loadMixin(hierarchalRepulsionMixin)):(this._clearMixin(barnesHutMixin),this._clearMixin(hierarchalRepulsionMixin),this.barnesHutTree=void 0,this.constants.physics.centralGravity=this.constants.physics.repulsion.centralGravity,this.constants.physics.springLength=this.constants.physics.repulsion.springLength,this.constants.physics.springConstant=this.constants.physics.repulsion.springConstant,this.constants.physics.damping=this.constants.physics.repulsion.damping,this._loadMixin(repulsionMixin))},_initializeForceCalculation:function(){1==this.nodeIndices.length?this.nodes[this.nodeIndices[0]]._setForce(0,0):(this.nodeIndices.length>this.constants.clustering.clusterThreshold&&1==this.constants.clustering.enabled&&this.clusterToFit(this.constants.clustering.reduceToNodes,!1),this._calculateForces())},_calculateForces:function(){this._calculateGravitationalForces(),this._calculateNodeForces(),1==this.constants.smoothCurves?this._calculateSpringForcesWithSupport():this._calculateSpringForces()},_updateCalculationNodes:function(){if(1==this.constants.smoothCurves){this.calculationNodes={},this.calculationNodeIndices=[];for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&(this.calculationNodes[e]=this.nodes[e]);var t=this.sectors.support.nodes;for(var n in t)t.hasOwnProperty(n)&&(this.edges.hasOwnProperty(t[n].parentEdgeId)?this.calculationNodes[n]=t[n]:t[n]._setForce(0,0));for(var r in this.calculationNodes)this.calculationNodes.hasOwnProperty(r)&&this.calculationNodeIndices.push(r)}else this.calculationNodes=this.nodes,this.calculationNodeIndices=this.nodeIndices},_calculateGravitationalForces:function(){var e,t,n,r,i,s=this.calculationNodes,o=this.constants.physics.centralGravity,u=0;for(i=0;i<this.calculationNodeIndices.length;i++)r=s[this.calculationNodeIndices[i]],r.damping=this.constants.physics.damping,"default"==this._sector()&&0!=o?(e=-r.x,t=-r.y,n=Math.sqrt(e*e+t*t),u=0==n?0:o/n,r.fx=e*u,r.fy=t*u):(r.fx=0,r.fy=0)},_calculateSpringForces:function(){var e,t,n,r,i,s,o,u,a,f=this.edges;for(n in f)f.hasOwnProperty(n)&&(t=f[n],t.connected&&this.nodes.hasOwnProperty(t.toId)&&this.nodes.hasOwnProperty(t.fromId)&&(e=t.customLength?t.length:this.constants.physics.springLength,e+=(t.to.clusterSize+t.from.clusterSize-2)*this.constants.clustering.edgeGrowth,r=t.from.x-t.to.x,i=t.from.y-t.to.y,a=Math.sqrt(r*r+i*i),0==a&&(a=.01),u=this.constants.physics.springConstant*(e-a)/a,s=r*u,o=i*u,t.from.fx+=s,t.from.fy+=o,t.to.fx-=s,t.to.fy-=o))},_calculateSpringForcesWithSupport:function(){var e,t,n,r,i=this.edges;for(n in i)if(i.hasOwnProperty(n)&&(t=i[n],t.connected&&this.nodes.hasOwnProperty(t.toId)&&this.nodes.hasOwnProperty(t.fromId)&&null!=t.via)){var s=t.to,o=t.via,u=t.from;e=t.customLength?t.length:this.constants.physics.springLength,r=s.clusterSize+u.clusterSize-2,e+=r*this.constants.clustering.edgeGrowth,this._calculateSpringForce(s,o,.5*e),this._calculateSpringForce(o,u,.5*e)}},_calculateSpringForce:function(e,t,n){var r,i,s,o,u,a;r=e.x-t.x,i=e.y-t.y,a=Math.sqrt(r*r+i*i),0==a&&(a=.01),u=this.constants.physics.springConstant*(n-a)/a,s=r*u,o=i*u,e.fx+=s,e.fy+=o,t.fx-=s,t.fy-=o},_loadPhysicsConfiguration:function(){if(void 0===this.physicsConfiguration){this.backupConstants={},util.copyObject(this.constants,this.backupConstants);var e=["LR","RL","UD","DU"];this.physicsConfiguration=document.createElement("div"),this.physicsConfiguration.className="PhysicsConfiguration",this.physicsConfiguration.innerHTML='<table><tr><td><b>Simulation Mode:</b></td></tr><tr><td width="120px"><input type="radio" name="graph_physicsMethod" id="graph_physicsMethod1" value="BH" checked="checked">Barnes Hut</td><td width="120px"><input type="radio" name="graph_physicsMethod" id="graph_physicsMethod2" value="R">Repulsion</td><td width="120px"><input type="radio" name="graph_physicsMethod" id="graph_physicsMethod3" value="H">Hierarchical</td></tr></table><table id="graph_BH_table" style="display:none"><tr><td><b>Barnes Hut</b></td></tr><tr><td width="150px">gravitationalConstant</td><td>0</td><td><input type="range" min="0" max="20000" value="'+ -1*this.constants.physics.barnesHut.gravitationalConstant+'" step="25" style="width:300px" id="graph_BH_gc"></td><td  width="50px">-20000</td><td><input value="'+ -1*this.constants.physics.barnesHut.gravitationalConstant+'" id="graph_BH_gc_value" style="width:60px"></td></tr><tr><td width="150px">centralGravity</td><td>0</td><td><input type="range" min="0" max="3"  value="'+this.constants.physics.barnesHut.centralGravity+'" step="0.05"  style="width:300px" id="graph_BH_cg"></td><td>3</td><td><input value="'+this.constants.physics.barnesHut.centralGravity+'" id="graph_BH_cg_value" style="width:60px"></td></tr><tr><td width="150px">springLength</td><td>0</td><td><input type="range" min="0" max="500" value="'+this.constants.physics.barnesHut.springLength+'" step="1" style="width:300px" id="graph_BH_sl"></td><td>500</td><td><input value="'+this.constants.physics.barnesHut.springLength+'" id="graph_BH_sl_value" style="width:60px"></td></tr><tr><td width="150px">springConstant</td><td>0</td><td><input type="range" min="0" max="0.5" value="'+this.constants.physics.barnesHut.springConstant+'" step="0.001" style="width:300px" id="graph_BH_sc"></td><td>0.5</td><td><input value="'+this.constants.physics.barnesHut.springConstant+'" id="graph_BH_sc_value" style="width:60px"></td></tr><tr><td width="150px">damping</td><td>0</td><td><input type="range" min="0" max="0.3" value="'+this.constants.physics.barnesHut.damping+'" step="0.005" style="width:300px" id="graph_BH_damp"></td><td>0.3</td><td><input value="'+this.constants.physics.barnesHut.damping+'" id="graph_BH_damp_value" style="width:60px"></td></tr></table><table id="graph_R_table" style="display:none"><tr><td><b>Repulsion</b></td></tr><tr><td width="150px">nodeDistance</td><td>0</td><td><input type="range" min="0" max="300" value="'+this.constants.physics.repulsion.nodeDistance+'" step="1" style="width:300px" id="graph_R_nd"></td><td width="50px">300</td><td><input value="'+this.constants.physics.repulsion.nodeDistance+'" id="graph_R_nd_value" style="width:60px"></td></tr><tr><td width="150px">centralGravity</td><td>0</td><td><input type="range" min="0" max="3"  value="'+this.constants.physics.repulsion.centralGravity+'" step="0.05"  style="width:300px" id="graph_R_cg"></td><td>3</td><td><input value="'+this.constants.physics.repulsion.centralGravity+'" id="graph_R_cg_value" style="width:60px"></td></tr><tr><td width="150px">springLength</td><td>0</td><td><input type="range" min="0" max="500" value="'+this.constants.physics.repulsion.springLength+'" step="1" style="width:300px" id="graph_R_sl"></td><td>500</td><td><input value="'+this.constants.physics.repulsion.springLength+'" id="graph_R_sl_value" style="width:60px"></td></tr><tr><td width="150px">springConstant</td><td>0</td><td><input type="range" min="0" max="0.5" value="'+this.constants.physics.repulsion.springConstant+'" step="0.001" style="width:300px" id="graph_R_sc"></td><td>0.5</td><td><input value="'+this.constants.physics.repulsion.springConstant+'" id="graph_R_sc_value" style="width:60px"></td></tr><tr><td width="150px">damping</td><td>0</td><td><input type="range" min="0" max="0.3" value="'+this.constants.physics.repulsion.damping+'" step="0.005" style="width:300px" id="graph_R_damp"></td><td>0.3</td><td><input value="'+this.constants.physics.repulsion.damping+'" id="graph_R_damp_value" style="width:60px"></td></tr></table><table id="graph_H_table" style="display:none"><tr><td width="150"><b>Hierarchical</b></td></tr><tr><td width="150px">nodeDistance</td><td>0</td><td><input type="range" min="0" max="300" value="'+this.constants.physics.hierarchicalRepulsion.nodeDistance+'" step="1" style="width:300px" id="graph_H_nd"></td><td width="50px">300</td><td><input value="'+this.constants.physics.hierarchicalRepulsion.nodeDistance+'" id="graph_H_nd_value" style="width:60px"></td></tr><tr><td width="150px">centralGravity</td><td>0</td><td><input type="range" min="0" max="3"  value="'+this.constants.physics.hierarchicalRepulsion.centralGravity+'" step="0.05"  style="width:300px" id="graph_H_cg"></td><td>3</td><td><input value="'+this.constants.physics.hierarchicalRepulsion.centralGravity+'" id="graph_H_cg_value" style="width:60px"></td></tr><tr><td width="150px">springLength</td><td>0</td><td><input type="range" min="0" max="500" value="'+this.constants.physics.hierarchicalRepulsion.springLength+'" step="1" style="width:300px" id="graph_H_sl"></td><td>500</td><td><input value="'+this.constants.physics.hierarchicalRepulsion.springLength+'" id="graph_H_sl_value" style="width:60px"></td></tr><tr><td width="150px">springConstant</td><td>0</td><td><input type="range" min="0" max="0.5" value="'+this.constants.physics.hierarchicalRepulsion.springConstant+'" step="0.001" style="width:300px" id="graph_H_sc"></td><td>0.5</td><td><input value="'+this.constants.physics.hierarchicalRepulsion.springConstant+'" id="graph_H_sc_value" style="width:60px"></td></tr><tr><td width="150px">damping</td><td>0</td><td><input type="range" min="0" max="0.3" value="'+this.constants.physics.hierarchicalRepulsion.damping+'" step="0.005" style="width:300px" id="graph_H_damp"></td><td>0.3</td><td><input value="'+this.constants.physics.hierarchicalRepulsion.damping+'" id="graph_H_damp_value" style="width:60px"></td></tr><tr><td width="150px">direction</td><td>1</td><td><input type="range" min="0" max="3" value="'+e.indexOf(this.constants.hierarchicalLayout.direction)+'" step="1" style="width:300px" id="graph_H_direction"></td><td>4</td><td><input value="'+this.constants.hierarchicalLayout.direction+'" id="graph_H_direction_value" style="width:60px"></td></tr><tr><td width="150px">levelSeparation</td><td>1</td><td><input type="range" min="0" max="500" value="'+this.constants.hierarchicalLayout.levelSeparation+'" step="1" style="width:300px" id="graph_H_levsep"></td><td>500</td><td><input value="'+this.constants.hierarchicalLayout.levelSeparation+'" id="graph_H_levsep_value" style="width:60px"></td></tr><tr><td width="150px">nodeSpacing</td><td>1</td><td><input type="range" min="0" max="500" value="'+this.constants.hierarchicalLayout.nodeSpacing+'" step="1" style="width:300px" id="graph_H_nspac"></td><td>500</td><td><input value="'+this.constants.hierarchicalLayout.nodeSpacing+'" id="graph_H_nspac_value" style="width:60px"></td></tr></table><table><tr><td><b>Options:</b></td></tr><tr><td width="180px"><input type="button" id="graph_toggleSmooth" value="Toggle smoothCurves" style="width:150px"></td><td width="180px"><input type="button" id="graph_repositionNodes" value="Reinitialize" style="width:150px"></td><td width="180px"><input type="button" id="graph_generateOptions" value="Generate Options" style="width:150px"></td></tr></table>',this.containerElement.parentElement.insertBefore(this.physicsConfiguration,this.containerElement),this.optionsDiv=document.createElement("div"),this.optionsDiv.style.fontSize="14px",this.optionsDiv.style.fontFamily="verdana",this.containerElement.parentElement.insertBefore(this.optionsDiv,this.containerElement);var t;t=document.getElementById("graph_BH_gc"),t.onchange=showValueOfRange.bind(this,"graph_BH_gc",-1,"physics_barnesHut_gravitationalConstant"),t=document.getElementById("graph_BH_cg"),t.onchange=showValueOfRange.bind(this,"graph_BH_cg",1,"physics_centralGravity"),t=document.getElementById("graph_BH_sc"),t.onchange=showValueOfRange.bind(this,"graph_BH_sc",1,"physics_springConstant"),t=document.getElementById("graph_BH_sl"),t.onchange=showValueOfRange.bind(this,"graph_BH_sl",1,"physics_springLength"),t=document.getElementById("graph_BH_damp"),t.onchange=showValueOfRange.bind(this,"graph_BH_damp",1,"physics_damping"),t=document.getElementById("graph_R_nd"),t.onchange=showValueOfRange.bind(this,"graph_R_nd",1,"physics_repulsion_nodeDistance"),t=document.getElementById("graph_R_cg"),t.onchange=showValueOfRange.bind(this,"graph_R_cg",1,"physics_centralGravity"),t=document.getElementById("graph_R_sc"),t.onchange=showValueOfRange.bind(this,"graph_R_sc",1,"physics_springConstant"),t=document.getElementById("graph_R_sl"),t.onchange=showValueOfRange.bind(this,"graph_R_sl",1,"physics_springLength"),t=document.getElementById("graph_R_damp"),t.onchange=showValueOfRange.bind(this,"graph_R_damp",1,"physics_damping"),t=document.getElementById("graph_H_nd"),t.onchange=showValueOfRange.bind(this,"graph_H_nd",1,"physics_hierarchicalRepulsion_nodeDistance"),t=document.getElementById("graph_H_cg"),t.onchange=showValueOfRange.bind(this,"graph_H_cg",1,"physics_centralGravity"),t=document.getElementById("graph_H_sc"),t.onchange=showValueOfRange.bind(this,"graph_H_sc",1,"physics_springConstant"),t=document.getElementById("graph_H_sl"),t.onchange=showValueOfRange.bind(this,"graph_H_sl",1,"physics_springLength"),t=document.getElementById("graph_H_damp"),t.onchange=showValueOfRange.bind(this,"graph_H_damp",1,"physics_damping"),t=document.getElementById("graph_H_direction"),t.onchange=showValueOfRange.bind(this,"graph_H_direction",e,"hierarchicalLayout_direction"),t=document.getElementById("graph_H_levsep"),t.onchange=showValueOfRange.bind(this,"graph_H_levsep",1,"hierarchicalLayout_levelSeparation"),t=document.getElementById("graph_H_nspac"),t.onchange=showValueOfRange.bind(this,"graph_H_nspac",1,"hierarchicalLayout_nodeSpacing");var n=document.getElementById("graph_physicsMethod1"),r=document.getElementById("graph_physicsMethod2"),i=document.getElementById("graph_physicsMethod3");r.checked=!0,this.constants.physics.barnesHut.enabled&&(n.checked=!0),this.constants.hierarchicalLayout.enabled&&(i.checked=!0);var s=document.getElementById("graph_toggleSmooth"),o=document.getElementById("graph_repositionNodes"),u=document.getElementById("graph_generateOptions");s.onclick=graphToggleSmoothCurves.bind(this),o.onclick=graphRepositionNodes.bind(this),u.onclick=graphGenerateOptions.bind(this),s.style.background=1==this.constants.smoothCurves?"#A4FF56":"#FF8532",switchConfigurations.apply(this),n.onchange=switchConfigurations.bind(this),r.onchange=switchConfigurations.bind(this),i.onchange=switchConfigurations.bind(this)}},_overWriteGraphConstants:function(e,t){var n=e.split("_");1==n.length?this.constants[n[0]]=t:2==n.length?this.constants[n[0]][n[1]]=t:3==n.length&&(this.constants[n[0]][n[1]][n[2]]=t)}},hierarchalRepulsionMixin={_calculateNodeForces:function(){var e,t,n,r,i,s,o,u,a,f,l=this.calculationNodes,c=this.calculationNodeIndices,h=5,p=.5*-h,d=this.constants.physics.hierarchicalRepulsion.nodeDistance,v=d;for(a=0;a<c.length-1;a++)for(o=l[c[a]],f=a+1;f<c.length;f++){u=l[c[f]],e=u.x-o.x,t=u.y-o.y,n=Math.sqrt(e*e+t*t);var m=p/v;2*v>n&&(s=m*n+h,0==n?n=.01:s/=n,r=e*s,i=t*s,o.fx-=r,o.fy-=i,u.fx+=r,u.fy+=i)}}},barnesHutMixin={_calculateNodeForces:function(){if(0!=this.constants.physics.barnesHut.gravitationalConstant){var e,t=this.calculationNodes,n=this.calculationNodeIndices,r=n.length;this._formBarnesHutTree(t,n);for(var i=this.barnesHutTree,s=0;r>s;s++)e=t[n[s]],this._getForceContribution(i.root.children.NW,e),this._getForceContribution(i.root.children.NE,e),this._getForceContribution(i.root.children.SW,e),this._getForceContribution(i.root.children.SE,e)}},_getForceContribution:function(e,t){if(e.childrenCount>0){var n,r,i;if(n=e.centerOfMass.x-t.x,r=e.centerOfMass.y-t.y,i=Math.sqrt(n*n+r*r),i*e.calcSize>this.constants.physics.barnesHut.theta){0==i&&(i=.1*Math.random(),n=i);var s=this.constants.physics.barnesHut.gravitationalConstant*e.mass*t.mass/(i*i*i),o=n*s,u=r*s;t.fx+=o,t.fy+=u}else if(4==e.childrenCount)this._getForceContribution(e.children.NW,t),this._getForceContribution(e.children.NE,t),this._getForceContribution(e.children.SW,t),this._getForceContribution(e.children.SE,t);else if(e.children.data.id!=t.id){0==i&&(i=.5*Math.random(),n=i);var s=this.constants.physics.barnesHut.gravitationalConstant*e.mass*t.mass/(i*i*i),o=n*s,u=r*s;t.fx+=o,t.fy+=u}}},_formBarnesHutTree:function(e,t){for(var n,r=t.length,i=Number.MAX_VALUE,s=Number.MAX_VALUE,o=-Number.MAX_VALUE,u=-Number.MAX_VALUE,a=0;r>a;a++){var f=e[t[a]].x,l=e[t[a]].y;i>f&&(i=f),f>o&&(o=f),s>l&&(s=l),l>u&&(u=l)}var c=Math.abs(o-i)-Math.abs(u-s);c>0?(s-=.5*c,u+=.5*c):(i+=.5*c,o-=.5*c);var h=1e-5,p=Math.max(h,Math.abs(o-i)),d=.5*p,v=.5*(i+o),m=.5*(s+u),g={root:{centerOfMass:{x:0,y:0},mass:0,range:{minX:v-d,maxX:v+d,minY:m-d,maxY:m+d},size:p,calcSize:1/p,children:{data:null},maxWidth:0,level:0,childrenCount:4}};for(this._splitBranch(g.root),a=0;r>a;a++)n=e[t[a]],this._placeInTree(g.root,n);this.barnesHutTree=g},_updateBranchMass:function(e,t){var n=e.mass+t.mass,r=1/n;e.centerOfMass.x=e.centerOfMass.x*e.mass+t.x*t.mass,e.centerOfMass.x*=r,e.centerOfMass.y=e.centerOfMass.y*e.mass+t.y*t.mass,e.centerOfMass.y*=r,e.mass=n;var i=Math.max(Math.max(t.height,t.radius),t.width);e.maxWidth=e.maxWidth<i?i:e.maxWidth},_placeInTree:function(e,t,n){(1!=n||void 0===n)&&this._updateBranchMass(e,t),e.children.NW.range.maxX>t.x?e.children.NW.range.maxY>t.y?this._placeInRegion(e,t,"NW"):this._placeInRegion(e,t,"SW"):e.children.NW.range.maxY>t.y?this._placeInRegion(e,t,"NE"):this._placeInRegion(e,t,"SE")},_placeInRegion:function(e,t,n){switch(e.children[n].childrenCount){case 0:e.children[n].children.data=t,e.children[n].childrenCount=1,this._updateBranchMass(e.children[n],t);break;case 1:e.children[n].children.data.x==t.x&&e.children[n].children.data.y==t.y?(t.x+=Math.random(),t.y+=Math.random()):(this._splitBranch(e.children[n]),this._placeInTree(e.children[n],t));break;case 4:this._placeInTree(e.children[n],t)}},_splitBranch:function(e){var t=null;1==e.childrenCount&&(t=e.children.data,e.mass=0,e.centerOfMass.x=0,e.centerOfMass.y=0),e.childrenCount=4,e.children.data=null,this._insertRegion(e,"NW"),this._insertRegion(e,"NE"),this._insertRegion(e,"SW"),this._insertRegion(e,"SE"),null!=t&&this._placeInTree(e,t)},_insertRegion:function(e,t){var n,r,i,s,o=.5*e.size;switch(t){case"NW":n=e.range.minX,r=e.range.minX+o,i=e.range.minY,s=e.range.minY+o;break;case"NE":n=e.range.minX+o,r=e.range.maxX,i=e.range.minY,s=e.range.minY+o;break;case"SW":n=e.range.minX,r=e.range.minX+o,i=e.range.minY+o,s=e.range.maxY;break;case"SE":n=e.range.minX+o,r=e.range.maxX,i=e.range.minY+o,s=e.range.maxY}e.children[t]={centerOfMass:{x:0,y:0},mass:0,range:{minX:n,maxX:r,minY:i,maxY:s},size:.5*e.size,calcSize:2*e.calcSize,children:{data:null},maxWidth:0,level:e.level+1,childrenCount:0}},_drawTree:function(e,t){void 0!==this.barnesHutTree&&(e.lineWidth=1,this._drawBranch(this.barnesHutTree.root,e,t))},_drawBranch:function(e,t,n){void 0===n&&(n="#FF0000"),4==e.childrenCount&&(this._drawBranch(e.children.NW,t),this._drawBranch(e.children.NE,t),this._drawBranch(e.children.SE,t),this._drawBranch(e.children.SW,t)),t.strokeStyle=n,t.beginPath(),t.moveTo(e.range.minX,e.range.minY),t.lineTo(e.range.maxX,e.range.minY),t.stroke(),t.beginPath(),t.moveTo(e.range.maxX,e.range.minY),t.lineTo(e.range.maxX,e.range.maxY),t.stroke(),t.beginPath(),t.moveTo(e.range.maxX,e.range.maxY),t.lineTo(e.range.minX,e.range.maxY),t.stroke(),t.beginPath(),t.moveTo(e.range.minX,e.range.maxY),t.lineTo(e.range.minX,e.range.minY),t.stroke()}},repulsionMixin={_calculateNodeForces:function(){var e,t,n,r,i,s,o,u,a,f,l,c=this.calculationNodes,h=this.calculationNodeIndices,p=-2/3,d=4/3,v=this.constants.physics.repulsion.nodeDistance,m=v;for(f=0;f<h.length-1;f++)for(u=c[h[f]],l=f+1;l<h.length;l++){a=c[h[l]],s=u.clusterSize+a.clusterSize-2,e=a.x-u.x,t=a.y-u.y,n=Math.sqrt(e*e+t*t),m=0==s?v:v*(1+s*this.constants.clustering.distanceAmplification);var g=p/m;2*m>n&&(o=.5*m>n?1:g*n+d,o*=0==s?1:1+s*this.constants.clustering.forceAmplification,o/=n,r=e*o,i=t*o,u.fx-=r,u.fy-=i,a.fx+=r,a.fy+=i)}}},HierarchicalLayoutMixin={_resetLevels:function(){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e)){var t=this.nodes[e];0==t.preassignedLevel&&(t.level=-1)}},_setupHierarchicalLayout:function(){if(1==this.constants.hierarchicalLayout.enabled&&this.nodeIndices.length>0){"RL"==this.constants.hierarchicalLayout.direction||"DU"==this.constants.hierarchicalLayout.direction?this.constants.hierarchicalLayout.levelSeparation*=-1:this.constants.hierarchicalLayout.levelSeparation=Math.abs(this.constants.hierarchicalLayout.levelSeparation);var e,t,n=0,r=!1,i=!1;for(t in this.nodes)this.nodes.hasOwnProperty(t)&&(e=this.nodes[t],-1!=e.level?r=!0:i=!0,n<e.edges.length&&(n=e.edges.length));if(1==i&&1==r)alert("To use the hierarchical layout, nodes require either no predefined levels or levels have to be defined for all nodes."),this.zoomExtent(!0,this.constants.clustering.enabled),this.constants.clustering.enabled||this.start();else{this._changeConstants(),1==i&&this._determineLevels(n);var s=this._getDistribution();this._placeNodesByHierarchy(s),this.start()}}},_placeNodesByHierarchy:function(e){var t,n;for(t in e[0].nodes)e[0].nodes.hasOwnProperty(t)&&(n=e[0].nodes[t],"UD"==this.constants.hierarchicalLayout.direction||"DU"==this.constants.hierarchicalLayout.direction?n.xFixed&&(n.x=e[0].minPos,n.xFixed=!1,e[0].minPos+=e[0].nodeSpacing):n.yFixed&&(n.y=e[0].minPos,n.yFixed=!1,e[0].minPos+=e[0].nodeSpacing),this._placeBranchNodes(n.edges,n.id,e,n.level));this._stabilize()},_getDistribution:function(){var e,t,n,r={};for(e in this.nodes)this.nodes.hasOwnProperty(e)&&(t=this.nodes[e],t.xFixed=!0,t.yFixed=!0,"UD"==this.constants.hierarchicalLayout.direction||"DU"==this.constants.hierarchicalLayout.direction?t.y=this.constants.hierarchicalLayout.levelSeparation*t.level:t.x=this.constants.hierarchicalLayout.levelSeparation*t.level,r.hasOwnProperty(t.level)||(r[t.level]={amount:0,nodes:{},minPos:0,nodeSpacing:0}),r[t.level].amount+=1,r[t.level].nodes[t.id]=t);var i=0;for(n in r)r.hasOwnProperty(n)&&i<r[n].amount&&(i=r[n].amount);for(n in r)r.hasOwnProperty(n)&&(r[n].nodeSpacing=(i+1)*this.constants.hierarchicalLayout.nodeSpacing,r[n].nodeSpacing/=r[n].amount+1,r[n].minPos=r[n].nodeSpacing-.5*(r[n].amount+1)*r[n].nodeSpacing);return r},_determineLevels:function(e){var t,n;for(t in this.nodes)this.nodes.hasOwnProperty(t)&&(n=this.nodes[t],n.edges.length==e&&(n.level=0));for(t in this.nodes)this.nodes.hasOwnProperty(t)&&(n=this.nodes[t],0==n.level&&this._setLevel(1,n.edges,n.id))},_changeConstants:function(){this.constants.clustering.enabled=!1,this.constants.physics.barnesHut.enabled=!1,this.constants.physics.hierarchicalRepulsion.enabled=!0,this._loadSelectedForceSolver(),this.constants.smoothCurves=!1,this._configureSmoothCurves()},_placeBranchNodes:function(e,t,n,r){for(var i=0;i<e.length;i++){var s=null;s=e[i].toId==t?e[i].from:e[i].to;var o=!1;"UD"==this.constants.hierarchicalLayout.direction||"DU"==this.constants.hierarchicalLayout.direction?s.xFixed&&s.level>r&&(s.xFixed=!1,s.x=n[s.level].minPos,o=!0):s.yFixed&&s.level>r&&(s.yFixed=!1,s.y=n[s.level].minPos,o=!0),1==o&&(n[s.level].minPos+=n[s.level].nodeSpacing,s.edges.length>1&&this._placeBranchNodes(s.edges,s.id,n,s.level))}},_setLevel:function(e,t,n){for(var r=0;r<t.length;r++){var i=null;i=t[r].toId==n?t[r].from:t[r].to,(-1==i.level||i.level>e)&&(i.level=e,t.length>1&&this._setLevel(e+1,i.edges,i.id))}},_restoreNodes:function(){for(nodeId in this.nodes)this.nodes.hasOwnProperty(nodeId)&&(this.nodes[nodeId].xFixed=!1,this.nodes[nodeId].yFixed=!1)}},manipulationMixin={_clearManipulatorBar:function(){for(;this.manipulationDiv.hasChildNodes();)this.manipulationDiv.removeChild(this.manipulationDiv.firstChild)},_restoreOverloadedFunctions:function(){for(var e in this.cachedFunctions)this.cachedFunctions.hasOwnProperty(e)&&(this[e]=this.cachedFunctions[e])},_toggleEditMode:function(){this.editMode=!this.editMode;var e=document.getElementById("graph-manipulationDiv"),t=document.getElementById("graph-manipulation-closeDiv"),n=document.getElementById("graph-manipulation-editMode");1==this.editMode?(e.style.display="block",t.style.display="block",n.style.display="none",t.onclick=this._toggleEditMode.bind(this)):(e.style.display="none",t.style.display="none",n.style.display="block",t.onclick=null),this._createManipulatorBar()},_createManipulatorBar:function(){if(this.boundFunction&&this.off("select",this.boundFunction),void 0!==this.edgeBeingEdited&&(this.edgeBeingEdited._disableControlNodes(),this.edgeBeingEdited=void 0,this.selectedControlNode=null),this._restoreOverloadedFunctions(),this.freezeSimulation=!1,this.blockConnectingEdgeSelection=!1,this.forceAppendSelection=!1,1==this.editMode){for(;this.manipulationDiv.hasChildNodes();)this.manipulationDiv.removeChild(this.manipulationDiv.firstChild);this.manipulationDiv.innerHTML="<span class='graph-manipulationUI add' id='graph-manipulate-addNode'><span class='graph-manipulationLabel'>"+this.constants.labels.add+"</span></span><div class='graph-seperatorLine'></div><span class='graph-manipulationUI connect' id='graph-manipulate-connectNode'><span class='graph-manipulationLabel'>"+this.constants.labels.link+"</span></span>",1==this._getSelectedNodeCount()&&this.triggerFunctions.edit?this.manipulationDiv.innerHTML+="<div class='graph-seperatorLine'></div><span class='graph-manipulationUI edit' id='graph-manipulate-editNode'><span class='graph-manipulationLabel'>"+this.constants.labels.editNode+"</span></span>":1==this._getSelectedEdgeCount()&&0==this._getSelectedNodeCount()&&(this.manipulationDiv.innerHTML+="<div class='graph-seperatorLine'></div><span class='graph-manipulationUI edit' id='graph-manipulate-editEdge'><span class='graph-manipulationLabel'>"+this.constants.labels.editEdge+"</span></span>"),0==this._selectionIsEmpty()&&(this.manipulationDiv.innerHTML+="<div class='graph-seperatorLine'></div><span class='graph-manipulationUI delete' id='graph-manipulate-delete'><span class='graph-manipulationLabel'>"+this.constants.labels.del+"</span></span>");var e=document.getElementById("graph-manipulate-addNode");e.onclick=this._createAddNodeToolbar.bind(this);var t=document.getElementById("graph-manipulate-connectNode");if(t.onclick=this._createAddEdgeToolbar.bind(this),1==this._getSelectedNodeCount()&&this.triggerFunctions.edit){var n=document.getElementById("graph-manipulate-editNode");n.onclick=this._editNode.bind(this)}else if(1==this._getSelectedEdgeCount()&&0==this._getSelectedNodeCount()){var n=document.getElementById("graph-manipulate-editEdge");n.onclick=this._createEditEdgeToolbar.bind(this)}if(0==this._selectionIsEmpty()){var r=document.getElementById("graph-manipulate-delete");r.onclick=this._deleteSelected.bind(this)}var i=document.getElementById("graph-manipulation-closeDiv");i.onclick=this._toggleEditMode.bind(this),this.boundFunction=this._createManipulatorBar.bind(this),this.on("select",this.boundFunction)}else{this.editModeDiv.innerHTML="<span class='graph-manipulationUI edit editmode' id='graph-manipulate-editModeButton'><span class='graph-manipulationLabel'>"+this.constants.labels.edit+"</span></span>";var s=document.getElementById("graph-manipulate-editModeButton");s.onclick=this._toggleEditMode.bind(this)}},_createAddNodeToolbar:function(){this._clearManipulatorBar(),this.boundFunction&&this.off("select",this.boundFunction),this.manipulationDiv.innerHTML="<span class='graph-manipulationUI back' id='graph-manipulate-back'><span class='graph-manipulationLabel'>"+this.constants.labels.back+" </span></span><div class='graph-seperatorLine'></div><span class='graph-manipulationUI none' id='graph-manipulate-back'><span id='graph-manipulatorLabel' class='graph-manipulationLabel'>"+this.constants.labels.addDescription+"</span></span>";var e=document.getElementById("graph-manipulate-back");e.onclick=this._createManipulatorBar.bind(this),this.boundFunction=this._addNode.bind(this),this.on("select",this.boundFunction)},_createAddEdgeToolbar:function(){this._clearManipulatorBar(),this._unselectAll(!0),this.freezeSimulation=!0,this.boundFunction&&this.off("select",this.boundFunction),this._unselectAll(),this.forceAppendSelection=!1,this.blockConnectingEdgeSelection=!0,this.manipulationDiv.innerHTML="<span class='graph-manipulationUI back' id='graph-manipulate-back'><span class='graph-manipulationLabel'>"+this.constants.labels.back+" </span></span><div class='graph-seperatorLine'></div><span class='graph-manipulationUI none' id='graph-manipulate-back'><span id='graph-manipulatorLabel' class='graph-manipulationLabel'>"+this.constants.labels.linkDescription+"</span></span>";var e=document.getElementById("graph-manipulate-back");e.onclick=this._createManipulatorBar.bind(this),this.boundFunction=this._handleConnect.bind(this),this.on("select",this.boundFunction),this.cachedFunctions._handleTouch=this._handleTouch,this.cachedFunctions._handleOnRelease=this._handleOnRelease,this._handleTouch=this._handleConnect,this._handleOnRelease=this._finishConnect,this._redraw()},_createEditEdgeToolbar:function(){this._clearManipulatorBar(),this.boundFunction&&this.off("select",this.boundFunction),this.edgeBeingEdited=this._getSelectedEdge(),this.edgeBeingEdited._enableControlNodes(),this.manipulationDiv.innerHTML="<span class='graph-manipulationUI back' id='graph-manipulate-back'><span class='graph-manipulationLabel'>"+this.constants.labels.back+" </span></span><div class='graph-seperatorLine'></div><span class='graph-manipulationUI none' id='graph-manipulate-back'><span id='graph-manipulatorLabel' class='graph-manipulationLabel'>"+this.constants.labels.editEdgeDescription+"</span></span>";var e=document.getElementById("graph-manipulate-back");e.onclick=this._createManipulatorBar.bind(this),this.cachedFunctions._handleTouch=this._handleTouch,this.cachedFunctions._handleOnRelease=this._handleOnRelease,this.cachedFunctions._handleTap=this._handleTap,this.cachedFunctions._handleDragStart=this._handleDragStart,this.cachedFunctions._handleOnDrag=this._handleOnDrag,this._handleTouch=this._selectControlNode,this._handleTap=function(){},this._handleOnDrag=this._controlNodeDrag,this._handleDragStart=function(){},this._handleOnRelease=this._releaseControlNode,this._redraw()},_selectControlNode:function(e){this.edgeBeingEdited.controlNodes.from.unselect(),this.edgeBeingEdited.controlNodes.to.unselect(),this.selectedControlNode=this.edgeBeingEdited._getSelectedControlNode(this._XconvertDOMtoCanvas(e.x),this._YconvertDOMtoCanvas(e.y)),null!==this.selectedControlNode&&(this.selectedControlNode.select(),this.freezeSimulation=!0),this._redraw()},_controlNodeDrag:function(e){var t=this._getPointer(e.gesture.center);null!==this.selectedControlNode&&void 0!==this.selectedControlNode&&(this.selectedControlNode.x=this._XconvertDOMtoCanvas(t.x),this.selectedControlNode.y=this._YconvertDOMtoCanvas(t.y)),this._redraw()},_releaseControlNode:function(e){var t=this._getNodeAt(e);null!=t?(1==this.edgeBeingEdited.controlNodes.from.selected&&(this._editEdge(t.id,this.edgeBeingEdited.to.id),this.edgeBeingEdited.controlNodes.from.unselect()),1==this.edgeBeingEdited.controlNodes.to.selected&&(this._editEdge(this.edgeBeingEdited.from.id,t.id),this.edgeBeingEdited.controlNodes.to.unselect())):this.edgeBeingEdited._restoreControlNodes(),this.freezeSimulation=!1,this._redraw()},_handleConnect:function(e){if(0==this._getSelectedNodeCount()){var t=this._getNodeAt(e);null!=t&&(t.clusterSize>1?alert("Cannot create edges to a cluster."):(this._selectObject(t,!1),this.sectors.support.nodes.targetNode=new Node({id:"targetNode"},{},{},this.constants),this.sectors.support.nodes.targetNode.x=t.x,this.sectors.support.nodes.targetNode.y=t.y,this.sectors.support.nodes.targetViaNode=new Node({id:"targetViaNode"},{},{},this.constants),this.sectors.support.nodes.targetViaNode.x=t.x,this.sectors.support.nodes.targetViaNode.y=t.y,this.sectors.support.nodes.targetViaNode.parentEdgeId="connectionEdge",this.edges.connectionEdge=new Edge({id:"connectionEdge",from:t.id,to:this.sectors.support.nodes.targetNode.id},this,this.constants),this.edges.connectionEdge.from=t,this.edges.connectionEdge.connected=!0,this.edges.connectionEdge.smooth=!0,this.edges.connectionEdge.selected=!0,this.edges.connectionEdge.to=this.sectors.support.nodes.targetNode,this.edges.connectionEdge.via=this.sectors.support.nodes.targetViaNode,this.cachedFunctions._handleOnDrag=this._handleOnDrag,this._handleOnDrag=function(e){var t=this._getPointer(e.gesture.center);this.sectors.support.nodes.targetNode.x=this._XconvertDOMtoCanvas(t.x),this.sectors.support.nodes.targetNode.y=this._YconvertDOMtoCanvas(t.y),this.sectors.support.nodes.targetViaNode.x=.5*(this._XconvertDOMtoCanvas(t.x)+this.edges.connectionEdge.from.x),this.sectors.support.nodes.targetViaNode.y=this._YconvertDOMtoCanvas(t.y)},this.moving=!0,this.start()))}},_finishConnect:function(e){if(1==this._getSelectedNodeCount()){this._handleOnDrag=this.cachedFunctions._handleOnDrag,delete this.cachedFunctions._handleOnDrag;var t=this.edges.connectionEdge.fromId;delete this.edges.connectionEdge,delete this.sectors.support.nodes.targetNode,delete this.sectors.support.nodes.targetViaNode;var n=this._getNodeAt(e);null!=n&&(n.clusterSize>1?alert("Cannot create edges to a cluster."):(this._createEdge(t,n.id),this._createManipulatorBar())),this._unselectAll()}},_addNode:function(){if(this._selectionIsEmpty()&&1==this.editMode){var e=this._pointerToPositionObject(this.pointerPosition),t={id:util.randomUUID(),x:e.left,y:e.top,label:"new",allowedToMoveX:!0,allowedToMoveY:!0};if(this.triggerFunctions.add)if(2==this.triggerFunctions.add.length){var n=this;this.triggerFunctions.add(t,function(e){n.nodesData.add(e),n._createManipulatorBar(),n.moving=!0,n.start()})}else alert(this.constants.labels.addError),this._createManipulatorBar(),this.moving=!0,this.start();else this.nodesData.add(t),this._createManipulatorBar(),this.moving=!0,this.start()}},_createEdge:function(e,t){if(1==this.editMode){var n={from:e,to:t};if(this.triggerFunctions.connect)if(2==this.triggerFunctions.connect.length){var r=this;this.triggerFunctions.connect(n,function(e){r.edgesData.add(e),r.moving=!0,r.start()})}else alert(this.constants.labels.linkError),this.moving=!0,this.start();else this.edgesData.add(n),this.moving=!0,this.start()}},_editEdge:function(e,t){if(1==this.editMode){var n={id:this.edgeBeingEdited.id,from:e,to:t};if(this.triggerFunctions.editEdge)if(2==this.triggerFunctions.editEdge.length){var r=this;this.triggerFunctions.editEdge(n,function(e){r.edgesData.update(e),r.moving=!0,r.start()})}else alert(this.constants.labels.linkError),this.moving=!0,this.start();else this.edgesData.update(n),this.moving=!0,this.start()}},_editNode:function(){if(this.triggerFunctions.edit&&1==this.editMode){var e=this._getSelectedNode(),t={id:e.id,label:e.label,group:e.group,shape:e.shape,color:{background:e.color.background,border:e.color.border,highlight:{background:e.color.highlight.background,border:e.color.highlight.border}}};if(2==this.triggerFunctions.edit.length){var n=this;this.triggerFunctions.edit(t,function(e){n.nodesData.update(e),n._createManipulatorBar(),n.moving=!0,n.start()})}else alert(this.constants.labels.editError)}else alert(this.constants.labels.editBoundError)},_deleteSelected:function(){if(!this._selectionIsEmpty()&&1==this.editMode)if(this._clusterInSelection())alert(this.constants.labels.deleteClusterError);else{var e=this.getSelectedNodes(),t=this.getSelectedEdges();if(this.triggerFunctions.del){var n=this,r={nodes:e,edges:t};(this.triggerFunctions.del.length=2)?this.triggerFunctions.del(r,function(e){n.edgesData.remove(e.edges),n.nodesData.remove(e.nodes),n._unselectAll(),n.moving=!0,n.start()}):alert(this.constants.labels.deleteError)}else this.edgesData.remove(t),this.nodesData.remove(e),this._unselectAll(),this.moving=!0,this.start()}}},SectorMixin={_putDataInSector:function(){this.sectors.active[this._sector()].nodes=this.nodes,this.sectors.active[this._sector()].edges=this.edges,this.sectors.active[this._sector()].nodeIndices=this.nodeIndices},_switchToSector:function(e,t){void 0===t||"active"==t?this._switchToActiveSector(e):this._switchToFrozenSector(e)},_switchToActiveSector:function(e){this.nodeIndices=this.sectors.active[e].nodeIndices,this.nodes=this.sectors.active[e].nodes,this.edges=this.sectors.active[e].edges},_switchToSupportSector:function(){this.nodeIndices=this.sectors.support.nodeIndices,this.nodes=this.sectors.support.nodes,this.edges=this.sectors.support.edges},_switchToFrozenSector:function(e){this.nodeIndices=this.sectors.frozen[e].nodeIndices,this.nodes=this.sectors.frozen[e].nodes,this.edges=this.sectors.frozen[e].edges},_loadLatestSector:function(){this._switchToSector(this._sector())},_sector:function(){return this.activeSector[this.activeSector.length-1]},_previousSector:function(){if(this.activeSector.length>1)return this.activeSector[this.activeSector.length-2];throw new TypeError("there are not enough sectors in the this.activeSector array.")},_setActiveSector:function(e){this.activeSector.push(e)},_forgetLastSector:function(){this.activeSector.pop()},_createNewSector:function(e){this.sectors.active[e]={nodes:{},edges:{},nodeIndices:[],formationScale:this.scale,drawingNode:void 0},this.sectors.active[e].drawingNode=new Node({id:e,color:{background:"#eaefef",border:"495c5e"}},{},{},this.constants),this.sectors.active[e].drawingNode.clusterSize=2},_deleteActiveSector:function(e){delete this.sectors.active[e]},_deleteFrozenSector:function(e){delete this.sectors.frozen[e]},_freezeSector:function(e){this.sectors.frozen[e]=this.sectors.active[e],this._deleteActiveSector(e)},_activateSector:function(e){this.sectors.active[e]=this.sectors.frozen[e],this._deleteFrozenSector(e)},_mergeThisWithFrozen:function(e){for(var t in this.nodes)this.nodes.hasOwnProperty(t)&&(this.sectors.frozen[e].nodes[t]=this.nodes[t]);for(var n in this.edges)this.edges.hasOwnProperty(n)&&(this.sectors.frozen[e].edges[n]=this.edges[n]);for(var r=0;r<this.nodeIndices.length;r++)this.sectors.frozen[e].nodeIndices.push(this.nodeIndices[r])},_collapseThisToSingleCluster:function(){this.clusterToFit(1,!1)},_addSector:function(e){var t=this._sector();delete this.nodes[e.id];var n=util.randomUUID();this._freezeSector(t),this._createNewSector(n),this._setActiveSector(n),this._switchToSector(this._sector()),this.nodes[e.id]=e},_collapseSector:function(){var e=this._sector();if("default"!=e&&(1==this.nodeIndices.length||this.sectors.active[e].drawingNode.width*this.scale<this.constants.clustering.screenSizeThreshold*this.frame.canvas.clientWidth||this.sectors.active[e].drawingNode.height*this.scale<this.constants.clustering.screenSizeThreshold*this.frame.canvas.clientHeight)){var t=this._previousSector();this._collapseThisToSingleCluster(),this._mergeThisWithFrozen(t),this._deleteActiveSector(e),this._activateSector(t),this._switchToSector(t),this._forgetLastSector(),this._updateNodeIndexList(),this._updateCalculationNodes()}},_doInAllActiveSectors:function(e,t){if(void 0===t)for(var n in this.sectors.active)this.sectors.active.hasOwnProperty(n)&&(this._switchToActiveSector(n),this[e]());else for(var n in this.sectors.active)if(this.sectors.active.hasOwnProperty(n)){this._switchToActiveSector(n);var r=Array.prototype.splice.call(arguments,1);r.length>1?this[e](r[0],r[1]):this[e](t)}this._loadLatestSector()},_doInSupportSector:function(e,t){if(void 0===t)this._switchToSupportSector(),this[e]();else{this._switchToSupportSector();var n=Array.prototype.splice.call(arguments,1);n.length>1?this[e](n[0],n[1]):this[e](t)}this._loadLatestSector()},_doInAllFrozenSectors:function(e,t){if(void 0===t)for(var n in this.sectors.frozen)this.sectors.frozen.hasOwnProperty(n)&&(this._switchToFrozenSector(n),this[e]());else for(var n in this.sectors.frozen)if(this.sectors.frozen.hasOwnProperty(n)){this._switchToFrozenSector(n);var r=Array.prototype.splice.call(arguments,1);r.length>1?this[e](r[0],r[1]):this[e](t)}this._loadLatestSector()},_doInAllSectors:function(e,t){var n=Array.prototype.splice.call(arguments,1);void 0===t?(this._doInAllActiveSectors(e),this._doInAllFrozenSectors(e)):n.length>1?(this._doInAllActiveSectors(e,n[0],n[1]),this._doInAllFrozenSectors(e,n[0],n[1])):(this._doInAllActiveSectors(e,t),this._doInAllFrozenSectors(e,t))},_clearNodeIndexList:function(){var e=this._sector();this.sectors.active[e].nodeIndices=[],this.nodeIndices=this.sectors.active[e].nodeIndices},_drawSectorNodes:function(e,t){var n,r=1e9,i=-1e9,s=1e9,o=-1e9;for(var u in this.sectors[t])if(this.sectors[t].hasOwnProperty(u)&&void 0!==this.sectors[t][u].drawingNode){this._switchToSector(u,t),r=1e9,i=-1e9,s=1e9,o=-1e9;for(var a in this.nodes)this.nodes.hasOwnProperty(a)&&(n=this.nodes[a],n.resize(e),s>n.x-.5*n.width&&(s=n.x-.5*n.width),o<n.x+.5*n.width&&(o=n.x+.5*n.width),r>n.y-.5*n.height&&(r=n.y-.5*n.height),i<n.y+.5*n.height&&(i=n.y+.5*n.height));n=this.sectors[t][u].drawingNode,n.x=.5*(o+s),n.y=.5*(i+r),n.width=2*(n.x-s),n.height=2*(n.y-r),n.radius=Math.sqrt(Math.pow(.5*n.width,2)+Math.pow(.5*n.height,2)),n.setScale(this.scale),n._drawCircle(e)}},_drawAllSectorNodes:function(e){this._drawSectorNodes(e,"frozen"),this._drawSectorNodes(e,"active"),this._loadLatestSector()}},ClusterMixin={startWithClustering:function(){this.clusterToFit(this.constants.clustering.initialMaxNodes,!0),this.updateLabels(),this.stabilize&&this._stabilize(),this.start()},clusterToFit:function(e,t){for(var n=this.nodeIndices.length,r=50,i=0;n>e&&r>i;)i%3==0?(this.forceAggregateHubs(!0),this.normalizeClusterLevels()):this.increaseClusterLevel(),n=this.nodeIndices.length,i+=1;i>0&&1==t&&this.repositionNodes(),this._updateCalculationNodes()},openCluster:function(e){var t=this.moving;if(e.clusterSize>this.constants.clustering.sectorThreshold&&this._nodeInActiveArea(e)&&("default"!=this._sector()||1!=this.nodeIndices.length)){this._addSector(e);for(var n=0;this.nodeIndices.length<this.constants.clustering.initialMaxNodes&&10>n;)this.decreaseClusterLevel(),n+=1}else this._expandClusterNode(e,!1,!0),this._updateNodeIndexList(),this._updateDynamicEdges(),this._updateCalculationNodes(),this.updateLabels();this.moving!=t&&this.start()},updateClustersDefault:function(){1==this.constants.clustering.enabled&&this.updateClusters(0,!1,!1)},increaseClusterLevel:function(){this.updateClusters(-1,!1,!0)},decreaseClusterLevel:function(){this.updateClusters(1,!1,!0)},updateClusters:function(e,t,n,r){var i=this.moving,s=this.nodeIndices.length;this.previousScale>this.scale&&0==e&&this._collapseSector(),this.previousScale>this.scale||-1==e?this._formClusters(n):(this.previousScale<this.scale||1==e)&&(1==n?this._openClusters(t,n):this._openClustersBySize()),this._updateNodeIndexList(),this.nodeIndices.length==s&&(this.previousScale>this.scale||-1==e)&&(this._aggregateHubs(n),this._updateNodeIndexList()),(this.previousScale>this.scale||-1==e)&&(this.handleChains(),this._updateNodeIndexList()),this.previousScale=this.scale,this._updateDynamicEdges(),this.updateLabels(),this.nodeIndices.length<s&&(this.clusterSession+=1,this.normalizeClusterLevels()),(0==r||void 0===r)&&this.moving!=i&&this.start(),this._updateCalculationNodes()},handleChains:function(){var e=this._getChainFraction();e>this.constants.clustering.chainThreshold&&this._reduceAmountOfChains(1-this.constants.clustering.chainThreshold/e)},_aggregateHubs:function(e){this._getHubSize(),this._formClustersByHub(e,!1)},forceAggregateHubs:function(e){var t=this.moving,n=this.nodeIndices.length;this._aggregateHubs(!0),this._updateNodeIndexList(),this._updateDynamicEdges(),this.updateLabels(),this.nodeIndices.length!=n&&(this.clusterSession+=1),(0==e||void 0===e)&&this.moving!=t&&this.start()},_openClustersBySize:function(){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e)){var t=this.nodes[e];1==t.inView()&&(t.width*this.scale>this.constants.clustering.screenSizeThreshold*this.frame.canvas.clientWidth||t.height*this.scale>this.constants.clustering.screenSizeThreshold*this.frame.canvas.clientHeight)&&this.openCluster(t)}},_openClusters:function(e,t){for(var n=0;n<this.nodeIndices.length;n++){var r=this.nodes[this.nodeIndices[n]];this._expandClusterNode(r,e,t),this._updateCalculationNodes()}},_expandClusterNode:function(e,t,n,r){if(e.clusterSize>1&&(e.clusterSize<this.constants.clustering.sectorThreshold&&(r=!0),t=r?!0:t,e.formationScale<this.scale||1==n))for(var i in e.containedNodes)if(e.containedNodes.hasOwnProperty(i)){var s=e.containedNodes[i];1==n?(s.clusterSession==e.clusterSessions[e.clusterSessions.length-1]||r)&&this._expelChildFromParent(e,i,t,n,r):this._nodeInActiveArea(e)&&this._expelChildFromParent(e,i,t,n,r)}},_expelChildFromParent:function(e,t,n,r,i){var s=e.containedNodes[t];if(s.formationScale<this.scale||1==r){this._unselectAll(),this.nodes[t]=s,this._releaseContainedEdges(e,s),this._connectEdgeBackToChild(e,s),this._validateEdges(e),e.mass-=s.mass,e.clusterSize-=s.clusterSize,e.fontSize=Math.min(this.constants.clustering.maxFontSize,this.constants.nodes.fontSize+this.constants.clustering.fontSizeMultiplier*e.clusterSize),e.dynamicEdgesLength=e.dynamicEdges.length,s.x=e.x+e.growthIndicator*(.5-Math.random()),s.y=e.y+e.growthIndicator*(.5-Math.random()),delete e.containedNodes[t];var o=!1;for(var u in e.containedNodes)if(e.containedNodes.hasOwnProperty(u)&&e.containedNodes[u].clusterSession==s.clusterSession){o=!0;break}0==o&&e.clusterSessions.pop(),this._repositionBezierNodes(s),s.clusterSession=0,e.clearSizeCache(),this.moving=!0}1==n&&this._expandClusterNode(s,n,r,i)},_repositionBezierNodes:function(e){for(var t=0;t<e.dynamicEdges.length;t++)e.dynamicEdges[t].positionBezierNode()},_formClusters:function(e){0==e?this._formClustersByZoom():this._forceClustersByZoom()},_formClustersByZoom:function(){var e,t,n,r=this.constants.clustering.clusterEdgeThreshold/this.scale;for(var i in this.edges)if(this.edges.hasOwnProperty(i)){var s=this.edges[i];if(s.connected&&s.toId!=s.fromId&&(e=s.to.x-s.from.x,t=s.to.y-s.from.y,n=Math.sqrt(e*e+t*t),r>n)){var o=s.from,u=s.to;s.to.mass>s.from.mass&&(o=s.to,u=s.from),1==u.dynamicEdgesLength?this._addToCluster(o,u,!1):1==o.dynamicEdgesLength&&this._addToCluster(u,o,!1)}}},_forceClustersByZoom:function(){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e)){var t=this.nodes[e];if(1==t.dynamicEdgesLength&&0!=t.dynamicEdges.length){var n=t.dynamicEdges[0],r=n.toId==t.id?this.nodes[n.fromId]:this.nodes[n.toId];t.id!=r.id&&(r.mass>t.mass?this._addToCluster(r,t,!0):this._addToCluster(t,r,!0))}}},_clusterToSmallestNeighbour:function(e){for(var t=-1,n=null,r=0;r<e.dynamicEdges.length;r++)if(void 0!==e.dynamicEdges[r]){var i=null;e.dynamicEdges[r].fromId!=e.id?i=e.dynamicEdges[r].from:e.dynamicEdges[r].toId!=e.id&&(i=e.dynamicEdges[r].to),null!=i&&t>i.clusterSessions.length&&(t=i.clusterSessions.length,n=i)}null!=i&&void 0!==this.nodes[i.id]&&this._addToCluster(i,e,!0)},_formClustersByHub:function(e,t){for(var n in this.nodes)this.nodes.hasOwnProperty(n)&&this._formClusterFromHub(this.nodes[n],e,t)},_formClusterFromHub:function(e,t,n,r){if(void 0===r&&(r=0),e.dynamicEdgesLength>=this.hubThreshold&&0==n||e.dynamicEdgesLength==this.hubThreshold&&1==n){for(var i,s,o,u=this.constants.clustering.clusterEdgeThreshold/this.scale,a=!1,f=[],l=e.dynamicEdges.length,c=0;l>c;c++)f.push(e.dynamicEdges[c].id);if(0==t)for(a=!1,c=0;l>c;c++){var h=this.edges[f[c]];if(void 0!==h&&h.connected&&h.toId!=h.fromId&&(i=h.to.x-h.from.x,s=h.to.y-h.from.y,o=Math.sqrt(i*i+s*s),u>o)){a=!0;break}}if(!t&&a||t)for(c=0;l>c;c++)if(h=this.edges[f[c]],void 0!==h){var p=this.nodes[h.fromId==e.id?h.toId:h.fromId];p.dynamicEdges.length<=this.hubThreshold+r&&p.id!=e.id&&this._addToCluster(e,p,t)}}},_addToCluster:function(e,t,n){e.containedNodes[t.id]=t;for(var r=0;r<t.dynamicEdges.length;r++){var i=t.dynamicEdges[r];i.toId==e.id||i.fromId==e.id?this._addToContainedEdges(e,t,i):this._connectEdgeToCluster(e,t,i)}t.dynamicEdges=[],this._containCircularEdgesFromNode(e,t),delete this.nodes[t.id];var s=e.mass;t.clusterSession=this.clusterSession,e.mass+=t.mass,e.clusterSize+=t.clusterSize,e.fontSize=Math.min(this.constants.clustering.maxFontSize,this.constants.nodes.fontSize+this.constants.clustering.fontSizeMultiplier*e.clusterSize),e.clusterSessions[e.clusterSessions.length-1]!=this.clusterSession&&e.clusterSessions.push(this.clusterSession),e.formationScale=1==n?0:this.scale,e.clearSizeCache(),e.containedNodes[t.id].formationScale=e.formationScale,t.clearVelocity(),e.updateVelocity(s),this.moving=!0},_updateDynamicEdges:function(){for(var e=0;e<this.nodeIndices.length;e++){var t=this.nodes[this.nodeIndices[e]];t.dynamicEdgesLength=t.dynamicEdges.length;var n=0;if(t.dynamicEdgesLength>1)for(var r=0;r<t.dynamicEdgesLength-1;r++)for(var i=t.dynamicEdges[r].toId,s=t.dynamicEdges[r].fromId,o=r+1;o<t.dynamicEdgesLength;o++)(t.dynamicEdges[o].toId==i&&t.dynamicEdges[o].fromId==s||t.dynamicEdges[o].fromId==i&&t.dynamicEdges[o].toId==s)&&(n+=1);t.dynamicEdgesLength-=n}},_addToContainedEdges:function(e,t,n){e.containedEdges.hasOwnProperty(t.id)||(e.containedEdges[t.id]=[]),e.containedEdges[t.id].push(n),delete this.edges[n.id];for(var r=0;r<e.dynamicEdges.length;r++)if(e.dynamicEdges[r].id==n.id){e.dynamicEdges.splice(r,1);break}},_connectEdgeToCluster:function(e,t,n){n.toId==n.fromId?this._addToContainedEdges(e,t,n):(n.toId==t.id?(n.originalToId.push(t.id),n.to=e,n.toId=e.id):(n.originalFromId.push(t.id),n.from=e,n.fromId=e.id),this._addToReroutedEdges(e,t,n))},_containCircularEdgesFromNode:function(e,t){for(var n=0;n<e.dynamicEdges.length;n++){var r=e.dynamicEdges[n];r.toId==r.fromId&&this._addToContainedEdges(e,t,r)}},_addToReroutedEdges:function(e,t,n){e.reroutedEdges.hasOwnProperty(t.id)||(e.reroutedEdges[t.id]=[]),e.reroutedEdges[t.id].push(n),e.dynamicEdges.push(n)},_connectEdgeBackToChild:function(e,t){if(e.reroutedEdges.hasOwnProperty(t.id)){for(var n=0;n<e.reroutedEdges[t.id].length;n++){var r=e.reroutedEdges[t.id][n];r.originalFromId[r.originalFromId.length-1]==t.id?(r.originalFromId.pop(),r.fromId=t.id,r.from=t):(r.originalToId.pop(),r.toId=t.id,r.to=t),t.dynamicEdges.push(r);for(var i=0;i<e.dynamicEdges.length;i++)if(e.dynamicEdges[i].id==r.id){e.dynamicEdges.splice(i,1);break}}delete e.reroutedEdges[t.id]}},_validateEdges:function(e){for(var t=0;t<e.dynamicEdges.length;t++){var n=e.dynamicEdges[t];e.id!=n.toId&&e.id!=n.fromId&&e.dynamicEdges.splice(t,1)}},_releaseContainedEdges:function(e,t){for(var n=0;n<e.containedEdges[t.id].length;n++){var r=e.containedEdges[t.id][n];this.edges[r.id]=r,t.dynamicEdges.push(r),e.dynamicEdges.push(r)}delete e.containedEdges[t.id]},updateLabels:function(){var e;for(e in this.nodes)if(this.nodes.hasOwnProperty(e)){var t=this.nodes[e];t.clusterSize>1&&(t.label="[".concat(String(t.clusterSize),"]"))}for(e in this.nodes)this.nodes.hasOwnProperty(e)&&(t=this.nodes[e],1==t.clusterSize&&(t.label=void 0!==t.originalLabel?t.originalLabel:String(t.id)))},normalizeClusterLevels:function(){var e,t=0,n=1e9,r=0;for(e in this.nodes)this.nodes.hasOwnProperty(e)&&(r=this.nodes[e].clusterSessions.length,r>t&&(t=r),n>r&&(n=r));if(t-n>this.constants.clustering.clusterLevelDifference){var i=this.nodeIndices.length,s=t-this.constants.clustering.clusterLevelDifference;for(e in this.nodes)this.nodes.hasOwnProperty(e)&&this.nodes[e].clusterSessions.length<s&&this._clusterToSmallestNeighbour(this.nodes[e]);this._updateNodeIndexList(),this._updateDynamicEdges(),this.nodeIndices.length!=i&&(this.clusterSession+=1)}},_nodeInActiveArea:function(e){return Math.abs(e.x-this.areaCenter.x)<=this.constants.clustering.activeAreaBoxSize/this.scale&&Math.abs(e.y-this.areaCenter.y)<=this.constants.clustering.activeAreaBoxSize/this.scale},repositionNodes:function(){for(var e=0;e<this.nodeIndices.length;e++){var t=this.nodes[this.nodeIndices[e]];if(0==t.xFixed||0==t.yFixed){var n=1*this.nodeIndices.length*Math.min(100,t.mass),r=2*Math.PI*Math.random();0==t.xFixed&&(t.x=n*Math.cos(r)),0==t.yFixed&&(t.y=n*Math.sin(r)),this._repositionBezierNodes(t)}}},_getHubSize:function(){for(var e=0,t=0,n=0,r=0,i=0;i<this.nodeIndices.length;i++){var s=this.nodes[this.nodeIndices[i]];s.dynamicEdgesLength>r&&(r=s.dynamicEdgesLength),e+=s.dynamicEdgesLength,t+=Math.pow(s.dynamicEdgesLength,2),n+=1}e/=n,t/=n;var o=t-Math.pow(e,2),u=Math.sqrt(o);this.hubThreshold=Math.floor(e+2*u),this.hubThreshold>r&&(this.hubThreshold=r)},_reduceAmountOfChains:function(e){this.hubThreshold=2;var t=Math.floor(this.nodeIndices.length*e);for(var n in this.nodes)this.nodes.hasOwnProperty(n)&&2==this.nodes[n].dynamicEdgesLength&&this.nodes[n].dynamicEdges.length>=2&&t>0&&(this._formClusterFromHub(this.nodes[n],!0,!0,1),t-=1)},_getChainFraction:function(){var e=0,t=0;for(var n in this.nodes)this.nodes.hasOwnProperty(n)&&(2==this.nodes[n].dynamicEdgesLength&&this.nodes[n].dynamicEdges.length>=2&&(e+=1),t+=1);return e/t}},SelectionMixin={_getNodesOverlappingWith:function(e,t){var n=this.nodes;for(var r in n)n.hasOwnProperty(r)&&n[r].isOverlappingWith(e)&&t.push(r)},_getAllNodesOverlappingWith:function(e){var t=[];return this._doInAllActiveSectors("_getNodesOverlappingWith",e,t),t},_pointerToPositionObject:function(e){var t=this._XconvertDOMtoCanvas(e.x),n=this._YconvertDOMtoCanvas(e.y);return{left:t,top:n,right:t,bottom:n}},_getNodeAt:function(e){var t=this._pointerToPositionObject(e),n=this._getAllNodesOverlappingWith(t);return n.length>0?this.nodes[n[n.length-1]]:null},_getEdgesOverlappingWith:function(e,t){var n=this.edges;for(var r in n)n.hasOwnProperty(r)&&n[r].isOverlappingWith(e)&&t.push(r)},_getAllEdgesOverlappingWith:function(e){var t=[];return this._doInAllActiveSectors("_getEdgesOverlappingWith",e,t),t},_getEdgeAt:function(e){var t=this._pointerToPositionObject(e),n=this._getAllEdgesOverlappingWith(t);return n.length>0?this.edges[n[n.length-1]]:null},_addToSelection:function(e){e instanceof Node?this.selectionObj.nodes[e.id]=e:this.selectionObj.edges[e.id]=e},_addToHover:function(e){e instanceof Node?this.hoverObj.nodes[e.id]=e:this.hoverObj.edges[e.id]=e},_removeFromSelection:function(e){e instanceof Node?delete this.selectionObj.nodes[e.id]:delete this.selectionObj.edges[e.id]},_unselectAll:function(e){void 0===e&&(e=!1);for(var t in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(t)&&this.selectionObj.nodes[t].unselect();for(var n in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(n)&&this.selectionObj.edges[n].unselect();this.selectionObj={nodes:{},edges:{}},0==e&&this.emit("select",this.getSelection())},_unselectClusters:function(e){void 0===e&&(e=!1);for(var t in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(t)&&this.selectionObj.nodes[t].clusterSize>1&&(this.selectionObj.nodes[t].unselect(),this._removeFromSelection(this.selectionObj.nodes[t]));0==e&&this.emit("select",this.getSelection())},_getSelectedNodeCount:function(){var e=0;for(var t in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(t)&&(e+=1);return e},_getSelectedNode:function(){for(var e in this.selectionObj.nodes)if(this.selectionObj.nodes.hasOwnProperty(e))return this.selectionObj.nodes[e];return null},_getSelectedEdge:function(){for(var e in this.selectionObj.edges)if(this.selectionObj.edges.hasOwnProperty(e))return this.selectionObj.edges[e];return null},_getSelectedEdgeCount:function(){var e=0;for(var t in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(t)&&(e+=1);return e},_getSelectedObjectCount:function(){var e=0;for(var t in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(t)&&(e+=1);for(var n in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(n)&&(e+=1);return e},_selectionIsEmpty:function(){for(var e in this.selectionObj.nodes)if(this.selectionObj.nodes.hasOwnProperty(e))return!1;for(var t in this.selectionObj.edges)if(this.selectionObj.edges.hasOwnProperty(t))return!1;return!0},_clusterInSelection:function(){for(var e in this.selectionObj.nodes)if(this.selectionObj.nodes.hasOwnProperty(e)&&this.selectionObj.nodes[e].clusterSize>1)return!0;return!1},_selectConnectedEdges:function(e){for(var t=0;t<e.dynamicEdges.length;t++){var n=e.dynamicEdges[t];n.select(),this._addToSelection(n)}},_hoverConnectedEdges:function(e){for(var t=0;t<e.dynamicEdges.length;t++){var n=e.dynamicEdges[t];n.hover=!0,this._addToHover(n)}},_unselectConnectedEdges:function(e){for(var t=0;t<e.dynamicEdges.length;t++){var n=e.dynamicEdges[t];n.unselect(),this._removeFromSelection(n)}},_selectObject:function(e,t,n){void 0===n&&(n=!1),0==this._selectionIsEmpty()&&0==t&&0==this.forceAppendSelection&&this._unselectAll(!0),0==e.selected?(e.select(),this._addToSelection(e),e instanceof Node&&0==this.blockConnectingEdgeSelection&&this._selectConnectedEdges(e)):(e.unselect(),this._removeFromSelection(e)),0==n&&this.emit("select",this.getSelection())},_blurObject:function(e){1==e.hover&&(e.hover=!1,this.emit("blurNode",{node:e.id}))},_hoverObject:function(e){0==e.hover&&(e.hover=!0,this._addToHover(e),e instanceof Node&&this.emit("hoverNode",{node:e.id})),e instanceof Node&&this._hoverConnectedEdges(e)},_handleTouch:function(){},_handleTap:function(e){var t=this._getNodeAt(e);if(null!=t)this._selectObject(t,!1);else{var n=this._getEdgeAt(e);null!=n?this._selectObject(n,!1):this._unselectAll()}this.emit("click",this.getSelection()),this._redraw()},_handleDoubleTap:function(e){var t=this._getNodeAt(e);null!=t&&void 0!==t&&(this.areaCenter={x:this._XconvertDOMtoCanvas(e.x),y:this._YconvertDOMtoCanvas(e.y)},this.openCluster(t)),this.emit("doubleClick",this.getSelection())},_handleOnHold:function(e){var t=this._getNodeAt(e);if(null!=t)this._selectObject(t,!0);else{var n=this._getEdgeAt(e);null!=n&&this._selectObject(n,!0)}this._redraw()},_handleOnRelease:function(){},getSelection:function(){var e=this.getSelectedNodes(),t=this.getSelectedEdges();return{nodes:e,edges:t}},getSelectedNodes:function(){var e=[];for(var t in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(t)&&e.push(t);return e},getSelectedEdges:function(){var e=[];for(var t in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(t)&&e.push(t);return e},setSelection:function(e){var t,n,r;if(!e||void 0==e.length)throw"Selection must be an array with ids";for(this._unselectAll(!0),t=0,n=e.length;n>t;t++){r=e[t];var i=this.nodes[r];if(!i)throw new RangeError('Node with id "'+r+'" not found');this._selectObject(i,!0,!0)}this.redraw()},_updateSelection:function(){for(var e in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(e)&&(this.nodes.hasOwnProperty(e)||delete this.selectionObj.nodes[e]);for(var t in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(t)&&(this.edges.hasOwnProperty(t)||delete this.selectionObj.edges[t])}},NavigationMixin={_cleanNavigation:function(){var e=document.getElementById("graph-navigation_wrapper");null!=e&&this.containerElement.removeChild(e),document.onmouseup=null},_loadNavigationElements:function(){this._cleanNavigation(),this.navigationDivs={};var e=["up","down","left","right","zoomIn","zoomOut","zoomExtends"],t=["_moveUp","_moveDown","_moveLeft","_moveRight","_zoomIn","_zoomOut","zoomExtent"];this.navigationDivs.wrapper=document.createElement("div"),this.navigationDivs.wrapper.id="graph-navigation_wrapper",this.navigationDivs.wrapper.style.position="absolute",this.navigationDivs.wrapper.style.width=this.frame.canvas.clientWidth+"px",this.navigationDivs.wrapper.style.height=this.frame.canvas.clientHeight+"px",this.containerElement.insertBefore(this.navigationDivs.wrapper,this.frame);for(var n=0;n<e.length;n++)this.navigationDivs[e[n]]=document.createElement("div"),this.navigationDivs[e[n]].id="graph-navigation_"+e[n],this.navigationDivs[e[n]].className="graph-navigation "+e[n],this.navigationDivs.wrapper.appendChild(this.navigationDivs[e[n]]),this.navigationDivs[e[n]].onmousedown=this[t[n]].bind(this);document.onmouseup=this._stopMovement.bind(this)},_stopMovement:function(){this._xStopMoving(),this._yStopMoving(),this._stopZoom()},_preventDefault:function(e){void 0!==e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},_moveUp:function(e){this.yIncrement=this.constants.keyboard.speed.y,this.start(),this._preventDefault(e),this.navigationDivs&&(this.navigationDivs.up.className+=" active")},_moveDown:function(e){this.yIncrement=-this.constants.keyboard.speed.y,this.start(),this._preventDefault(e),this.navigationDivs&&(this.navigationDivs.down.className+=" active")},_moveLeft:function(e){this.xIncrement=this.constants.keyboard.speed.x,this.start(),this._preventDefault(e),this.navigationDivs&&(this.navigationDivs.left.className+=" active")},_moveRight:function(e){this.xIncrement=-this.constants.keyboard.speed.y,this.start(),this._preventDefault(e),this.navigationDivs&&(this.navigationDivs.right.className+=" active")},_zoomIn:function(e){this.zoomIncrement=this.constants.keyboard.speed.zoom,this.start(),this._preventDefault(e),this.navigationDivs&&(this.navigationDivs.zoomIn.className+=" active")},_zoomOut:function(){this.zoomIncrement=-this.constants.keyboard.speed.zoom,this.start(),this._preventDefault(event),this.navigationDivs&&(this.navigationDivs.zoomOut.className+=" active")},_stopZoom:function(){this.zoomIncrement=0,this.navigationDivs&&(this.navigationDivs.zoomIn.className=this.navigationDivs.zoomIn.className.replace(" active",""),this.navigationDivs.zoomOut.className=this.navigationDivs.zoomOut.className.replace(" active",""))},_yStopMoving:function(){this.yIncrement=0,this.navigationDivs&&(this.navigationDivs.up.className=this.navigationDivs.up.className.replace(" active",""),this.navigationDivs.down.className=this.navigationDivs.down.className.replace(" active",""))},_xStopMoving:function(){this.xIncrement=0,this.navigationDivs&&(this.navigationDivs.left.className=this.navigationDivs.left.className.replace(" active",""),this.navigationDivs.right.className=this.navigationDivs.right.className.replace(" active",""))}},graphMixinLoaders={_loadMixin:function(e){for(var t in e)e.hasOwnProperty(t)&&(Graph.prototype[t]=e[t])},_clearMixin:function(e){for(var t in e)e.hasOwnProperty(t)&&(Graph.prototype[t]=void 0)},_loadPhysicsSystem:function(){this._loadMixin(physicsMixin),this._loadSelectedForceSolver(),1==this.constants.configurePhysics&&this._loadPhysicsConfiguration()},_loadClusterSystem:function(){this.clusterSession=0,this.hubThreshold=5,this._loadMixin(ClusterMixin)},_loadSectorSystem:function(){this.sectors={},this.activeSector=["default"],this.sectors.active={},this.sectors.active["default"]={nodes:{},edges:{},nodeIndices:[],formationScale:1,drawingNode:void 0},this.sectors.frozen={},this.sectors.support={nodes:{},edges:{},nodeIndices:[],formationScale:1,drawingNode:void 0},this.nodeIndices=this.sectors.active["default"].nodeIndices,this._loadMixin(SectorMixin)},_loadSelectionSystem:function(){this.selectionObj={nodes:{},edges:{}},this._loadMixin(SelectionMixin)},_loadManipulationSystem:function(){this.blockConnectingEdgeSelection=!1,this.forceAppendSelection=!1,1==this.constants.dataManipulation.enabled?(void 0===this.manipulationDiv&&(this.manipulationDiv=document.createElement("div"),this.manipulationDiv.className="graph-manipulationDiv",this.manipulationDiv.id="graph-manipulationDiv",this.manipulationDiv.style.display=1==this.editMode?"block":"none",this.containerElement.insertBefore(this.manipulationDiv,this.frame)),void 0===this.editModeDiv&&(this.editModeDiv=document.createElement("div"),this.editModeDiv.className="graph-manipulation-editMode",this.editModeDiv.id="graph-manipulation-editMode",this.editModeDiv.style.display=1==this.editMode?"none":"block",this.containerElement.insertBefore(this.editModeDiv,this.frame)),void 0===this.closeDiv&&(this.closeDiv=document.createElement("div"),this.closeDiv.className="graph-manipulation-closeDiv",this.closeDiv.id="graph-manipulation-closeDiv",this.closeDiv.style.display=this.manipulationDiv.style.display,this.containerElement.insertBefore(this.closeDiv,this.frame)),this._loadMixin(manipulationMixin),this._createManipulatorBar()):void 0!==this.manipulationDiv&&(this._createManipulatorBar(),this.containerElement.removeChild(this.manipulationDiv),this.containerElement.removeChild(this.editModeDiv),this.containerElement.removeChild(this.closeDiv),this.manipulationDiv=void 0,this.editModeDiv=void 0,this.closeDiv=void 0,this._clearMixin(manipulationMixin))},_loadNavigationControls:function(){this._loadMixin(NavigationMixin),this._cleanNavigation(),1==this.constants.navigation.enabled&&this._loadNavigationElements()},_loadHierarchySystem:function(){this._loadMixin(HierarchicalLayoutMixin)}};Emitter(Graph.prototype),Graph.prototype._getScriptPath=function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++){var n=e[t].src,r=n&&/\/?vis(.min)?\.js$/.exec(n);if(r)return n.substring(0,n.length-r[0].length)}return null},Graph.prototype._getRange=function(){var e,t=1e9,n=-1e9,r=1e9,i=-1e9;for(var s in this.nodes)this.nodes.hasOwnProperty(s)&&(e=this.nodes[s],r>e.x&&(r=e.x),i<e.x&&(i=e.x),t>e.y&&(t=e.y),n<e.y&&(n=e.y));return 1e9==r&&-1e9==i&&1e9==t&&-1e9==n&&(t=0,n=0,r=0,i=0),{minX:r,maxX:i,minY:t,maxY:n}},Graph.prototype._findCenter=function(e){return{x:.5*(e.maxX+e.minX),y:.5*(e.maxY+e.minY)}},Graph.prototype._centerGraph=function(e){var t=this._findCenter(e);t.x*=this.scale,t.y*=this.scale,t.x-=.5*this.frame.canvas.clientWidth,t.y-=.5*this.frame.canvas.clientHeight,this._setTranslation(-t.x,-t.y)},Graph.prototype.zoomExtent=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n,r=this._getRange();if(1==e){var i=this.nodeIndices.length;n=1==this.constants.smoothCurves?1==this.constants.clustering.enabled&&i>=this.constants.clustering.initialMaxNodes?49.07548/(i+142.05338)+91444e-8:12.662/(i+7.4147)+.0964822:1==this.constants.clustering.enabled&&i>=this.constants.clustering.initialMaxNodes?77.5271985/(i+187.266146)+476710517e-13:30.5062972/(i+19.93597763)+.08413486;var s=Math.min(this.frame.canvas.clientWidth/600,this.frame.canvas.clientHeight/600);n*=s}else{var o=1.1*(Math.abs(r.minX)+Math.abs(r.maxX)),u=1.1*(Math.abs(r.minY)+Math.abs(r.maxY)),a=this.frame.canvas.clientWidth/o,f=this.frame.canvas.clientHeight/u;n=f>=a?a:f}n>1&&(n=1),this._setScale(n),this._centerGraph(r),0==t&&(this.moving=!0,this.start())},Graph.prototype._updateNodeIndexList=function(){this._clearNodeIndexList();for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&this.nodeIndices.push(e)},Graph.prototype.setData=function(e,t){if(void 0===t&&(t=!1),e&&e.dot&&(e.nodes||e.edges))throw new SyntaxError('Data must contain either parameter "dot" or  parameter pair "nodes" and "edges", but not both.');if(this.setOptions(e&&e.options),e&&e.dot){if(e&&e.dot){var n=vis.util.DOTToGraph(e.dot);return void this.setData(n)}}else this._setNodes(e&&e.nodes),this._setEdges(e&&e.edges);if(this._putDataInSector(),!t)if(this.stabilize){var r=this;setTimeout(function(){r._stabilize(),r.start()},0)}else this.start()},Graph.prototype.setOptions=function(e){if(e){var t;if(void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height),void 0!==e.stabilize&&(this.stabilize=e.stabilize),void 0!==e.selectable&&(this.selectable=e.selectable),void 0!==e.smoothCurves&&(this.constants.smoothCurves=e.smoothCurves),void 0!==e.freezeForStabilization&&(this.constants.freezeForStabilization=e.freezeForStabilization),void 0!==e.configurePhysics&&(this.constants.configurePhysics=e.configurePhysics),void 0!==e.stabilizationIterations&&(this.constants.stabilizationIterations=e.stabilizationIterations),void 0!==e.dragGraph&&(this.constants.dragGraph=e.dragGraph),void 0!==e.dragNodes&&(this.constants.dragNodes=e.dragNodes),void 0!==e.zoomable&&(this.constants.zoomable=e.zoomable),void 0!==e.hover&&(this.constants.hover=e.hover),void 0!==e.labels)for(t in e.labels)e.labels.hasOwnProperty(t)&&(this.constants.labels[t]=e.labels[t]);if(e.onAdd&&(this.triggerFunctions.add=e.onAdd),e.onEdit&&(this.triggerFunctions.edit=e.onEdit),e.onEditEdge&&(this.triggerFunctions.editEdge=e.onEditEdge),e.onConnect&&(this.triggerFunctions.connect=e.onConnect),e.onDelete&&(this.triggerFunctions.del=e.onDelete),e.physics){if(e.physics.barnesHut){this.constants.physics.barnesHut.enabled=!0;for(t in e.physics.barnesHut)e.physics.barnesHut.hasOwnProperty(t)&&(this.constants.physics.barnesHut[t]=e.physics.barnesHut[t])}if(e.physics.repulsion){this.constants.physics.barnesHut.enabled=!1;for(t in e.physics.repulsion)e.physics.repulsion.hasOwnProperty(t)&&(this.constants.physics.repulsion[t]=e.physics.repulsion[t])}if(e.physics.hierarchicalRepulsion){this.constants.hierarchicalLayout.enabled=!0,this.constants.physics.hierarchicalRepulsion.enabled=!0,this.constants.physics.barnesHut.enabled=!1;for(t in e.physics.hierarchicalRepulsion)e.physics.hierarchicalRepulsion.hasOwnProperty(t)&&(this.constants.physics.hierarchicalRepulsion[t]=e.physics.hierarchicalRepulsion[t])}}if(e.hierarchicalLayout){this.constants.hierarchicalLayout.enabled=!0;for(t in e.hierarchicalLayout)e.hierarchicalLayout.hasOwnProperty(t)&&(this.constants.hierarchicalLayout[t]=e.hierarchicalLayout[t])}else void 0!==e.hierarchicalLayout&&(this.constants.hierarchicalLayout.enabled=!1);if(e.clustering){this.constants.clustering.enabled=!0;for(t in e.clustering)e.clustering.hasOwnProperty(t)&&(this.constants.clustering[t]=e.clustering[t])}else void 0!==e.clustering&&(this.constants.clustering.enabled=!1);if(e.navigation){this.constants.navigation.enabled=!0;for(t in e.navigation)e.navigation.hasOwnProperty(t)&&(this.constants.navigation[t]=e.navigation[t])}else void 0!==e.navigation&&(this.constants.navigation.enabled=!1);if(e.keyboard){this.constants.keyboard.enabled=!0;for(t in e.keyboard)e.keyboard.hasOwnProperty(t)&&(this.constants.keyboard[t]=e.keyboard[t])}else void 0!==e.keyboard&&(this.constants.keyboard.enabled=!1);if(e.dataManipulation){this.constants.dataManipulation.enabled=!0;for(t in e.dataManipulation)e.dataManipulation.hasOwnProperty(t)&&(this.constants.dataManipulation[t]=e.dataManipulation[t]);this.editMode=this.constants.dataManipulation.initiallyVisible}else void 0!==e.dataManipulation&&(this.constants.dataManipulation.enabled=!1);if(e.edges){for(t in e.edges)e.edges.hasOwnProperty(t)&&"object"!=typeof e.edges[t]&&(this.constants.edges[t]=e.edges[t]);void 0!==e.edges.color&&(util.isString(e.edges.color)?(this.constants.edges.color={},this.constants.edges.color.color=e.edges.color,this.constants.edges.color.highlight=e.edges.color,this.constants.edges.color.hover=e.edges.color):(void 0!==e.edges.color.color&&(this.constants.edges.color.color=e.edges.color.color),void 0!==e.edges.color.highlight&&(this.constants.edges.color.highlight=e.edges.color.highlight),void 0!==e.edges.color.hover&&(this.constants.edges.color.hover=e.edges.color.hover))),e.edges.fontColor||void 0!==e.edges.color&&(util.isString(e.edges.color)?this.constants.edges.fontColor=e.edges.color:void 0!==e.edges.color.color&&(this.constants.edges.fontColor=e.edges.color.color)),e.edges.dash&&(void 0!==e.edges.dash.length&&(this.constants.edges.dash.length=e.edges.dash.length),void 0!==e.edges.dash.gap&&(this.constants.edges.dash.gap=e.edges.dash.gap),void 0!==e.edges.dash.altLength&&(this.constants.edges.dash.altLength=e.edges.dash.altLength))}if(e.nodes){for(t in e.nodes)e.nodes.hasOwnProperty(t)&&(this.constants.nodes[t]=e.nodes[t]);e.nodes.color&&(this.constants.nodes.color=util.parseColor(e.nodes.color))}if(e.groups)for(var n in e.groups)if(e.groups.hasOwnProperty(n)){var r=e.groups[n];this.groups.add(n,r)}if(e.tooltip){for(t in e.tooltip)e.tooltip.hasOwnProperty(t)&&(this.constants.tooltip[t]=e.tooltip[t]);e.tooltip.color&&(this.constants.tooltip.color=util.parseColor(e.tooltip.color))}}this._loadPhysicsSystem(),this._loadNavigationControls(),this._loadManipulationSystem(),this._configureSmoothCurves(),this._createKeyBinds(),this.setSize(this.width,this.height),this.moving=!0,this.start()},Graph.prototype._create=function(){for(;this.containerElement.hasChildNodes();)this.containerElement.removeChild(this.containerElement.firstChild);if(this.frame=document.createElement("div"),this.frame.className="graph-frame",this.frame.style.position="relative",this.frame.style.overflow="hidden",this.frame.canvas=document.createElement("canvas"),this.frame.canvas.style.position="relative",this.frame.appendChild(this.frame.canvas),!this.frame.canvas.getContext){var e=document.createElement("DIV");e.style.color="red",e.style.fontWeight="bold",e.style.padding="10px",e.innerHTML="Error: your browser does not support HTML canvas",this.frame.canvas.appendChild(e)}var t=this;this.drag={},this.pinch={},this.hammer=Hammer(this.frame.canvas,{prevent_default:!0}),this.hammer.on("tap",t._onTap.bind(t)),this.hammer.on("doubletap",t._onDoubleTap.bind(t)),this.hammer.on("hold",t._onHold.bind(t)),this.hammer.on("pinch",t._onPinch.bind(t)),this.hammer.on("touch",t._onTouch.bind(t)),this.hammer.on("dragstart",t._onDragStart.bind(t)),this.hammer.on("drag",t._onDrag.bind(t)),this.hammer.on("dragend",t._onDragEnd.bind(t)),this.hammer.on("release",t._onRelease.bind(t)),this.hammer.on("mousewheel",t._onMouseWheel.bind(t)),this.hammer.on("DOMMouseScroll",t._onMouseWheel.bind(t)),this.hammer.on("mousemove",t._onMouseMoveTitle.bind(t)),this.containerElement.appendChild(this.frame)},Graph.prototype._createKeyBinds=function(){var e=this;this.mousetrap=mousetrap,this.mousetrap.reset(),1==this.constants.keyboard.enabled&&(this.mousetrap.bind("up",this._moveUp.bind(e),"keydown"),this.mousetrap.bind("up",this._yStopMoving.bind(e),"keyup"),this.mousetrap.bind("down",this._moveDown.bind(e),"keydown"),this.mousetrap.bind("down",this._yStopMoving.bind(e),"keyup"),this.mousetrap.bind("left",this._moveLeft.bind(e),"keydown"),this.mousetrap.bind("left",this._xStopMoving.bind(e),"keyup"),this.mousetrap.bind("right",this._moveRight.bind(e),"keydown"),this.mousetrap.bind("right",this._xStopMoving.bind(e),"keyup"),this.mousetrap.bind("=",this._zoomIn.bind(e),"keydown"),this.mousetrap.bind("=",this._stopZoom.bind(e),"keyup"),this.mousetrap.bind("-",this._zoomOut.bind(e),"keydown"),this.mousetrap.bind("-",this._stopZoom.bind(e),"keyup"),this.mousetrap.bind("[",this._zoomIn.bind(e),"keydown"),this.mousetrap.bind("[",this._stopZoom.bind(e),"keyup"),this.mousetrap.bind("]",this._zoomOut.bind(e),"keydown"),this.mousetrap.bind("]",this._stopZoom.bind(e),"keyup"),this.mousetrap.bind("pageup",this._zoomIn.bind(e),"keydown"),this.mousetrap.bind("pageup",this._stopZoom.bind(e),"keyup"),this.mousetrap.bind("pagedown",this._zoomOut.bind(e),"keydown"),this.mousetrap.bind("pagedown",this._stopZoom.bind(e),"keyup")),1==this.constants.dataManipulation.enabled&&(this.mousetrap.bind("escape",this._createManipulatorBar.bind(e)),this.mousetrap.bind("del",this._deleteSelected.bind(e)))},Graph.prototype._getPointer=function(e){return{x:e.pageX-vis.util.getAbsoluteLeft(this.frame.canvas),y:e.pageY-vis.util.getAbsoluteTop(this.frame.canvas)}},Graph.prototype._onTouch=function(e){this.drag.pointer=this._getPointer(e.gesture.center),this.drag.pinched=!1,this.pinch.scale=this._getScale(),this._handleTouch(this.drag.pointer)},Graph.prototype._onDragStart=function(){this._handleDragStart()},Graph.prototype._handleDragStart=function(){var e=this.drag,t=this._getNodeAt(e.pointer);if(e.dragging=!0,e.selection=[],e.translation=this._getTranslation(),e.nodeId=null,null!=t){e.nodeId=t.id,t.isSelected()||this._selectObject(t,!1);for(var n in this.selectionObj.nodes)if(this.selectionObj.nodes.hasOwnProperty(n)){var r=this.selectionObj.nodes[n],i={id:r.id,node:r,x:r.x,y:r.y,xFixed:r.xFixed,yFixed:r.yFixed};r.xFixed=!0,r.yFixed=!0,e.selection.push(i)}}},Graph.prototype._onDrag=function(e){this._handleOnDrag(e)},Graph.prototype._handleOnDrag=function(e){if(!this.drag.pinched){var t=this._getPointer(e.gesture.center),n=this,r=this.drag,i=r.selection;if(i&&i.length&&1==this.constants.dragNodes){var s=t.x-r.pointer.x,o=t.y-r.pointer.y;i.forEach(function(e){var t=e.node;e.xFixed||(t.x=n._XconvertDOMtoCanvas(n._XconvertCanvasToDOM(e.x)+s)),e.yFixed||(t.y=n._YconvertDOMtoCanvas(n._YconvertCanvasToDOM(e.y)+o))}),this.moving||(this.moving=!0,this.start())}else if(1==this.constants.dragGraph){var u=t.x-this.drag.pointer.x,a=t.y-this.drag.pointer.y;this._setTranslation(this.drag.translation.x+u,this.drag.translation.y+a),this._redraw(),this.moving=!0,this.start()}}},Graph.prototype._onDragEnd=function(){this.drag.dragging=!1;var e=this.drag.selection;e&&e.forEach(function(e){e.node.xFixed=e.xFixed,e.node.yFixed=e.yFixed})},Graph.prototype._onTap=function(e){var t=this._getPointer(e.gesture.center);this.pointerPosition=t,this._handleTap(t)},Graph.prototype._onDoubleTap=function(e){var t=this._getPointer(e.gesture.center);this._handleDoubleTap(t)},Graph.prototype._onHold=function(e){var t=this._getPointer(e.gesture.center);this.pointerPosition=t,this._handleOnHold(t)},Graph.prototype._onRelease=function(e){var t=this._getPointer(e.gesture.center);this._handleOnRelease(t)},Graph.prototype._onPinch=function(e){var t=this._getPointer(e.gesture.center);this.drag.pinched=!0,"scale"in this.pinch||(this.pinch.scale=1);var n=this.pinch.scale*e.gesture.scale;this._zoom(n,t)},Graph.prototype._zoom=function(e,t){if(1==this.constants.zoomable){var n=this._getScale();1e-5>e&&(e=1e-5),e>10&&(e=10);var r=this._getTranslation(),i=e/n,s=(1-i)*t.x+r.x*i,o=(1-i)*t.y+r.y*i;return this.areaCenter={x:this._XconvertDOMtoCanvas(t.x),y:this._YconvertDOMtoCanvas(t.y)},this._setScale(e),this._setTranslation(s,o),this.updateClustersDefault(),this._redraw(),e>n?this.emit("zoom",{direction:"+"}):this.emit("zoom",{direction:"-"}),e}},Graph.prototype._onMouseWheel=function(e){var t=0;if(e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t){var n=this._getScale(),r=t/10;0>t&&(r/=1-r),n*=1+r;var i=util.fakeGesture(this,e),s=this._getPointer(i.center);this._zoom(n,s)}e.preventDefault()},Graph.prototype._onMouseMoveTitle=function(e){var t=util.fakeGesture(this,e),n=this._getPointer(t.center);this.popupObj&&this._checkHidePopup(n);var r=this,i=function(){r._checkShowPopup(n)};if(this.popupTimer&&clearInterval(this.popupTimer),this.drag.dragging||(this.popupTimer=setTimeout(i,this.constants.tooltip.delay)),1==this.constants.hover){for(var s in this.hoverObj.edges)this.hoverObj.edges.hasOwnProperty(s)&&(this.hoverObj.edges[s].hover=!1,delete this.hoverObj.edges[s]);var o=this._getNodeAt(n);null==o&&(o=this._getEdgeAt(n)),null!=o&&this._hoverObject(o);for(var u in this.hoverObj.nodes)this.hoverObj.nodes.hasOwnProperty(u)&&(o instanceof Node&&o.id!=u||o instanceof Edge||null==o)&&(this._blurObject(this.hoverObj.nodes[u]),delete this.hoverObj.nodes[u]);this.redraw()}},Graph.prototype._checkShowPopup=function(e){var t,n={left:this._XconvertDOMtoCanvas(e.x),top:this._YconvertDOMtoCanvas(e.y),right:this._XconvertDOMtoCanvas(e.x),bottom:this._YconvertDOMtoCanvas(e.y)},r=this.popupObj;if(void 0==this.popupObj){var i=this.nodes;for(t in i)if(i.hasOwnProperty(t)){var s=i[t];if(void 0!==s.getTitle()&&s.isOverlappingWith(n)){this.popupObj=s;break}}}if(void 0===this.popupObj){var o=this.edges;for(t in o)if(o.hasOwnProperty(t)){var u=o[t];if(u.connected&&void 0!==u.getTitle()&&u.isOverlappingWith(n)){this.popupObj=u;break}}}if(this.popupObj){if(this.popupObj!=r){var a=this;a.popup||(a.popup=new Popup(a.frame,a.constants.tooltip)),a.popup.setPosition(e.x-3,e.y-3),a.popup.setText(a.popupObj.getTitle()),a.popup.show()}}else this.popup&&this.popup.hide()},Graph.prototype._checkHidePopup=function(e){this.popupObj&&this._getNodeAt(e)||(this.popupObj=void 0,this.popup&&this.popup.hide())},Graph.prototype.setSize=function(e,t){this.frame.style.width=e,this.frame.style.height=t,this.frame.canvas.style.width="100%",this.frame.canvas.style.height="100%",this.frame.canvas.width=this.frame.canvas.clientWidth,this.frame.canvas.height=this.frame.canvas.clientHeight,void 0!==this.manipulationDiv&&(this.manipulationDiv.style.width=this.frame.canvas.clientWidth+"px"),void 0!==this.navigationDivs&&void 0!==this.navigationDivs.wrapper&&(this.navigationDivs.wrapper.style.width=this.frame.canvas.clientWidth+"px",this.navigationDivs.wrapper.style.height=this.frame.canvas.clientHeight+"px"),this.emit("resize",{width:this.frame.canvas.width,height:this.frame.canvas.height})},Graph.prototype._setNodes=function(e){var t=this.nodesData;if(e instanceof DataSet||e instanceof DataView)this.nodesData=e;else if(e instanceof Array)this.nodesData=new DataSet,this.nodesData.add(e);else{if(e)throw new TypeError("Array or DataSet expected");this.nodesData=new DataSet}if(t&&util.forEach(this.nodesListeners,function(e,n){t.off(n,e)}),this.nodes={},this.nodesData){var n=this;util.forEach(this.nodesListeners,function(e,t){n.nodesData.on(t,e)});var r=this.nodesData.getIds();this._addNodes(r)}this._updateSelection()},Graph.prototype._addNodes=function(e){for(var t,n=0,r=e.length;r>n;n++){t=e[n];var i=this.nodesData.get(t),s=new Node(i,this.images,this.groups,this.constants);if(this.nodes[t]=s,!(0!=s.xFixed&&0!=s.yFixed||null!==s.x&&null!==s.y)){var o=1*e.length,u=2*Math.PI*Math.random();0==s.xFixed&&(s.x=o*Math.cos(u)),0==s.yFixed&&(s.y=o*Math.sin(u))}this.moving=!0}this._updateNodeIndexList(),1==this.constants.hierarchicalLayout.enabled&&0==this.initializing&&(this._resetLevels(),this._setupHierarchicalLayout()),this._updateCalculationNodes(),this._reconnectEdges(),this._updateValueRange(this.nodes),this.updateLabels()},Graph.prototype._updateNodes=function(e){for(var t=this.nodes,n=this.nodesData,r=0,i=e.length;i>r;r++){var s=e[r],o=t[s],u=n.get(s);o?o.setProperties(u,this.constants):(o=new Node(properties,this.images,this.groups,this.constants),t[s]=o)}this.moving=!0,1==this.constants.hierarchicalLayout.enabled&&0==this.initializing&&(this._resetLevels(),this._setupHierarchicalLayout()),this._updateNodeIndexList(),this._reconnectEdges(),this._updateValueRange(t)},Graph.prototype._removeNodes=function(e){for(var t=this.nodes,n=0,r=e.length;r>n;n++){var i=e[n];delete t[i]}this._updateNodeIndexList(),1==this.constants.hierarchicalLayout.enabled&&0==this.initializing&&(this._resetLevels(),this._setupHierarchicalLayout()),this._updateCalculationNodes(),this._reconnectEdges(),this._updateSelection(),this._updateValueRange(t)},Graph.prototype._setEdges=function(e){var t=this.edgesData;if(e instanceof DataSet||e instanceof DataView)this.edgesData=e;else if(e instanceof Array)this.edgesData=new DataSet,this.edgesData.add(e);else{if(e)throw new TypeError("Array or DataSet expected");this.edgesData=new DataSet}if(t&&util.forEach(this.edgesListeners,function(e,n){t.off(n,e)}),this.edges={},this.edgesData){var n=this;util.forEach(this.edgesListeners,function(e,t){n.edgesData.on(t,e)});var r=this.edgesData.getIds();this._addEdges(r)}this._reconnectEdges()},Graph.prototype._addEdges=function(e){for(var t=this.edges,n=this.edgesData,r=0,i=e.length;i>r;r++){var s=e[r],o=t[s];o&&o.disconnect();var u=n.get(s,{showInternalIds:!0});t[s]=new Edge(u,this,this.constants)}this.moving=!0,this._updateValueRange(t),this._createBezierNodes(),1==this.constants.hierarchicalLayout.enabled&&0==this.initializing&&(this._resetLevels(),this._setupHierarchicalLayout()),this._updateCalculationNodes()},Graph.prototype._updateEdges=function(e){for(var t=this.edges,n=this.edgesData,r=0,i=e.length;i>r;r++){var s=e[r],o=n.get(s),u=t[s];u?(u.disconnect(),u.setProperties(o,this.constants),u.connect()):(u=new Edge(o,this,this.constants),this.edges[s]=u)}this._createBezierNodes(),1==this.constants.hierarchicalLayout.enabled&&0==this.initializing&&(this._resetLevels(),this._setupHierarchicalLayout()),this.moving=!0,this._updateValueRange(t)},Graph.prototype._removeEdges=function(e){for(var t=this.edges,n=0,r=e.length;r>n;n++){var i=e[n],s=t[i];s&&(null!=s.via&&delete this.sectors.support.nodes[s.via.id],s.disconnect(),delete t[i])}this.moving=!0,this._updateValueRange(t),1==this.constants.hierarchicalLayout.enabled&&0==this.initializing&&(this._resetLevels(),this._setupHierarchicalLayout()),this._updateCalculationNodes()},Graph.prototype._reconnectEdges=function(){var e,t=this.nodes,n=this.edges;for(e in t)t.hasOwnProperty(e)&&(t[e].edges=[]);for(e in n)if(n.hasOwnProperty(e)){var r=n[e];r.from=null,r.to=null,r.connect()}},Graph.prototype._updateValueRange=function(e){var t,n=void 0,r=void 0;for(t in e)if(e.hasOwnProperty(t)){var i=e[t].getValue();void 0!==i&&(n=void 0===n?i:Math.min(i,n),r=void 0===r?i:Math.max(i,r))}if(void 0!==n&&void 0!==r)for(t in e)e.hasOwnProperty(t)&&e[t].setValueRange(n,r)},Graph.prototype.redraw=function(){this.setSize(this.width,this.height),this._redraw()},Graph.prototype._redraw=function(){var e=this.frame.canvas.getContext("2d"),t=this.frame.canvas.width,n=this.frame.canvas.height;e.clearRect(0,0,t,n),e.save(),e.translate(this.translation.x,this.translation.y),e.scale(this.scale,this.scale),this.canvasTopLeft={x:this._XconvertDOMtoCanvas(0),y:this._YconvertDOMtoCanvas(0)},this.canvasBottomRight={x:this._XconvertDOMtoCanvas(this.frame.canvas.clientWidth),y:this._YconvertDOMtoCanvas(this.frame.canvas.clientHeight)},this._doInAllSectors("_drawAllSectorNodes",e),this._doInAllSectors("_drawEdges",e),this._doInAllSectors("_drawNodes",e,!1),this._doInAllSectors("_drawControlNodes",e),e.restore()},Graph.prototype._setTranslation=function(e,t){void 0===this.translation&&(this.translation={x:0,y:0}),void 0!==e&&(this.translation.x=e),void 0!==t&&(this.translation.y=t),this.emit("viewChanged")},Graph.prototype._getTranslation=function(){return{x:this.translation.x,y:this.translation.y}},Graph.prototype._setScale=function(e){this.scale=e},Graph.prototype._getScale=function(){return this.scale},Graph.prototype._XconvertDOMtoCanvas=function(e){return(e-this.translation.x)/this.scale},Graph.prototype._XconvertCanvasToDOM=function(e){return e*this.scale+this.translation.x},Graph.prototype._YconvertDOMtoCanvas=function(e){return(e-this.translation.y)/this.scale},Graph.prototype._YconvertCanvasToDOM=function(e){return e*this.scale+this.translation.y},Graph.prototype.canvasToDOM=function(e){return{x:this._XconvertCanvasToDOM(e.x),y:this._YconvertCanvasToDOM(e.y)}},Graph.prototype.DOMtoCanvas=function(e){return{x:this._XconvertDOMtoCanvas(e.x),y:this._YconvertDOMtoCanvas(e.y)}},Graph.prototype._drawNodes=function(e,t){void 0===t&&(t=!1);var n=this.nodes,r=[];for(var i in n)n.hasOwnProperty(i)&&(n[i].setScaleAndPos(this.scale,this.canvasTopLeft,this.canvasBottomRight),n[i].isSelected()?r.push(i):(n[i].inArea()||t)&&n[i].draw(e));for(var s=0,o=r.length;o>s;s++)(n[r[s]].inArea()||t)&&n[r[s]].draw(e)},Graph.prototype._drawEdges=function(e){var t=this.edges;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.setScale(this.scale),r.connected&&t[n].draw(e)}},Graph.prototype._drawControlNodes=function(e){var t=this.edges;for(var n in t)t.hasOwnProperty(n)&&t[n]._drawControlNodes(e)},Graph.prototype._stabilize=function(){1==this.constants.freezeForStabilization&&this._freezeDefinedNodes();for(var e=0;this.moving&&e<this.constants.stabilizationIterations;)this._physicsTick(),e++;this.zoomExtent(!1,!0),1==this.constants.freezeForStabilization&&this._restoreFrozenNodes(),this.emit("stabilized",{iterations:e})},Graph.prototype._freezeDefinedNodes=function(){var e=this.nodes;for(var t in e)e.hasOwnProperty(t)&&null!=e[t].x&&null!=e[t].y&&(e[t].fixedData.x=e[t].xFixed,e[t].fixedData.y=e[t].yFixed,e[t].xFixed=!0,e[t].yFixed=!0)},Graph.prototype._restoreFrozenNodes=function(){var e=this.nodes;for(var t in e)e.hasOwnProperty(t)&&null!=e[t].fixedData.x&&(e[t].xFixed=e[t].fixedData.x,e[t].yFixed=e[t].fixedData.y)},Graph.prototype._isMoving=function(e){var t=this.nodes;for(var n in t)if(t.hasOwnProperty(n)&&t[n].isMoving(e))return!0;return!1},Graph.prototype._discreteStepNodes=function(){var e,t=this.physicsDiscreteStepsize,n=this.nodes,r=!1;if(this.constants.maxVelocity>0)for(e in n)n.hasOwnProperty(e)&&(n[e].discreteStepLimited(t,this.constants.maxVelocity),r=!0);else for(e in n)n.hasOwnProperty(e)&&(n[e].discreteStep(t),r=!0);if(1==r){var i=this.constants.minVelocity/Math.max(this.scale,.05);this.moving=i>.5*this.constants.maxVelocity?!0:this._isMoving(i)}},Graph.prototype._physicsTick=function(){this.freezeSimulation||this.moving&&(this._doInAllActiveSectors("_initializeForceCalculation"),this._doInAllActiveSectors("_discreteStepNodes"),this.constants.smoothCurves&&this._doInSupportSector("_discreteStepNodes"),this._findCenter(this._getRange()))},Graph.prototype._animationStep=function(){this.timer=void 0,this._handleNavigation(),this.start();var e=Date.now(),t=1;this._physicsTick();for(var n=Date.now()-e;n<this.renderTimestep-this.renderTime&&t<this.maxPhysicsTicksPerRender;)this._physicsTick(),n=Date.now()-e,t++;var r=Date.now();this._redraw(),this.renderTime=Date.now()-r},"undefined"!=typeof window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),Graph.prototype.start=function(){if(this.moving||0!=this.xIncrement||0!=this.yIncrement||0!=this.zoomIncrement){if(!this.timer){var e=navigator.userAgent.toLowerCase(),t=!1;-1!=e.indexOf("msie 9.0")?t=!0:-1!=e.indexOf("safari")&&e.indexOf("chrome")<=-1&&(t=!0),this.timer=1==t?window.setTimeout(this._animationStep.bind(this),this.renderTimestep):window.requestAnimationFrame(this._animationStep.bind(this),this.renderTimestep)}}else this._redraw()},Graph.prototype._handleNavigation=function(){if(0!=this.xIncrement||0!=this.yIncrement){var e=this._getTranslation();this._setTranslation(e.x+this.xIncrement,e.y+this.yIncrement)}if(0!=this.zoomIncrement){var t={x:this.frame.canvas.clientWidth/2,y:this.frame.canvas.clientHeight/2};this._zoom(this.scale*(1+this.zoomIncrement),t)}},Graph.prototype.toggleFreeze=function(){0==this.freezeSimulation?this.freezeSimulation=!0:(this.freezeSimulation=!1,this.start())},Graph.prototype._configureSmoothCurves=function(e){if(void 0===e&&(e=!0),1==this.constants.smoothCurves)this._createBezierNodes();else{this.sectors.support.nodes={};for(var t in this.edges)this.edges.hasOwnProperty(t)&&(this.edges[t].smooth=!1,this.edges[t].via=null)}this._updateCalculationNodes(),e||(this.moving=!0,this.start())},Graph.prototype._createBezierNodes=function(){if(1==this.constants.smoothCurves)for(var e in this.edges)if(this.edges.hasOwnProperty(e)){var t=this.edges[e];if(null==t.via){t.smooth=!0;var n="edgeId:".concat(t.id);this.sectors.support.nodes[n]=new Node({id:n,mass:1,shape:"circle",image:"",internalMultiplier:1},{},{},this.constants),t.via=this.sectors.support.nodes[n],t.via.parentEdgeId=t.id,t.positionBezierNode()}}},Graph.prototype._initializeMixinLoaders=function(){for(var e in graphMixinLoaders)graphMixinLoaders.hasOwnProperty(e)&&(Graph.prototype[e]=graphMixinLoaders[e])},Graph.prototype.storePosition=function(){var e=[];for(var t in this.nodes)if(this.nodes.hasOwnProperty(t)){var n=this.nodes[t],r=!this.nodes.xFixed,i=!this.nodes.yFixed;(this.nodesData.data[t].x!=Math.round(n.x)||this.nodesData.data[t].y!=Math.round(n.y))&&e.push({id:t,x:Math.round(n.x),y:Math.round(n.y),allowedToMoveX:r,allowedToMoveY:i})}this.nodesData.update(e)},Graph.prototype.focusOnNode=function(e,t){if(this.nodes.hasOwnProperty(e)){void 0===t&&(t=this._getScale());var n={x:this.nodes[e].x,y:this.nodes[e].y},r=t;this._setScale(r);var i=this.DOMtoCanvas({x:.5*this.frame.canvas.width,y:.5*this.frame.canvas.height}),s=this._getTranslation(),o={x:i.x-n.x,y:i.y-n.y};this._setTranslation(s.x+r*o.x,s.y+r*o.y),this.redraw()}else console.log("This nodeId cannot be found.")},Emitter(Graph3d.prototype),Graph3d.Camera=function(){this.armLocation=new Point3d,this.armRotation={},this.armRotation.horizontal=0,this.armRotation.vertical=0,this.armLength=1.7,this.cameraLocation=new Point3d,this.cameraRotation=new Point3d(.5*Math.PI,0,0),this.calculateCameraOrientation()},Graph3d.Camera.prototype.setArmLocation=function(e,t,n){this.armLocation.x=e,this.armLocation.y=t,this.armLocation.z=n,this.calculateCameraOrientation()},Graph3d.Camera.prototype.setArmRotation=function(e,t){void 0!==e&&(this.armRotation.horizontal=e),void 0!==t&&(this.armRotation.vertical=t,this.armRotation.vertical<0&&(this.armRotation.vertical=0),this.armRotation.vertical>.5*Math.PI&&(this.armRotation.vertical=.5*Math.PI)),(void 0!==e||void 0!==t)&&this.calculateCameraOrientation()},Graph3d.Camera.prototype.getArmRotation=function(){var e={};return e.horizontal=this.armRotation.horizontal,e.vertical=this.armRotation.vertical,e},Graph3d.Camera.prototype.setArmLength=function(e){void 0!==e&&(this.armLength=e,this.armLength<.71&&(this.armLength=.71),this.armLength>5&&(this.armLength=5),this.calculateCameraOrientation())},Graph3d.Camera.prototype.getArmLength=function(){return this.armLength},Graph3d.Camera.prototype.getCameraLocation=function(){return this.cameraLocation},Graph3d.Camera.prototype.getCameraRotation=function(){return this.cameraRotation},Graph3d.Camera.prototype.calculateCameraOrientation=function(){this.cameraLocation.x=this.armLocation.x-this.armLength*Math.sin(this.armRotation.horizontal)*Math.cos(this.armRotation.vertical),this.cameraLocation.y=this.armLocation.y-this.armLength*Math.cos(this.armRotation.horizontal)*Math.cos(this.armRotation.vertical),this.cameraLocation.z=this.armLocation.z+this.armLength*Math.sin(this.armRotation.vertical),this.cameraRotation.x=Math.PI/2-this.armRotation.vertical,this.cameraRotation.y=0,this.cameraRotation.z=-this.armRotation.horizontal},Graph3d.prototype._setScale=function(){this.scale=new Point3d(1/(this.xMax-this.xMin),1/(this.yMax-this.yMin),1/(this.zMax-this.zMin)),this.keepAspectRatio&&(this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y),this.scale.z*=this.verticalRatio,this.scale.value=1/(this.valueMax-this.valueMin);var e=(this.xMax+this.xMin)/2*this.scale.x,t=(this.yMax+this.yMin)/2*this.scale.y,n=(this.zMax+this.zMin)/2*this.scale.z;this.camera.setArmLocation(e,t,n)},Graph3d.prototype._convert3Dto2D=function(e){var t=this._convertPointToTranslation(e);return this._convertTranslationToScreen(t)},Graph3d.prototype._convertPointToTranslation=function(e){var t=e.x*this.scale.x,n=e.y*this.scale.y,r=e.z*this.scale.z,i=this.camera.getCameraLocation().x,s=this.camera.getCameraLocation().y,o=this.camera.getCameraLocation().z,u=Math.sin(this.camera.getCameraRotation().x),a=Math.cos(this.camera.getCameraRotation().x),f=Math.sin(this.camera.getCameraRotation().y),l=Math.cos(this.camera.getCameraRotation().y),c=Math.sin(this.camera.getCameraRotation().z),h=Math.cos(this.camera.getCameraRotation().z),p=l*(c*(n-s)+h*(t-i))-f*(r-o),d=u*(l*(r-o)+f*(c*(n-s)+h*(t-i)))+a*(h*(n-s)-c*(t-i)),v=a*(l*(r-o)+f*(c*(n-s)+h*(t-i)))-u*(h*(n-s)-c*(t-i));return new Point3d(p,d,v)},Graph3d.prototype._convertTranslationToScreen=function(e){var t,n,r=this.eye.x,i=this.eye.y,s=this.eye.z,o=e.x,u=e.y,a=e.z;return this.showPerspective?(t=(o-r)*(s/a),n=(u-i)*(s/a)):(t=o*-(s/this.camera.getArmLength()),n=u*-(s/this.camera.getArmLength())),new Point2d(this.xcenter+t*this.frame.canvas.clientWidth,this.ycenter-n*this.frame.canvas.clientWidth)},Graph3d.prototype._setBackgroundColor=function(e){var t="white",n="gray",r=1;if("string"==typeof e)t=e,n="none",r=0;else if("object"==typeof e)void 0!==e.fill&&(t=e.fill),void 0!==e.stroke&&(n=e.stroke),void 0!==e.strokeWidth&&(r=e.strokeWidth);else if(void 0!==e)throw"Unsupported type of backgroundColor";this.frame.style.backgroundColor=t,this.frame.style.borderColor=n,this.frame.style.borderWidth=r+"px",this.frame.style.borderStyle="solid"},Graph3d.STYLE={BAR:0,BARCOLOR:1,BARSIZE:2,DOT:3,DOTLINE:4,DOTCOLOR:5,DOTSIZE:6,GRID:7,LINE:8,SURFACE:9},Graph3d.prototype._getStyleNumber=function(e){switch(e){case"dot":return Graph3d.STYLE.DOT;case"dot-line":return Graph3d.STYLE.DOTLINE;case"dot-color":return Graph3d.STYLE.DOTCOLOR;case"dot-size":return Graph3d.STYLE.DOTSIZE;case"line":return Graph3d.STYLE.LINE;case"grid":return Graph3d.STYLE.GRID;case"surface":return Graph3d.STYLE.SURFACE;case"bar":return Graph3d.STYLE.BAR;case"bar-color":return Graph3d.STYLE.BARCOLOR;case"bar-size":return Graph3d.STYLE.BARSIZE}return-1},Graph3d.prototype._determineColumnIndexes=function(e){if(this.style===Graph3d.STYLE.DOT||this.style===Graph3d.STYLE.DOTLINE||this.style===Graph3d.STYLE.LINE||this.style===Graph3d.STYLE.GRID||this.style===Graph3d.STYLE.SURFACE||this.style===Graph3d.STYLE.BAR)this.colX=0,this.colY=1,this.colZ=2,this.colValue=void 0,e.getNumberOfColumns()>3&&(this.colFilter=3);else{if(this.style!==Graph3d.STYLE.DOTCOLOR&&this.style!==Graph3d.STYLE.DOTSIZE&&this.style!==Graph3d.STYLE.BARCOLOR&&this.style!==Graph3d.STYLE.BARSIZE)throw'Unknown style "'+this.style+'"';this.colX=0,this.colY=1,this.colZ=2,this.colValue=3,e.getNumberOfColumns()>4&&(this.colFilter=4)}},Graph3d.prototype.getNumberOfRows=function(e){return e.length},Graph3d.prototype.getNumberOfColumns=function(e){var t=0;for(var n in e[0])e[0].hasOwnProperty(n)&&t++;return t},Graph3d.prototype.getDistinctValues=function(e,t){for(var n=[],r=0;r<e.length;r++)-1==n.indexOf(e[r][t])&&n.push(e[r][t]);return n},Graph3d.prototype.getColumnRange=function(e,t){for(var n={min:e[0][t],max:e[0][t]},r=0;r<e.length;r++)n.min>e[r][t]&&(n.min=e[r][t]),n.max<e[r][t]&&(n.max=e[r][t]);return n},Graph3d.prototype._dataInitialize=function(e){var t=this;if(this.dataSet&&this.dataSet.off("*",this._onChange),void 0!==e){Array.isArray(e)&&(e=new DataSet(e));var n;if(!(e instanceof DataSet||e instanceof DataView))throw new Error("Array, DataSet, or DataView expected");if(n=e.get(),0!=n.length){this.dataSet=e,this.dataTable=n,this._onChange=function(){t.setData(t.dataSet)},this.dataSet.on("*",this._onChange),this.colX="x",this.colY="y",this.colZ="z",this.colValue="style",this.colFilter="filter",n[0].hasOwnProperty("filter")&&void 0===this.dataFilter&&(this.dataFilter=new Filter(e,this.colFilter,this),this.dataFilter.setOnLoadCallback(function(){t.redraw()}));var r=this.style==Graph3d.STYLE.BAR||this.style==Graph3d.STYLE.BARCOLOR||this.style==Graph3d.STYLE.BARSIZE;if(r){if(void 0!==this.defaultXBarWidth)this.xBarWidth=this.defaultXBarWidth;else{var i=this.getDistinctValues(n,this.colX);this.xBarWidth=i[1]-i[0]||1}if(void 0!==this.defaultYBarWidth)this.yBarWidth=this.defaultYBarWidth;else{var s=this.getDistinctValues(n,this.colY);this.yBarWidth=s[1]-s[0]||1}}var o=this.getColumnRange(n,this.colX);r&&(o.min-=this.xBarWidth/2,o.max+=this.xBarWidth/2),this.xMin=void 0!==this.defaultXMin?this.defaultXMin:o.min,this.xMax=void 0!==this.defaultXMax?this.defaultXMax:o.max,this.xMax<=this.xMin&&(this.xMax=this.xMin+1),this.xStep=void 0!==this.defaultXStep?this.defaultXStep:(this.xMax-this.xMin)/5;var u=this.getColumnRange(n,this.colY);r&&(u.min-=this.yBarWidth/2,u.max+=this.yBarWidth/2),this.yMin=void 0!==this.defaultYMin?this.defaultYMin:u.min,this.yMax=void 0!==this.defaultYMax?this.defaultYMax:u.max,this.yMax<=this.yMin&&(this.yMax=this.yMin+1),this.yStep=void 0!==this.defaultYStep?this.defaultYStep:(this.yMax-this.yMin)/5;var a=this.getColumnRange(n,this.colZ);if(this.zMin=void 0!==this.defaultZMin?this.defaultZMin:a.min,this.zMax=void 0!==this.defaultZMax?this.defaultZMax:a.max,this.zMax<=this.zMin&&(this.zMax=this.zMin+1),this.zStep=void 0!==this.defaultZStep?this.defaultZStep:(this.zMax-this.zMin)/5,void 0!==this.colValue){var f=this.getColumnRange(n,this.colValue);this.valueMin=void 0!==this.defaultValueMin?this.defaultValueMin:f.min,this.valueMax=void 0!==this.defaultValueMax?this.defaultValueMax:f.max,this.valueMax<=this.valueMin&&(this.valueMax=this.valueMin+1)}this._setScale()}}},Graph3d.prototype._getDataPoints=function(e){function t(e,t){return e-t}var n,r,i,s,o,u,a=[];if(this.style===Graph3d.STYLE.GRID||this.style===Graph3d.STYLE.SURFACE){var f=[],l=[];for(i=0;i<this.getNumberOfRows(e);i++)n=e[i][this.colX]||0,r=e[i][this.colY]||0,-1===f.indexOf(n)&&f.push(n),-1===l.indexOf(r)&&l.push(r);f.sort(t),l.sort(t);var c=[];for(i=0;i<e.length;i++){n=e[i][this.colX]||0,r=e[i][this.colY]||0,s=e[i][this.colZ]||0;var h=f.indexOf(n),p=l.indexOf(r);void 0===c[h]&&(c[h]=[]);var d=new Point3d;d.x=n,d.y=r,d.z=s,o={},o.point=d,o.trans=void 0,o.screen=void 0,o.bottom=new Point3d(n,r,this.zMin),c[h][p]=o,a.push(o)}for(n=0;n<c.length;n++)for(r=0;r<c[n].length;r++)c[n][r]&&(c[n][r].pointRight=n<c.length-1?c[n+1][r]:void 0,c[n][r].pointTop=r<c[n].length-1?c[n][r+1]:void 0,c[n][r].pointCross=n<c.length-1&&r<c[n].length-1?c[n+1][r+1]:void 0)}else for(i=0;i<e.length;i++)u=new Point3d,u.x=e[i][this.colX]||0,u.y=e[i][this.colY]||0,u.z=e[i][this.colZ]||0,void 0!==this.colValue&&(u.value=e[i][this.colValue]||0),o={},o.point=u,o.bottom=new Point3d(u.x,u.y,this.zMin),o.trans=void 0,o.screen=void 0,a.push(o);return a},Graph3d.px=function(e){return e+"px"},Graph3d.prototype.create=function(){for(;this.containerElement.hasChildNodes();)this.containerElement.removeChild(this.containerElement.firstChild);this.frame=document.createElement("div"),this.frame.style.position="relative",this.frame.style.overflow="hidden",this.frame.canvas=document.createElement("canvas"),this.frame.canvas.style.position="relative",this.frame.appendChild(this.frame.canvas);var e=document.createElement("DIV");e.style.color="red",e.style.fontWeight="bold",e.style.padding="10px",e.innerHTML="Error: your browser does not support HTML canvas",this.frame.canvas.appendChild(e),this.frame.filter=document.createElement("div"),this.frame.filter.style.position="absolute",this.frame.filter.style.bottom="0px",this.frame.filter.style.left="0px",this.frame.filter.style.width="100%",this.frame.appendChild(this.frame.filter);var t=this,n=function(e){t._onMouseDown(e)},r=function(e){t._onTouchStart(e)},i=function(e){t._onWheel(e)},s=function(e){t._onTooltip(e)};G3DaddEventListener(this.frame.canvas,"keydown",onkeydown),G3DaddEventListener(this.frame.canvas,"mousedown",n),G3DaddEventListener(this.frame.canvas,"touchstart",r),G3DaddEventListener(this.frame.canvas,"mousewheel",i),G3DaddEventListener(this.frame.canvas,"mousemove",s),this.containerElement.appendChild(this.frame)},Graph3d.prototype.setSize=function(e,t){this.frame.style.width=e,this.frame.style.height=t,this._resizeCanvas()},Graph3d.prototype._resizeCanvas=function(){this.frame.canvas.style.width="100%",this.frame.canvas.style.height="100%",this.frame.canvas.width=this.frame.canvas.clientWidth,this.frame.canvas.height=this.frame.canvas.clientHeight,this.frame.filter.style.width=this.frame.canvas.clientWidth-20+"px"},Graph3d.prototype.animationStart=function(){if(!this.frame.filter||!this.frame.filter.slider)throw"No animation available";this.frame.filter.slider.play()},Graph3d.prototype.animationStop=function(){this.frame.filter&&this.frame.filter.slider&&this.frame.filter.slider.stop()},Graph3d.prototype._resizeCenter=function(){this.xcenter="%"===this.defaultXCenter.charAt(this.defaultXCenter.length-1)?parseFloat(this.defaultXCenter)/100*this.frame.canvas.clientWidth:parseFloat(this.defaultXCenter),this.ycenter="%"===this.defaultYCenter.charAt(this.defaultYCenter.length-1)?parseFloat(this.defaultYCenter)/100*(this.frame.canvas.clientHeight-this.frame.filter.clientHeight):parseFloat(this.defaultYCenter)},Graph3d.prototype.setCameraPosition=function(e){void 0!==e&&(void 0!==e.horizontal&&void 0!==e.vertical&&this.camera.setArmRotation(e.horizontal,e.vertical),void 0!==e.distance&&this.camera.setArmLength(e.distance),this.redraw())},Graph3d.prototype.getCameraPosition=function(){var e=this.camera.getArmRotation();return e.distance=this.camera.getArmLength(),e},Graph3d.prototype._readData=function(e){this._dataInitialize(e,this.style),this.dataPoints=this.dataFilter?this.dataFilter._getDataPoints():this._getDataPoints(this.dataTable),this._redrawFilter()},Graph3d.prototype.setData=function(e){this._readData(e),this.redraw(),this.animationAutoStart&&this.dataFilter&&this.animationStart()},Graph3d.prototype.setOptions=function(e){var t=void 0;if(this.animationStop(),void 0!==e){if(void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height),void 0!==e.xCenter&&(this.defaultXCenter=e.xCenter),void 0!==e.yCenter&&(this.defaultYCenter=e.yCenter),void 0!==e.filterLabel&&(this.filterLabel=e.filterLabel),void 0!==e.legendLabel&&(this.legendLabel=e.legendLabel),void 0!==e.xLabel&&(this.xLabel=e.xLabel),void 0!==e.yLabel&&(this.yLabel=e.yLabel),void 0!==e.zLabel&&(this.zLabel=e.zLabel),void 0!==e.style){var n=this._getStyleNumber(e.style);-1!==n&&(this.style=n)}void 0!==e.showGrid&&(this.showGrid=e.showGrid),void 0!==e.showPerspective&&(this.showPerspective=e.showPerspective),void 0!==e.showShadow&&(this.showShadow=e.showShadow),void 0!==e.tooltip&&(this.showTooltip=e.tooltip),void 0!==e.showAnimationControls&&(this.showAnimationControls=e.showAnimationControls),void 0!==e.keepAspectRatio&&(this.keepAspectRatio=e.keepAspectRatio),void 0!==e.verticalRatio&&(this.verticalRatio=e.verticalRatio),void 0!==e.animationInterval&&(this.animationInterval=e.animationInterval),void 0!==e.animationPreload&&(this.animationPreload=e.animationPreload),void 0!==e.animationAutoStart&&(this.animationAutoStart=e.animationAutoStart),void 0!==e.xBarWidth&&(this.defaultXBarWidth=e.xBarWidth),void 0!==e.yBarWidth&&(this.defaultYBarWidth=e.yBarWidth),void 0!==e.xMin&&(this.defaultXMin=e.xMin),void 0!==e.xStep&&(this.defaultXStep=e.xStep),void 0!==e.xMax&&(this.defaultXMax=e.xMax),void 0!==e.yMin&&(this.defaultYMin=e.yMin),void 0!==e.yStep&&(this.defaultYStep=e.yStep),void 0!==e.yMax&&(this.defaultYMax=e.yMax),void 0!==e.zMin&&(this.defaultZMin=e.zMin),void 0!==e.zStep&&(this.defaultZStep=e.zStep),void 0!==e.zMax&&(this.defaultZMax=e.zMax),void 0!==e.valueMin&&(this.defaultValueMin=e.valueMin),void 0!==e.valueMax&&(this.defaultValueMax=e.valueMax),void 0!==e.cameraPosition&&(t=e.cameraPosition),void 0!==t?(this.camera.setArmRotation(t.horizontal,t.vertical),this.camera.setArmLength(t.distance)):(this.camera.setArmRotation(1,.5),this.camera.setArmLength(1.7))}this._setBackgroundColor(e&&e.backgroundColor),this.setSize(this.width,this.height),this.dataTable&&this.setData(this.dataTable),this.animationAutoStart&&this.dataFilter&&this.animationStart()},Graph3d.prototype.redraw=function(){if(void 0===this.dataPoints)throw"Error: graph data not initialized";this._resizeCanvas(),this._resizeCenter(),this._redrawSlider(),this._redrawClear(),this._redrawAxis(),this.style===Graph3d.STYLE.GRID||this.style===Graph3d.STYLE.SURFACE?this._redrawDataGrid():this.style===Graph3d.STYLE.LINE?this._redrawDataLine():this.style===Graph3d.STYLE.BAR||this.style===Graph3d.STYLE.BARCOLOR||this.style===Graph3d.STYLE.BARSIZE?this._redrawDataBar():this._redrawDataDot(),this._redrawInfo(),this._redrawLegend()},Graph3d.prototype._redrawClear=function(){var e=this.frame.canvas,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height)},Graph3d.prototype._redrawLegend=function(){var e;if(this.style===Graph3d.STYLE.DOTCOLOR||this.style===Graph3d.STYLE.DOTSIZE){var t,n,r=.02*this.frame.clientWidth;this.style===Graph3d.STYLE.DOTSIZE?(t=r/2,n=r/2+2*r):(t=20,n=20);var i=Math.max(.25*this.frame.clientHeight,100),s=this.margin,o=this.frame.clientWidth-this.margin,u=o-n,a=s+i}var f=this.frame.canvas,l=f.getContext("2d");if(l.lineWidth=1,l.font="14px arial",this.style===Graph3d.STYLE.DOTCOLOR){var c=0,h=i;for(e=c;h>e;e++){var p=(e-c)/(h-c),d=240*p,v=this._hsv2rgb(d,1,1);l.strokeStyle=v,l.beginPath(),l.moveTo(u,s+e),l.lineTo(o,s+e),l.stroke()}l.strokeStyle=this.colorAxis,l.strokeRect(u,s,n,i)}if(this.style===Graph3d.STYLE.DOTSIZE&&(l.strokeStyle=this.colorAxis,l.fillStyle=this.colorDot,l.beginPath(),l.moveTo(u,s),l.lineTo(o,s),l.lineTo(o-n+t,a),l.lineTo(u,a),l.closePath(),l.fill(),l.stroke()),this.style===Graph3d.STYLE.DOTCOLOR||this.style===Graph3d.STYLE.DOTSIZE){var m=5,g=new StepNumber(this.valueMin,this.valueMax,(this.valueMax-this.valueMin)/5,!0);for(g.start(),g.getCurrent()<this.valueMin&&g.next();!g.end();)e=a-(g.getCurrent()-this.valueMin)/(this.valueMax-this.valueMin)*i,l.beginPath(),l.moveTo(u-m,e),l.lineTo(u,e),l.stroke(),l.textAlign="right",l.textBaseline="middle",l.fillStyle=this.colorAxis,l.fillText(g.getCurrent(),u-2*m,e),g.next();l.textAlign="right",l.textBaseline="top";var y=this.legendLabel;l.fillText(y,o,a+this.margin)}},Graph3d.prototype._redrawFilter=function(){if(this.frame.filter.innerHTML="",this.dataFilter){var e={visible:this.showAnimationControls},t=new Slider(this.frame.filter,e);this.frame.filter.slider=t,this.frame.filter.style.padding="10px",t.setValues(this.dataFilter.values),t.setPlayInterval(this.animationInterval);var n=this,r=function(){var e=t.getIndex();n.dataFilter.selectValue(e),n.dataPoints=n.dataFilter._getDataPoints(),n.redraw()};t.setOnChangeCallback(r)}else this.frame.filter.slider=void 0},Graph3d.prototype._redrawSlider=function(){void 0!==this.frame.filter.slider&&this.frame.filter.slider.redraw()},Graph3d.prototype._redrawInfo=function(){if(this.dataFilter){var e=this.frame.canvas,t=e.getContext("2d");t.font="14px arial",t.lineStyle="gray",t.fillStyle="gray",t.textAlign="left",t.textBaseline="top";var n=this.margin,r=this.margin;t.fillText(this.dataFilter.getLabel()+": "+this.dataFilter.getSelectedValue(),n,r)}},Graph3d.prototype._redrawAxis=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p=this.frame.canvas,d=p.getContext("2d");d.font=24/this.camera.getArmLength()+"px arial";var v=.025/this.scale.x,m=.025/this.scale.y,g=5/this.camera.getArmLength(),y=this.camera.getArmRotation().horizontal;for(d.lineWidth=1,r=void 0===this.defaultXStep,n=new StepNumber(this.xMin,this.xMax,this.xStep,r),n.start(),n.getCurrent()<this.xMin&&n.next();!n.end();){var b=n.getCurrent();this.showGrid?(e=this._convert3Dto2D(new Point3d(b,this.yMin,this.zMin)),t=this._convert3Dto2D(new Point3d(b,this.yMax,this.zMin)),d.strokeStyle=this.colorGrid,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke()):(e=this._convert3Dto2D(new Point3d(b,this.yMin,this.zMin)),t=this._convert3Dto2D(new Point3d(b,this.yMin+v,this.zMin)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke(),e=this._convert3Dto2D(new Point3d(b,this.yMax,this.zMin)),t=this._convert3Dto2D(new Point3d(b,this.yMax-v,this.zMin)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke()),o=Math.cos(y)>0?this.yMin:this.yMax,i=this._convert3Dto2D(new Point3d(b,o,this.zMin)),Math.cos(2*y)>0?(d.textAlign="center",d.textBaseline="top",i.y+=g):Math.sin(2*y)<0?(d.textAlign="right",d.textBaseline="middle"):(d.textAlign="left",d.textBaseline="middle"),d.fillStyle=this.colorAxis,d.fillText("  "+n.getCurrent()+"  ",i.x,i.y),n.next()}for(d.lineWidth=1,r=void 0===this.defaultYStep,n=new StepNumber(this.yMin,this.yMax,this.yStep,r),n.start(),n.getCurrent()<this.yMin&&n.next();!n.end();)this.showGrid?(e=this._convert3Dto2D(new Point3d(this.xMin,n.getCurrent(),this.zMin)),t=this._convert3Dto2D(new Point3d(this.xMax,n.getCurrent(),this.zMin)),d.strokeStyle=this.colorGrid,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke()):(e=this._convert3Dto2D(new Point3d(this.xMin,n.getCurrent(),this.zMin)),t=this._convert3Dto2D(new Point3d(this.xMin+m,n.getCurrent(),this.zMin)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke(),e=this._convert3Dto2D(new Point3d(this.xMax,n.getCurrent(),this.zMin)),t=this._convert3Dto2D(new Point3d(this.xMax-m,n.getCurrent(),this.zMin)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke()),s=Math.sin(y)>0?this.xMin:this.xMax,i=this._convert3Dto2D(new Point3d(s,n.getCurrent(),this.zMin)),Math.cos(2*y)<0?(d.textAlign="center",d.textBaseline="top",i.y+=g):Math.sin(2*y)>0?(d.textAlign="right",d.textBaseline="middle"):(d.textAlign="left",d.textBaseline="middle"),d.fillStyle=this.colorAxis,d.fillText("  "+n.getCurrent()+"  ",i.x,i.y),n.next();for(d.lineWidth=1,r=void 0===this.defaultZStep,n=new StepNumber(this.zMin,this.zMax,this.zStep,r),n.start(),n.getCurrent()<this.zMin&&n.next(),s=Math.cos(y)>0?this.xMin:this.xMax,o=Math.sin(y)<0?this.yMin:this.yMax;!n.end();)e=this._convert3Dto2D(new Point3d(s,o,n.getCurrent())),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(e.x-g,e.y),d.stroke(),d.textAlign="right",d.textBaseline="middle",d.fillStyle=this.colorAxis,d.fillText(n.getCurrent()+" ",e.x-5,e.y),n.next();d.lineWidth=1,e=this._convert3Dto2D(new Point3d(s,o,this.zMin)),t=this._convert3Dto2D(new Point3d(s,o,this.zMax)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke(),d.lineWidth=1,c=this._convert3Dto2D(new Point3d(this.xMin,this.yMin,this.zMin)),h=this._convert3Dto2D(new Point3d(this.xMax,this.yMin,this.zMin)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(c.x,c.y),d.lineTo(h.x,h.y),d.stroke(),c=this._convert3Dto2D(new Point3d(this.xMin,this.yMax,this.zMin)),h=this._convert3Dto2D(new Point3d(this.xMax,this.yMax,this.zMin)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(c.x,c.y),d.lineTo(h.x,h.y),d.stroke(),d.lineWidth=1,e=this._convert3Dto2D(new Point3d(this.xMin,this.yMin,this.zMin)),t=this._convert3Dto2D(new Point3d(this.xMin,this.yMax,this.zMin)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke(),e=this._convert3Dto2D(new Point3d(this.xMax,this.yMin,this.zMin)),t=this._convert3Dto2D(new Point3d(this.xMax,this.yMax,this.zMin)),d.strokeStyle=this.colorAxis,d.beginPath(),d.moveTo(e.x,e.y),d.lineTo(t.x,t.y),d.stroke();var w=this.xLabel;w.length>0&&(l=.1/this.scale.y,s=(this.xMin+this.xMax)/2,o=Math.cos(y)>0?this.yMin-l:this.yMax+l,i=this._convert3Dto2D(new Point3d(s,o,this.zMin)),Math.cos(2*y)>0?(d.textAlign="center",d.textBaseline="top"):Math.sin(2*y)<0?(d.textAlign="right",d.textBaseline="middle"):(d.textAlign="left",d.textBaseline="middle"),d.fillStyle=this.colorAxis,d.fillText(w,i.x,i.y));var E=this.yLabel;E.length>0&&(f=.1/this.scale.x,s=Math.sin(y)>0?this.xMin-f:this.xMax+f,o=(this.yMin+this.yMax)/2,i=this._convert3Dto2D(new Point3d(s,o,this.zMin)),Math.cos(2*y)<0?(d.textAlign="center",d.textBaseline="top"):Math.sin(2*y)>0?(d.textAlign="right",d.textBaseline="middle"):(d.textAlign="left",d.textBaseline="middle"),d.fillStyle=this.colorAxis,d.fillText(E,i.x,i.y));var S=this.zLabel;S.length>0&&(a=30,s=Math.cos(y)>0?this.xMin:this.xMax,o=Math.sin(y)<0?this.yMin:this.yMax,u=(this.zMin+this.zMax)/2,i=this._convert3Dto2D(new Point3d(s,o,u)),d.textAlign="right",d.textBaseline="middle",d.fillStyle=this.colorAxis,d.fillText(S,i.x-a,i.y))},Graph3d.prototype._hsv2rgb=function(e,t,n){var r,i,s,o,u,a;switch(o=n*t,u=Math.floor(e/60),a=o*(1-Math.abs(e/60%2-1)),u){case 0:r=o,i=a,s=0;break;case 1:r=a,i=o,s=0;break;case 2:r=0,i=o,s=a;break;case 3:r=0,i=a,s=o;break;case 4:r=a,i=0,s=o;break;case 5:r=o,i=0,s=a;break;default:r=0,i=0,s=0}return"RGB("+parseInt(255*r)+","+parseInt(255*i)+","+parseInt(255*s)+")"},Graph3d.prototype._redrawDataGrid=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p=this.frame.canvas,d=p.getContext("2d");if(!(void 0===this.dataPoints||this.dataPoints.length<=0)){for(i=0;i<this.dataPoints.length;i++){var v=this._convertPointToTranslation(this.dataPoints[i].point),m=this._convertTranslationToScreen(v);this.dataPoints[i].trans=v,this.dataPoints[i].screen=m;var g=this._convertPointToTranslation(this.dataPoints[i].bottom);this.dataPoints[i].dist=this.showPerspective?g.length():-g.z}var y=function(e,t){return t.dist-e.dist};if(this.dataPoints.sort(y),this.style===Graph3d.STYLE.SURFACE){for(i=0;i<this.dataPoints.length;i++)if(e=this.dataPoints[i],t=this.dataPoints[i].pointRight,n=this.dataPoints[i].pointTop,r=this.dataPoints[i].pointCross,void 0!==e&&void 0!==t&&void 0!==n&&void 0!==r){if(this.showGrayBottom||this.showShadow){var b=Point3d.subtract(r.trans,e.trans),w=Point3d.subtract(n.trans,t.trans),E=Point3d.crossProduct(b,w),S=E.length();s=E.z>0}else s=!0;s?(h=(e.point.z+t.point.z+n.point.z+r.point.z)/4,f=240*(1-(h-this.zMin)*this.scale.z/this.verticalRatio),l=1,this.showShadow?(c=Math.min(1+E.x/S/2,1),o=this._hsv2rgb(f,l,c),u=o):(c=1,o=this._hsv2rgb(f,l,c),u=this.colorAxis)):(o="gray",u=this.colorAxis),a=.5,d.lineWidth=a,d.fillStyle=o,d.strokeStyle=u,d.beginPath(),d.moveTo(e.screen.x,e.screen.y),d.lineTo(t.screen.x,t.screen.y),d.lineTo(r.screen.x,r.screen.y),d.lineTo(n.screen.x,n.screen.y),d.closePath(),d.fill(),d.stroke()}}else for(i=0;i<this.dataPoints.length;i++)e=this.dataPoints[i],t=this.dataPoints[i].pointRight,n=this.dataPoints[i].pointTop,void 0!==e&&(a=this.showPerspective?2/-e.trans.z:2*-(this.eye.z/this.camera.getArmLength())),void 0!==e&&void 0!==t&&(h=(e.point.z+t.point.z)/2,f=240*(1-(h-this.zMin)*this.scale.z/this.verticalRatio),d.lineWidth=a,d.strokeStyle=this._hsv2rgb(f,1,1),d.beginPath(),d.moveTo(e.screen.x,e.screen.y),d.lineTo(t.screen.x,t.screen.y),d.stroke()),void 0!==e&&void 0!==n&&(h=(e.point.z+n.point.z)/2,f=240*(1-(h-this.zMin)*this.scale.z/this.verticalRatio),d.lineWidth=a,d.strokeStyle=this._hsv2rgb(f,1,1),d.beginPath(),d.moveTo(e.screen.x,e.screen.y),d.lineTo(n.screen.x,n.screen.y),d.stroke())}},Graph3d.prototype._redrawDataDot=function(){var e,t=this.frame.canvas,n=t.getContext("2d");if(!(void 0===this.dataPoints||this.dataPoints.length<=0)){for(e=0;e<this.dataPoints.length;e++){var r=this._convertPointToTranslation(this.dataPoints[e].point),i=this._convertTranslationToScreen(r);this.dataPoints[e].trans=r,this.dataPoints[e].screen=i;var s=this._convertPointToTranslation(this.dataPoints[e].bottom);this.dataPoints[e].dist=this.showPerspective?s.length():-s.z}var o=function(e,t){return t.dist-e.dist};this.dataPoints.sort(o);var u=.02*this.frame.clientWidth;for(e=0;e<this.dataPoints.length;e++){var a=this.dataPoints[e];if(this.style===Graph3d.STYLE.DOTLINE){var f=this._convert3Dto2D(a.bottom);n.lineWidth=1,n.strokeStyle=this.colorGrid,n.beginPath(),n.moveTo(f.x,f.y),n.lineTo(a.screen.x,a.screen.y),n.stroke()}var l;l=this.style===Graph3d.STYLE.DOTSIZE?u/2+2*u*(a.point.value-this.valueMin)/(this.valueMax-this.valueMin):u;var c;c=this.showPerspective?l/-a.trans.z:l*-(this.eye.z/this.camera.getArmLength()),0>c&&(c=0);var h,p,d;this.style===Graph3d.STYLE.DOTCOLOR?(h=240*(1-(a.point.value-this.valueMin)*this.scale.value),p=this._hsv2rgb(h,1,1),d=this._hsv2rgb(h,1,.8)):this.style===Graph3d.STYLE.DOTSIZE?(p=this.colorDot,d=this.colorDotBorder):(h=240*(1-(a.point.z-this.zMin)*this.scale.z/this.verticalRatio),p=this._hsv2rgb(h,1,1),d=this._hsv2rgb(h,1,.8)),n.lineWidth=1,n.strokeStyle=d,n.fillStyle=p,n.beginPath(),n.arc(a.screen.x,a.screen.y,c,0,2*Math.PI,!0),n.fill(),n.stroke()}}},Graph3d.prototype._redrawDataBar=function(){var e,t,n,r,i=this.frame.canvas,s=i.getContext("2d");if(!(void 0===this.dataPoints||this.dataPoints.length<=0)){for(e=0;e<this.dataPoints.length;e++){var o=this._convertPointToTranslation(this.dataPoints[e].point),u=this._convertTranslationToScreen(o);this.dataPoints[e].trans=o,this.dataPoints[e].screen=u;var a=this._convertPointToTranslation(this.dataPoints[e].bottom);this.dataPoints[e].dist=this.showPerspective?a.length():-a.z}var f=function(e,t){return t.dist-e.dist};this.dataPoints.sort(f);var l=this.xBarWidth/2,c=this.yBarWidth/2;for(e=0;e<this.dataPoints.length;e++){var h,p,d,v=this.dataPoints[e];this.style===Graph3d.STYLE.BARCOLOR?(h=240*(1-(v.point.value-this.valueMin)*this.scale.value),p=this._hsv2rgb(h,1,1),d=this._hsv2rgb(h,1,.8)):this.style===Graph3d.STYLE.BARSIZE?(p=this.colorDot,d=this.colorDotBorder):(h=240*(1-(v.point.z-this.zMin)*this.scale.z/this.verticalRatio),p=this._hsv2rgb(h,1,1),d=this._hsv2rgb(h,1,.8)),this.style===Graph3d.STYLE.BARSIZE&&(l=this.xBarWidth/2*((v.point.value-this.valueMin)/(this.valueMax-this.valueMin)*.8+.2),c=this.yBarWidth/2*((v.point.value-this.valueMin)/(this.valueMax-this.valueMin)*.8+.2));var m=this,g=v.point,y=[{point:new Point3d(g.x-l,g.y-c,g.z)},{point:new Point3d(g.x+l,g.y-c,g.z)},{point:new Point3d(g.x+l,g.y+c,g.z)},{point:new Point3d(g.x-l,g.y+c,g.z)}],b=[{point:new Point3d(g.x-l,g.y-c,this.zMin)},{point:new Point3d(g.x+l,g.y-c,this.zMin)},{point:new Point3d(g.x+l,g.y+c,this.zMin)},{point:new Point3d(g.x-l,g.y+c,this.zMin)}];y.forEach(function(e){e.screen=m._convert3Dto2D(e.point)}),b.forEach(function(e){e.screen=m._convert3Dto2D(e.point)});var w=[{corners:y,center:Point3d.avg(b[0].point,b[2].point)},{corners:[y[0],y[1],b[1],b[0]],center:Point3d.avg(b[1].point,b[0].point)},{corners:[y[1],y[2],b[2],b[1]],center:Point3d.avg(b[2].point,b[1].point)},{corners:[y[2],y[3],b[3],b[2]],center:Point3d.avg(b[3].point,b[2].point)},{corners:[y[3],y[0],b[0],b[3]],center:Point3d.avg(b[0].point,b[3].point)}];for(v.surfaces=w,t=0;t<w.length;t++){n=w[t];var E=this._convertPointToTranslation(n.center);n.dist=this.showPerspective?E.length():-E.z}for(w.sort(function(e,t){var n=t.dist-e.dist;return n?n:e.corners===y?1:t.corners===y?-1:0}),s.lineWidth=1,s.strokeStyle=d,s.fillStyle=p,t=2;t<w.length;t++)n=w[t],r=n.corners,s.beginPath(),s.moveTo(r[3].screen.x,r[3].screen.y),s.lineTo(r[0].screen.x,r[0].screen.y),s.lineTo(r[1].screen.x,r[1].screen.y),s.lineTo(r[2].screen.x,r[2].screen.y),s.lineTo(r[3].screen.x,r[3].screen.y),s.fill(),s.stroke()}}},Graph3d.prototype._redrawDataLine=function(){var e,t,n=this.frame.canvas,r=n.getContext("2d");if(!(void 0===this.dataPoints||this.dataPoints.length<=0)){for(t=0;t<this.dataPoints.length;t++){var i=this._convertPointToTranslation(this.dataPoints[t].point),s=this._convertTranslationToScreen(i);this.dataPoints[t].trans=i,this.dataPoints[t].screen=s}for(this.dataPoints.length>0&&(e=this.dataPoints[0],r.lineWidth=1,r.strokeStyle="blue",r.beginPath(),r.moveTo(e.screen.x,e.screen.y)),t=1;t<this.dataPoints.length;t++)e=this.dataPoints[t],r.lineTo(e.screen.x,e.screen.y);this.dataPoints.length>0&&r.stroke()}},Graph3d.prototype._onMouseDown=function(e){if(e=e||window.event,this.leftButtonDown&&this._onMouseUp(e),this.leftButtonDown=e.which?1===e.which:1===e.button,this.leftButtonDown||this.touchDown){this.startMouseX=getMouseX(e),this.startMouseY=getMouseY(e),this.startStart=new Date(this.start),this.startEnd=new Date(this.end),this.startArmRotation=this.camera.getArmRotation(),this.frame.style.cursor="move";var t=this;this.onmousemove=function(e){t._onMouseMove(e)},this.onmouseup=function(e){t._onMouseUp(e)},G3DaddEventListener(document,"mousemove",t.onmousemove),G3DaddEventListener(document,"mouseup",t.onmouseup),G3DpreventDefault(e)}},Graph3d.prototype._onMouseMove=function(e){e=e||window.event;var t=parseFloat(getMouseX(e))-this.startMouseX,n=parseFloat(getMouseY(e))-this.startMouseY,r=this.startArmRotation.horizontal+t/200,i=this.startArmRotation.vertical+n/200,s=4,o=Math.sin(s/360*2*Math.PI);Math.abs(Math.sin(r))<o&&(r=Math.round(r/Math.PI)*Math.PI-.001),Math.abs(Math.cos(r))<o&&(r=(Math.round(r/Math.PI-.5)+.5)*Math.PI-.001),Math.abs(Math.sin(i))<o&&(i=Math.round(i/Math.PI)*Math.PI),Math.abs(Math.cos(i))<o&&(i=(Math.round(i/Math.PI-.5)+.5)*Math.PI),this.camera.setArmRotation(r,i),this.redraw();var u=this.getCameraPosition();this.emit("cameraPositionChange",u),G3DpreventDefault(e)},Graph3d.prototype._onMouseUp=function(e){this.frame.style.cursor="auto",this.leftButtonDown=!1,G3DremoveEventListener(document,"mousemove",this.onmousemove),G3DremoveEventListener(document,"mouseup",this.onmouseup),G3DpreventDefault(e)},Graph3d.prototype._onTooltip=function(e){var t=300,n=getMouseX(e)-getAbsoluteLeft(this.frame),r=getMouseY(e)-getAbsoluteTop(this.frame);if(this.showTooltip){if(this.tooltipTimeout&&clearTimeout(this.tooltipTimeout),this.leftButtonDown)return void this._hideTooltip();if(this.tooltip&&this.tooltip.dataPoint){var i=this._dataPointFromXY(n,r);i!==this.tooltip.dataPoint&&(i?this._showTooltip(i):this._hideTooltip())}else{var s=this;this.tooltipTimeout=setTimeout(function(){s.tooltipTimeout=null;var e=s._dataPointFromXY(n,r);e&&s._showTooltip(e)},t)}}},Graph3d.prototype._onTouchStart=function(e){this.touchDown=!0;var t=this;this.ontouchmove=function(e){t._onTouchMove(e)},this.ontouchend=function(e){t._onTouchEnd(e)},G3DaddEventListener(document,"touchmove",t.ontouchmove),G3DaddEventListener(document,"touchend",t.ontouchend),this._onMouseDown(e)},Graph3d.prototype._onTouchMove=function(e){this._onMouseMove(e)},Graph3d.prototype._onTouchEnd=function(e){this.touchDown=!1,G3DremoveEventListener(document,"touchmove",this.ontouchmove),G3DremoveEventListener(document,"touchend",this.ontouchend),this._onMouseUp(e)},Graph3d.prototype._onWheel=function(e){e||(e=window.event);var t=0;if(e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t){var n=this.camera.getArmLength(),r=n*(1-t/10);this.camera.setArmLength(r),this.redraw(),this._hideTooltip()}var i=this.getCameraPosition();this.emit("cameraPositionChange",i),G3DpreventDefault(e)},Graph3d.prototype._insideTriangle=function(e,t){function n(e){return e>0?1:0>e?-1:0}var r=t[0],i=t[1],s=t[2],o=n((i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x)),u=n((s.x-i.x)*(e.y-i.y)-(s.y-i.y)*(e.x-i.x)),a=n((r.x-s.x)*(e.y-s.y)-(r.y-s.y)*(e.x-s.x));return!(0!=o&&0!=u&&o!=u||0!=u&&0!=a&&u!=a||0!=o&&0!=a&&o!=a)},Graph3d.prototype._dataPointFromXY=function(e,t){var n,r=100,i=null,s=null,o=null,u=new Point2d(e,t);if(this.style===Graph3d.STYLE.BAR||this.style===Graph3d.STYLE.BARCOLOR||this.style===Graph3d.STYLE.BARSIZE)for(n=this.dataPoints.length-1;n>=0;n--){i=this.dataPoints[n];var a=i.surfaces;if(a)for(var f=a.length-1;f>=0;f--){var l=a[f],c=l.corners,h=[c[0].screen,c[1].screen,c[2].screen],p=[c[2].screen,c[3].screen,c[0].screen];if(this._insideTriangle(u,h)||this._insideTriangle(u,p))return i}}else for(n=0;n<this.dataPoints.length;n++){i=this.dataPoints[n];var d=i.screen;if(d){var v=Math.abs(e-d.x),m=Math.abs(t-d.y),g=Math.sqrt(v*v+m*m);(null===o||o>g)&&r>g&&(o=g,s=i)}}return s},Graph3d.prototype._showTooltip=function(e){var t,n,r;this.tooltip?(t=this.tooltip.dom.content,n=this.tooltip.dom.line,r=this.tooltip.dom.dot):(t=document.createElement("div"),t.style.position="absolute",t.style.padding="10px",t.style.border="1px solid #4d4d4d",t.style.color="#1a1a1a",t.style.background="rgba(255,255,255,0.7)",t.style.borderRadius="2px",t.style.boxShadow="5px 5px 10px rgba(128,128,128,0.5)",n=document.createElement("div"),n.style.position="absolute",n.style.height="40px",n.style.width="0",n.style.borderLeft="1px solid #4d4d4d",r=document.createElement("div"),r.style.position="absolute",r.style.height="0",r.style.width="0",r.style.border="5px solid #4d4d4d",r.style.borderRadius="5px",this.tooltip={dataPoint:null,dom:{content:t,line:n,dot:r}}),this._hideTooltip(),this.tooltip.dataPoint=e,t.innerHTML="function"==typeof this.showTooltip?this.showTooltip(e.point):"<table><tr><td>x:</td><td>"+e.point.x+"</td></tr><tr><td>y:</td><td>"+e.point.y+"</td></tr><tr><td>z:</td><td>"+e.point.z+"</td></tr></table>",t.style.left="0",t.style.top="0",this.frame.appendChild(t),this.frame.appendChild(n),this.frame.appendChild(r);var i=t.offsetWidth,s=t.offsetHeight,o=n.offsetHeight,u=r.offsetWidth,a=r.offsetHeight,f=e.screen.x-i/2;f=Math.min(Math.max(f,10),this.frame.clientWidth-10-i),n.style.left=e.screen.x+"px",n.style.top=e.screen.y-o+"px",t.style.left=f+"px",t.style.top=e.screen.y-o-s+"px",r.style.left=e.screen.x-u/2+"px",r.style.top=e.screen.y-a/2+"px"},Graph3d.prototype._hideTooltip=function(){if(this.tooltip){this.tooltip.dataPoint=null;for(var e in this.tooltip.dom)if(this.tooltip.dom.hasOwnProperty(e)){var t=this.tooltip.dom[e];t&&t.parentNode&&t.parentNode.removeChild(t)}}},G3DaddEventListener=function(e,t,n,r){e.addEventListener?(void 0===r&&(r=!1),"mousewheel"===t&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.addEventListener(t,n,r)):e.attachEvent("on"+t,n)},G3DremoveEventListener=function(e,t,n,r){e.removeEventListener?(void 0===r&&(r=!1),"mousewheel"===t&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.removeEventListener(t,n,r)):e.detachEvent("on"+t,n)},G3DstopPropagation=function(e){e||(e=window.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},G3DpreventDefault=function(e){e||(e=window.event),e.preventDefault?e.preventDefault():e.returnValue=!1},Point3d.subtract=function(e,t){var n=new Point3d;return n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n},Point3d.add=function(e,t){var n=new Point3d;return n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n},Point3d.avg=function(e,t){return new Point3d((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)},Point3d.crossProduct=function(e,t){var n=new Point3d;return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n},Point3d.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Point2d=function(e,t){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0},Filter.prototype.isLoaded=function(){return this.loaded},Filter.prototype.getLoadedProgress=function(){for(var e=this.values.length,t=0;this.dataPoints[t];)t++;return Math.round(t/e*100)},Filter.prototype.getLabel=function(){return this.graph.filterLabel},Filter.prototype.getColumn=function(){return this.column},Filter.prototype.getSelectedValue=function(){return void 0===this.index?void 0:this.values[this.index]},Filter.prototype.getValues=function(){return this.values},Filter.prototype.getValue=function(e){if(e>=this.values.length)throw"Error: index out of range";return this.values[e]},Filter.prototype._getDataPoints=function(e){if(void 0===e&&(e=this.index),void 0===e)return[];var t;if(this.dataPoints[e])t=this.dataPoints[e];else{var n={};n.column=this.column,n.value=this.values[e];var r=(new DataView(this.data,{filter:function(e){return e[n.column]==n.value}})).get();t=this.graph._getDataPoints(r),this.dataPoints[e]=t}return t},Filter.prototype.setOnLoadCallback=function(e){this.onLoadCallback=e},Filter.prototype.selectValue=function(e){if(e>=this.values.length)throw"Error: index out of range";this.index=e,this.value=this.values[e]},Filter.prototype.loadInBackground=function(e){void 0===e&&(e=0);var t=this.graph.frame;if(e<this.values.length){this._getDataPoints(e),void 0===t.progress&&(t.progress=document.createElement("DIV"),t.progress.style.position="absolute",t.progress.style.color="gray",t.appendChild(t.progress));var n=this.getLoadedProgress();t.progress.innerHTML="Loading animation... "+n+"%",t.progress.style.bottom=Graph3d.px(60),t.progress.style.left=Graph3d.px(10);var r=this;setTimeout(function(){r.loadInBackground(e+1)},10),this.loaded=!1}else this.loaded=!0,void 0!==t.progress&&(t.removeChild(t.progress),t.progress=void 0),this.onLoadCallback&&this.onLoadCallback()},StepNumber=function(e,t,n,r){this._start=0,this._end=0,this._step=1,this.prettyStep=!0,this.precision=5,this._current=0,this.setRange(e,t,n,r)},StepNumber.prototype.setRange=function(e,t,n,r){this._start=e?e:0,this._end=t?t:0,this.setStep(n,r)},StepNumber.prototype.setStep=function(e,t){void 0===e||0>=e||(void 0!==t&&(this.prettyStep=t),this._step=this.prettyStep===!0?StepNumber.calculatePrettyStep(e):e)},StepNumber.calculatePrettyStep=function(e){var t=function(e){return Math.log(e)/Math.LN10},n=Math.pow(10,Math.round(t(e))),r=2*Math.pow(10,Math.round(t(e/2))),i=5*Math.pow(10,Math.round(t(e/5))),s=n;return Math.abs(r-e)<=Math.abs(s-e)&&(s=r),Math.abs(i-e)<=Math.abs(s-e)&&(s=i),0>=s&&(s=1),s},StepNumber.prototype.getCurrent=function(){return parseFloat(this._current.toPrecision(this.precision))},StepNumber.prototype.getStep=function(){return this._step},StepNumber.prototype.start=function(){this._current=this._start-this._start%this._step},StepNumber.prototype.next=function(){this._current+=this._step},StepNumber.prototype.end=function(){return this._current>this._end},Slider.prototype.prev=function(){var e=this.getIndex();e>0&&(e--,this.setIndex(e))},Slider.prototype.next=function(){var e=this.getIndex();e<this.values.length-1&&(e++,this.setIndex(e))},Slider.prototype.playNext=function(){var e=new Date,t=this.getIndex();t<this.values.length-1?(t++,this.setIndex(t)):this.playLoop&&(t=0,this.setIndex(t));var n=new Date,r=n-e,i=Math.max(this.playInterval-r,0),s=this;this.playTimeout=setTimeout(function(){s.playNext()},i)},Slider.prototype.togglePlay=function(){void 0===this.playTimeout?this.play():this.stop()},Slider.prototype.play=function(){this.playTimeout||(this.playNext(),this.frame&&(this.frame.play.value="Stop"))},Slider.prototype.stop=function(){clearInterval(this.playTimeout),this.playTimeout=void 0,this.frame&&(this.frame.play.value="Play")},Slider.prototype.setOnChangeCallback=function(e){this.onChangeCallback=e},Slider.prototype.setPlayInterval=function(e){this.playInterval=e},Slider.prototype.getPlayInterval=function(){return this.playInterval},Slider.prototype.setPlayLoop=function(e){this.playLoop=e},Slider.prototype.onChange=function(){void 0!==this.onChangeCallback&&this.onChangeCallback()},Slider.prototype.redraw=function(){if(this.frame){this.frame.bar.style.top=this.frame.clientHeight/2-this.frame.bar.offsetHeight/2+"px",this.frame.bar.style.width=this.frame.clientWidth-this.frame.prev.clientWidth-this.frame.play.clientWidth-this.frame.next.clientWidth-30+"px";var e=this.indexToLeft(this.index);this.frame.slide.style.left=e+"px"}},Slider.prototype.setValues=function(e){this.values=e,this.values.length>0?this.setIndex(0):this.index=void 0},Slider.prototype.setIndex=function(e){if(!(e<this.values.length))throw"Error: index out of range";this.index=e,this.redraw(),this.onChange()},Slider.prototype.getIndex=function(){return this.index},Slider.prototype.get=function(){return this.values[this.index]},Slider.prototype._onMouseDown=function(e){var t=e.which?1===e.which:1===e.button;if(t){this.startClientX=e.clientX,this.startSlideX=parseFloat(this.frame.slide.style.left),this.frame.style.cursor="move";var n=this;this.onmousemove=function(e){n._onMouseMove(e)},this.onmouseup=function(e){n._onMouseUp(e)},G3DaddEventListener(document,"mousemove",this.onmousemove),G3DaddEventListener(document,"mouseup",this.onmouseup),G3DpreventDefault(e)}},Slider.prototype.leftToIndex=function(e){var t=parseFloat(this.frame.bar.style.width)-this.frame.slide.clientWidth-10,n=e-3,r=Math.round(n/t*(this.values.length-1));return 0>r&&(r=0),r>this.values.length-1&&(r=this.values.length-1),r},Slider.prototype.indexToLeft=function(e){var t=parseFloat(this.frame.bar.style.width)-this.frame.slide.clientWidth-10,n=e/(this.values.length-1)*t,r=n+3;return r},Slider.prototype._onMouseMove=function(e){var t=e.clientX-this.startClientX,n=this.startSlideX+t,r=this.leftToIndex(n);this.setIndex(r),G3DpreventDefault()},Slider.prototype._onMouseUp=function(){this.frame.style.cursor="auto",G3DremoveEventListener(document,"mousemove",this.onmousemove),G3DremoveEventListener(document,"mouseup",this.onmouseup),G3DpreventDefault()},getAbsoluteLeft=function(e){for(var t=0;null!==e;)t+=e.offsetLeft,t-=e.scrollLeft,e=e.offsetParent;return t},getAbsoluteTop=function(e){for(var t=0;null!==e;)t+=e.offsetTop,t-=e.scrollTop,e=e.offsetParent;return t},getMouseX=function(e){return"clientX"in e?e.clientX:e.targetTouches[0]&&e.targetTouches[0].clientX||0},getMouseY=function(e){return"clientY"in e?e.clientY:e.targetTouches[0]&&e.targetTouches[0].clientY||0};var vis={util:util,moment:moment,DataSet:DataSet,DataView:DataView,Range:Range,stack:stack,TimeStep:TimeStep,components:{items:{Item:Item,ItemBox:ItemBox,ItemPoint:ItemPoint,ItemRange:ItemRange},Component:Component,ItemSet:ItemSet,TimeAxis:TimeAxis},graph:{Node:Node,Edge:Edge,Popup:Popup,Groups:Groups,Images:Images},Timeline:Timeline,Graph:Graph,Graph3d:Graph3d};"undefined"!=typeof exports&&(exports=vis),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=vis),"function"==typeof define&&define(function(){return vis}),"undefined"!=typeof window&&(window.vis=vis)},{"emitter-component":2,hammerjs:3,moment:4,mousetrap:5}],2:[function(e,t){function n(e){return e?r(e):void 0}function r(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){function n(){r.off(e,n),t.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var r=0,i=n.length;i>r;++r)n[r].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],3:[function(e,t){!function(e,n){"use strict";function r(){if(!i.READY){i.event.determineEventTypes();for(var e in i.gestures)i.gestures.hasOwnProperty(e)&&i.detection.register(i.gestures[e]);i.event.onTouch(i.DOCUMENT,i.EVENT_MOVE,i.detection.detect),i.event.onTouch(i.DOCUMENT,i.EVENT_END,i.detection.detect),i.READY=!0}}var i=function(e,t){return new i.Instance(e,t||{})};i.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in e,i.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&navigator.userAgent.match(i.MOBILE_REGEX),i.EVENT_TYPES={},i.DIRECTION_DOWN="down",i.DIRECTION_LEFT="left",i.DIRECTION_UP="up",i.DIRECTION_RIGHT="right",i.POINTER_MOUSE="mouse",i.POINTER_TOUCH="touch",i.POINTER_PEN="pen",i.EVENT_START="start",i.EVENT_MOVE="move",i.EVENT_END="end",i.DOCUMENT=document,i.plugins={},i.READY=!1,i.Instance=function(e,t){var n=this;return r(),this.element=e,this.enabled=!0,this.options=i.utils.extend(i.utils.extend({},i.defaults),t||{}),this.options.stop_browser_behavior&&i.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),i.event.onTouch(e,i.EVENT_START,function(e){n.enabled&&i.detection.startDetect(n,e)}),this},i.Instance.prototype={on:function(e,t){for(var n=e.split(" "),r=0;r<n.length;r++)this.element.addEventListener(n[r],t,!1);return this},off:function(e,t){for(var n=e.split(" "),r=0;r<n.length;r++)this.element.removeEventListener(n[r],t,!1);return this},trigger:function(e,t){var n=i.DOCUMENT.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t;var r=this.element;return i.utils.hasParent(t.target,r)&&(r=t.target),r.dispatchEvent(n),this},enable:function(e){return this.enabled=e,this}};var s=null,o=!1,u=!1;i.event={bindDom:function(e,t,n){for(var r=t.split(" "),i=0;i<r.length;i++)e.addEventListener(r[i],n,!1)},onTouch:function(e,t,n){var r=this;this.bindDom(e,i.EVENT_TYPES[t],function(f){var l=f.type.toLowerCase();if(!l.match(/mouse/)||!u){(l.match(/touch/)||l.match(/pointerdown/)||l.match(/mouse/)&&1===f.which)&&(o=!0),l.match(/touch|pointer/)&&(u=!0);var c=0;o&&(i.HAS_POINTEREVENTS&&t!=i.EVENT_END?c=i.PointerEvent.updatePointer(t,f):l.match(/touch/)?c=f.touches.length:u||(c=l.match(/up/)?0:1),c>0&&t==i.EVENT_END?t=i.EVENT_MOVE:c||(t=i.EVENT_END),c||null===s?s=f:f=s,n.call(i.detection,r.collectEventData(e,t,f)),i.HAS_POINTEREVENTS&&t==i.EVENT_END&&(c=i.PointerEvent.updatePointer(t,f))),c||(s=null,o=!1,u=!1,i.PointerEvent.reset())}})},determineEventTypes:function(){var e;e=i.HAS_POINTEREVENTS?i.PointerEvent.getEvents():i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],i.EVENT_TYPES[i.EVENT_START]=e[0],i.EVENT_TYPES[i.EVENT_MOVE]=e[1],i.EVENT_TYPES[i.EVENT_END]=e[2]},getTouchList:function(e){return i.HAS_POINTEREVENTS?i.PointerEvent.getTouchList():e.touches?e.touches:[{identifier:1,pageX:e.pageX,pageY:e.pageY,target:e.target}]},collectEventData:function(e,t,n){var r=this.getTouchList(n,t),s=i.POINTER_TOUCH;return(n.type.match(/mouse/)||i.PointerEvent.matchType(i.POINTER_MOUSE,n))&&(s=i.POINTER_MOUSE),{center:i.utils.getCenter(r),timeStamp:(new Date).getTime(),target:n.target,touches:r,eventType:t,pointerType:s,srcEvent:n,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return i.detection.stopDetect()}}}},i.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return Object.keys(e.pointers).sort().forEach(function(n){t.push(e.pointers[n])}),t},updatePointer:function(e,t){return e==i.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var n={};return n[i.POINTER_MOUSE]=t.pointerType==t.MSPOINTER_TYPE_MOUSE||t.pointerType==i.POINTER_MOUSE,n[i.POINTER_TOUCH]=t.pointerType==t.MSPOINTER_TYPE_TOUCH||t.pointerType==i.POINTER_TOUCH,n[i.POINTER_PEN]=t.pointerType==t.MSPOINTER_TYPE_PEN||t.pointerType==i.POINTER_PEN,n[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},i.utils={extend:function(e,t,r){for(var i in t)e[i]!==n&&r||(e[i]=t[i]);return e},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){for(var t=[],n=[],r=0,i=e.length;i>r;r++)t.push(e[r].pageX),n.push(e[r].pageY);return{pageX:(Math.min.apply(Math,t)+Math.max.apply(Math,t))/2,pageY:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2}},getVelocity:function(e,t,n){return{x:Math.abs(t/e)||0,y:Math.abs(n/e)||0}},getAngle:function(e,t){var n=t.pageY-e.pageY,r=t.pageX-e.pageX;return 180*Math.atan2(n,r)/Math.PI},getDirection:function(e,t){var n=Math.abs(e.pageX-t.pageX),r=Math.abs(e.pageY-t.pageY);return n>=r?e.pageX-t.pageX>0?i.DIRECTION_LEFT:i.DIRECTION_RIGHT:e.pageY-t.pageY>0?i.DIRECTION_UP:i.DIRECTION_DOWN},getDistance:function(e,t){var n=t.pageX-e.pageX,r=t.pageY-e.pageY;return Math.sqrt(n*n+r*r)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==i.DIRECTION_UP||e==i.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(e,t){var n,r=["webkit","khtml","moz","ms","o",""];if(t&&e.style){for(var i=0;i<r.length;i++)for(var s in t)t.hasOwnProperty(s)&&(n=s,r[i]&&(n=r[i]+n.substring(0,1).toUpperCase()+n.substring(1)),e.style[n]=t[s]);"none"==t.userSelect&&(e.onselectstart=function(){return!1})}}},i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:i.utils.extend({},t),lastEvent:!1,name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);for(var t=this.current.inst.options,n=0,r=this.gestures.length;r>n;n++){var s=this.gestures[n];if(!this.stopped&&t[s.name]!==!1&&s.handler.call(s,e,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=e),e.eventType==i.EVENT_END&&!e.touches.length-1&&this.stopDetect(),e}},stopDetect:function(){this.previous=i.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(e){var t=this.current.startEvent;if(t&&(e.touches.length!=t.touches.length||e.touches===t.touches)){t.touches=[];for(var n=0,r=e.touches.length;r>n;n++)t.touches.push(i.utils.extend({},e.touches[n]))}var s=e.timeStamp-t.timeStamp,o=e.center.pageX-t.center.pageX,u=e.center.pageY-t.center.pageY,a=i.utils.getVelocity(s,o,u);return i.utils.extend(e,{deltaTime:s,deltaX:o,deltaY:u,velocityX:a.x,velocityY:a.y,distance:i.utils.getDistance(t.center,e.center),angle:i.utils.getAngle(t.center,e.center),direction:i.utils.getDirection(t.center,e.center),scale:i.utils.getScale(t.touches,e.touches),rotation:i.utils.getRotation(t.touches,e.touches),startEvent:t}),e},register:function(e){var t=e.defaults||{};return t[e.name]===n&&(t[e.name]=!0),i.utils.extend(i.defaults,t,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},i.gestures=i.gestures||{},i.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(e,t){switch(e.eventType){case i.EVENT_START:clearTimeout(this.timer),i.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==i.detection.current.name&&t.trigger("hold",e)},t.options.hold_timeout);break;case i.EVENT_MOVE:e.distance>t.options.hold_threshold&&clearTimeout(this.timer);break;case i.EVENT_END:clearTimeout(this.timer)}}},i.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(e,t){if(e.eventType==i.EVENT_END){var n=i.detection.previous,r=!1;if(e.deltaTime>t.options.tap_max_touchtime||e.distance>t.options.tap_max_distance)return;n&&"tap"==n.name&&e.timeStamp-n.lastEvent.timeStamp<t.options.doubletap_interval&&e.distance<t.options.doubletap_distance&&(t.trigger("doubletap",e),r=!0),(!r||t.options.tap_always)&&(i.detection.current.name="tap",t.trigger(i.detection.current.name,e))}}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(e,t){if(e.eventType==i.EVENT_END){if(t.options.swipe_max_touches>0&&e.touches.length>t.options.swipe_max_touches)return;(e.velocityX>t.options.swipe_velocity||e.velocityY>t.options.swipe_velocity)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},i.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(e,t){if(i.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+"end",e),void (this.triggered=!1);if(!(t.options.drag_max_touches>0&&e.touches.length>t.options.drag_max_touches))switch(e.eventType){case i.EVENT_START:this.triggered=!1;break;case i.EVENT_MOVE:if(e.distance<t.options.drag_min_distance&&i.detection.current.name!=this.name)return;i.detection.current.name=this.name,(i.detection.current.lastEvent.drag_locked_to_axis||t.options.drag_lock_to_axis&&t.options.drag_lock_min_distance<=e.distance)&&(e.drag_locked_to_axis=!0);var n=i.detection.current.lastEvent.direction;e.drag_locked_to_axis&&n!==e.direction&&(e.direction=i.utils.isVertical(n)?e.deltaY<0?i.DIRECTION_UP:i.DIRECTION_DOWN:e.deltaX<0?i.DIRECTION_LEFT:i.DIRECTION_RIGHT),this.triggered||(t.trigger(this.name+"start",e),this.triggered=!0),t.trigger(this.name,e),t.trigger(this.name+e.direction,e),(t.options.drag_block_vertical&&i.utils.isVertical(e.direction)||t.options.drag_block_horizontal&&!i.utils.isVertical(e.direction))&&e.preventDefault();break;case i.EVENT_END:this.triggered&&t.trigger(this.name+"end",e),this.triggered=!1}}},i.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(e,t){if(i.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+"end",e),void (this.triggered=!1);if(!(e.touches.length<2))switch(t.options.transform_always_block&&e.preventDefault(),e.eventType){case i.EVENT_START:this.triggered=!1;break;case i.EVENT_MOVE:var n=Math.abs(1-e.scale),r=Math.abs(e.rotation);if(n<t.options.transform_min_scale&&r<t.options.transform_min_rotation)return;i.detection.current.name=this.name,this.triggered||(t.trigger(this.name+"start",e),this.triggered=!0),t.trigger(this.name,e),r>t.options.transform_min_rotation&&t.trigger("rotate",e),n>t.options.transform_min_scale&&(t.trigger("pinch",e),t.trigger("pinch"+(e.scale<1?"in":"out"),e));break;case i.EVENT_END:this.triggered&&t.trigger(this.name+"end",e),this.triggered=!1}}},i.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(e,t){return t.options.prevent_mouseevents&&e.pointerType==i.POINTER_MOUSE?void e.stopDetect():(t.options.prevent_default&&e.preventDefault(),void (e.eventType==i.EVENT_START&&t.trigger(this.name,e)))}},i.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==i.EVENT_END&&t.trigger(this.name,e)}},"object"==typeof t&&"object"==typeof t.exports?t.exports=i:(e.Hammer=i,"function"==typeof e.define&&e.define.amd&&e.define("hammer",[],function(){return i}))}(this)},{}],4:[function(e,t){var n="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(r){function s(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function o(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function u(e,t){function n(){mt.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}var r=!0;return p(function(){return r&&(n(),r=!1),t.apply(this,arguments)},t)}function a(e,t){return function(n){return m(e.call(this,n),t)}}function f(e,t){return function(n){return this.lang().ordinal(e.call(this,n),t)}}function l(){}function c(e){A(e),p(this,e)}function h(e){var t=S(e),n=t.year||0,r=t.quarter||0,i=t.month||0,s=t.week||0,o=t.day||0,u=t.hour||0,a=t.minute||0,f=t.second||0,l=t.millisecond||0;this._milliseconds=+l+1e3*f+6e4*a+36e5*u,this._days=+o+7*s,this._months=+i+3*r+12*n,this._data={},this._bubble()}function p(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return t.hasOwnProperty("toString")&&(e.toString=t.toString),t.hasOwnProperty("valueOf")&&(e.valueOf=t.valueOf),e}function d(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&Ot.hasOwnProperty(t)&&(n[t]=e[t]);return n}function v(e){return 0>e?Math.ceil(e):Math.floor(e)}function m(e,t,n){for(var r=""+Math.abs(e),i=e>=0;r.length<t;)r="0"+r;return(i?n?"+":"":"-")+r}function g(e,t,n,r){var i=t._milliseconds,s=t._days,o=t._months;r=null==r?!0:r,i&&e._d.setTime(+e._d+i*n),s&&ct(e,"Date",lt(e,"Date")+s*n),o&&ft(e,lt(e,"Month")+o*n),r&&mt.updateOffset(e,s||o)}function y(e){return"[object Array]"===Object.prototype.toString.call(e)}function b(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function w(e,t,n){var r,i=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),o=0;for(r=0;i>r;r++)(n&&e[r]!==t[r]||!n&&T(e[r])!==T(t[r]))&&o++;return o+s}function E(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=on[e]||un[t]||t}return e}function S(e){var t,n,r={};for(n in e)e.hasOwnProperty(n)&&(t=E(n),t&&(r[t]=e[n]));return r}function x(e){var t,n;if(0===e.indexOf("week"))t=7,n="day";else{if(0!==e.indexOf("month"))return;t=12,n="month"}mt[e]=function(s,o){var u,a,f=mt.fn._lang[e],l=[];if("number"==typeof s&&(o=s,s=r),a=function(e){var t=mt().utc().set(n,e);return f.call(mt.fn._lang,t,s||"")},null!=o)return a(o);for(u=0;t>u;u++)l.push(a(u));return l}}function T(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function N(e,t){return(new Date(Date.UTC(e,t+1,0))).getUTCDate()}function C(e,t,n){return st(mt([e,11,31+t-n]),t,n).week}function k(e){return L(e)?366:365}function L(e){return e%4===0&&e%100!==0||e%400===0}function A(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[xt]<0||e._a[xt]>11?xt:e._a[Tt]<1||e._a[Tt]>N(e._a[St],e._a[xt])?Tt:e._a[Nt]<0||e._a[Nt]>23?Nt:e._a[Ct]<0||e._a[Ct]>59?Ct:e._a[kt]<0||e._a[kt]>59?kt:e._a[Lt]<0||e._a[Lt]>999?Lt:-1,e._pf._overflowDayOfYear&&(St>t||t>Tt)&&(t=Tt),e._pf.overflow=t)}function O(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length)),e._isValid}function M(e){return e?e.toLowerCase().replace("_","-"):e}function _(e,t){return t._isUTC?mt(e).zone(t._offset||0):mt(e).local()}function D(e,t){return t.abbr=e,At[e]||(At[e]=new l),At[e].set(t),At[e]}function P(e){delete At[e]}function H(t){var n,r,i,s,o=0,u=function(t){if(!At[t]&&Mt)try{e("./lang/"+t)}catch(n){}return At[t]};if(!t)return mt.fn._lang;if(!y(t)){if(r=u(t))return r;t=[t]}for(;o<t.length;){for(s=M(t[o]).split("-"),n=s.length,i=M(t[o+1]),i=i?i.split("-"):null;n>0;){if(r=u(s.slice(0,n).join("-")))return r;if(i&&i.length>=n&&w(s,i,!0)>=n-1)break;n--}o++}return mt.fn._lang}function B(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function j(e){var t,n,r=e.match(Ht);for(t=0,n=r.length;n>t;t++)r[t]=hn[r[t]]?hn[r[t]]:B(r[t]);return function(s){var o="";for(t=0;n>t;t++)o+=r[t]instanceof Function?r[t].call(s,e):r[t];return o}}function F(e,t){return e.isValid()?(t=I(t,e.lang()),an[t]||(an[t]=j(t)),an[t](e)):e.lang().invalidDate()}function I(e,t){function n(e){return t.longDateFormat(e)||e}var r=5;for(Bt.lastIndex=0;r>=0&&Bt.test(e);)e=e.replace(Bt,n),Bt.lastIndex=0,r-=1;return e}function q(e,t){var n,r=t._strict;switch(e){case"Q":return $t;case"DDDD":return Kt;case"YYYY":case"GGGG":case"gggg":return r?Qt:It;case"Y":case"G":case"g":return Yt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return r?Gt:qt;case"S":if(r)return $t;case"SS":if(r)return Jt;case"SSS":if(r)return Kt;case"DDD":return Ft;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Ut;case"a":case"A":return H(t._l)._meridiemParse;case"X":return Xt;case"Z":case"ZZ":return zt;case"T":return Wt;case"SSSS":return Rt;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return r?Jt:jt;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return jt;case"Do":return Vt;default:return n=new RegExp(K(J(e.replace("\\","")),"i"))}}function R(e){e=e||"";var t=e.match(zt)||[],n=t[t.length-1]||[],r=(n+"").match(rn)||["-",0,0],i=+(60*r[1])+T(r[2]);return"+"===r[0]?-i:i}function U(e,t,n){var r,i=n._a;switch(e){case"Q":null!=t&&(i[xt]=3*(T(t)-1));break;case"M":case"MM":null!=t&&(i[xt]=T(t)-1);break;case"MMM":case"MMMM":r=H(n._l).monthsParse(t),null!=r?i[xt]=r:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(i[Tt]=T(t));break;case"Do":null!=t&&(i[Tt]=T(parseInt(t,10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=T(t));break;case"YY":i[St]=mt.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":i[St]=T(t);break;case"a":case"A":n._isPm=H(n._l).isPM(t);break;case"H":case"HH":case"h":case"hh":i[Nt]=T(t);break;case"m":case"mm":i[Ct]=T(t);break;case"s":case"ss":i[kt]=T(t);break;case"S":case"SS":case"SSS":case"SSSS":i[Lt]=T(1e3*("0."+t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=R(t);break;case"dd":case"ddd":case"dddd":r=H(n._l).weekdaysParse(t),null!=r?(n._w=n._w||{},n._w.d=r):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=T(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=mt.parseTwoDigitYear(t)}}function z(e){var t,n,r,i,o,u,a,f;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(o=1,u=4,n=s(t.GG,e._a[St],st(mt(),1,4).year),r=s(t.W,1),i=s(t.E,1)):(f=H(e._l),o=f._week.dow,u=f._week.doy,n=s(t.gg,e._a[St],st(mt(),o,u).year),r=s(t.w,1),null!=t.d?(i=t.d,o>i&&++r):i=null!=t.e?t.e+o:o),a=ot(n,r,i,u,o),e._a[St]=a.year,e._dayOfYear=a.dayOfYear}function W(e){var t,n,r,i,o=[];if(!e._d){for(r=V(e),e._w&&null==e._a[Tt]&&null==e._a[xt]&&z(e),e._dayOfYear&&(i=s(e._a[St],r[St]),e._dayOfYear>k(i)&&(e._pf._overflowDayOfYear=!0),n=tt(i,0,e._dayOfYear),e._a[xt]=n.getUTCMonth(),e._a[Tt]=n.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=o[t]=r[t];for(;7>t;t++)e._a[t]=o[t]=null==e._a[t]?2===t?1:0:e._a[t];e._d=(e._useUTC?tt:et).apply(null,o),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm)}}function X(e){var t;e._d||(t=S(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],W(e))}function V(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function $(e){if(e._f===mt.ISO_8601)return void G(e);e._a=[],e._pf.empty=!0;var t,n,r,i,s,o=H(e._l),u=""+e._i,a=u.length,f=0;for(r=I(e._f,o).match(Ht)||[],t=0;t<r.length;t++)i=r[t],n=(u.match(q(i,e))||[])[0],n&&(s=u.substr(0,u.indexOf(n)),s.length>0&&e._pf.unusedInput.push(s),u=u.slice(u.indexOf(n)+n.length),f+=n.length),hn[i]?(n?e._pf.empty=!1:e._pf.unusedTokens.push(i),U(i,n,e)):e._strict&&!n&&e._pf.unusedTokens.push(i);e._pf.charsLeftOver=a-f,u.length>0&&e._pf.unusedInput.push(u),e._isPm&&e._a[Nt]<12&&(e._a[Nt]+=12),e._isPm===!1&&12===e._a[Nt]&&(e._a[Nt]=0),W(e),A(e)}function J(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,i){return t||n||r||i})}function K(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(e){var t,n,r,i,s;if(0===e._f.length)return e._pf.invalidFormat=!0,void (e._d=new Date(0/0));for(i=0;i<e._f.length;i++)s=0,t=p({},e),t._pf=o(),t._f=e._f[i],$(t),O(t)&&(s+=t._pf.charsLeftOver,s+=10*t._pf.unusedTokens.length,t._pf.score=s,(null==r||r>s)&&(r=s,n=t));p(e,n||t)}function G(e){var t,n,r=e._i,i=Zt.exec(r);if(i){for(e._pf.iso=!0,t=0,n=tn.length;n>t;t++)if(tn[t][1].exec(r)){e._f=tn[t][0]+(i[6]||" ");break}for(t=0,n=nn.length;n>t;t++)if(nn[t][1].exec(r)){e._f+=nn[t][0];break}r.match(zt)&&(e._f+="Z"),$(e)}else e._isValid=!1}function Y(e){G(e),e._isValid===!1&&(delete e._isValid,mt.createFromInputFallback(e))}function Z(e){var t=e._i,n=_t.exec(t);t===r?e._d=new Date:n?e._d=new Date(+n[1]):"string"==typeof t?Y(e):y(t)?(e._a=t.slice(0),W(e)):b(t)?e._d=new Date(+t):"object"==typeof t?X(e):"number"==typeof t?e._d=new Date(t):mt.createFromInputFallback(e)}function et(e,t,n,r,i,s,o){var u=new Date(e,t,n,r,i,s,o);return 1970>e&&u.setFullYear(e),u}function tt(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function nt(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function rt(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function it(e,t,n){var r=Et(Math.abs(e)/1e3),i=Et(r/60),s=Et(i/60),o=Et(s/24),u=Et(o/365),a=r<fn.s&&["s",r]||1===i&&["m"]||i<fn.m&&["mm",i]||1===s&&["h"]||s<fn.h&&["hh",s]||1===o&&["d"]||o<=fn.dd&&["dd",o]||o<=fn.dm&&["M"]||o<fn.dy&&["MM",Et(o/30)]||1===u&&["y"]||["yy",u];return a[2]=t,a[3]=e>0,a[4]=n,rt.apply({},a)}function st(e,t,n){var r,i=n-t,s=n-e.day();return s>i&&(s-=7),i-7>s&&(s+=7),r=mt(e).add("d",s),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function ot(e,t,n,r,i){var s,o,u=tt(e,0,1).getUTCDay();return u=0===u?7:u,n=null!=n?n:i,s=i-u+(u>r?7:0)-(i>u?7:0),o=7*(t-1)+(n-i)+s+1,{year:o>0?e:e-1,dayOfYear:o>0?o:k(e-1)+o}}function ut(e){var t=e._i,n=e._f;return null===t||n===r&&""===t?mt.invalid({nullInput:!0}):("string"==typeof t&&(e._i=t=H().preparse(t)),mt.isMoment(t)?(e=d(t),e._d=new Date(+t._d)):n?y(n)?Q(e):$(e):Z(e),new c(e))}function at(e,t){var n,r;if(1===t.length&&y(t[0])&&(t=t[0]),!t.length)return mt();for(n=t[0],r=1;r<t.length;++r)t[r][e](n)&&(n=t[r]);return n}function ft(e,t){var n;return"string"==typeof t&&(t=e.lang().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),N(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function lt(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function ct(e,t,n){return"Month"===t?ft(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function ht(e,t){return function(n){return null!=n?(ct(this,e,n),mt.updateOffset(this,t),this):lt(this,e)}}function pt(e){mt.duration.fn[e]=function(){return this._data[e]}}function dt(e,t){mt.duration.fn["as"+e]=function(){return+this/t}}function vt(e){"undefined"==typeof ender&&(gt=wt.moment,wt.moment=e?u("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",mt):mt)}for(var mt,gt,yt,bt="2.7.0",wt="undefined"!=typeof n?n:this,Et=Math.round,St=0,xt=1,Tt=2,Nt=3,Ct=4,kt=5,Lt=6,At={},Ot={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_tzm:null,_isUTC:null,_offset:null,_pf:null,_lang:null},Mt="undefined"!=typeof t&&t.exports,_t=/^\/?Date\((\-?\d+)/i,Dt=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Pt=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Ht=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Bt=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,jt=/\d\d?/,Ft=/\d{1,3}/,It=/\d{1,4}/,qt=/[+\-]?\d{1,6}/,Rt=/\d+/,Ut=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,zt=/Z|[\+\-]\d\d:?\d\d/gi,Wt=/T/i,Xt=/[\+\-]?\d+(\.\d{1,3})?/,Vt=/\d{1,2}/,$t=/\d/,Jt=/\d\d/,Kt=/\d{3}/,Qt=/\d{4}/,Gt=/[+-]?\d{6}/,Yt=/[+-]?\d+/,Zt=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,en="YYYY-MM-DDTHH:mm:ssZ",tn=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],nn=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],rn=/([\+\-]|\d\d)/gi,sn=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),on={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},un={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},an={},fn={s:45,m:45,h:22,dd:25,dm:45,dy:345},ln="DDD w W M D d".split(" "),cn="M D H h m s w W".split(" "),hn={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return m(this.year()%100,2)},YYYY:function(){return m(this.year(),4)},YYYYY:function(){return m(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+m(Math.abs(e),6)},gg:function(){return m(this.weekYear()%100,2)},gggg:function(){return m(this.weekYear(),4)},ggggg:function(){return m(this.weekYear(),5)},GG:function(){return m(this.isoWeekYear()%100,2)},GGGG:function(){return m(this.isoWeekYear(),4)},GGGGG:function(){return m(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return T(this.milliseconds()/100)},SS:function(){return m(T(this.milliseconds()/10),2)},SSS:function(){return m(this.milliseconds(),3)},SSSS:function(){return m(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(T(e/60),2)+":"+m(T(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(T(e/60),2)+m(T(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},pn=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ln.length;)yt=ln.pop(),hn[yt+"o"]=f(hn[yt],yt);for(;cn.length;)yt=cn.pop(),hn[yt+yt]=a(hn[yt],2);for(hn.DDDD=a(hn.DDD,3),p(l.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,n,r;for(this._monthsParse||(this._monthsParse=[]),t=0;12>t;t++)if(this._monthsParse[t]||(n=mt.utc([2e3,t]),r="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[t]=new RegExp(r.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=mt([2e3,1]).day(t),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return"function"==typeof n?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return"function"==typeof i?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return st(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),mt=function(e,t,n,i){var s;return"boolean"==typeof n&&(i=n,n=r),s={},s._isAMomentObject=!0,s._i=e,s._f=t,s._l=n,s._strict=i,s._isUTC=!1,s._pf=o(),ut(s)},mt.suppressDeprecationWarnings=!1,mt.createFromInputFallback=u("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i)}),mt.min=function(){var e=[].slice.call(arguments,0);return at("isBefore",e)},mt.max=function(){var e=[].slice.call(arguments,0);return at("isAfter",e)},mt.utc=function(e,t,n,i){var s;return"boolean"==typeof n&&(i=n,n=r),s={},s._isAMomentObject=!0,s._useUTC=!0,s._isUTC=!0,s._l=n,s._i=e,s._f=t,s._strict=i,s._pf=o(),ut(s).utc()},mt.unix=function(e){return mt(1e3*e)},mt.duration=function(e,t){var n,r,i,s=e,o=null;return mt.isDuration(e)?s={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(s={},t?s[t]=e:s.milliseconds=e):(o=Dt.exec(e))?(n="-"===o[1]?-1:1,s={y:0,d:T(o[Tt])*n,h:T(o[Nt])*n,m:T(o[Ct])*n,s:T(o[kt])*n,ms:T(o[Lt])*n}):(o=Pt.exec(e))&&(n="-"===o[1]?-1:1,i=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*n},s={y:i(o[2]),M:i(o[3]),d:i(o[4]),h:i(o[5]),m:i(o[6]),s:i(o[7]),w:i(o[8])}),r=new h(s),mt.isDuration(e)&&e.hasOwnProperty("_lang")&&(r._lang=e._lang),r},mt.version=bt,mt.defaultFormat=en,mt.ISO_8601=function(){},mt.momentProperties=Ot,mt.updateOffset=function(){},mt.relativeTimeThreshold=function(e,t){return fn[e]===r?!1:(fn[e]=t,!0)},mt.lang=function(e,t){var n;return e?(t?D(M(e),t):null===t?(P(e),e="en"):At[e]||H(e),n=mt.duration.fn._lang=mt.fn._lang=H(e),n._abbr):mt.fn._lang._abbr},mt.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),H(e)},mt.isMoment=function(e){return e instanceof c||null!=e&&e.hasOwnProperty("_isAMomentObject")},mt.isDuration=function(e){return e instanceof h},yt=pn.length-1;yt>=0;--yt)x(pn[yt]);mt.normalizeUnits=function(e){return E(e)},mt.invalid=function(e){var t=mt.utc(0/0);return null!=e?p(t._pf,e):t._pf.userInvalidated=!0,t},mt.parseZone=function(){return mt.apply(null,arguments).parseZone()},mt.parseTwoDigitYear=function(e){return T(e)+(T(e)>68?1900:2e3)},p(mt.fn=c.prototype,{clone:function(){return mt(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=mt(this).utc();return 0<e.year()&&e.year()<=9999?F(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):F(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return O(this)},isDSTShifted:function(){return this._a?this.isValid()&&w(this._a,(this._isUTC?mt.utc(this._a):mt(this._a)).toArray())>0:!1},parsingFlags:function(){return p({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=F(this,e||mt.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var n;return n="string"==typeof e&&"string"==typeof t?mt.duration(isNaN(+t)?+e:+t,isNaN(+t)?t:e):"string"==typeof e?mt.duration(+t,e):mt.duration(e,t),g(this,n,1),this},subtract:function(e,t){var n;return n="string"==typeof e&&"string"==typeof t?mt.duration(isNaN(+t)?+e:+t,isNaN(+t)?t:e):"string"==typeof e?mt.duration(+t,e):mt.duration(e,t),g(this,n,-1),this},diff:function(e,t,n){var r,i,s=_(e,this),o=6e4*(this.zone()-s.zone());return t=E(t),"year"===t||"month"===t?(r=432e5*(this.daysInMonth()+s.daysInMonth()),i=12*(this.year()-s.year())+(this.month()-s.month()),i+=(this-mt(this).startOf("month")-(s-mt(s).startOf("month")))/r,i-=6e4*(this.zone()-mt(this).startOf("month").zone()-(s.zone()-mt(s).startOf("month").zone()))/r,"year"===t&&(i/=12)):(r=this-s,i="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-o)/864e5:"week"===t?(r-o)/6048e5:r),n?i:v(i)},from:function(e,t){return mt.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(mt(),e)},calendar:function(e){var t=e||mt(),n=_(t,this).startOf("day"),r=this.diff(n,"days",!0),i=-6>r?"sameElse":-1>r?"lastWeek":0>r?"lastDay":1>r?"sameDay":2>r?"nextDay":7>r?"nextWeek":"sameElse";return this.format(this.lang().calendar(i,this))},isLeapYear:function(){return L(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=nt(e,this.lang()),this.add({d:e-t})):t},month:ht("Month",!0),startOf:function(e){switch(e=E(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(e){return e=E(e),this.startOf(e).add("isoWeek"===e?"week":e,1).subtract("ms",1)},isAfter:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)>+mt(e).startOf(t)},isBefore:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)<+mt(e).startOf(t)},isSame:function(e,t){return t=t||"ms",+this.clone().startOf(t)===+_(e,this).startOf(t)},min:u("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=mt.apply(null,arguments),this>e?this:e}),max:u("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=mt.apply(null,arguments),e>this?this:e}),zone:function(e,t){var n=this._offset||0;return null==e?this._isUTC?n:this._d.getTimezoneOffset():("string"==typeof e&&(e=R(e)),Math.abs(e)<16&&(e=60*e),this._offset=e,this._isUTC=!0,n!==e&&(!t||this._changeInProgress?g(this,mt.duration(n-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,mt.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?mt(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return N(this.year(),this.month())},dayOfYear:function(e){var t=Et((mt(this).startOf("day")-mt(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=st(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=st(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=st(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return C(this.year(),1,4)},weeksInYear:function(){var e=this._lang._week;return C(this.year(),e.dow,e.doy)},get:function(e){return e=E(e),this[e]()},set:function(e,t){return e=E(e),"function"==typeof this[e]&&this[e](t),this},lang:function(e){return e===r?this._lang:(this._lang=H(e),this)}}),mt.fn.millisecond=mt.fn.milliseconds=ht("Milliseconds",!1),mt.fn.second=mt.fn.seconds=ht("Seconds",!1),mt.fn.minute=mt.fn.minutes=ht("Minutes",!1),mt.fn.hour=mt.fn.hours=ht("Hours",!0),mt.fn.date=ht("Date",!0),mt.fn.dates=u("dates accessor is deprecated. Use date instead.",ht("Date",!0)),mt.fn.year=ht("FullYear",!0),mt.fn.years=u("years accessor is deprecated. Use year instead.",ht("FullYear",!0)),mt.fn.days=mt.fn.day,mt.fn.months=mt.fn.month,mt.fn.weeks=mt.fn.week,mt.fn.isoWeeks=mt.fn.isoWeek,mt.fn.quarters=mt.fn.quarter,mt.fn.toJSON=mt.fn.toISOString,p(mt.duration.fn=h.prototype,{_bubble:function(){var e,t,n,r,i=this._milliseconds,s=this._days,o=this._months,u=this._data;u.milliseconds=i%1e3,e=v(i/1e3),u.seconds=e%60,t=v(e/60),u.minutes=t%60,n=v(t/60),u.hours=n%24,s+=v(n/24),u.days=s%30,o+=v(s/30),u.months=o%12,r=v(o/12),u.years=r},weeks:function(){return v(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*T(this._months/12)},humanize:function(e){var t=+this,n=it(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},add:function(e,t){var n=mt.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=mt.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=E(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=E(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:mt.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),r=Math.abs(this.hours()),i=Math.abs(this.minutes()),s=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(r||i||s?"T":"")+(r?r+"H":"")+(i?i+"M":"")+(s?s+"S":""):"P0D"}});for(yt in sn)sn.hasOwnProperty(yt)&&(dt(yt,sn[yt]),pt(yt.toLowerCase()));dt("Weeks",6048e5),mt.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},mt.lang("en",{ordinal:function(e){var t=e%10,n=1===T(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),Mt?t.exports=mt:"function"==typeof define&&define.amd?(define("moment",function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(wt.moment=gt),mt}),vt(!0)):vt()}).call(this)},{}],5:[function(e,t){function n(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):void e.attachEvent("on"+t,n)}function r(e){return"keypress"==e.type?String.fromCharCode(e.which):E[e.which]?E[e.which]:S[e.which]?S[e.which]:String.fromCharCode(e.which).toLowerCase()}function i(e){var t=e.target||e.srcElement,n=t.tagName;return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==n||"SELECT"==n||"TEXTAREA"==n||t.contentEditable&&"true"==t.contentEditable}function s(e,t){return e.sort().join(",")===t.sort().join(",")}function o(e){e=e||{};var t,n=!1;for(t in k)e[t]?n=!0:k[t]=0;n||(A=!1)}function u(e,t,n,r,i){var o,u,a=[];if(!N[e])return[];for("keyup"==n&&h(e)&&(t=[e]),o=0;o<N[e].length;++o)u=N[e][o],u.seq&&k[u.seq]!=u.level||n==u.action&&("keypress"==n||s(t,u.modifiers))&&(r&&u.combo==i&&N[e].splice(o,1),a.push(u));return a}function a(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function f(e,t){e(t)===!1&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,t.cancelBubble=!0)}function l(e,t){if(!i(t)){var n,r=u(e,a(t),t.type),s={},l=!1;for(n=0;n<r.length;++n)r[n].seq?(l=!0,s[r[n].seq]=1,f(r[n].callback,t)):l||A||f(r[n].callback,t);t.type!=A||h(e)||o(s)}}function c(e){e.which="number"==typeof e.which?e.which:e.keyCode;var t=r(e);if(t)return"keyup"==e.type&&L==t?void (L=!1):void l(t,e)}function h(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function p(){clearTimeout(w),w=setTimeout(o,1e3)}function d(){if(!b){b={};for(var e in E)e>95&&112>e||E.hasOwnProperty(e)&&(b[E[e]]=e)}return b}function v(e,t,n){return n||(n=d()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function m(e,t,n,i){k[e]=0,i||(i=v(t[0],[]));var s,u=function(){A=i,++k[e],p()},a=function(e){f(n,e),"keyup"!==i&&(L=r(e)),setTimeout(o,10)};for(s=0;s<t.length;++s)g(t[s],s<t.length-1?u:a,i,e,s)}function g(e,t,n,r,i){e=e.replace(/\s+/g," ");var s,o,a,f=e.split(" "),l=[];if(f.length>1)return m(e,f,t,n);for(a="+"===e?["+"]:e.split("+"),s=0;s<a.length;++s)o=a[s],T[o]&&(o=T[o]),n&&"keypress"!=n&&x[o]&&(o=x[o],l.push("shift")),h(o)&&l.push(o);n=v(o,l,n),N[o]||(N[o]=[]),u(o,l,n,!r,e),N[o][r?"unshift":"push"]({callback:t,modifiers:l,action:n,seq:r,level:i,combo:e})}function y(e,t,n){for(var r=0;r<e.length;++r)g(e[r],t,n)}for(var b,w,E={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},S={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},x={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},T={option:"alt",command:"meta","return":"enter",escape:"esc"},N={},C={},k={},L=!1,A=!1,O=1;20>O;++O)E[111+O]="f"+O;for(O=0;9>=O;++O)E[O+96]=O;n(document,"keypress",c),n(document,"keydown",c),n(document,"keyup",c);var M={bind:function(e,t,n){return y(e instanceof Array?e:[e],t,n),C[e+":"+n]=t,this},unbind:function(e,t){return C[e+":"+t]&&(delete C[e+":"+t],this.bind(e,function(){},t)),this},trigger:function(e,t){return C[e+":"+t](),this},reset:function(){return N={},C={},this}};t.exports=M},{}]},{},[1])(1)});