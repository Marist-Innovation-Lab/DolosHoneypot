/**
 * ocLazyLoad - Load modules on demand (lazy load) with angularJS
 * @version v0.3.0
 * @link https://github.com/ocombe/ocLazyLoad
 * @license MIT
 * @author Olivier Combe <olivier.combe@gmail.com>
 */

(function(){"use strict";function s(t){var n=[];return angular.forEach(t.requires,function(t){e.indexOf(t)===-1&&n.push(t)}),n}function o(e){try{return angular.module(e)}catch(t){if(/No module/.test(t)||t.message.indexOf("$injector:nomod")>-1)return!1}}function u(e){try{return angular.module(e)}catch(t){if(/No module/.test(t)||t.message.indexOf("$injector:nomod")>-1)t.message='The module "'+e+'" that you are trying to load does not exist. '+t.message;throw t}}function a(e,t){if(!t)return;var n,r,i,s;for(n=0,r=t.length;n<r;n++){i=t[n];if(angular.isArray(i)){if(!e.hasOwnProperty(i[0]))throw new Error("unsupported provider "+i[0]);s=e[i[0]],l(i[2][0])&&s[i[1]].apply(s,i[2])}}}function f(t,n){if(n){var r,s,o,u=[];for(r=n.length-1;r>=0;r--){s=n[r],typeof s!="string"&&(s=c(s));if(!s)continue;o=angular.module(s),e.indexOf(s)===-1&&(e.push(s),f(t,o.requires),u=u.concat(o._runBlocks)),a(t,o._invokeQueue),a(t,o._configBlocks),i("ocLazyLoad.moduleLoaded",s),n.pop()}var l=t.getInstanceInjector();angular.forEach(u,function(e){l.invoke(e)})}}function l(e){var n=!1;if(angular.isString(e))t.indexOf(e)===-1&&(n=!0,t.push(e),i("ocLazyLoad.componentLoaded",e));else{if(!angular.isObject(e))return!0;angular.forEach(e,function(e){angular.isString(e)&&t.indexOf(e)===-1&&(n=!0,t.push(e))})}return n}function c(e){if(e===null)return null;var t=null;return typeof e=="string"?t=e:typeof e=="object"&&e.hasOwnProperty("name")&&typeof e.name=="string"&&(t=e.name),t}function h(t){function u(e){return e&&n.push(e)}var n=[t],r,i,s=["ng:app","ng-app","x-ng-app","data-ng-app"],o=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;angular.forEach(s,function(e){s[e]=!0,u(document.getElementById(e)),e=e.replace(":","\\:"),t.querySelectorAll&&(angular.forEach(t.querySelectorAll("."+e),u),angular.forEach(t.querySelectorAll("."+e+"\\:"),u),angular.forEach(t.querySelectorAll("["+e+"]"),u))}),angular.forEach(n,function(e){if(!r){var n=" "+t.className+" ",u=o.exec(n);u?(r=e,i=(u[2]||"").replace(/\s+/g,",")):angular.forEach(e.attributes,function(t){!r&&s[t.name]&&(r=e,i=t.value)})}}),r&&function a(t){if(e.indexOf(t)===-1){e.push(t);var n=angular.module(t),r=n._invokeQueue,i,s,o;for(i=0,s=r.length;i<s;i++)o=r[i],angular.isArray(o)&&l(o[2][0]);if(angular.isDefined(n._configBlocks)){var r=n._configBlocks,i,s,o;for(i=0,s=r.length;i<s;i++)o=r[i],angular.isArray(o)&&l(o[2][0])}angular.forEach(n.requires,a)}}(i)}var e=["ng"],t=[],n=[],r=angular.module("oc.lazyLoad",["ng"]),i=angular.noop;r.provider("$ocLazyLoad",["$controllerProvider","$provide","$compileProvider","$filterProvider","$injector","$animateProvider",function(t,r,a,l,p,d){var v={},m=[],g={$controllerProvider:t,$compileProvider:a,$filterProvider:l,$provide:r,$injector:p,$animateProvider:d},y=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0],b,w,E,S=!1,x=!1;h(angular.element(window.document)),this.$get=["$timeout","$log","$q","$templateCache","$http","$rootElement","$rootScope",function(t,r,a,l,h,p,d){var T;S||(r={},r.error=angular.noop,r.warn=angular.noop),g.getInstanceInjector=function(){return T?T:T=p.data("$injector")},i=function(t,n){x&&d.$broadcast(t,n)};var N=function(t,r){var s=a.defer(),o,u;switch(t){case"css":o=document.createElement("link"),o.type="text/css",o.rel="stylesheet",o.href=r;break;case"js":o=document.createElement("script"),o.src=r;break;default:s.reject(new Error('Requested type "'+t+'" is not known. Could not inject "'+r+'"'))}return o.onload=o.onreadystatechange=function(e){if(o.readyState&&!/^c|loade/.test(o.readyState)||u)return;o.onload=o.onreadystatechange=null,u=1,n.indexOf(r)===-1&&(n.push(r),i("ocLazyLoad.fileLoaded",r)),s.resolve()},o.onerror=function(e){console.log("error"),s.reject(new Error("Unable to load "+r))},o.async=1,y.insertBefore(o,y.lastChild),s.promise};b=b||function(e,t){var n=[];angular.forEach(e,function(t){n.push(N("js",t))}),a.all(n).then(function(){t()},function(n){t(n)})},w=w||function(e,t){var n=[];angular.forEach(e,function(t){n.push(N("css",t))}),a.all(n).then(function(){t()},function(n){t(n)})},E=E||function(e,t,n){angular.isString(e)&&(e=[e]),angular.isFunction(t)&&(n=t,t={}),angular.isUndefined(t)&&(t={});var i=[];return angular.forEach(e,function(e){var n=a.defer();i.push(n.promise),m.indexOf(e)===-1||angular.isDefined(t)&&t.cache===!1?h.get(e,t).success(function(t){angular.forEach(angular.element(t),function(e){e.nodeName==="SCRIPT"&&e.type==="text/ng-template"&&l.put(e.id,e.innerHTML)}),m.push(e),n.resolve()}).error(function(t){var i='Error load template "'+e+'": '+t;r.error(i),n.reject(new Error(i))}):n.resolve()}),a.all(i).then(function(){n()},function(t){n(t)})};var C=function(e,t){var n=[],i=[],s=[],o=[];angular.forEach(e,function(e){/\.css[^\.]*$/.test(e)?n.push(e):/\.(htm|html)[^\.]*$/.test(e)?i.push(e):s.push(e)});if(n.length>0){var u=a.defer();w(n,function(e){angular.isDefined(e)?(r.error(e),u.reject(e)):u.resolve()}),o.push(u.promise)}if(i.length>0){var f=a.defer();E(i,t,function(e){angular.isDefined(e)?(r.error(e),f.reject(e)):f.resolve()}),o.push(f.promise)}if(s.length>0){var l=a.defer();b(s,function(e){angular.isDefined(e)?(r.error(e),l.reject(e)):l.resolve()}),o.push(l.promise)}return a.all(o)};return{getModuleConfig:function(e){return v[e]?v[e]:null},setModuleConfig:function(e){return v[e.name]=e,e},getModules:function(){return e},loadTemplateFile:function(e,t){return C(e,t)},load:function(n,i){var l=this,h=null,p=[],d=[],v=a.defer(),m,y;if(angular.isArray(n))return angular.forEach(n,function(e){d.push(l.load(e))}),a.all(d).then(function(){v.resolve(n)}),v.promise;m=c(n),typeof n=="string"?(h=l.getModuleConfig(n),h||(h={files:[n]},m=null)):typeof n=="object"&&(h=l.setModuleConfig(n)),h===null?(y='Module "'+m+'" is not configured, cannot load.',r.error(y),v.reject(new Error(y))):angular.isDefined(h.template)&&(angular.isUndefined(h.files)&&(h.files=[]),angular.isString(h.template)?h.files.push(h.template):angular.isArray(h.template)&&h.files.concat(h.template)),p.push=function(e){this.indexOf(e)===-1&&Array.prototype.push.apply(this,arguments)};if(angular.isDefined(m)&&o(m)&&e.indexOf(m)!==-1){p.push(m);if(angular.isUndefined(h.files))return v.resolve(),v.promise}var b=function w(e){var t,n,i,f=[];t=c(e);if(t===null)return a.when();try{n=u(t)}catch(h){var d=a.defer();return r.error(h.message),d.reject(h),d.promise}return i=s(n),angular.forEach(i,function(n){if(typeof n=="string"){var i=l.getModuleConfig(n);if(i===null){p.push(n);return}n=i}if(o(n.name)||p.indexOf(n.name)!==-1){typeof e!="string"&&r.warn('Module "',t,'" attempted to redefine configuration for dependency "',n.name,'"\nExisting:',l.getModuleConfig(n.name),"Ignored:",n);return}typeof n=="object"&&(n.hasOwnProperty("name")&&n.name&&(l.setModuleConfig(n),p.push(n.name)),n.hasOwnProperty("css")&&n.css.length!==0&&angular.forEach(n.css,function(e){N("css",e)})),n.hasOwnProperty("files")&&n.files.length!==0&&n.files&&f.push(C(n.files).then(function(){return w(n)}))}),a.all(f)};return C(h.files).then(function(){m===null?v.resolve(n):(p.push(m),b(m).then(function(){try{f(g,p)}catch(i){r.error(i.message),v.reject(i);return}t(function(){v.resolve(n)})},function(n){t(function(){v.reject(n)})}))},function(t){v.reject(t)}),v.promise}}}],this.config=function(t){b=t.jsLoader||t.asyncLoader;if(angular.isDefined()&&!angular.isFunction(b))throw"The js loader needs to be a function";angular.isDefined(t.cssLoader)&&(w=t.cssLoader),angular.isDefined(t.templatesLoader)&&(E=t.templatesLoader);if(angular.isDefined(t.loadedModules)){var n=function(t){e.indexOf(t)<0&&(e.push(t),angular.forEach(angular.module(t).requires,n))};angular.forEach(t.loadedModules,n)}angular.isDefined(t.modules)&&(angular.isArray(t.modules)?angular.forEach(t.modules,function(e){v[e.name]=e}):v[t.modules.name]=t.modules),angular.isDefined(t.debug)&&(S=t.debug),angular.isDefined(t.events)&&(x=t.events)}}]),r.directive("ocLazyLoad",["$http","$log","$ocLazyLoad","$compile","$timeout","$templateCache","$animate",function(e,t,n,r,i,s,o){return{restrict:"A",terminal:!0,priority:401,transclude:"element",controller:angular.noop,compile:function(r,i){return function(r,i,u,a,f){function p(){l&&(l.$destroy(),l=null),i.html("")}function d(n,r){var i;typeof (i=s.get(n))!="undefined"?r(i):e.get(n).success(function(e){s.put("view:"+n,e),r(e)}).error(function(e){t.error('Error load template "'+n+'": '+e)})}var l,c=r.$eval(u.ocLazyLoad),h=c&&c.onload?c.onload:"";r.$watch(u.ocLazyLoad,function(e){angular.isDefined(e)?n.load(e).then(function(e){f(r,function(t){o.enter(t,null,i)})}):p()},!0)}}}}])})();