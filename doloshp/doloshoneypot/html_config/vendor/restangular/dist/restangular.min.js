/**
 * Restful Resources service for AngularJS apps
 * @version v1.2.1 - 2013-12-13
 * @link https://github.com/mgonto/restangular
 * @author Martin Gontovnikas <martin@gonto.com.ar>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

!function(){var e=angular.module("restangular",[]);e.provider("Restangular",function(){var e={};e.init=function(e,t){function n(e,t,n,r){var i={};return _.each(_.keys(r),function(s){var o=r[s];o.params=_.extend({},o.params,e.defaultRequestParams[o.method.toLowerCase()]),_.isEmpty(o.params)&&delete o.params,i[s]=e.isSafe(o.method)?function(){return t(_.extend(o,{url:n}))}:function(e){return t(_.extend(o,{url:n,data:e}))}}),i}e.configuration=t;var r=["get","head","options","trace","getlist"];t.isSafe=function(e){return _.contains(r,e.toLowerCase())};var i=/^https?:\/\//i;t.isAbsoluteUrl=function(e){return _.isUndefined(t.absoluteUrl)||_.isNull(t.absoluteUrl)?e&&i.test(e):t.absoluteUrl},t.absoluteUrl=_.isUndefined(t.absoluteUrl)?!1:!0,e.setSelfLinkAbsoluteUrl=function(e){t.absoluteUrl=e},t.baseUrl=_.isUndefined(t.baseUrl)?"":t.baseUrl,e.setBaseUrl=function(e){return t.baseUrl=/\/$/.test(e)?e.substring(0,e.length-1):e,this},t.extraFields=t.extraFields||[],e.setExtraFields=function(e){return t.extraFields=e,this},t.defaultHttpFields=t.defaultHttpFields||{},e.setDefaultHttpFields=function(e){return t.defaultHttpFields=e,this},t.withHttpValues=function(e,n){return _.defaults(n,e,t.defaultHttpFields)},t.encodeIds=_.isUndefined(t.encodeIds)?!0:t.encodeIds,e.setEncodeIds=function(e){t.encodeIds=e},t.defaultRequestParams=t.defaultRequestParams||{get:{},post:{},put:{},remove:{},common:{}},e.setDefaultRequestParams=function(e,n){var r=[],i=n||e;return _.isUndefined(n)?r.push("common"):_.isArray(e)?r=e:r.push(e),_.each(r,function(e){t.defaultRequestParams[e]=i}),this},e.requestParams=t.defaultRequestParams,t.defaultHeaders=t.defaultHeaders||{},e.setDefaultHeaders=function(n){return t.defaultHeaders=n,e.defaultHeaders=t.defaultHeaders,this},e.defaultHeaders=t.defaultHeaders,t.methodOverriders=t.methodOverriders||[],e.setMethodOverriders=function(e){var n=_.extend([],e);return t.isOverridenMethod("delete",n)&&n.push("remove"),t.methodOverriders=n,this},t.isOverridenMethod=function(e,n){var r=n||t.methodOverriders;return!_.isUndefined(_.find(r,function(t){return t.toLowerCase()===e.toLowerCase()}))},t.urlCreator=t.urlCreator||"path",e.setUrlCreator=function(e){if(!_.has(t.urlCreatorFactory,e))throw new Error("URL Path selected isn't valid");return t.urlCreator=e,this},t.restangularFields=t.restangularFields||{id:"id",route:"route",parentResource:"parentResource",restangularCollection:"restangularCollection",cannonicalId:"__cannonicalId",etag:"restangularEtag",selfLink:"href",get:"get",getList:"getList",put:"put",post:"post",remove:"remove",head:"head",trace:"trace",options:"options",patch:"patch",getRestangularUrl:"getRestangularUrl",getRequestedUrl:"getRequestedUrl",putElement:"putElement",addRestangularMethod:"addRestangularMethod",getParentList:"getParentList",clone:"clone",ids:"ids",httpConfig:"_$httpConfig",reqParams:"reqParams",one:"one",all:"all",several:"several",oneUrl:"oneUrl",allUrl:"allUrl",customPUT:"customPUT",customPOST:"customPOST",customDELETE:"customDELETE",customGET:"customGET",doPUT:"doPUT",doPOST:"doPOST",doDELETE:"doDELETE",doGET:"doGET"},e.setRestangularFields=function(e){return t.restangularFields=_.extend(t.restangularFields,e),this},t.isRestangularized=function(e){return!!e[t.restangularFields.one]||!!e[t.restangularFields.all]},t.setFieldToElem=function(e,t,n){var r=e.split("."),i=t;return _.each(_.initial(r),function(e){i[e]={},i=i[e]}),i[_.last(r)]=n,this},t.getFieldFromElem=function(e,t){var n=e.split("."),r=angular.copy(t);return _.each(n,function(e){r&&(r=r[e])}),r},t.setIdToElem=function(e,n){return t.setFieldToElem(t.restangularFields.id,e,n),this},t.getIdFromElem=function(e){return t.getFieldFromElem(t.restangularFields.id,e)},t.isValidId=function(e){return""!==e&&!_.isUndefined(e)&&!_.isNull(e)},t.setUrlToElem=function(e,n){return t.setFieldToElem(t.restangularFields.selfLink,e,n),this},t.getUrlFromElem=function(e){return t.getFieldFromElem(t.restangularFields.selfLink,e)},t.useCannonicalId=_.isUndefined(t.useCannonicalId)?!1:t.useCannonicalId,e.setUseCannonicalId=function(e){return t.useCannonicalId=e,this},t.getCannonicalIdFromElem=function(e){var n=e[t.restangularFields.cannonicalId],r=t.isValidId(n)?n:t.getIdFromElem(e);return r},t.responseExtractor=t.responseExtractor||function(e){return e},e.setResponseExtractor=function(e){return t.responseExtractor=e,this},e.setResponseInterceptor=e.setResponseExtractor,t.fullRequestInterceptor=t.fullRequestInterceptor||function(e,t,n,r,i,s,o){return{element:e,headers:i,params:s,httpConfig:o}},e.setRequestInterceptor=function(e){return t.fullRequestInterceptor=function(t,n,r,i,s,o,u){return{headers:s,params:o,element:e(t,n,r,i),httpConfig:u}},this},e.setFullRequestInterceptor=function(e){return t.fullRequestInterceptor=e,this},t.errorInterceptor=t.errorInterceptor||function(){},e.setErrorInterceptor=function(e){return t.errorInterceptor=e,this},t.onBeforeElemRestangularized=t.onBeforeElemRestangularized||function(e){return e},e.setOnBeforeElemRestangularized=function(e){return t.onBeforeElemRestangularized=e,this},t.onElemRestangularized=t.onElemRestangularized||function(e){return e},e.setOnElemRestangularized=function(e){return t.onElemRestangularized=e,this},e.setListTypeIsArray=function(){},t.shouldSaveParent=t.shouldSaveParent||function(){return!0},e.setParentless=function(e){return _.isArray(e)?t.shouldSaveParent=function(t){return!_.contains(e,t)}:_.isBoolean(e)&&(t.shouldSaveParent=function(){return!e}),this},t.suffix=_.isUndefined(t.suffix)?null:t.suffix,e.setRequestSuffix=function(e){return t.suffix=e,this},t.transformers=t.transformers||{},e.addElementTransformer=function(e,n,r){var i=null,s=null;2===arguments.length?s=n:(s=r,i=n);var o=t.transformers[e];o||(o=t.transformers[e]=[]),o.push(function(e,t){return _.isNull(i)||e==i?s(t):t})},e.extendCollection=function(t,n){return e.addElementTransformer(t,!0,n)},e.extendModel=function(t,n){return e.addElementTransformer(t,!1,n)},t.transformElem=function(e,n,r,i){var s=t.transformers[r],o=e;return s&&_.each(s,function(e){o=e(n,o)}),t.onElemRestangularized(o,n,r,i)},t.fullResponse=_.isUndefined(t.fullResponse)?!1:t.fullResponse,e.setFullResponse=function(e){return t.fullResponse=e,this},t.urlCreatorFactory={};var s=function(){};s.prototype.setConfig=function(e){return this.config=e,this},s.prototype.parentsArray=function(e){for(var t=[];e;)t.push(e),e=e[this.config.restangularFields.parentResource];return t.reverse()},s.prototype.resource=function(e,r,i,s,o,u,a,f){var l=_.defaults(o||{},this.config.defaultRequestParams.common),h=_.defaults(s||{},this.config.defaultHeaders);a&&(t.isSafe(f)?h["If-None-Match"]=a:h["If-Match"]=a);var p=this.base(e);if(u){var d="";/\/$/.test(p)||(d+="/"),d+=u,p+=d}return this.config.suffix&&-1===p.indexOf(this.config.suffix,p.length-this.config.suffix.length)&&!this.config.getUrlFromElem(e)&&(p+=this.config.suffix),e[this.config.restangularFields.httpConfig]=void 0,n(this.config,r,p,{getList:this.config.withHttpValues(i,{method:"GET",params:l,headers:h}),get:this.config.withHttpValues(i,{method:"GET",params:l,headers:h}),put:this.config.withHttpValues(i,{method:"PUT",params:l,headers:h}),post:this.config.withHttpValues(i,{method:"POST",params:l,headers:h}),remove:this.config.withHttpValues(i,{method:"DELETE",params:l,headers:h}),head:this.config.withHttpValues(i,{method:"HEAD",params:l,headers:h}),trace:this.config.withHttpValues(i,{method:"TRACE",params:l,headers:h}),options:this.config.withHttpValues(i,{method:"OPTIONS",params:l,headers:h}),patch:this.config.withHttpValues(i,{method:"PATCH",params:l,headers:h})})};var o=function(){};o.prototype=new s,o.prototype.base=function(e){var n=this;return _.reduce(this.parentsArray(e),function(e,r){var i,s=n.config.getUrlFromElem(r);if(s){if(n.config.isAbsoluteUrl(s))return s;i=s}else if(i=r[n.config.restangularFields.route],r[n.config.restangularFields.restangularCollection]){var o=r[n.config.restangularFields.ids];o&&(i+="/"+o.join(","))}else{var u;u=n.config.useCannonicalId?n.config.getCannonicalIdFromElem(r):n.config.getIdFromElem(r),t.isValidId(u)&&(i+="/"+(n.config.encodeIds?encodeURIComponent(u):u))}return e+"/"+i},this.config.baseUrl)},o.prototype.fetchUrl=function(e,t){var n=this.base(e);return t&&(n+="/"+t),n},o.prototype.fetchRequestedUrl=function(e,n){function r(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort()}function i(e,t,n){for(var i=r(e),s=0;s<i.length;s++)t.call(n,e[i[s]],i[s]);return i}function s(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}var o=this.fetchUrl(e,n),u=e[t.restangularFields.reqParams];if(!u)return o;var a=[];return i(u,function(e,t){null!=e&&void 0!=e&&(angular.isArray(e)||(e=[e]),angular.forEach(e,function(e){angular.isObject(e)&&(e=angular.toJson(e)),a.push(s(t)+"="+s(e))}))}),o+(-1===o.indexOf("?")?"?":"&")+a.join("&")},t.urlCreatorFactory.path=o};var t={};e.init(this,t),this.$get=["$http","$q",function(n,r){function i(t){function s(e,n,r,i){if(n[t.restangularFields.route]=r,n[t.restangularFields.getRestangularUrl]=_.bind(z.fetchUrl,z,n),n[t.restangularFields.getRequestedUrl]=_.bind(z.fetchRequestedUrl,z,n),n[t.restangularFields.addRestangularMethod]=_.bind(q,n),n[t.restangularFields.clone]=_.bind(w,n,n),n[t.restangularFields.reqParams]=_.isEmpty(i)?null:i,n.withHttpConfig=_.bind(L,n),n[t.restangularFields.one]=_.bind(o,n,n),n[t.restangularFields.all]=_.bind(u,n,n),n[t.restangularFields.several]=_.bind(f,n,n),n[t.restangularFields.oneUrl]=_.bind(l,n,n),n[t.restangularFields.allUrl]=_.bind(h,n,n),e&&t.shouldSaveParent(r)){var s=t.getIdFromElem(e),a=t.getUrlFromElem(e),c=_.union(_.values(_.pick(t.restangularFields,["route","parentResource"])),t.extraFields),p=_.pick(e,c);t.isValidId(s)&&t.setIdToElem(p,s),t.isValidId(a)&&t.setUrlToElem(p,a),n[t.restangularFields.parentResource]=p}else n[t.restangularFields.parentResource]=null;return n}function o(e,n,r){var i={};return t.setIdToElem(i,r),E(e,i,n)}function u(e,t){return S(e,[],t,!0)}function f(e,n){var r=[];return r[t.restangularFields.ids]=Array.prototype.splice.call(arguments,2),S(e,r,n,!0)}function l(e,n,r){var i={};return t.setUrlToElem(i,r),E(e,i,n)}function h(e,n,r){var i={};return t.setUrlToElem(i,r),S(e,i,n,!0)}function p(e,n,r){return e.call=_.bind(v,e),e.get=_.bind(m,e),e[t.restangularFields.restangularCollection]=n,n&&(e.push=_.bind(v,e,"push")),e.$object=r,e}function v(e){var n=r.defer(),i=arguments,s={};return this.then(function(t){var r=Array.prototype.slice.call(i,1),o=t[e];o.apply(t,r),s=t,n.resolve(t)}),p(n.promise,this[t.restangularFields.restangularCollection],s)}function m(e){var n=r.defer(),i={};return this.then(function(t){i=t[e],n.resolve(i)}),p(n.promise,this[t.restangularFields.restangularCollection],i)}function g(e,n,r,i){return _.extend(i,r),t.fullResponse?e.resolve(_.extend(n,{data:r})):(e.resolve(r),void 0)}function y(e){if(_.isArray(e)){var n=[];return _.each(e,function(e){n.push(y(e))}),n}return _.omit(e,_.values(_.omit(t.restangularFields,"id")))}function b(e){e.customOperation=_.bind(I,e),_.each(["put","post","get","delete"],function(t){_.each(["do","custom"],function(n){var r,i="delete"===t?"remove":t,s=n+t.toUpperCase();r="put"!==i&&"post"!==i?I:function(e,t,n,r,i){return _.bind(I,this)(e,n,r,i,t)},e[s]=_.bind(r,e,i)})}),e.customGETLIST=_.bind(k,e),e.doGETLIST=e.customGETLIST}function w(e){var n=angular.copy(e);return E(n[t.restangularFields.parentResource],n,n[t.restangularFields.route])}function E(e,n,r,i,o){var u=t.onBeforeElemRestangularized(n,!1,r),a=s(e,u,r,o);return t.useCannonicalId&&(a[t.restangularFields.cannonicalId]=t.getIdFromElem(a)),i&&(a[t.restangularFields.getParentList]=function(){return i}),a[t.restangularFields.restangularCollection]=!1,a[t.restangularFields.get]=_.bind(O,a),a[t.restangularFields.getList]=_.bind(k,a),a[t.restangularFields.put]=_.bind(D,a),a[t.restangularFields.post]=_.bind(P,a),a[t.restangularFields.remove]=_.bind(M,a),a[t.restangularFields.head]=_.bind(H,a),a[t.restangularFields.trace]=_.bind(B,a),a[t.restangularFields.options]=_.bind(j,a),a[t.restangularFields.patch]=_.bind(F,a),b(a),t.transformElem(a,!1,r,U)}function S(e,n,r,i){var o=t.onBeforeElemRestangularized(n,!0,r),u=s(e,o,r,i);return u[t.restangularFields.restangularCollection]=!0,u[t.restangularFields.post]=_.bind(P,u,null),u[t.restangularFields.remove]=_.bind(M,u),u[t.restangularFields.head]=_.bind(H,u),u[t.restangularFields.trace]=_.bind(B,u),u[t.restangularFields.putElement]=_.bind(N,u),u[t.restangularFields.options]=_.bind(j,u),u[t.restangularFields.patch]=_.bind(F,u),u[t.restangularFields.get]=_.bind(T,u),u[t.restangularFields.getList]=_.bind(k,u,null),b(u),t.transformElem(u,!0,r,U)}function x(e,t,n){var r=S(e,t,n);return _.each(r,function(t){E(e,t,n)}),r}function T(e,t,n){return this.customGET(e.toString(),t,n)}function N(e,t,n){var i=this,s=this[e],o=r.defer(),u=[];return s.put(t,n).then(function(t){var n=w(i);n[e]=t,u=n,o.resolve(n)},function(e){o.reject(e)}),p(o.promise,!0,u)}function C(e,n,r,i,s,o){var u=t.responseExtractor(e,n,r,i,s,o),a=s.headers("ETag");return u&&a&&(u[t.restangularFields.etag]=a),u}function k(e,i,s){var o=this,u=r.defer(),a="getList",f=z.fetchUrl(this,e),l=e||o[t.restangularFields.route],h=t.fullRequestInterceptor(null,a,l,f,s||{},i||{},this[t.restangularFields.httpConfig]||{}),v=[];return z.resource(this,n,h.httpConfig,h.headers,h.params,e,this[t.restangularFields.etag],a).getList().then(function(n){var r=n.data,i=n.config.params,s=C(r,a,l,f,n,u),c=_.map(s,function(n){return o[t.restangularFields.restangularCollection]?E(o[t.restangularFields.parentResource],n,o[t.restangularFields.route],s):E(o,n,e,s)});c=_.extend(s,c),o[t.restangularFields.restangularCollection]?g(u,n,S(o[t.restangularFields.parentResource],c,o[t.restangularFields.route],i),v):g(u,n,S(o,c,e,i),v)},function(e){t.errorInterceptor(e)!==!1&&u.reject(e)}),p(u.promise,!0,v)}function L(e){return this[t.restangularFields.httpConfig]=e,this}function A(e,i,s,o,u){var a=this,f=r.defer(),l=s||{},h=i||this[t.restangularFields.route],v=z.fetchUrl(this,i),m=o||this,b=m[t.restangularFields.etag];_.isObject(m)&&t.isRestangularized(m)&&(m=y(m));var w=t.fullRequestInterceptor(m,e,h,v,u||{},l||{},this[t.restangularFields.httpConfig]||{}),S={},x=function(n){var r=n.data,s=n.config.params,o=C(r,e,h,v,n,f);o?"post"!==e||a[t.restangularFields.restangularCollection]?g(f,n,E(a[t.restangularFields.parentResource],o,a[t.restangularFields.route],s),S):g(f,n,E(a,o,i,s),S):g(f,n,void 0,S)},T=function(e){t.errorInterceptor(e)!==!1&&f.reject(e)},N=e,k=_.extend({},w.headers),L=t.isOverridenMethod(e);return L&&(N="post",k=_.extend(k,{"X-HTTP-Method-Override":"remove"===e?"DELETE":e})),t.isSafe(e)?L?z.resource(this,n,w.httpConfig,k,w.params,i,b,N)[N]({}).then(x,T):z.resource(this,n,w.httpConfig,k,w.params,i,b,N)[N]().then(x,T):z.resource(this,n,w.httpConfig,k,w.params,i,b,N)[N](w.element).then(x,T),p(f.promise,!1,S)}function O(e,t){return _.bind(A,this)("get",void 0,e,void 0,t)}function M(e,t){return _.bind(A,this)("remove",void 0,e,void 0,t)}function D(e,t){return _.bind(A,this)("put",void 0,e,void 0,t)}function P(e,t,n,r){return _.bind(A,this)("post",e,n,t,r)}function H(e,t){return _.bind(A,this)("head",void 0,e,void 0,t)}function B(e,t){return _.bind(A,this)("trace",void 0,e,void 0,t)}function j(e,t){return _.bind(A,this)("options",void 0,e,void 0,t)}function F(e,t,n){return _.bind(A,this)("patch",void 0,t,e,n)}function I(e,t,n,r,i){return _.bind(A,this)(e,t,n,i,r)}function q(e,n,r,i,s,o){var u;u="getList"===n?_.bind(k,this,r):_.bind(I,this,n,r);var a=function(e,t,n){var r=_.defaults({params:e,headers:t,elem:n},{params:i,headers:s,elem:o});return u(r.params,r.headers,r.elem)};this[e]=t.isSafe(n)?a:function(e,t,n){return a(t,n,e)}}function R(n){var r=angular.copy(t);return e.init(r,r),n(r),i(r)}var U={},z=new t.urlCreatorFactory[t.urlCreator];return z.setConfig(t),e.init(U,t),U.copy=_.bind(w,U),U.withConfig=_.bind(R,U),U.one=_.bind(o,U,null),U.all=_.bind(u,U,null),U.several=_.bind(f,U,null),U.oneUrl=_.bind(l,U,null),U.allUrl=_.bind(h,U,null),U.stripRestangular=_.bind(y,U),U.restangularizeElement=_.bind(E,U),U.restangularizeCollection=_.bind(x,U),U}return i(t)}]})}();